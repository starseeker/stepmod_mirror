*** concatenated_mim.exp.orig	2011-07-27 10:31:33.000000000 -0500
--- concatenated_mim.exp	2011-07-27 10:34:36.000000000 -0500
***************
*** 45324,45364 ****
  SCHEMA product_property_representation_schema;
    REFERENCE FROM basic_attribute_schema (description_attribute, get_description_value, get_name_value, name_attribute);
    REFERENCE FROM material_property_definition_schema (property_definition_relationship);
    REFERENCE FROM product_definition_schema (product_definition, product_definition_relationship);
    REFERENCE FROM product_property_definition_schema (characterized_object, characterized_definition, general_property, product_definition_shape, property_definition, shape_aspect, shape_aspect_relationship);
    REFERENCE FROM representation_schema (representation, representation_item, representation_relationship, using_representations, mapped_item, representation_context, representation_map);
    REFERENCE FROM support_resource_schema (bag_to_set, label, text);
  
    TYPE chained_representation_link = SELECT (mapped_item, representation_context, representation_relationship);
    END_TYPE;
  
    TYPE represented_definition = SELECT (
      general_property, 
      property_definition, 
      property_definition_relationship, 
      shape_aspect, 
      shape_aspect_relationship);
    END_TYPE;
  
    TYPE item_identified_representation_usage_definition = EXTENSIBLE GENERIC_ENTITY SELECT (
!     represented_definition);
    END_TYPE;
  
    ENTITY chain_based_item_identified_representation_usage
      SUBTYPE OF (item_identified_representation_usage);
      nodes : LIST [2:?] OF UNIQUE representation;
      undirected_link : LIST [1:?] OF UNIQUE chained_representation_link;
    DERIVE
      root : representation := nodes[1];
      SELF\item_identified_representation_usage.used_representation RENAMED leaf : representation := nodes[HIINDEX(nodes)];
      directed_link : LIST [1:?] OF representation_relationship := get_directed_link(nodes, undirected_link);
    WHERE
      WR1 : root :=: directed_link[1]\representation_relationship.rep_1;
      WR2 : leaf :=: directed_link[HIINDEX(undirected_link)]\representation_relationship.rep_2;
      WR3 : SIZEOF(nodes) :=: SIZEOF(undirected_link) + 1;
      WR4 : (SIZEOF(QUERY(directed_link_element <* directed_link |(root :=:  directed_link_element\representation_relationship.rep_1))) +
             SIZEOF(QUERY(directed_link_element <* directed_link |(root :=:  directed_link_element\representation_relationship.rep_2)))) = 1;
      WR5 : (SIZEOF(QUERY(directed_link_element <* directed_link |(leaf :=:  directed_link_element\representation_relationship.rep_1))) +
             SIZEOF(QUERY(directed_link_element <* directed_link |(leaf :=:  directed_link_element\representation_relationship.rep_2)))) = 1;
      WR6 : (SIZEOF(QUERY(directed_link_element <* directed_link |(root :<>: directed_link_element\representation_relationship.rep_1))) +
             SIZEOF(QUERY(directed_link_element <* directed_link |(root :<>: directed_link_element\representation_relationship.rep_2))) + 
--- 45324,45368 ----
  SCHEMA product_property_representation_schema;
    REFERENCE FROM basic_attribute_schema (description_attribute, get_description_value, get_name_value, name_attribute);
    REFERENCE FROM material_property_definition_schema (property_definition_relationship);
    REFERENCE FROM product_definition_schema (product_definition, product_definition_relationship);
    REFERENCE FROM product_property_definition_schema (characterized_object, characterized_definition, general_property, product_definition_shape, property_definition, shape_aspect, shape_aspect_relationship);
    REFERENCE FROM representation_schema (representation, representation_item, representation_relationship, using_representations, mapped_item, representation_context, representation_map);
    REFERENCE FROM support_resource_schema (bag_to_set, label, text);
  
    TYPE chained_representation_link = SELECT (mapped_item, representation_context, representation_relationship);
    END_TYPE;
  
    TYPE represented_definition = SELECT (
      general_property, 
      property_definition, 
      property_definition_relationship, 
      shape_aspect, 
      shape_aspect_relationship);
    END_TYPE;
  
    TYPE item_identified_representation_usage_definition = EXTENSIBLE GENERIC_ENTITY SELECT (
!     general_property, 
!     property_definition, 
!     property_definition_relationship, 
!     shape_aspect, 
!     shape_aspect_relationship);
    END_TYPE;
  
    ENTITY chain_based_item_identified_representation_usage
      SUBTYPE OF (item_identified_representation_usage);
      nodes : LIST [2:?] OF UNIQUE representation;
      undirected_link : LIST [1:?] OF UNIQUE chained_representation_link;
    DERIVE
      root : representation := nodes[1];
      SELF\item_identified_representation_usage.used_representation RENAMED leaf : representation := nodes[HIINDEX(nodes)];
      directed_link : LIST [1:?] OF representation_relationship := get_directed_link(nodes, undirected_link);
    WHERE
      WR1 : root :=: directed_link[1]\representation_relationship.rep_1;
      WR2 : leaf :=: directed_link[HIINDEX(undirected_link)]\representation_relationship.rep_2;
      WR3 : SIZEOF(nodes) :=: SIZEOF(undirected_link) + 1;
      WR4 : (SIZEOF(QUERY(directed_link_element <* directed_link |(root :=:  directed_link_element\representation_relationship.rep_1))) +
             SIZEOF(QUERY(directed_link_element <* directed_link |(root :=:  directed_link_element\representation_relationship.rep_2)))) = 1;
      WR5 : (SIZEOF(QUERY(directed_link_element <* directed_link |(leaf :=:  directed_link_element\representation_relationship.rep_1))) +
             SIZEOF(QUERY(directed_link_element <* directed_link |(leaf :=:  directed_link_element\representation_relationship.rep_2)))) = 1;
      WR6 : (SIZEOF(QUERY(directed_link_element <* directed_link |(root :<>: directed_link_element\representation_relationship.rep_1))) +
             SIZEOF(QUERY(directed_link_element <* directed_link |(root :<>: directed_link_element\representation_relationship.rep_2))) + 
