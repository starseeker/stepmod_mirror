<?xml version="1.0"?>
<!-- $Id: mim_lf.xml,v 1.2 2002/01/16 14:45:43 robbod Exp $ -->
<?xml-stylesheet type="text/xsl" href="../../../xsl/express.xsl"?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">
<express
  language_version="2"
  rcs.date="$Date: 2002/01/16 14:45:43 $"
  rcs.revision="$Revision: 1.2 $">

  <application
    name="express2xml.js"
    owner="Eurostep Limited"
    url="http://www.eurostep.com"
    version="1.6"
    source="../data/modules/approval/mim_lf.exp"/>

  <schema name="approval_mim">
    <type name="ahead_or_behind">
      <enumeration
        items="ahead exact behind">
      </enumeration>


    </type>
    <type name="approval_item">
      <select
        extensible="YES">
      </select>

    </type>
    <type name="attribute_type">
      <select
        selectitems="label text">
      </select>

    </type>
    <type name="date_time_or_event_occurrence">
      <select
        selectitems="date_time_select">
      </select>

    </type>
    <type name="date_time_select">
      <select
        selectitems="date local_time date_and_time">
      </select>

    </type>
    <type name="day_in_month_number">
      <builtintype
        type="INTEGER">
      </builtintype>


      <where
        label="WHERE"
        expression="((1 &lt;= SELF) AND (SELF &lt;= 31))">
      </where>
    </type>
    <type name="description_attribute_select">
      <select
        selectitems="approval_role person_and_organization">
      </select>

    </type>
    <type name="hour_in_day">
      <builtintype
        type="INTEGER">
      </builtintype>


      <where
        label="WHERE"
        expression="((0 &lt;= SELF) AND (SELF &lt; 24))">
      </where>
    </type>
    <type name="identifier">
      <builtintype
        type="STRING">
      </builtintype>


    </type>
    <type name="label">
      <builtintype
        type="STRING">
      </builtintype>


    </type>
    <type name="minute_in_hour">
      <builtintype
        type="INTEGER">
      </builtintype>


      <where
        label="WHERE"
        expression="((0 &lt;= SELF) AND (SELF &lt;= 59))">
      </where>
    </type>
    <type name="month_in_year_number">
      <builtintype
        type="INTEGER">
      </builtintype>


      <where
        label="WHERE"
        expression="((1 &lt;= SELF) AND (SELF &lt;= 12))">
      </where>
    </type>
    <type name="name_attribute_select">
      <select
        selectitems="person_and_organization">
      </select>

    </type>
    <type name="person_organization_select">
      <select
        selectitems="person organization person_and_organization">
      </select>

    </type>
    <type name="role_select">
      <select
        selectitems="approval_assignment approval_date_time">
      </select>

    </type>
    <type name="second_in_minute">
      <builtintype
        type="REAL">
      </builtintype>


      <where
        label="WHERE"
        expression="((0 &lt;= SELF) AND (SELF &lt;= 60))">
      </where>
    </type>
    <type name="text">
      <builtintype
        type="STRING">
      </builtintype>


    </type>
    <type name="year_number">
      <builtintype
        type="INTEGER">
      </builtintype>


    </type>
    <entity
      name="address">
      <explicit
        name="internal_location"
        optional="YES">
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="street_number"
        optional="YES">
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="street"
        optional="YES">
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="postal_box"
        optional="YES">
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="town"
        optional="YES">
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="region"
        optional="YES">
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="postal_code"
        optional="YES">
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="country"
        optional="YES">
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="facsimile_number"
        optional="YES">
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="telephone_number"
        optional="YES">
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="electronic_mail_address"
        optional="YES">
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="telex_number"
        optional="YES">
        <typename
          name="label"/>
      </explicit>
      <where
        label="wr1"
        expression="(EXISTS(internal_location) OR EXISTS(street_number) OR EXISTS(               street) OR EXISTS(postal_box) OR EXISTS(town) OR EXISTS(               region) OR EXISTS(postal_code) OR EXISTS(country) OR EXISTS(               facsimile_number) OR EXISTS(telephone_number) OR EXISTS(               electronic_mail_address) OR EXISTS(telex_number))">
      </where>
    </entity>

    <entity
      name="applied_approval_assignment"
      supertypes="approval_assignment">
      <explicit
        name="items">
        <aggregate
          type="SET"
          lower="1"
          upper="?"/>
        <typename
          name="approval_item"/>
      </explicit>
    </entity>

    <entity
      name="approval">
      <explicit
        name="status">
        <typename
          name="approval_status"/>
      </explicit>
      <explicit
        name="level">
        <typename
          name="label"/>
      </explicit>
    </entity>

    <entity
      name="approval_assignment"
      abstract.supertype="YES">
      <explicit
        name="assigned_approval">
        <typename
          name="approval"/>
      </explicit>
      <derived
        name="role"
        expression="get_role(SELF)">
        <typename
          name="object_role "/>
      </derived>
      <where
        label="wr1"
        expression="(SIZEOF(USEDIN(SELF,'APPROVAL_MIM.' +                'ROLE_ASSOCIATION.ITEM_WITH_ROLE')) &lt;= 1)">
      </where>
    </entity>

    <entity
      name="approval_date_time">
      <explicit
        name="date_time">
        <typename
          name="date_time_select"/>
      </explicit>
      <explicit
        name="dated_approval">
        <typename
          name="approval"/>
      </explicit>
      <derived
        name="role"
        expression="get_role(SELF)">
        <typename
          name="object_role "/>
      </derived>
      <where
        label="wr1"
        expression="(SIZEOF(USEDIN(SELF,'APPROVAL_MIM.' +                'ROLE_ASSOCIATION.ITEM_WITH_ROLE')) &lt;= 1)">
      </where>
    </entity>

    <entity
      name="approval_person_organization">
      <explicit
        name="person_organization">
        <typename
          name="person_organization_select"/>
      </explicit>
      <explicit
        name="authorized_approval">
        <typename
          name="approval"/>
      </explicit>
      <explicit
        name="role">
        <typename
          name="approval_role"/>
      </explicit>
    </entity>

    <entity
      name="approval_relationship">
      <explicit
        name="name">
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="description"
        optional="YES">
        <typename
          name="text"/>
      </explicit>
      <explicit
        name="relating_approval">
        <typename
          name="approval"/>
      </explicit>
      <explicit
        name="related_approval">
        <typename
          name="approval"/>
      </explicit>
    </entity>

    <entity
      name="approval_role">
      <explicit
        name="role">
        <typename
          name="label"/>
      </explicit>
      <derived
        name="description"
        expression="get_description_value(SELF)">
        <typename
          name="text "/>
      </derived>
      <where
        label="wr1"
        expression="(SIZEOF(USEDIN(SELF,'APPROVAL_MIM.' +                'DESCRIPTION_ATTRIBUTE.DESCRIBED_ITEM')) &lt;= 1)">
      </where>
    </entity>

    <entity
      name="approval_status">
      <explicit
        name="name">
        <typename
          name="label"/>
      </explicit>
    </entity>

    <entity
      name="calendar_date"
      supertypes="date">
      <explicit
        name="day_component">
        <typename
          name="day_in_month_number"/>
      </explicit>
      <explicit
        name="month_component">
        <typename
          name="month_in_year_number"/>
      </explicit>
      <where
        label="wr1"
        expression="valid_calendar_date(SELF)">
      </where>
    </entity>

    <entity
      name="coordinated_universal_time_offset">
      <explicit
        name="hour_offset">
        <builtintype
          type="INTEGER"/>
      </explicit>
      <explicit
        name="minute_offset"
        optional="YES">
        <builtintype
          type="INTEGER"/>
      </explicit>
      <explicit
        name="sense">
        <typename
          name="ahead_or_behind"/>
      </explicit>
      <where
        label="wr1"
        expression="((0 &lt;= hour_offset) AND (hour_offset &lt;= 12))">
      </where>
      <where
        label="wr2"
        expression="((0 &lt;= minute_offset) AND (minute_offset &lt;= 59))">
      </where>
      <where
        label="wr3"
        expression="(NOT ((hour_offset &lt;&gt; 0) AND (sense = exact)))">
      </where>
    </entity>

    <entity
      name="date"
      super.expression="(calendar_date)">
      <explicit
        name="year_component">
        <typename
          name="year_number"/>
      </explicit>
    </entity>

    <entity
      name="date_and_time">
      <explicit
        name="date_component">
        <typename
          name="date"/>
      </explicit>
      <explicit
        name="time_component">
        <typename
          name="local_time"/>
      </explicit>
    </entity>

    <entity
      name="description_attribute">
      <explicit
        name="attribute_value">
        <typename
          name="text"/>
      </explicit>
      <explicit
        name="described_item">
        <typename
          name="description_attribute_select"/>
      </explicit>
    </entity>

    <entity
      name="local_time">
      <explicit
        name="hour_component">
        <typename
          name="hour_in_day"/>
      </explicit>
      <explicit
        name="minute_component"
        optional="YES">
        <typename
          name="minute_in_hour"/>
      </explicit>
      <explicit
        name="second_component"
        optional="YES">
        <typename
          name="second_in_minute"/>
      </explicit>
      <explicit
        name="zone">
        <typename
          name="coordinated_universal_time_offset"/>
      </explicit>
      <where
        label="wr1"
        expression="valid_time(SELF)">
      </where>
    </entity>

    <entity
      name="name_attribute">
      <explicit
        name="attribute_value">
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="named_item">
        <typename
          name="name_attribute_select"/>
      </explicit>
    </entity>

    <entity
      name="object_role">
      <explicit
        name="name">
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="description"
        optional="YES">
        <typename
          name="text"/>
      </explicit>
    </entity>

    <entity
      name="organization">
      <explicit
        name="id"
        optional="YES">
        <typename
          name="identifier"/>
      </explicit>
      <explicit
        name="name">
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="description"
        optional="YES">
        <typename
          name="text"/>
      </explicit>
    </entity>

    <entity
      name="organizational_address"
      supertypes="address">
      <explicit
        name="organizations">
        <aggregate
          type="SET"
          lower="1"
          upper="?"/>
        <typename
          name="organization"/>
      </explicit>
      <explicit
        name="description"
        optional="YES">
        <typename
          name="text"/>
      </explicit>
    </entity>

    <entity
      name="person">
      <explicit
        name="id">
        <typename
          name="identifier"/>
      </explicit>
      <explicit
        name="last_name"
        optional="YES">
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="first_name"
        optional="YES">
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="middle_names"
        optional="YES">
        <aggregate
          type="LIST"
          lower="1"
          upper="?"/>
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="prefix_titles"
        optional="YES">
        <aggregate
          type="LIST"
          lower="1"
          upper="?"/>
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="suffix_titles"
        optional="YES">
        <aggregate
          type="LIST"
          lower="1"
          upper="?"/>
        <typename
          name="label"/>
      </explicit>
      <where
        label="wr1"
        expression="(EXISTS(last_name) OR EXISTS(first_name))">
      </where>
    </entity>

    <entity
      name="person_and_organization">
      <explicit
        name="the_person">
        <typename
          name="person"/>
      </explicit>
      <explicit
        name="the_organization">
        <typename
          name="organization"/>
      </explicit>
      <derived
        name="name"
        expression="get_name_value(SELF)">
        <typename
          name="label "/>
      </derived>
      <derived
        name="description"
        expression="get_description_value(SELF)">
        <typename
          name="text "/>
      </derived>
      <where
        label="wr1"
        expression="(SIZEOF(USEDIN(SELF,'APPROVAL_MIM.' +                'NAME_ATTRIBUTE.NAMED_ITEM')) &lt;= 1)">
      </where>
      <where
        label="wr2"
        expression="(SIZEOF(USEDIN(SELF,'APPROVAL_MIM.' +                'DESCRIPTION_ATTRIBUTE.DESCRIBED_ITEM')) &lt;= 1)">
      </where>
    </entity>

    <entity
      name="personal_address"
      supertypes="address">
      <explicit
        name="people">
        <aggregate
          type="SET"
          lower="1"
          upper="?"/>
        <typename
          name="person"/>
      </explicit>
      <explicit
        name="description"
        optional="YES">
        <typename
          name="text"/>
      </explicit>
    </entity>

    <entity
      name="role_association">
      <explicit
        name="role">
        <typename
          name="object_role"/>
      </explicit>
      <explicit
        name="item_with_role">
        <typename
          name="role_select"/>
      </explicit>
    </entity>

    <function
      name="get_description_value">
      <typename
        name="text"/>
      <parameter
        name="obj">
        <typename
          name="description_attribute_select"/>
      </parameter>
      <algorithm>

    LOCAL
      description_bag : BAG OF description_attribute := USEDIN(obj,
                         'APPROVAL_MIM.' + 'DESCRIPTION_ATTRIBUTE.' + 
                         'DESCRIBED_ITEM');
    END_LOCAL;
    IF SIZEOF(description_bag) = 1 THEN
      RETURN(description_bag[1].attribute_value);
    ELSE
      RETURN(?);
    END_IF;

      </algorithm>

    </function>

    <function
      name="get_name_value">
      <typename
        name="label"/>
      <parameter
        name="obj">
        <typename
          name="name_attribute_select"/>
      </parameter>
      <algorithm>

    LOCAL
      name_bag : BAG OF name_attribute := USEDIN(obj,'APPROVAL_MIM.' + 
                  'NAME_ATTRIBUTE.' + 'NAMED_ITEM');
    END_LOCAL;
    IF SIZEOF(name_bag) = 1 THEN
      RETURN(name_bag[1].attribute_value);
    ELSE
      RETURN(?);
    END_IF;

      </algorithm>

    </function>

    <function
      name="get_role">
      <typename
        name="object_role"/>
      <parameter
        name="obj">
        <typename
          name="role_select"/>
      </parameter>
      <algorithm>

    LOCAL
      role_bag : BAG OF role_association := USEDIN(obj,'APPROVAL_MIM.' + 
                  'ROLE_ASSOCIATION.' + 'ITEM_WITH_ROLE');
    END_LOCAL;
    IF SIZEOF(role_bag) = 1 THEN
      RETURN(role_bag[1].role);
    ELSE
      RETURN(?);
    END_IF;

      </algorithm>

    </function>

    <function
      name="leap_year">
      <builtintype
        type="BOOLEAN"/>
      <parameter
        name="year">
        <typename
          name="year_number"/>
      </parameter>
      <algorithm>
    IF (((year MOD 4) = 0) AND ((year MOD 100) &lt;&gt; 0)) OR ((year MOD 400) =
         0) THEN
      RETURN(TRUE);
    ELSE
      RETURN(FALSE);
    END_IF;

      </algorithm>

    </function>

    <function
      name="valid_calendar_date">
      <builtintype
        type="LOGICAL"/>
      <parameter
        name="date">
        <typename
          name="calendar_date"/>
      </parameter>
      <algorithm>
    CASE date.month_component OF
      1 :         RETURN((1 &lt;= date.day_component) AND (date.day_component 
            &lt;= 31));
      2 :         BEGIN
          IF leap_year(date.year_component) THEN
            RETURN((1 &lt;= date.day_component) AND (date.day_component &lt;= 29));
          ELSE
            RETURN((1 &lt;= date.day_component) AND (date.day_component &lt;= 28));
          END_IF;
        END;
      3 :         RETURN((1 &lt;= date.day_component) AND (date.day_component 
            &lt;= 31));
      4 :         RETURN((1 &lt;= date.day_component) AND (date.day_component 
            &lt;= 30));
      5 :         RETURN((1 &lt;= date.day_component) AND (date.day_component 
            &lt;= 31));
      6 :         RETURN((1 &lt;= date.day_component) AND (date.day_component 
            &lt;= 30));
      7 :         RETURN((1 &lt;= date.day_component) AND (date.day_component 
            &lt;= 31));
      8 :         RETURN((1 &lt;= date.day_component) AND (date.day_component 
            &lt;= 31));
      9 :         RETURN((1 &lt;= date.day_component) AND (date.day_component 
            &lt;= 30));
      10  :         RETURN((1 &lt;= date.day_component) AND (date.
            day_component &lt;= 31));
      11  :         RETURN((1 &lt;= date.day_component) AND (date.
            day_component &lt;= 30));
      12  :         RETURN((1 &lt;= date.day_component) AND (date.
            day_component &lt;= 31));
      END_CASE;
    RETURN(FALSE);

      </algorithm>

    </function>

    <function
      name="valid_time">
      <builtintype
        type="BOOLEAN"/>
      <parameter
        name="time">
        <typename
          name="local_time"/>
      </parameter>
      <algorithm>
    IF EXISTS(time.second_component) THEN
      RETURN(EXISTS(time.minute_component));
    ELSE
      RETURN(TRUE);
    END_IF;

      </algorithm>

    </function>

  </schema>

</express>
