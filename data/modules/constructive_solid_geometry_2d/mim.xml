<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<?xml-stylesheet type="text/xsl" href="../../../xsl/express.xsl"?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">

<express description.file="mim_descriptions.xml" language_version="2" rcs.date="$Date$" rcs.revision="$Revision$" reference="ISO/TS 10303-1731">
   <application name="JSDAI" owner="LKSoft" source="constructive_solid_geometry_2d_mim schema_instance" url="www.lksoft.com" version="4.0 beta"/>
   <schema name="Constructive_solid_geometry_2d_mim">
      <interface kind="use" schema="Area_2d_mim"/>
      <interface kind="use" schema="Basic_curve_mim"/>
      <interface kind="use" schema="representation_schema">
         <interfaced.item name="compound_representation_item"/>
         <interfaced.item name="mapped_item"/>
      </interface>
      <interface kind="use" schema="geometric_model_schema">
         <interfaced.item name="boolean_result"/>
         <interfaced.item name="csg_solid"/>
         <interfaced.item name="half_space_2d"/>
         <interfaced.item name="area_with_outer_boundary"/>
      </interface>
      <interface kind="use" schema="geometry_schema">
         <interfaced.item name="composite_curve"/>
      </interface>
      <type name="boolean_operand_2d">
         <select extensible="NO" genericentity="NO" selectitems="primitive_2d boolean_result_2d"/>
      </type>
      <type name="compound_inner_area_boundary">
         <select extensible="NO" genericentity="NO" selectitems="set_inner_area_boundary"/>
      </type>
      <type name="csg_2d_area_select">
         <select extensible="NO" genericentity="NO" selectitems="axis2_placement_2d csg_primitive_solid_2d"/>
      </type>
      <type name="csg_2d_shape_select">
         <select extensible="NO" genericentity="NO" selectitems="mapped_item axis2_placement_2d csg_solid_2d"/>
      </type>
      <type name="csg_select_2d">
         <select extensible="NO" genericentity="NO" selectitems="primitive_2d boolean_result_2d"/>
      </type>
      <type name="set_inner_area_boundary">
         <aggregate lower="1" optional="NO" type="SET" unique="NO" upper="?"/>
         <typename name="primitive_2d"/>
      </type>
      <entity abstract.entity="NO" abstract.supertype="NO" name="boolean_result_2d" supertypes="boolean_result">
         <explicit name="first_operand" optional="NO">
            <typename name="boolean_operand_2d"/>
            <redeclaration entity-ref="boolean_result"/>
         </explicit>
         <explicit name="second_operand" optional="NO">
            <typename name="boolean_operand_2d"/>
            <redeclaration entity-ref="boolean_result"/>
         </explicit>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="closed_curve_style_parameters" supertypes="curve_style_parameters_representation"/>
      <entity abstract.entity="NO" abstract.supertype="YES" name="complex_area" super.expression="path_area_with_parameters ANDOR primitive_2d_with_inner_boundary" supertypes="primitive_2d"/>
      <entity abstract.entity="NO" abstract.supertype="NO" name="csg_2d_shape_representation" supertypes="shape_representation">
         <explicit name="items" optional="NO">
            <aggregate lower="1" optional="NO" type="SET" unique="NO" upper="?"/>
            <typename name="csg_2d_shape_select"/>
            <redeclaration entity-ref="representation"/>
         </explicit>
         <where expression="SELF.context_of_items\geometric_representation_context.coordinate_space_dimension = 2" label="WR1"/>
         <where expression="SIZEOF(QUERY ( it &lt;* SELF.items | &#10;       (SIZEOF(['CONSTRUCTIVE_SOLID_GEOMETRY_2D_MIM.CSG_SOLID']&#10;  &#9;   * TYPEOF(it)) = 1) &#10;  &#9;   OR &#10;&#9;   (('CONSTRUCTIVE_SOLID_GEOMETRY_2D_MIM.MAPPED_ITEM' &#10;&#9;   IN TYPEOF(it)) AND&#10;&#9;   ('CONSTRUCTIVE_SOLID_GEOMETRY_2D_MIM.' +&#10;&#9;   'CSG_2D_SHAPE_REPRESENTATION' &#10;&#9;   IN TYPEOF(it\mapped_item.mapping_source.mapped_representation))) &#10;       )) &gt;= 1" label="WR2"/>
         <where expression="SIZEOF(QUERY ( it &lt;* SELF.items | &#10;       (('CONSTRUCTIVE_SOLID_GEOMETRY_2D_MIM.MAPPED_ITEM' &#10;       IN TYPEOF(it)) AND (NOT (( &#10;       'CONSTRUCTIVE_SOLID_GEOMETRY_2D_MIM.' +&#10;       'CSG_2D_SHAPE_REPRESENTATION') &#10;       IN TYPEOF(it\mapped_item.mapping_source.mapped_representation)))) )) = 0" label="WR3"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="csg_primitive_solid_2d" supertypes="csg_solid_2d">
         <explicit name="tree_root_expression" optional="NO">
            <typename name="primitive_2d"/>
            <redeclaration entity-ref="csg_solid"/>
         </explicit>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="csg_solid_2d" supertypes="csg_solid">
         <explicit name="tree_root_expression" optional="NO">
            <typename name="csg_select_2d"/>
            <redeclaration entity-ref="csg_solid"/>
         </explicit>
         <where expression="valid_csg_2d_primitives(SELF)" label="WR1"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="curve_style_parameters_representation" supertypes="representation"/>
      <entity abstract.entity="NO" abstract.supertype="NO" name="curve_style_parameters_with_ends" supertypes="curve_style_parameters_representation"/>
      <entity abstract.entity="NO" abstract.supertype="NO" name="path_area_with_parameters" supertypes="complex_area mapped_item">
         <where expression="'GEOMETRY_SCHEMA.CURVE' IN TYPEOF(SELF\mapped_item.mapping_target)" label="WR1"/>
         <where expression="'CONSTRUCTIVE_SOLID_GEOMETRY_2D_MIM.CURVE_STYLE_PARAMETERS_REPRESENTATION' IN TYPEOF(SELF\mapped_item.mapping_source\representation_map.mapped_representation)" label="WR2"/>
         <where expression="SELF\mapped_item.mapping_source\representation_map.mapping_origin\representation_item.name = 'curve width'" label="WR3"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="primitive_2d_with_inner_boundary" supertypes="complex_area compound_representation_item">
         <explicit name="inner_boundary" optional="NO">
            <typename name="compound_inner_area_boundary"/>
            <redeclaration entity-ref="compound_representation_item" old_name="item_element"/>
         </explicit>
         <where expression="SIZEOF(['GEOMETRIC_MODEL_SCHEMA.CIRCULAR_AREA', 'GEOMETRIC_MODEL_SCHEMA.ELLIPTIC_AREA', 'GEOMETRIC_MODEL_SCHEMA.RECTANGULAR_AREA',&#10;        'GEOMETRIC_MODEL_SCHEMA.POLYGONAL_AREA', 'CONSTRUCTIVE_SOLID_GEOMETRY_2D_MIM.COMPLEX_AREA'] * TYPEOF(SELF)) &gt; 0" label="WR1"/>
         <where expression="SIZEOF(QUERY(inner &lt;* inner_boundary |&#10;        'CONSTRUCTIVE_SOLID_GEOMETRY_2D_MIM.PRIMITIVE_2D_WITH_INNER_BOUNDARY' IN TYPEOF(inner))) = 0" label="WR2"/>
         <where expression="open_path_based_inner_boundary(inner_boundary)" label="WR3"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="single_area_csg_2d_shape_representation" supertypes="csg_2d_shape_representation">
         <explicit name="items" optional="NO">
            <aggregate lower="1" optional="NO" type="SET" unique="NO" upper="?"/>
            <typename name="csg_2d_area_select"/>
            <redeclaration entity-ref="representation"/>
         </explicit>
         <where expression="SIZEOF (QUERY (it &lt;* SELF.items| &#10;     ('CONSTRUCTIVE_SOLID_GEOMETRY_2D_MIM.MAPPED_ITEM' &#10;     IN TYPEOF(it)) )) = 0" label="WR1"/>
         <where expression="SIZEOF (QUERY (it &lt;* SELF.items| &#10;     ('CONSTRUCTIVE_SOLID_GEOMETRY_2D_MIM.CSG_SOLID_2D' &#10;     IN TYPEOF(it)) )) = 1" label="WR2"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="single_boundary_csg_2d_shape_representation" supertypes="single_area_csg_2d_shape_representation">
         <where expression="SIZEOF(QUERY ( it &lt;* SELF.items |&#10;        (('CONSTRUCTIVE_SOLID_GEOMETRY_2D_MIM.CSG_PRIMITIVE_SOLID_2D' IN TYPEOF(it))&#10;        AND (('CONSTRUCTIVE_SOLID_GEOMETRY_2D_MIM.PRIMITIVE_2D_WITH_INNER_BOUNDARY') IN&#10;        TYPEOF(it\csg_primitive_solid_2d.tree_root_expression))) )) = 0" label="WR1"/>
      </entity>
      <function name="open_path_based_inner_boundary">
         <parameter name="input">
            <aggregate lower="0" optional="NO" type="SET" unique="NO" upper="?"/>
            <typename name="primitive_2d"/>
         </parameter>
         <builtintype fixed="NO" type="BOOLEAN"/>
         <algorithm>LOCAL
   pass : BOOLEAN := TRUE;
  END_LOCAL;
  REPEAT i := 1 TO SIZEOF(input);
      IF ('CONSTRUCTIVE_SOLID_GEOMETRY_2D_MIM.PATH_AREA_WITH_PARAMETERS' IN TYPEOF(input[i]))
        AND ( 
         ('GEOMETRY_SCHEMA.CIRCLE' IN TYPEOF(input[i]\mapped_item.mapping_source\representation_map.mapping_origin))
          OR
          (('GEOMETRY_SCHEMA.COMPOSITE_CURVE' IN TYPEOF(input[i]\mapped_item.mapping_source\representation_map.mapping_origin))
           AND
            (input[i]\mapped_item.mapping_source\representation_map.mapping_origin\composite_curve.closed_curve = TRUE) 
          )
        )  
      THEN
       pass := FALSE;
      END_IF;
  END_REPEAT;
  RETURN(pass);</algorithm>
      </function>
      <function name="valid_csg_2d_primitives">
         <parameter name="input">
            <typename name="csg_solid_2d"/>
         </parameter>
         <builtintype fixed="NO" type="BOOLEAN"/>
         <algorithm>CASE TRUE OF
  ('GEOMETRIC_MODEL_SCHEMA.PRIMITIVE_2D' IN TYPEOF(input\csg_solid_2d.tree_root_expression)) :
  BEGIN
    IF (SIZEOF(['GEOMETRIC_MODEL_SCHEMA.CIRCULAR_AREA', 
       'CONSTRUCTIVE_SOLID_GEOMETRY_2D_MIM.COMPLEX_AREA',
       'GEOMETRIC_MODEL_SCHEMA.ELLIPTIC_AREA',
       'GEOMETRIC_MODEL_SCHEMA.POLYGONAL_AREA',
       'CONSTRUCTIVE_SOLID_GEOMETRY_2D_MIM.PRIMITIVE_2D_WITH_INNER_BOUNDARY',
       'GEOMETRIC_MODEL_SCHEMA.RECTANGULAR_AREA'] * TYPEOF(input\csg_solid_2d.tree_root_expression)) &gt; 0)
    THEN 
           RETURN(TRUE);
    ELSE
           RETURN(FALSE);
    END_IF;
  END;

  ('CONSTRUCTIVE_SOLID_GEOMETRY_2D_MIM.BOOLEAN_RESULT_2D' IN TYPEOF(input\csg_solid_2d.tree_root_expression)) : 
    RETURN (valid_csg_2d_primitives(input\csg_solid_2d.tree_root_expression\boolean_result_2d.first_operand) 
        AND valid_csg_2d_primitives(input\csg_solid_2d.tree_root_expression\boolean_result_2d.second_operand));

  ('GEOMETRIC_MODEL_SCHEMA.HALF_SPACE_2D' IN TYPEOF(input\csg_solid_2d.tree_root_expression)) : RETURN(TRUE);

  OTHERWISE : RETURN(FALSE);
END_CASE;</algorithm>
      </function>
   </schema>
</express>
