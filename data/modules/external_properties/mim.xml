<?xml version="1.0"?>
<!-- $Id: mim.xml,v 1.5 2003/01/28 11:19:20 rugarcia Exp $ -->
<?xml-stylesheet type="text/xsl" href="../../../xsl/express.xsl"?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">
<express language_version="2" description.file="mim_descriptions.xml" rcs.date="$Date: 2003/01/28 11:19:20 $" rcs.revision="$Revision: 1.5 $">
	<application name="express2xml.js" owner="Eurostep Limited" url="http://www.eurostep.com" version="1.26" source="../data/modules/external_properties/mim.exp"/>
	<schema name="External_properties_mim">
		<interface kind="use" schema="External_item_identification_assignment_mim"/>
		<interface kind="use" schema="Independent_property_mim"/>
		<interface kind="use" schema="Plib_class_reference_mim"/>
		<interface kind="use" schema="external_reference_schema">
			<interfaced.item name="externally_defined_item"/>
			<interfaced.item name="externally_defined_item_relationship"/>
		</interface>
		<interface kind="use" schema="support_resource_schema">
			<interfaced.item name="identifier"/>
		</interface>
		<constant name="schema_name" expression="'EXTERNAL_PROPERTIES_MIM'">
			<builtintype type="STRING"/>
		</constant>
		<type name="external_identification_for_plib_property">
			<select basedon="external_identification_item" selectitems="externally_defined_general_property"/>
		</type>
		<type name="externally_versioned_item">
			<select extensible="YES" genericentity="YES"/>
		</type>
		<type name="version_for_plib_property">
			<select basedon="externally_versioned_item" selectitems="externally_defined_general_property"/>
		</type>
		<entity name="externally_defined_general_property" supertypes="general_property externally_defined_item"/>
		<rule name="external_version_assignments_are_valid" appliesto="applied_external_identification_assignment">
			<algorithm/>
			<where label="WR1" expression="SIZEOF(QUERY(aia &lt;* applied_external_identification_assignment | 		NOT external_version_assignment_is_valid(aia)))=0"/>
		</rule>
		<rule name="plib_property_reference_requires_version" appliesto="externally_defined_general_property">
			<algorithm>
LOCAL
  plib_properties : SET OF externally_defined_general_property := [];
END_LOCAL;
plib_properties := QUERY ( edgp &lt;* externally_defined_general_property | 
	( schema_name + '.KNOWN_SOURCE' IN TYPEOF ( edgp.source ) ) AND
	( known_source\pre_defined_item.name = 'ISO 13584 library' ) ); 
      </algorithm>
			<where label="WR1" expression="SIZEOF( QUERY( edgp &lt;* plib_properties | 	(SIZEOF( QUERY( edir &lt;* USEDIN(edgp, schema_name + '.APPLIED_EXTERNAL_IDENTIFICATION_ASSIGNMENT.ITEMS') | 	(edir.role.name = 'version') )) &lt;&gt; 1) )) = 0"/>
		</rule>
		<rule name="plib_property_reference_requires_name_scope" appliesto="externally_defined_general_property">
			<algorithm>
LOCAL
   known_sourced_properties : SET OF externally_defined_general_property;
END_LOCAL;
  known_sourced_properties := QUERY( edc &lt;* externally_defined_general_property | 
	schema_name + '.KNOWN_SOURCE' IN TYPEOF(edc.source) );
      </algorithm>
			<where label="WR1" expression="SIZEOF ( QUERY ( edgp &lt;* known_sourced_properties |    ( SIZEOF ( QUERY ( edir &lt;* USEDIN ( edgp, schema_name + '.EXTERNALLY_DEFINED_ITEM_RELATIONSHIP.RELATING_ITEM' )| 	( edir.name =  'name scope' ) AND       (schema_name + '.EXTERNALLY_DEFINED_CLASS' IN  TYPEOF ( edir.related_item ) ) AND       ( schema_name + '.KNOWN_SOURCE' IN TYPEOF ( edir.related_item.source ) ) ) ) &lt;&gt;1 ) ) ) =  0"/>
		</rule>
		<function name="external_version_assignment_is_valid">
			<parameter name="aia">
				<typename name="applied_external_identification_assignment"/>
			</parameter>
			<builtintype type="BOOLEAN"/>
			<algorithm>
LOCAL
  item: identification_item;
  role: identification_role;
END_LOCAL;

role:= aia.role;
IF role.name='version' THEN
  REPEAT i:=LOINDEX(aia.items) TO HIINDEX(aia.items);
    item:= aia.items[i];

    IF (SIZEOF(['EXTERNAL_PROPERTIES_MIM.' + 'EXTERNALLY_VERSIONED_ITEM']*TYPEOF(item))=0) THEN
-- item invalid if item does not belong to versionable types
	RETURN(FALSE);
    END_IF;
  END_REPEAT;
  RETURN(TRUE);

ELSE		-- case where aia does not convey a version id
  RETURN(TRUE);
END_IF;
      </algorithm>
		</function>
	</schema>
</express>
