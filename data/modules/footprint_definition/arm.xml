<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../../../xsl/express.xsl"?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">

<express language_version="2" rcs.date="$Date$" rcs.revision="$Revision$" description.file="arm_descriptions.xml">
   <application name="JSDAI" owner="LKSoft" url="www.lksoft.com" version="4.0 beta" source="footprint_definition_arm schema_instance"/>
   <schema name="Footprint_definition_arm">
      <interface kind="use" schema="Part_template_2d_shape_arm"/>
      <interface kind="use" schema="Package_arm"/>
      <interface kind="reference" schema="Characterizable_object_arm">
         <interfaced.item name="bag_to_set"/>
      </interface>
      <entity name="Breakout_footprint_definition" supertypes="Generic_footprint_definition" abstract.supertype="NO" abstract.entity="NO">
         <explicit name="reference_footprint" optional="NO">
            <typename name="Footprint_definition"/>
         </explicit>
         <inverse name="breakout_traces" entity="Stratum_feature_template_location_in_breakout_footprint_definition" attribute="assembly">
            <inverse.aggregate type="SET" lower="1" upper="?"/>
         </inverse>
         <where label="WR1" expression="SELF\Multi_stratum_structured_template.location = reference_footprint\Multi_stratum_structured_template.location"/>
      <where label="IP1"/>
         <where label="IP2"/>
         <where label="IP3"/>
      </entity>
      <entity name="Breakout_footprint_definition_shape_model" supertypes="Structured_template_planar_shape_model" abstract.supertype="NO" abstract.entity="NO">
         <explicit name="shape_characterized_definition" optional="NO">
            <aggregate type="SET" lower="1" upper="1" unique="NO" optional="NO"/>
            <typename name="Breakout_footprint_definition"/>
            <redeclaration entity-ref="Structured_template_planar_shape_model"/>
         </explicit>
         <explicit name="reference_shape" optional="NO">
            <typename name="Footprint_definition_shape_model"/>
         </explicit>
         <where label="WR1" expression="reference_shape.shape_characterized_definition[1] :=: shape_characterized_definition[1].reference_footprint"/>
      </entity>
      <entity name="Footprint_definition" supertypes="Generic_footprint_definition" abstract.supertype="NO" abstract.entity="NO">
         <explicit name="reference_package" optional="YES">
            <typename name="Part_usage_view"/>
         </explicit>
         <where label="WR1" expression="SIZEOF (QUERY(shape &lt;* SELF\Structured_template.shapes |&#10;               NOT ('PART_TEMPLATE_2D_SHAPE_ARM.FOOTPRINT_DEFINITION_SHAPE_MODEL' IN TYPEOF(shape))&#10;              )) = 0"/>
         <where label="WR2" expression="SIZEOF (QUERY(tlist &lt;* SELF\Structured_template.templates |&#10;               ('FOOTPRINT_DEFINITION_ARM.FOOTPRINT_DEFINITION' IN TYPEOF(tlist.template))&#10;              )) = 0"/>
      </entity>
      <entity name="Footprint_definition_shape_model" supertypes="Structured_template_planar_shape_model" abstract.supertype="NO" abstract.entity="NO">
         <explicit name="shape_characterized_definition" optional="NO">
            <aggregate type="SET" lower="1" upper="1" unique="NO" optional="NO"/>
            <typename name="Footprint_definition"/>
            <redeclaration entity-ref="Structured_template_planar_shape_model"/>
         </explicit>
         <explicit name="reference_shape" optional="YES">
            <typename name="physical_unit_shape_model_select"/>
         </explicit>
         <where label="WR1" expression="NOT (SIZEOF(['PHYSICAL_UNIT_3D_SHAPE_ARM.PHYSICAL_UNIT_3D_SHAPE_MODEL',&#10;                         'PHYSICAL_UNIT_2D_SHAPE_ARM.PHYSICAL_UNIT_PLANAR_SHAPE_MODEL'] * TYPEOF(reference_shape)) = 1) OR &#10;            NOT ('PACKAGE_ARM.PACKAGE' IN TYPEOF(reference_shape\Physical_unit_shape_model.shape_characterized_definition)) OR&#10;            NOT ('PART_TEMPLATE_2D_SHAPE_ARM.FOOTPRINT_DEFINITION' IN TYPEOF(shape_characterized_definition[1])) OR      &#10;                 (shape_characterized_definition[1]\Footprint_definition.reference_package :=: &#10;                  reference_shape\Physical_unit_shape_model.shape_characterized_definition)"/>
         <where label="WR2" expression="NOT (SIZEOF(['PHYSICAL_UNIT_3D_SHAPE_ARM.PHYSICAL_UNIT_3D_SHAPE_MODEL',&#10;                         'PHYSICAL_UNIT_2D_SHAPE_ARM.PHYSICAL_UNIT_PLANAR_SHAPE_MODEL'] * TYPEOF(reference_shape)) = 1) OR &#10;                ('PACKAGE_ARM.PACKAGE' IN TYPEOF(reference_shape\Physical_unit_shape_model.shape_characterized_definition))"/>
         <where label="WR3" expression="NOT (SIZEOF(['PART_TEMPLATE_3D_SHAPE_ARM.PART_TEMPLATE_3D_SHAPE_MODEL',&#10;                         'PART_TEMPLATE_2D_SHAPE_ARM.PART_TEMPLATE_PLANAR_SHAPE_MODEL'] * TYPEOF(reference_shape)) = 1) OR &#10;                ('PRINTED_PHYSICAL_LAYOUT_TEMPLATE_ARM.PRINTED_PART_TEMPLATE' &#10;                   IN TYPEOF(reference_shape\Part_template_shape_model.shape_characterized_definition))"/>
         <where label="WR4" expression="NOT EXISTS(SELF\Representation.description)"/>
      </entity>
      <entity name="Generic_footprint_definition" abstract.supertype="YES" supertypes="Multi_stratum_structured_template" super.expression="ONEOF (Footprint_definition, Breakout_footprint_definition)" abstract.entity="NO">
         <derived name="location" expression="get_template_arrangement(padstacks)">
            <typename name="template_arrangement"/>
            <redeclaration entity-ref="Multi_stratum_structured_template"/>
         </derived>
         <derived name="padstacks" expression="bag_to_set(QUERY(tlict &lt;* SELF\Structured_template.templates |&#10;         ('PART_TEMPLATE_2D_SHAPE_ARM.PADSTACK_DEFINITION' IN TYPEOF(tlict.template))))">
            <aggregate type="SET" lower="1" upper="?" unique="NO" optional="NO"/>
            <typename name="Template_location_in_structured_template"/>
         </derived>
         <where label="WR1" expression="SIZEOF(QUERY(ps &lt;* templates | (ps.template\Multi_stratum_structured_template.location &lt;&gt; location)&#10;              AND (ps.template\Multi_stratum_structured_template.location &lt;&gt; template_arrangement.symmetrical))) = 0"/>
         <where label="WR2" expression="((location = template_arrangement.top) AND (SELF\Product_view_definition.initial_context\View_definition_context.description = 'top')) OR &#10;            (NOT (location = template_arrangement.top) AND NOT (SELF\Product_view_definition.initial_context\View_definition_context.description = 'top'))"/>
         <where label="WR3" expression="((location = template_arrangement.bottom) AND (SELF\Product_view_definition.initial_context\View_definition_context.description = 'bottom')) OR &#10;            (NOT (location = template_arrangement.bottom) AND NOT (SELF\Product_view_definition.initial_context\View_definition_context.description = 'bottom'))"/>
         <where label="WR4" expression="((location = template_arrangement.symmetrical) AND (SELF\Product_view_definition.initial_context\View_definition_context.description = 'symmetrical')) OR &#10;            (NOT (location = template_arrangement.symmetrical) AND NOT (SELF\Product_view_definition.initial_context\View_definition_context.description = 'symmetrical'))"/>
      </entity>
      <entity name="Part_feature_based_template_location" supertypes="Template_location_in_structured_template" abstract.supertype="NO" abstract.entity="NO">
         <explicit name="reference_feature" optional="NO">
            <typename name="Part_feature"/>
         </explicit>
         <derived name="all_reference_feature" expression="bag_to_set(USEDIN&#10;      (SELF\Template_location_in_structured_template.assembly,&#10;      'PART_TEMPLATE_2D_SHAPE_ARM.TEMPLATE_LOCATION_IN_STRUCTURED_TEMPLATE.ASSEMBLY'))">
            <aggregate type="SET" lower="1" upper="?" unique="NO" optional="NO"/>
            <typename name="Part_feature"/>
         </derived>
         <derived name="reference_designation" expression="reference_feature\Shape_element.element_name">
            <builtintype type="STRING" fixed="NO"/>
            <redeclaration entity-ref="Template_location_in_structured_template"/>
         </derived>
         <where label="WR1" expression="SIZEOF(QUERY( arf &lt;* all_reference_feature | NOT(reference_feature.associated_definition :=: arf.associated_definition))) = 0"/>
      </entity>
      <entity name="Stratum_feature_template_location_in_breakout_footprint_definition" supertypes="Stratum_specific_template_location" abstract.supertype="NO" abstract.entity="NO">
         <explicit name="assembly" optional="NO">
            <typename name="Breakout_footprint_definition"/>
            <redeclaration entity-ref="Template_location_in_structured_template"/>
         </explicit>
         <explicit name="template" optional="NO">
            <typename name="Stratum_feature_template"/>
            <redeclaration entity-ref="Template_location_in_structured_template"/>
         </explicit>
         <explicit name="original_padstack" optional="NO">
            <typename name="Part_feature_based_template_location"/>
         </explicit>
         <explicit name="breakout_padstack" optional="NO">
            <typename name="Template_location_in_structured_template"/>
         </explicit>
         <where label="WR1" expression="original_padstack.assembly :=: assembly.reference_footprint"/>
         <where label="WR2" expression="breakout_padstack.assembly :=: assembly"/>
      </entity>
      <subtype.constraint name="structured_template_planar_shape_model_subtypes" entity="Structured_template_planar_shape_model" super.expression="ONEOF (Breakout_footprint_definition_shape_model, Footprint_definition_shape_model)" abstract.supertype="NO"/>
      <subtype.constraint name="multi_stratum_structured_template_subtypes" entity="Multi_stratum_structured_template" super.expression="ONEOF (Padstack_definition, Generic_footprint_definition, Multi_stratum_special_symbol_template)" abstract.supertype="NO"/>
      <function name="get_template_arrangement">
         <parameter name="input">
            <aggregate type="SET" lower="0" upper="?" unique="NO" optional="NO"/>
            <typename name="Template_location_in_structured_template"/>
         </parameter>
         <typename name="template_arrangement"/>
         <algorithm>LOCAL
      tlist : SET OF Template_location_in_structured_template := 
        (QUERY(inx &lt;* input | ('PART_TEMPLATE_2D_SHAPE_ARM.MULTI_STRATUM_STRUCTURED_TEMPLATE' IN TYPEOF(inx.template))));
      pabt : BAG OF STRING := [];
      pabb : BAG OF STRING := [];
      pabs : BAG OF STRING := [];
    END_LOCAL;

    REPEAT i := 1 TO SIZEOF(tlist) BY 1;
      IF (tlist[i].template\Multi_stratum_structured_template.location = template_arrangement.top) THEN
        pabt := pabt + 'top';
      END_IF;
      IF (tlist[i].template\Multi_stratum_structured_template.location = template_arrangement.bottom) THEN
        pabb := pabb + 'bottom';
      END_IF;
      IF (tlist[i].template\Multi_stratum_structured_template.location = template_arrangement.symmetrical) THEN
        pabs := pabs + 'symmetrical';
      END_IF;
    END_REPEAT;
    IF ((SIZEOF(pabt) &gt; 0) AND (SIZEOF(pabb) = 0)) THEN
      RETURN(template_arrangement.top);
    END_IF;
    IF ((SIZEOF(pabb) &gt; 0) AND (SIZEOF(pabt) = 0)) THEN
      RETURN(template_arrangement.bottom);
    END_IF;
    IF ((SIZEOF(pabb) = 0) AND (SIZEOF(pabt) = 0) AND (SIZEOF(pabs) &gt; 0)) THEN
      RETURN(template_arrangement.symmetrical);
    END_IF;
    RETURN(?);</algorithm>
      </function>
   </schema>
</express>
