<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../../../xsl/express.xsl"?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">

<express language_version="2" rcs.date="2005-09-13T14:57:35" rcs.revision="1.0" description.file="mim_descriptions.xml">
   <application name="JSDAI" owner="LKSoft" url="www.lksoft.com" version="4.0 beta" source="functional_usage_view_mim schema_instance"/>
   <schema name="Functional_usage_view_mim">
      <interface kind="use" schema="Analytical_model_mim"/>
      <interface kind="use" schema="Network_functional_design_view_mim"/>
      <interface kind="use" schema="Product_identification_mim"/>
      <interface kind="use" schema="Product_view_definition_relationship_mim"/>
      <interface kind="use" schema="document_schema">
         <interfaced.item name="document_type"/>
      </interface>
      <interface kind="use" schema="product_property_definition_schema">
         <interfaced.item name="shape_aspect"/>
         <interfaced.item name="shape_aspect_relationship"/>
      </interface>
      <interface kind="use" schema="material_property_definition_schema">
         <interfaced.item name="property_definition_relationship"/>
      </interface>
      <type name="nfuv_groupable_item">
         <select extensible="YES" genericentity="YES" basedon="groupable_item" selectitems="shape_aspect"/>
      </type>
      <entity name="functional_terminal_group" supertypes="group">
         <unique label="UR1">
            <unique.attribute entity-ref="functional_terminal_group" attribute="name"/>
         </unique>
      </entity>
      <entity name="functional_unit" supertypes="product_definition">
         <where label="WR1" expression="SELF.frame_of_reference.name IN ['functional design usage', &#10;       'functional network design']"/>
         <where label="WR2" expression="(NOT ('FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'PRODUCT_DEFINITION_WITH_ASSOCIATED_DOCUMENTS' IN &#10;       TYPEOF (SELF))) OR&#10;       (SIZEOF (QUERY (docs &lt;* &#10;   SELF\product_definition_with_associated_documents.documentation_ids |&#10;       docs.kind\document_type.product_data_type = 'CAD filename')) &lt;= 1)"/>
         <where label="WR3" expression="SIZEOF (QUERY (adta &lt;* USEDIN (SELF, &#10;       'FUNCTIONAL_USAGE_VIEW_MIM.' + &#10;       'APPLIED_DATE_AND_TIME_ASSIGNMENT.ITEMS') |&#10;       adta.role\date_time_role.name = 'creation date')) = 1"/>
         <where label="WR4" expression="SIZEOF (USEDIN (SELF, &#10;       'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'APPLIED_APPROVAL_ASSIGNMENT.ITEMS')) = 1"/>
         <where label="WR5" expression="SIZEOF (QUERY (apoa &lt;* USEDIN (SELF, &#10;       'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'APPLIED_PERSON_AND_ORGANIZATION_ASSIGNMENT.ITEMS') |&#10;       apoa.role\person_and_organization_role.name = 'creator')) +&#10;       SIZEOF (QUERY (apoa &lt;* USEDIN (SELF, &#10;       'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'APPLIED_ORGANIZATION_ASSIGNMENT.ITEMS') |&#10;       apoa.role\organization_role.name = 'creator')) &gt;= 1"/>
         <where label="WR6" expression="SIZEOF (USEDIN (SELF, &#10;       'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'APPLIED_SECURITY_CLASSIFICATION_ASSIGNMENT.ITEMS')) = 1"/>
         <where label="WR7" expression="(NOT (SELF.frame_of_reference.name = &#10;                                 'functional network design')) OR&#10;       (SIZEOF (QUERY (du &lt;* QUERY (pdr &lt;* USEDIN (SELF,&#10;       'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'PRODUCT_DEFINITION_RELATIONSHIP.' +&#10;       'RELATED_PRODUCT_DEFINITION') |&#10;       pdr\product_definition_relationship.name = 'design usage') |&#10;       du.relating_product_definition.frame_of_reference.name = &#10;       'functional design usage')) = 1)"/>
         <where label="WR8" expression="(NOT (SIZEOF([&#10;        'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;            'THERMAL_NETWORK',&#10;            'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;            'ELECTRICAL_NETWORK'] * TYPEOF(SELF)) = 1))&#10;        OR (SELF.frame_of_reference.name = 'functional network design')"/>
      </entity>
      <entity name="functional_unit_terminal_definition" supertypes="shape_aspect">
         <where label="WR1" expression="('FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'FUNCTIONAL_UNIT' IN&#10;       TYPEOF (SELF.of_shape.definition)) AND&#10;   (SELF.of_shape.definition\product_definition.frame_of_reference.name =&#10;       'functional design usage')"/>
         <where label="WR2" expression="SIZEOF (QUERY (pd2 &lt;* QUERY (pd &lt;* USEDIN (SELF,&#10;       'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'PROPERTY_DEFINITION.DEFINITION') |&#10;       'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'PROPERTY_DEFINITION' IN&#10;       TYPEOF (pd)) |&#10;       SIZEOF (QUERY (funtdba &lt;* QUERY (pdr &lt;* USEDIN (pd2,&#10;       'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'PROPERTY_DEFINITION_RELATIONSHIP.RELATED_PROPERTY_DEFINITION') |&#10;       pdr\property_definition_relationship.name = &#10;       'functional unit network terminal definition bus assignment') |&#10;       'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'BUS_STRUCTURAL_DEFINITION' IN &#10;       TYPEOF &#10;       (funtdba.relating_property_definition.definition))) &lt;= 1)) &lt;= 1"/>
         <where label="WR3" expression="SIZEOF (QUERY (pd2 &lt;* QUERY (pd &lt;* USEDIN (SELF,&#10;       'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'PROPERTY_DEFINITION.DEFINITION') |&#10;       'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'PROPERTY_DEFINITION' IN&#10;       TYPEOF (pd)) |&#10;       SIZEOF (QUERY (funtdna &lt;* QUERY (pdr &lt;* USEDIN (pd2,&#10;       'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'PROPERTY_DEFINITION_RELATIONSHIP.RELATED_PROPERTY_DEFINITION') |&#10;       pdr\property_definition_relationship.name = &#10;       'functional unit network terminal definition node assignment') |&#10;       'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'NETWORK_NODE_DEFINITION' IN &#10;       TYPEOF &#10;       (funtdna.relating_property_definition.definition))) &lt;= 1)) &lt;= 1"/>
      </entity>
      <entity name="make_from_functional_unit_terminal_definition_relationship" supertypes="shape_aspect shape_aspect_relationship">
         <unique label="UR1">
            <unique.attribute entity-ref="make_from_functional_unit_terminal_definition_relationship" attribute="relating_shape_aspect"/>
            <unique.attribute entity-ref="make_from_functional_unit_terminal_definition_relationship" attribute="related_shape_aspect"/>
         </unique>
         <where label="WR1" expression="SIZEOF (['FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'FUNCTIONAL_UNIT_TERMINAL_DEFINITION'] *&#10;       TYPEOF (SELF.relating_shape_aspect)) = 1"/>
         <where label="WR2" expression="SIZEOF (['FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'FUNCTIONAL_UNIT_TERMINAL_DEFINITION'] *&#10;       TYPEOF (SELF.related_shape_aspect)) = 1"/>
         <where label="WR3" expression="SIZEOF(TYPEOF(SELF) - TYPEOF(SELF\shape_aspect ||&#10;       SELF\shape_aspect_relationship ||&#10;    SELF\make_from_functional_unit_terminal_definition_relationship)) = 0"/>
         <where label="WR4" expression="relating_shape_aspect.of_shape :&lt;&gt;: &#10;       related_shape_aspect.of_shape"/>
         <where label="WR5" expression="SELF\shape_aspect.name = ''"/>
         <where label="WR6" expression="SELF\shape_aspect.description = ''"/>
         <where label="WR7" expression="SELF\shape_aspect.product_definitional = FALSE"/>
         <where label="WR8" expression="SIZEOF (USEDIN (SELF,&#10;       'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'PROPERTY_DEFINITION.DEFINITION')) = 0"/>
         <where label="WR9" expression="SIZEOF (QUERY( sar &lt;* USEDIN(SELF,&#10;       'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'SHAPE_ASPECT_RELATIONSHIP.RELATED_SHAPE_ASPECT') |&#10;       (('FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'PRODUCT_DEFINITION_RELATIONSHIP') IN TYPEOF&#10;       (sar.of_shape\property_definition.definition))&#10;       )) = 1"/>
      </entity>
      <entity name="scalar_terminal_definition_link" supertypes="shape_aspect shape_aspect_relationship">
         <unique label="UR1">
            <unique.attribute entity-ref="scalar_terminal_definition_link" attribute="related_shape_aspect"/>
            <unique.attribute entity-ref="scalar_terminal_definition_link" attribute="relating_shape_aspect"/>
         </unique>
         <where label="WR1" expression="SELF\shape_aspect_relationship.related_shape_aspect :&lt;&gt;:&#10;       SELF\shape_aspect_relationship.relating_shape_aspect"/>
         <where label="WR2" expression="'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'FUNCTIONAL_UNIT_TERMINAL_DEFINITION' IN&#10;       TYPEOF (SELF\shape_aspect_relationship.related_shape_aspect)"/>
         <where label="WR3" expression="'FUNCTIONAL_USAGE_VIEW_MIM.' +&#10;       'FUNCTIONAL_UNIT_TERMINAL_DEFINITION' IN&#10;       TYPEOF (SELF\shape_aspect_relationship.relating_shape_aspect)"/>
         <where label="WR4" expression="SIZEOF(TYPEOF(SELF) - TYPEOF(SELF\shape_aspect ||&#10;       SELF\shape_aspect_relationship ||&#10;       SELF\scalar_terminal_definition_link)) = 0"/>
         <where label="WR5" expression="SELF\shape_aspect.name = ''"/>
         <where label="WR6" expression="SELF\shape_aspect_relationship.name = ''"/>
         <where label="WR7" expression="SELF\shape_aspect_relationship.relating_shape_aspect\shape_aspect.description = 'scalar terminal'"/>
         <where label="WR8" expression="SELF\shape_aspect_relationship.related_shape_aspect\shape_aspect.description = 'scalar terminal'"/>
      </entity>
      <rule name="functional_unit_usage_view_terminal_definition_unique_constraint" appliesto="functional_unit_terminal_definition">
         <algorithm>LOCAL
  name_bag : BAG OF STRING := [];
  futd_bag : BAG OF functional_unit_terminal_definition;
  adr_bag : BAG OF applied_document_reference;
  pass : BOOLEAN := TRUE;
  fu_bag : BAG OF functional_unit;
END_LOCAL;

REPEAT i := 1 to SIZEOF(functional_unit_terminal_definition) by 1;
  IF EXISTS( functional_unit_terminal_definition[i]\shape_aspect.name ) THEN
    IF( NOT( functional_unit_terminal_definition[i]\shape_aspect.name IN 
                                              name_bag ) ) THEN
      name_bag := name_bag + 
                    functional_unit_terminal_definition[i]\shape_aspect.name;
    END_IF;
  END_IF;
END_REPEAT;

REPEAT i := 1 to SIZEOF(name_bag) by 1;
  IF ( NOT pass ) THEN ESCAPE;
  END_IF;
  fu_bag := [];
  futd_bag := QUERY( futd &lt;* functional_unit_terminal_definition |
((futd\shape_aspect.name = name_bag[i]) AND
('FUNCTIONAL_USAGE_VIEW_MIM.' +
'FUNCTIONAL_UNIT' IN TYPEOF(futd.of_shape.definition)) AND
(futd.of_shape.definition.frame_of_reference.name = 
                                    'functional design usage')) );
  REPEAT j := 1 to SIZEOF(futd_bag) by 1;
    IF EXISTS( futd_bag[j].of_shape.definition ) THEN
      IF ( futd_bag[j].of_shape.definition IN fu_bag ) THEN
        pass := FALSE;
        ESCAPE;
      ELSE
        fu_bag := fu_bag + futd_bag[j].of_shape.definition;
      END_IF;
    END_IF;
  END_REPEAT;
END_REPEAT;</algorithm>
         <where label="WR1" expression="pass"/>
      </rule>
   </schema>
</express>
