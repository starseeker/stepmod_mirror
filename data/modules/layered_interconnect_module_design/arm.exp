(*
   $Id: arm.exp,v 1.237 2006/04/24 11:46:32 liutkus Exp $
   ISO TC184/SC4/WG12 N4041 - ISO/TS 10303-1698 Layered interconnect module design - EXPRESS ARM
   Supersedes ISO TC184/SC4/WG12 N3483
*)

SCHEMA Layered_interconnect_module_design_arm;

	USE FROM Component_grouping_arm;	-- ISO/TS 10303-1656
	USE FROM Edge_shape_feature_arm;	-- ISO/TS 10303-1673
	USE FROM Interconnect_module_usage_view_arm;	-- ISO/TS 10303-1686
	USE FROM Interconnect_physical_requirement_allocation_arm;	-- ISO/TS 10303-1689
	USE FROM Footprint_definition_arm;	-- ISO/TS 10303-1646
	USE FROM Physical_connectivity_definition_arm;	-- ISO/TS 10303-1755
	USE FROM Part_template_extension_arm;	-- ISO/TS 10303-1718
	USE FROM Interconnect_module_connection_routing_arm;
	USE FROM Assembly_component_placement_requirements_arm;	-- ISO/TS 10303-1634	

	REFERENCE FROM Characterizable_object_arm(bag_to_set);  -- ISO/TS 10303-1765

	TYPE limd_groupable_item = SELECT BASED_ON groupable_item WITH 
	   (Generic_physical_network,
	   Stratum);
	END_TYPE; 

	TYPE limd_restriction_basis_item = EXTENSIBLE SELECT BASED_ON restriction_basis_item WITH 
	   (stratum_concept,
	   Stratum);
	END_TYPE; 

    TYPE stratum_feature_or_stratum = SELECT (
      Stratum_feature,
      Stratum);
    END_TYPE;

    TYPE stratum_feature_template_component_or_stratum = SELECT
      (Stratum_feature_template_component, Stratum);
    END_TYPE;
    
	SUBTYPE_CONSTRAINT limd_assembly_component_subtypes FOR Assembly_component; 
	    (ONEOF (Physical_component,
	 	Laminate_component));
	END_SUBTYPE_CONSTRAINT;
	
	SUBTYPE_CONSTRAINT array_placement_group_subtypes FOR Array_placement_group; 
		(ONEOF (Laminate_text_string_component,
		 Linear_array_placement_group_component,
		 Rectangular_array_placement_group_component));
	END_SUBTYPE_CONSTRAINT;

	SUBTYPE_CONSTRAINT assembly_group_component_subtypes FOR Assembly_group_component; 
	    (interfaced_group_component ANDOR
	 	array_placement_group ANDOR
	 	(ONEOF (Footprint_occurrence,
	 	Padstack_occurrence)));
	END_SUBTYPE_CONSTRAINT;

	SUBTYPE_CONSTRAINT component_feature_subtypes FOR Component_feature;     
		 ONEOF (Physical_component_feature,
		 Laminate_component_feature);
	END_SUBTYPE_CONSTRAINT;

	SUBTYPE_CONSTRAINT component_terminal_subtypes FOR Component_terminal;     
		 ONEOF (Physical_component_terminal,
		 Laminate_component_join_terminal);
	END_SUBTYPE_CONSTRAINT;

	SUBTYPE_CONSTRAINT inter_stratum_feature_subtypes FOR Inter_stratum_feature;     
		 ONEOF (Cutout,
		 Interconnect_module_edge);
	END_SUBTYPE_CONSTRAINT;

	SUBTYPE_CONSTRAINT interconnect_module_terminal_subtypes FOR Interconnect_module_terminal;     
		(ONEOF (Interconnect_module_interface_terminal,
		 Interconnect_module_macro_terminal));
	END_SUBTYPE_CONSTRAINT; 

	SUBTYPE_CONSTRAINT limd_part_view_definition_subtypes FOR Part_view_definition; 
		(ONEOF (Part_usage_view,
		Part_design_view,
		Stratum));
	END_SUBTYPE_CONSTRAINT; 
	
	SUBTYPE_CONSTRAINT limd_template_definition_subtypes FOR Template_definition; 
	    (ONEOF (
           ONEOF(Printed_part_template, Special_symbol_template) ANDOR  Geometric_template, 
           Non_conductive_cross_section_template,
           Part_string_template, 
           Printed_part_cross_section_template, 
           Parametric_template,
           Part_text_template,
           Stratum_stack_model));
	END_SUBTYPE_CONSTRAINT;

    TYPE material_removal_feature_template_or_parametric_template = SELECT
      (Material_removal_feature_template, Parametric_template);
    END_TYPE;

    TYPE special_symbol_component = SELECT
      (Single_stratum_special_symbol_component, Multi_stratum_special_symbol_component);
    END_TYPE;

    TYPE stratum_feature_template_or_parametric_template = SELECT
      (Stratum_feature_template, Parametric_template);
    END_TYPE;

 	TYPE bare_die_component_or_packaged_component = EXTENSIBLE GENERIC_ENTITY SELECT;
	END_TYPE;

 	TYPE bare_die_terminal_or_packaged_part_terminal = EXTENSIBLE GENERIC_ENTITY SELECT;
	END_TYPE;

 	TYPE component_feature_or_stratum_surface = EXTENSIBLE GENERIC_ENTITY SELECT
		(Component_feature,
		Stratum_surface);
 	END_TYPE;

	TYPE limd_ee_product_definition_with_annotation_elements = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON ee_product_definition_with_annotation_elements WITH 
   	(Template_definition,
   	Part_usage_view,
   	Part_design_view,
   	Stratum);
	END_TYPE; 

 	TYPE limd_external_identification_item = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON external_identification_item WITH  
		(Stratum_based_pattern,
		Stratum_feature_based_derived_pattern,
		Stratum,
		Laminate_component);
	END_TYPE;

	TYPE limd_feature_select = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON feature_select WITH 
	   	(Printed_part_template_terminal,
	   	Land_template_terminal,
	   	Component_termination_passage_template_terminal,
	   	Via_template_terminal,
	   	Part_terminal_external_reference);
	END_TYPE; 

	TYPE limd_physical_feature_or_part_template = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON physical_feature_or_part_template WITH 
	   (Part_feature,
		Physical_component_feature,
	 	Laminate_component,
	 	Template_definition,
	 	Stratum_feature);
	END_TYPE;

	TYPE limd_requirement_assignment_item = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON requirement_assignment_item WITH 
	    (Stratum_feature_conductive_join,
	     Dielectric_crossover_area,
	    Interconnect_module);
	END_TYPE; 

	TYPE limd_documented_element_select = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON documented_element_select WITH 
	    (stratum_concept,
	     Stratum);
	END_TYPE;

	TYPE limd_trace_junction_or_via_select = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON trace_junction_or_via WITH 
		(Inter_stratum_join_relationship);
	END_TYPE;

	TYPE limd_usage_concept = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON usage_concept WITH 
		(Component_termination_passage_template_terminal,
	     Via_template_terminal);
	END_TYPE;

 	TYPE material_or_specification = SELECT
 		(Predefined_requirement_view_definition,
     	Material_identification);
	END_TYPE;

    TYPE printed_part_template_or_printed_part_cross_section_template = SELECT
    (Printed_part_template,
     Printed_part_cross_section_template);
    END_TYPE;

 	TYPE stratum_concept = EXTENSIBLE GENERIC_ENTITY SELECT
    (Laminate_component,
     Inter_stratum_feature,
     Stratum_feature,
     Stratum,
     Stratum_surface,
     Structured_layout_component);
	END_TYPE;

    TYPE stratum_surface_designation = ENUMERATION OF
    (average_surface,
     primary_surface,
     secondary_surface);
    END_TYPE;

  ENTITY Adjacent_stratum_surface_definition;
      name               : STRING;
      precedent_surface  : Stratum_surface;
      subsequent_surface : Stratum_surface;
    DERIVE
      of_product : Product := precedent_surface.of_stratum\Product_view_definition.defined_version.of_product;      
    UNIQUE
      UR1 : name;
      UR2 : precedent_surface, subsequent_surface;
    WHERE
      WR1 : precedent_surface.name = stratum_surface_designation.secondary_surface;
      WR2 : subsequent_surface.name = stratum_surface_designation.primary_surface;
      WR3: of_product :=: subsequent_surface.of_stratum\Product_view_definition.defined_version.of_product;
  END_ENTITY;

  ENTITY Adjacent_stratum_surface_embedded_physical_component_surface_definition;
      name            : STRING;
      precedent_item  : component_feature_or_stratum_surface;
      subsequent_item : component_feature_or_stratum_surface;
    UNIQUE
      UR1 : name;
      UR2 : precedent_item,
 subsequent_item;
    WHERE
      WR1 : precedent_item <> subsequent_item;
      WR2 : NOT ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.COMPONENT_FEATURE' IN TYPEOF(precedent_item)) OR 
        (SIZEOF(['LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.BARE_DIE_SURFACE',
               'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.PACKAGE_BODY_SURFACE',
               'INTERCONNECT_MODULE_USAGE_VIEW_ARM.INTERCONNECT_MODULE_SECONDARY_SURFACE'] * TYPEOF(precedent_item.definition)) = 1);
      WR3 : NOT ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.COMPONENT_FEATURE' IN TYPEOF(subsequent_item)) OR 
        (SIZEOF(['LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.BARE_DIE_SURFACE',
                 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.PACKAGE_BODY_SURFACE',
                 'INTERCONNECT_MODULE_USAGE_VIEW_ARM.INTERCONNECT_MODULE_PRIMARY_SURFACE'] * TYPEOF(subsequent_item.definition)) = 1);
      WR4 : NOT ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.STRATUM_SURFACE' IN TYPEOF(precedent_item)) OR 
                (precedent_item.name = stratum_surface_designation.secondary_surface);
      WR5 : NOT ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.STRATUM_SURFACE' IN TYPEOF(subsequent_item)) OR 
                (precedent_item.name = stratum_surface_designation.primary_surface);                 
  END_ENTITY;

  ENTITY Area_component
    SUPERTYPE OF (Connected_area_component)
    SUBTYPE OF (Stratum_feature_template_component);
      is_base : BOOLEAN;
      replaced_component : OPTIONAL Area_component;
      SELF\Definition_based_product_occurrence.derived_from : Fill_area_template;
    DERIVE
      is_final : BOOLEAN := (SIZEOF(replaced_by) = 0);
    INVERSE
      replaced_by : SET [0:?] OF Area_component FOR replaced_component;
    WHERE
      WR1: NOT(is_final XOR ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.STRATUM_FEATURE' IN TYPEOF(implementation_or_resident_stratum)));
      WR2: is_final OR (SIZEOF(QUERY(rp <* replaced_by | SELF\Stratum_feature_template_component.resident_stratum :<>: 
        get_resident_stratum(rp))) = 0);      
      WR3: NOT(SELF IN replaced_by);
      WR4: NOT(replaced_component IN replaced_by);
      WR5: is_final XOR (SIZEOF(USEDIN(SELF,'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.MATERIAL_REMOVAL_LAMINATE_COMPONENT.DESIGN_INTENT')) > 0);
  END_ENTITY;

  ENTITY Breakout_occurrence
    SUBTYPE OF (Footprint_occurrence);
      SELF\Definition_based_product_occurrence.derived_from : Breakout_footprint_definition;
      associated_footprint : Footprint_occurrence;
    WHERE
      WR1: associated_footprint <> SELF;
      WR2: derived_from.reference_footprint = associated_footprint.derived_from;
  END_ENTITY;

  ENTITY Component_termination_passage
    SUBTYPE OF (Plated_passage);
      SELF\Definition_based_product_occurrence.derived_from : Component_termination_passage_template;
    INVERSE
      access_mechanism           : SET[1:?] OF component_termination_passage_join_terminal FOR containing_shape;
      interface_access_mechanism : component_termination_passage_interface_terminal FOR associated_component;
  END_ENTITY;

  ENTITY Component_termination_passage_interface_terminal
    SUBTYPE OF (Laminate_component_interface_terminal);
      SELF\Component_feature.definition           : Component_termination_passage_template_interface_terminal;
      SELF\Component_feature.associated_component : Component_termination_passage;
    WHERE
      WR1 : NOT EXISTS(SELF\Shape_element.description);
  END_ENTITY;

  ENTITY Component_termination_passage_join_terminal
    SUBTYPE OF (Laminate_component_join_terminal);
      SELF\Component_feature.definition           : Component_termination_passage_template_join_terminal;
      SELF\Component_feature.associated_component : Component_termination_passage;
    WHERE
      WR1 : NOT EXISTS(SELF\Shape_element.description);
  END_ENTITY;

  ENTITY Conductive_filled_area
    SUPERTYPE OF (Connected_filled_area)
    SUBTYPE OF (Stratum_feature);
    WHERE
      WR1 : NOT EXISTS(SELF\Shape_element.description);
  END_ENTITY;

  ENTITY Conductive_interconnect_element
    ABSTRACT SUPERTYPE OF (ONEOF (Unrouted_conductive_interconnect_element, Conductive_interconnect_element_with_pre_defined_transitions))
    SUBTYPE OF (Stratum_feature_template_component);
    INVERSE
      access_mechanisms : SET [2:?] OF Conductive_interconnect_element_terminal FOR associated_component;
      connected_points : SET [1:?] OF Conductive_interconnect_element_terminal_link FOR associated_element;
    WHERE
      WR1: NOT EXISTS(SELF\Product_view_definition.name);
      WR2: NOT('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.PROBE_ACCESS_AREA' IN TYPEOF(SELF));
      WR3: NOT('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.FIDUCIAL' IN TYPEOF(SELF));
      WR4: correlated_terminals(SELF\Conductive_interconnect_element.access_mechanisms,
         connected_points);      
  END_ENTITY;

  ENTITY Conductive_interconnect_element_terminal
    SUBTYPE OF (Laminate_component_feature, Shape_feature);
      SELF\Component_feature.associated_component : Conductive_interconnect_element;
      SELF\Shape_feature.connection_area          : OPTIONAL SET[1:1] OF Connection_zone_in_design_view;
      location                                    : Layer_connection_point;
    UNIQUE
      UR1 : SELF\Component_feature.element_name, SELF\Component_feature.associated_component;
    WHERE
      WR1 : NOT EXISTS(SELF\Shape_element.description);
  END_ENTITY;

  ENTITY Conductive_interconnect_element_terminal_link;
      associated_element : Conductive_interconnect_element;
      precedent_point    : Conductive_interconnect_element_terminal;
      subsequent_point   : Conductive_interconnect_element_terminal;
    UNIQUE
      UR1 : precedent_point,
 subsequent_point;
    WHERE
      WR1 : precedent_point <> subsequent_point;
      WR2 : precedent_point.associated_component = associated_element;
      WR3 : subsequent_point.associated_component = associated_element;
  END_ENTITY;

  ENTITY Conductive_interconnect_element_with_pre_defined_transitions
    SUPERTYPE OF (Join_two_physical_connectivity_definition_supporting_printed_component)
    SUBTYPE OF (Conductive_interconnect_element);
      centreline_shape                                                           : Planar_path_shape_model_with_parameters;
      SELF\Definition_based_product_occurrence.derived_from                      : Trace_template;
      SELF\Stratum_feature_template_component.implementation_or_resident_stratum : Stratum_feature;
    WHERE
      WR1: SIZEOF(connected_points) = SIZEOF(SELF\Conductive_interconnect_element.access_mechanisms) - 1;
      WR2: SIZEOF(['LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.CONDUCTOR',
            'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.CONDUCTIVE_FILLED_AREA'] *
            TYPEOF(SELF\Stratum_feature_template_component.implementation_or_resident_stratum)) = 1;
      WR3: centreline_shape.parameters = derived_from.trace_style;            
      WR4 : SIZEOF(QUERY(ciet <* SELF\Conductive_interconnect_element.access_mechanisms |
             NOT(ciet.location.resident_design_layer_stratum = 
            SELF\Stratum_feature_template_component.implementation_or_resident_stratum.resident_stratum)
                  )) = 0;
  END_ENTITY;

  ENTITY Conductor
    SUBTYPE OF (Stratum_feature);
      SELF\Stratum_feature.resident_stratum : Design_layer_stratum;
      implementation_requirement            : Intra_stratum_join_relationship;
    WHERE
      WR1 : NOT EXISTS(SELF\Shape_element.description);
  END_ENTITY;

  ENTITY Connected_area_component
    SUBTYPE OF (Area_component);
      associated_layer_connection_point : SET[1:?] OF Layer_connection_point;
  END_ENTITY;

  ENTITY Connected_filled_area
    SUBTYPE OF (Conductive_filled_area);
      SELF\Stratum_feature.resident_stratum : Design_layer_stratum;
      implementation_requirement            : Intra_stratum_join_relationship;
  END_ENTITY;

  ENTITY Cutout
    SUPERTYPE OF (ONEOF (Physical_connectivity_interrupting_cutout,
 Plated_cutout,
 Partially_plated_cutout))
    SUBTYPE OF (Inter_stratum_feature);
    vertical_reference : OPTIONAL Interconnect_module_edge;
    WHERE
      WR1: NOT EXISTS(SELF\Product_view_definition.name);
      WR2: SIZEOF(QUERY(shape <* SELF\Inter_stratum_feature.derived_from\Geometric_template.shapes |
        NOT ('CONSTRUCTIVE_SOLID_GEOMETRY_2D_ARM.SINGLE_BOUNDARY_CSG_2D_MODEL' IN TYPEOF(shape)))) = 0;      
      WR3: EXISTS(SELF\Inter_stratum_feature.vertical_extent) XOR EXISTS(vertical_reference);
  END_ENTITY;

  ENTITY Cutout_edge_segment
    SUPERTYPE OF (Plated_cutout_edge_segment)
    SUBTYPE OF (Inter_stratum_feature);
      composed_cutout                             : Cutout;
      start_vertex                                : Edge_segment_vertex;
      end_vertex                                  : Edge_segment_vertex;
      SELF\Inter_stratum_feature.derived_from : Inter_stratum_feature_edge_segment_template;
    WHERE
      WR1 : start_vertex :<>: end_vertex;
  END_ENTITY;

  ENTITY Dependent_thermal_isolation_removal_component
    SUBTYPE OF (Material_removal_structured_component);
      SELF\Definition_based_product_occurrence.derived_from : Dependent_thermal_isolation_removal_template;
      associated_land : Land;
    WHERE
      WR1 : associated_land\Definition_based_product_occurrence.derived_from :=:
            SELF\Definition_based_product_occurrence.derived_from\Dependent_thermal_isolation_removal_template.associated_item;
  END_ENTITY;

  ENTITY Derived_stratum
     SUBTYPE OF (Stratum);
   WHERE
     WR1: SIZEOF(QUERY(sbpise <* USEDIN(SELF, 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.INTER_STRATUM_EXTENT.INCLUDED_STRATUM')|
                      ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.STRATUM_BASED_PATTERN_INTER_STRATUM_EXTENT' IN TYPEOF(sbpise))))=1;
  END_ENTITY;

  ENTITY Design_layer_stratum
    SUBTYPE OF (Stratum);
      primary_design_layer_stratum : BOOLEAN;
      SELF\Stratum.of_technology   : Design_layer_technology;
    INVERSE
      existence_dependence : SET[1:?] OF layer_connection_point FOR resident_design_layer_stratum;
    WHERE
      WR1 : (NOT (primary_design_layer_stratum) AND (SIZEOF(QUERY(imps <* USEDIN(SELF,
 'DESIGN_SPECIFIC_ASSIGNMENT_TO_INTERCONNECT_USAGE_VIEW_ARM.STRATUM_CONCEPT_TO_PHYSICAL_USAGE_VIEW_ASSIGNMENT.' + 'ASSIGNED_DESIGN_OBJECT') | ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.INTERCONNECT_MODULE_PRIMARY_SURFACE' IN TYPEOF(imps.defined_part_feature)))) = 0)) OR ((primary_design_layer_stratum) AND (SIZEOF(QUERY(imps <* USEDIN(SELF,
 'DESIGN_SPECIFIC_ASSIGNMENT_TO_INTERCONNECT_USAGE_VIEW_ARM.STRATUM_CONCEPT_TO_PHYSICAL_USAGE_VIEW_ASSIGNMENT.' + 'ASSIGNED_DESIGN_OBJECT') | ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.INTERCONNECT_MODULE_PRIMARY_SURFACE' IN TYPEOF(imps.defined_part_feature)))) = 1));
  END_ENTITY;

  ENTITY Dielectric_material_passage
    SUBTYPE OF (Inter_stratum_feature);
      feature_material  : OPTIONAL material_or_specification;
      precedent_passage : Cutout;
    WHERE
      WR1 : NOT EXISTS(SELF\Product_view_definition.name);
  END_ENTITY;

  ENTITY Documentation_layer_stratum
    SUBTYPE OF (Stratum);
      SELF\Stratum.of_technology : Documentation_layer_technology;
  END_ENTITY;

  ENTITY Electrical_isolation_laminate_component
    SUBTYPE OF (Material_removal_laminate_component);
      SELF\Definition_based_product_occurrence.derived_from : Electrical_isolation_removal_template;
  END_ENTITY;

  ENTITY Embedded_physical_component_terminal
    SUBTYPE OF (Laminate_component_join_terminal);
      SELF\Component_feature.definition           : bare_die_terminal_or_packaged_part_terminal;
      SELF\Component_feature.associated_component : bare_die_component_or_packaged_component;
    WHERE
      WR1 : NOT EXISTS(SELF\Shape_element.description);
  END_ENTITY;

  ENTITY Fiducial
    SUBTYPE OF (Laminate_component);
  END_ENTITY;

  ENTITY Fiducial_stratum_feature
    SUBTYPE OF (Stratum_feature);
  END_ENTITY;

  ENTITY Filled_via
    SUBTYPE OF (Via);
      SELF\Definition_based_product_occurrence.derived_from : Filled_via_template;
  END_ENTITY;  

  ENTITY Footprint_occurrence
    SUBTYPE OF (Structured_layout_component);
      SELF\Definition_based_product_occurrence.derived_from : Generic_footprint_definition;
  END_ENTITY;

  ENTITY Footprint_occurrence_sub_assembly_relationship
	SUBTYPE OF (Structured_layout_component_sub_assembly_relationship);
      SELF\Structured_layout_component_sub_assembly_relationship.relating_view : Footprint_occurrence;	
      SELF\Structured_layout_component_sub_assembly_relationship.related_view : Laminate_component;
      SELF\Structured_layout_component_sub_assembly_relationship.first_location RENAMED terminal_location : Part_feature_based_template_location;
      SELF\Structured_layout_component_sub_assembly_relationship.second_location RENAMED sub_assembly_reference_designation : Template_location_in_structured_template; 
   UNIQUE
      UR1 : sub_assembly_reference_designation,
       relating_view,
       terminal_location;
    WHERE
      WR1 : terminal_location.assembly :=: relating_view.derived_from;
      WR2 : terminal_location.template :=: sub_assembly_reference_designation.assembly;
      WR3 : 'PART_TEMPLATE_2D_SHAPE_ARM.PADSTACK_DEFINITION' IN TYPEOF(sub_assembly_reference_designation.assembly);
  END_ENTITY;

  ENTITY Generic_physical_network
    ABSTRACT SUPERTYPE OF (ONEOF(Unrouted_physical_network, Routed_physical_network));
      name                                         : STRING;
      current_associated_definition                : Interconnect_module;
      prior_associated_definition                  : OPTIONAL SET[1:?] OF Interconnect_module;      
      connectivity_requirement_element             : SET[1:?] OF Laminate_component_join_terminal;
      reference_connected_terminals                : OPTIONAL Part_connected_terminals_definition;    
      unrouted_connectivity_requirement_element    : OPTIONAL SET[1:?] OF Unrouted_join_relationship;
    UNIQUE
      UR1 : name,
 current_associated_definition;
 		WHERE
      WR1 : NOT (EXISTS(prior_associated_definition)) OR NOT (current_associated_definition IN prior_associated_definition); 
  END_ENTITY; 

  ENTITY Interface_access_material_removal_laminate_component
    SUBTYPE OF (Material_removal_laminate_component);
      accessed_interface : Laminate_component_interface_terminal;
  END_ENTITY;

  ENTITY Inter_stratum_extent
    SUBTYPE OF (Part_definition_relationship);
      SELF\View_definition_relationship.relating_view RENAMED from_stratum : Stratum;
      SELF\View_definition_relationship.related_view RENAMED to_stratum    : Stratum;
    DERIVE
      included_stratum : SET [1:?] OF Stratum := get_included_stratum(from_stratum,to_stratum);
    WHERE
      WR1 : NOT EXISTS(SELF\View_definition_relationship.relation_type);
  END_ENTITY;

  ENTITY Inter_stratum_feature
		ABSTRACT SUPERTYPE OF (ONEOF (Unsupported_passage,
			Plated_inter_stratum_feature))  
    SUBTYPE OF (Laminate_component);
      feature_of_size                                       : BOOLEAN;
      vertical_extent                                       : OPTIONAL Passage_technology_allocation_to_stack_model;
      SELF\Definition_based_product_occurrence.derived_from : Inter_stratum_feature_template;
    WHERE
      WR1: NOT EXISTS(vertical_extent) OR (SIZEOF(QUERY(nauor <* SELF\Assembly_component.occurrence_contexts |
         NOT(('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.INTERCONNECT_MODULE' IN TYPEOF(nauor\View_definition_relationship.relating_view)) AND             
              (vertical_extent\Passage_technology_allocation_to_stack_model.associated_stackup =
                   nauor\View_definition_relationship.relating_view.stackup_model[1].concept))
                   )) = 0);
  END_ENTITY;

  ENTITY Inter_stratum_join_relationship
    SUBTYPE OF (Routed_join_relationship);
      points_to_be_connected : SET[2:?] OF Layer_connection_point;
  END_ENTITY;

  ENTITY Interconnect_connection_zone_position_relationship;
      associating_design_view_shape               : Geometric_model;
      associated_usage                            : Connection_zone_in_design_view;
      associated_connection_zone_shape_definition : Geometric_model;
      associated_usage_placement                  : Axis_placement;
      associating_design_view                     : Interconnect_module;
  END_ENTITY;

  ENTITY Interconnect_module
  	SUPERTYPE OF (Pcb)
    SUBTYPE OF (Assembly_definition, Part_design_view);
    INVERSE
      of_fabrication_thickness_requirement : SET[0:?] OF requirement_assignment FOR assigned_to;
      stackup_model : SET[0:1] OF Stratum_stack_model_to_interconnect_assignment FOR design;
    WHERE
      WR1 : SIZEOF(QUERY(ftr <* of_fabrication_thickness_requirement | NOT ('FABRICATION_REQUIREMENT_ARM.FABRICATION_THICKNESS_REQUIREMENT_OCCURRENCE' IN TYPEOF(ftr\Requirement_assignment.assigned_requirement)))) = 0;
      WR2 : (SIZEOF(USEDIN(SELF,'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.INTERCONNECT_MODULE_STRATUM_ASSEMBLY_RELATIONSHIP.' + 'ASSEMBLY')) = 0)
      OR
      (SIZEOF(QUERY(imsar <* USEDIN(SELF, 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.INTERCONNECT_MODULE_STRATUM_ASSEMBLY_RELATIONSHIP.' + 'ASSEMBLY') | 
              (('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.DESIGN_LAYER_STRATUM' IN TYPEOF(imsar.component)) AND 
               (imsar.component\Design_layer_stratum.primary_design_layer_stratum = TRUE)))) = 1);
      WR3: NOT EXISTS (SELF\Product_view_definition.additional_characterization);
      WR4 : SIZEOF(QUERY(vdr <* USEDIN(SELF, 'PRODUCT_VIEW_DEFINITION_RELATIONSHIP_ARM.VIEW_DEFINITION_RELATIONSHIP.' + 'RELATING_VIEW') | 
              (('ASSEMBLY_STRUCTURE_ARM.ASSEMBLY_COMPONENT_RELATIONSHIP' IN TYPEOF(vdr)) AND
              ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.INTERCONNECT_MODULE_EDGE' IN TYPEOF(vdr.related_view)))
                  )) = 1;
  END_ENTITY;

  ENTITY Interconnect_module_edge
    SUPERTYPE OF (ONEOF (Partially_plated_interconnect_module_edge,
 Plated_interconnect_module_edge))
    SUBTYPE OF (Inter_stratum_feature);
    WHERE
      WR1: SIZEOF(QUERY(shape <* SELF\Inter_stratum_feature.derived_from\Geometric_template.shapes |
        NOT ('CONSTRUCTIVE_SOLID_GEOMETRY_2D_ARM.SINGLE_BOUNDARY_CSG_2D_MODEL' IN TYPEOF(shape)))) = 0;
      WR2: NOT EXISTS(SELF\Inter_stratum_feature.vertical_extent);
  END_ENTITY;

  ENTITY Interconnect_module_edge_segment
    SUPERTYPE OF (ONEOF(Plated_interconnect_module_edge_segment,
                        Unplated_interconnect_module_edge_segment))
    SUBTYPE OF (Inter_stratum_feature);
      composed_edge                               : Interconnect_module_edge;
      start_vertex                                : Edge_segment_vertex;
      end_vertex                                  : Edge_segment_vertex;
      SELF\Inter_stratum_feature.derived_from : Inter_stratum_feature_edge_segment_template;
    WHERE
      WR1 : start_vertex :<>: end_vertex;
  END_ENTITY;

  ENTITY Interconnect_module_macro_terminal
    SUBTYPE OF (Interconnect_module_terminal);
    INVERSE
      defining_terminal : component_feature_to_physical_usage_view_assignment FOR defined_part_feature;
    WHERE
      WR1 : SIZEOF(['LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.COMPONENT_TERMINATION_PASSAGE_JOIN_TERMINAL',
 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.VIA_TERMINAL',
 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.PRINTED_COMPONENT_JOIN_TERMINAL',
 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.CONDUCTIVE_INTERCONNECT_ELEMENT_TERMINAL',
 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.LAND_JOIN_TERMINAL'] * TYPEOF(defining_terminal.assigned_design_object)) = 1;
  END_ENTITY;

  ENTITY Interconnect_module_stratum_assembly_relationship;
      assembly              : Interconnect_module;
      component             : Stratum;
      reference_designation : STRING; 
    UNIQUE
      UR1 : assembly,
 reference_designation;
  END_ENTITY;

  ENTITY Interface_access_stratum_feature_template_component
    SUBTYPE OF (Stratum_feature_template_component);
      accessed_interface : Laminate_component_interface_terminal;
  END_ENTITY;

  ENTITY Internal_probe_access_area
    SUBTYPE OF (Probe_access_area);
      stratum_feature_implementation : Stratum_feature;
    INVERSE
      internal_access : internal_stratum_access FOR connected_probe;
  END_ENTITY;

  ENTITY Internal_stratum_access;
      connected_probe       : Internal_probe_access_area;
      inter_stratum_feature : Via;
    UNIQUE
      UR1 : connected_probe,
 Inter_stratum_feature;
  END_ENTITY;

  ENTITY Intra_stratum_join_relationship
    SUBTYPE OF (Routed_join_relationship);
      points_to_be_connected : SET[2:?] OF Layer_connection_point;
    DERIVE
      associated_stratum : Design_layer_stratum := points_to_be_connected[1].resident_design_layer_stratum;
    INVERSE
      ordered_implementation : SET[0:1] OF conductor FOR implementation_requirement;
      random_implementation  : SET[0:1] OF connected_filled_area FOR implementation_requirement;
    WHERE
      WR1 : (EXISTS(ordered_implementation)) XOR (EXISTS(random_implementation));
      WR2 : SIZEOF(QUERY(ptbc <* points_to_be_connected |
            NOT(ptbc.resident_design_layer_stratum = associated_stratum)
              )) = 0;
  END_ENTITY;

  ENTITY Join_relationship
    ABSTRACT SUPERTYPE OF (ONEOF (Routed_join_relationship,
	 	Unrouted_join_relationship));
      associated_layout : Interconnect_module;
  END_ENTITY;

  ENTITY Join_two_physical_connectivity_definition_supporting_printed_component
    SUBTYPE OF (Conductive_interconnect_element_with_pre_defined_transitions);
      joined_definitions : SET[2:2] OF Physical_connectivity_definition;
  END_ENTITY;

  ENTITY Laminate_component
		SUPERTYPE OF (ONEOF (Conductive_interconnect_element,
		    Material_removal_laminate_component,
			Stratum_feature_template_component ANDOR Probe_access_area,
			Inter_stratum_feature,
			Laminate_text_component,
			Laminate_text_string_component) ANDOR
			Fiducial)
    SUBTYPE OF (Assembly_component);
      SELF\Definition_based_product_occurrence.derived_from : Template_definition;
    INVERSE
	  cad_layer						: SET[0:1] OF External_source_identification FOR item;      	  
    WHERE
    WR1:('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.INTERCONNECT_MODULE' IN TYPEOF(SELF\Assembly_component.occurrence_contexts[1]\View_definition_relationship.relating_view))
         OR
        ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.STRUCTURED_LAYOUT_COMPONENT_SUB_ASSEMBLY_RELATIONSHIP' IN TYPEOF(SELF\Assembly_component.occurrence_contexts[1]));
    WR2: SIZEOF(QUERY(oc <* SELF\Assembly_component.occurrence_contexts |
                NOT(TYPEOF(oc) = TYPEOF(SELF\Assembly_component.occurrence_contexts[1]))
                )) = 0;
  END_ENTITY;

  ENTITY Laminate_component_feature
    ABSTRACT SUPERTYPE OF (ONEOF (Conductive_interconnect_element_terminal,
 Laminate_component_interface_terminal,
 Laminate_component_join_terminal,
 Via_terminal))
    SUBTYPE OF (Component_feature);
  END_ENTITY;

  ENTITY Laminate_component_interface_terminal
    ABSTRACT SUPERTYPE 
    SUBTYPE OF (Laminate_component_feature);
  END_ENTITY;

  ENTITY Laminate_component_join_terminal
    ABSTRACT SUPERTYPE 
    SUBTYPE OF (Laminate_component_feature,
 Component_terminal);
    INVERSE
      node_implementation : SET[0:1] OF Generic_physical_network FOR connectivity_requirement_element;
  END_ENTITY;

  ENTITY Laminate_group_component_make_from_relationship
    SUBTYPE OF (Component_make_from_relationship);
      SELF\Component_make_from_relationship.reusable_component  : Assembly_group_component;
      SELF\Component_make_from_relationship.resultant_component : Assembly_group_component;
      stratum_mapping                                           : SET[1:?] OF Part_definition_relationship;
    WHERE
     WR1: SIZEOF(QUERY(sar <* SELF\Component_make_from_relationship.reusable_component.components | NOT ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.LAMINATE_COMPONENT' IN TYPEOF(sar\view_definition_relationship.related_view)))) = 0;
     WR2: SIZEOF(QUERY(sar <* SELF\Component_make_from_relationship.resultant_component.components | NOT ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.LAMINATE_COMPONENT' IN TYPEOF(sar\view_definition_relationship.related_view)))) = 0;

  END_ENTITY;

  ENTITY Laminate_text_component
    SUBTYPE OF (Laminate_component);
      SELF\Definition_based_product_occurrence.derived_from : Part_text_template;
      stratum_feature_implementation           : SET[1:?] OF Stratum_feature;
	DERIVE
      of_character : STRING(1) := SELF\laminate_text_component.derived_from.of_character.character;      
    WHERE
      WR1 : NOT EXISTS(SELF\Product_view_definition.name);
  END_ENTITY;

  ENTITY Laminate_text_string_component
    SUBTYPE OF (Array_placement_group,
 Laminate_component);
      SELF\Definition_based_product_occurrence.derived_from : Part_string_template;
      message_contents            : Text_literal_with_extent;
    WHERE
      WR1 : SIZEOF(QUERY(sar <* SELF\Assembly_group_component.components | 
            NOT ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.LAMINATE_TEXT_COMPONENT' IN  TYPEOF(sar.related_view)) )) = 0;  
      WR2 : NOT EXISTS(SELF\Product_view_definition.name);
  END_ENTITY;

  ENTITY Layer_connection_point
    ABSTRACT SUPERTYPE
    SUBTYPE OF (Shape_element);
      SELF\Shape_element.element_name : STRING;
      location_2d                   : OPTIONAL Cartesian_point;
      location_3d                   : OPTIONAL Cartesian_point;
      SELF\Shape_element.containing_shape RENAMED resident_design_layer_stratum : Design_layer_stratum;
    DERIVE
      aggregate_join    : SET[1:?] OF join_relationship := 
           make_aggregate_join(
               inter_join_path,
               intra_join_path,
               embedded_physical_component_path,
               unrouted_join_path);
      reference_network : Generic_physical_network := aggregate_join[1].network_topology;
    INVERSE
      inter_join_path         : SET[0:1] OF Inter_stratum_join_relationship FOR points_to_be_connected;
      intra_join_path         : SET [0:1] OF Intra_stratum_join_relationship FOR points_to_be_connected;
      embedded_physical_component_path : SET[0:?] OF Stratum_embedded_physical_component_join_relationship FOR point_to_be_connected;
      unrouted_join_path         : SET [0:1] OF Unrouted_join_relationship FOR unrouted_lcp;
    UNIQUE
      UR1 : SELF\Shape_element.element_name, resident_design_layer_stratum;
    WHERE
      WR1 : EXISTS(location_2d) OR EXISTS(location_3d);
      WR2 : NOT (EXISTS(location_2d)) OR ((SIZEOF(location_2d\Cartesian_point.coordinates)) = 2);
      WR3 : NOT (EXISTS(location_3d)) OR ((SIZEOF(location_3d\Cartesian_point.coordinates)) = 3);
      WR4 : SIZEOF(QUERY(jr <* aggregate_join | jr.network_topology <> reference_network)) = 0;
      WR5 : EXISTS(reference_network); 
      WR6: NOT EXISTS (SELF\Shape_element.description);
  END_ENTITY;

  ENTITY Layout_junction;
      name                  : STRING;  
      associated_definition : Interconnect_module;
      net                   : Generic_physical_network;
      location              : Cartesian_point;
    UNIQUE
      UR1 : location,
 net;
      UR2 : name,
 net;
    WHERE
      WR1 : associated_definition :=: net.current_associated_definition;
  END_ENTITY;

  ENTITY Library_reference_view_definition_relationship
    SUBTYPE OF (View_definition_relationship);
  WHERE
    WR1 : NOT EXISTS(SELF\View_definition_relationship.relation_type);
  END_ENTITY;

  ENTITY Material_removal_laminate_component
    SUPERTYPE OF (Electrical_isolation_laminate_component)
    SUBTYPE OF (Laminate_component);
      causal_item                                           : OPTIONAL restriction_basis_item;
      design_intent                                         : SET[1:?] OF stratum_feature_template_component_or_stratum;
      SELF\Definition_based_product_occurrence.derived_from : material_removal_feature_template_or_parametric_template;
      explicitly_created                                    : BOOLEAN;
    WHERE
      WR1:   SIZEOF(QUERY(sa <* design_intent | NOT(
         NOT('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.STRATUM' IN TYPEOF(sa)) OR
           (SIZEOF(design_intent) = 1)))) = 0;
  END_ENTITY;

  ENTITY Material_removal_structured_component
    SUBTYPE OF (Structured_layout_component);
      SELF\Definition_based_product_occurrence.derived_from : Material_removal_structured_template;
    WHERE
      WR1 : NOT EXISTS(SELF\Product_view_definition.name);
  END_ENTITY;

  ENTITY Multi_layer_material_removal_laminate_component
    SUBTYPE OF (Material_removal_laminate_component);
      derived_layer_geometry : Stratum_feature_based_derived_pattern;
  END_ENTITY;

  ENTITY Multi_stratum_special_symbol_component
    SUBTYPE OF (Structured_layout_component);
      SELF\Definition_based_product_occurrence.derived_from : Multi_stratum_special_symbol_template;
    WHERE
      WR1 : NOT EXISTS(SELF\Product_view_definition.name);
  END_ENTITY;

  ENTITY Multi_layer_stratum_feature
    SUBTYPE OF (Stratum_feature);
      derived_layer_geometry : Stratum_feature_based_derived_pattern;
    WHERE
      WR1: SELF\Stratum_feature.resident_stratum = derived_layer_geometry.reference_stratum_feature.resident_stratum;
  END_ENTITY;

  ENTITY Multi_layer_stratum_feature_template_component
    SUBTYPE OF (Stratum_feature_template_component);
      derived_layer_geometry : Stratum_feature_based_derived_pattern;
    WHERE
      WR1: SELF\Stratum_feature_template_component.implementation_or_resident_stratum\Stratum_feature.resident_stratum
        :=: derived_layer_geometry.reference_stratum_feature.resident_stratum;
  END_ENTITY;

  ENTITY Padstack_occurrence
    SUBTYPE OF (Structured_layout_component);
      SELF\Definition_based_product_occurrence.derived_from : Padstack_definition;
    INVERSE
      SELF\Assembly_group_component.components : SET [1:?] OF Structured_layout_component_sub_assembly_relationship FOR relating_view;
    WHERE
      WR1 : SIZEOF(QUERY(sar <* components |
            EXISTS(sar.second_location)
                  )) = 0;
  END_ENTITY;

  ENTITY Partially_plated_cutout
    SUBTYPE OF (Cutout);
    INVERSE
      plated_segment   : SET[1:?] OF Plated_cutout_edge_segment FOR composed_cutout;
      unplated_segment : SET[1:?] OF Unplated_cutout_edge_segment FOR composed_cutout;
  END_ENTITY;
  
  ENTITY Partially_plated_interconnect_module_edge
    SUBTYPE OF (Interconnect_module_edge);
    INVERSE
      plated_segment   : SET[1:?] OF Plated_interconnect_module_edge_segment FOR composed_edge;
      unplated_segment : SET[1:?] OF Unplated_interconnect_module_edge_segment FOR composed_edge;
    WHERE
      WR1 : NOT EXISTS(SELF\Product_view_definition.name);
  END_ENTITY;

  ENTITY Pcb
    SUBTYPE OF (Interconnect_module);
      SELF\Part_design_view.usage_view : OPTIONAL Pcb_usage_view;
    INVERSE
      SELF\Interconnect_module.stackup_model : SET [1:1] OF Stratum_stack_model_to_interconnect_assignment FOR design;
  END_ENTITY;

  ENTITY Physical_connectivity_interrupting_cutout
    SUBTYPE OF (Cutout);
      interrupted_connectivity_element : SET[1:?] OF Conductive_interconnect_element;
  END_ENTITY;

  ENTITY Plated_cutout
    SUBTYPE OF (Cutout,
 Plated_inter_stratum_feature);
  END_ENTITY;

  ENTITY Plated_cutout_edge_segment
    SUBTYPE OF (Cutout_edge_segment,
 Plated_inter_stratum_feature);
      SELF\Cutout_edge_segment.composed_cutout : Partially_plated_cutout;
  END_ENTITY;

  ENTITY Plated_inter_stratum_feature
    ABSTRACT SUPERTYPE OF (ONEOF (Plated_cutout,
		 Plated_interconnect_module_edge,
		 Plated_cutout_edge_segment,
		 Plated_interconnect_module_edge_segment,
		 Plated_passage))
    SUBTYPE OF (Inter_stratum_feature);
    WHERE
      WR1 : SELF\Inter_stratum_feature.vertical_extent.allocated_technology.plated_passage = TRUE;
  END_ENTITY;

  ENTITY Plated_interconnect_module_edge
    SUBTYPE OF (Interconnect_module_edge,
 Plated_inter_stratum_feature);
    WHERE
      WR1 : NOT EXISTS(SELF\Product_view_definition.name);
  END_ENTITY;

  ENTITY Plated_interconnect_module_edge_segment
    SUBTYPE OF (Plated_inter_stratum_feature,
 Interconnect_module_edge_segment);
      SELF\Interconnect_module_edge_segment.composed_edge : Partially_plated_interconnect_module_edge;
  END_ENTITY;

  ENTITY Plated_passage
    SUPERTYPE OF (ONEOF (Component_termination_passage,
 Via))
    SUBTYPE OF (Plated_inter_stratum_feature);
    WHERE
      WR1 : NOT EXISTS(SELF\Product_view_definition.name);
  END_ENTITY;

  ENTITY Primary_stratum_indicator_symbol
    SUBTYPE OF (Single_stratum_special_symbol_component);
  END_ENTITY;

  ENTITY Probe_access_area
    SUPERTYPE OF (Internal_probe_access_area)
    SUBTYPE OF (Laminate_component, Shape_feature);
    	SELF\Definition_based_product_occurrence.derived_from : Stratum_feature_template;
        probed_layout_item                                    : Stratum_feature;
        SELF\Shape_feature.connection_area                    : SET[1:1] OF Connection_zone_in_design_view;
    	stratum_feature_material_stackup                      : OPTIONAL Multi_layer_stratum_feature;
    DERIVE
      SELF\shape_element.containing_shape : Probe_access_area := SELF;
      SELF\shape_feature.element_name : STRING := '';      
    INVERSE
      network : Routed_physical_network FOR probe;
  END_ENTITY;

  ENTITY Routed_join_relationship
    ABSTRACT SUPERTYPE OF (ONEOF (
        Inter_stratum_join_relationship,
		Intra_stratum_join_relationship,
	 	Stratum_embedded_physical_component_join_relationship))
    SUBTYPE OF (Join_relationship);
    INVERSE
      network_topology : Routed_physical_network FOR routed_connectivity_requirement_element;
  END_ENTITY;

  ENTITY Routed_physical_network
    SUBTYPE OF (Generic_physical_network);
      SELF\Generic_physical_network.connectivity_requirement_element : SET[2:?] OF Laminate_component_join_terminal;    
      routed_connectivity_requirement_element 	                     : SET[1:?] OF Routed_join_relationship;
      probe                                                          : OPTIONAL SET[1:?] OF Probe_access_area;
    DERIVE
    	complete	: BOOLEAN := NOT EXISTS(unrouted_connectivity_requirement_element);
    WHERE
      WR1 : SIZEOF(QUERY(cre <* connectivity_requirement_element | NOT (NOT ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.LAND_JOIN_TERMINAL' IN TYPEOF(cre)) OR (SIZEOF(TYPEOF(cre\Component_feature.associated_component) * ['LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.CONTACT_SIZE_DEPENDENT_LAND']) = 1)))) = 0;
      WR2: reference_connected_terminals.associated_definition = SELF\Generic_physical_network.current_associated_definition\Part_design_view.usage_view;
  END_ENTITY; 

  ENTITY Single_stratum_special_symbol_component
    SUPERTYPE OF (Primary_stratum_indicator_symbol)
    SUBTYPE OF (Structured_layout_component);
      SELF\Definition_based_product_occurrence.derived_from : Single_stratum_special_symbol_template;
    WHERE
      WR1 : NOT EXISTS(SELF\Product_view_definition.name);
  END_ENTITY;

  ENTITY Stratum
    SUPERTYPE OF (ONEOF (Documentation_layer_stratum,
 Design_layer_stratum))
    SUBTYPE OF (Part_view_definition, Item_shape);
      SELF\Product_view_definition.id : STRING;
      of_technology 			: Stratum_technology;
    DERIVE
      of_average_surface 	: SET[0:1] OF stratum_average_surface := 
        QUERY(tmp <* of_surface | 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.STRATUM_AVERAGE_SURFACE' IN TYPEOF(tmp));

      SELF\Item_shape.described_element : shapeable_item := SELF;
      
      of_product_version : SET [1:?] OF product_version := 
          bag_to_set(QUERY(pv <* USEDIN(assembly[1].assembly.defined_version.of_product, 'PRODUCT_VERSION_ARM.PRODUCT_VERSION.OF_PRODUCT') | 
                (SIZEOF(QUERY( pd <* USEDIN(pv, 'PRODUCT_VIEW_DEFINITION_ARM.PRODUCT_VIEW_DEFINITION.DEFINED_VERSION') |
                     (SIZEOF(QUERY(nauo <* USEDIN(pd, 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.INTERCONNECT_MODULE_STRATUM_ASSEMBLY_RELATIONSHIP.ASSEMBLY') | (SELF = nauo.component))) = 1)
                     )) = 1)
               ));
      base_component : SET [0:?] OF Area_component := get_base_component(SELF);               
    INVERSE
      of_surface         	: SET[1:3] OF stratum_surface FOR of_stratum;
      assembly           	: SET[1:?] OF interconnect_module_stratum_assembly_relationship FOR component;
	  stratum_usage			: SET[0:1] OF External_source_identification FOR item;      
	  material_product      : SET [0:1] OF Make_from_relationship FOR related_view;
   WHERE
    WR1: SIZEOF(QUERY(tmp <* of_surface | tmp\Stratum_surface.name = stratum_surface_designation.average_surface)) <= 1;
    WR2: NOT(SIZEOF(QUERY(tmp <* of_surface | tmp\Stratum_surface.name = stratum_surface_designation.average_surface)) = 1) OR
            (SIZEOF(of_surface) < 3);    
    WR3: SIZEOF(QUERY(tmp <* of_surface | tmp\Stratum_surface.name = stratum_surface_designation.primary_surface)) <= 1;
    WR4: SIZEOF(QUERY(tmp <* of_surface | tmp\Stratum_surface.name = stratum_surface_designation.secondary_surface)) <= 1;
    WR5: NOT(SIZEOF(QUERY(tmp <* of_surface | tmp\Stratum_surface.name = stratum_surface_designation.secondary_surface)) = 1) OR
            (SIZEOF(QUERY(tmp <* of_surface | tmp\Stratum_surface.name = stratum_surface_designation.primary_surface)) = 1);
    WR6: NOT EXISTS (SELF\Product_view_definition.additional_characterization);
    WR7: SIZEOF(QUERY(asse <* assembly |
                NOT(asse.assembly.defined_version.of_product = assembly[1].assembly.defined_version.of_product)
         )) = 0;
    WR8: SIZEOF(of_product_version) = SIZEOF(assembly);
    WR9: SELF\Product_view_definition.defined_version IN of_product_version;
    WR10: NOT ( SIZEOF(material_product)= 1) OR (material_product[1].relating_view IN               
          of_technology.stratum_material.items);   
    WR11: SIZEOF(base_component) < 2;
  END_ENTITY;

  ENTITY Stratum_average_surface
      SUBTYPE OF (Stratum_surface);
   WHERE
    WR1 : SELF\Stratum_surface.name = stratum_surface_designation.average_surface;
  END_ENTITY;

  ENTITY Stratum_based_pattern;
      name        : STRING;  
      extent      : Inter_stratum_extent;
    INVERSE
      layer_usage	: SET[0:1] OF External_source_identification FOR item;
    UNIQUE
      UR1 : name;
  END_ENTITY;

  ENTITY Stratum_based_pattern_inter_stratum_extent
    SUBTYPE OF (Inter_stratum_extent);
      reference_stratum : Stratum;
    WHERE
      WR1: reference_stratum IN SELF\Inter_stratum_extent.included_stratum;

      WR2: SIZEOF(QUERY(rs <* SELF\Inter_stratum_extent.included_stratum | 
      (SIZEOF(['LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.DESIGN_LAYER_STRATUM',
               'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.DOCUMENTATION_LAYER_STRATUM'] * TYPEOF(rs)) = 1)
                  )) = 1;
  END_ENTITY;

  ENTITY Stratum_embedded_physical_component_join_relationship
    SUBTYPE OF (Routed_join_relationship);
      terminal_to_be_connected : SET[1:?] OF Embedded_physical_component_terminal;
      point_to_be_connected    : SET[1:?] OF Layer_connection_point;
    DERIVE
      associated_component : Assembly_component := terminal_to_be_connected[1]\Component_feature.associated_component;
    WHERE
      WR1 : SIZEOF(QUERY(t <* terminal_to_be_connected | t.associated_component <> associated_component)) = 0;
  END_ENTITY;

  ENTITY Stratum_feature
		SUPERTYPE OF (ONEOF (Conductor,
 			Conductive_filled_area) ANDOR (Fiducial_stratum_feature))    
		SUBTYPE OF (Shape_element); 			
      SELF\Shape_element.containing_shape RENAMED resident_stratum  : Stratum;
      SELF\Shape_element.element_name : STRING;
      feature_of_size                                               : BOOLEAN;
    UNIQUE
      UR1 : SELF\Shape_element.element_name, resident_stratum;
    WHERE
      WR1 : SIZEOF(query ( ac <* USEDIN(SELF,'') |
                  ('PHYSICAL_UNIT_DESIGN_VIEW_ARM.ASSEMBLY_COMPONENT' IN TYPEOF(ac))
                   AND
                  (get_assemblies(ac) <> get_ims(resident_stratum))
                  ))
                  = 0;      
  END_ENTITY;

  ENTITY Stratum_feature_based_derived_pattern;
      extent                    : Inter_stratum_extent;
      reference_stratum_feature : Stratum_feature;
    INVERSE
      layer_usage	: SET[0:1] OF External_source_identification FOR item;
    WHERE
      WR1: reference_stratum_feature\Stratum_feature.resident_stratum IN extent\Inter_stratum_extent.included_stratum;
      WR2: SIZEOF(['LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.DESIGN_LAYER_STRATUM',
                   'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.DOCUMENTATION_LAYER_STRATUM'] * TYPEOF(reference_stratum_feature\Stratum_feature.resident_stratum)) = 1;
      WR3: SIZEOF(QUERY(ds <* extent\Inter_Stratum_extent.included_stratum |
             NOT('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.DERIVED_STRATUM' IN TYPEOF(ds))
                 )) = 1;
  END_ENTITY;

  ENTITY Stratum_feature_template_component
    SUBTYPE OF (Laminate_component);
      SELF\Definition_based_product_occurrence.derived_from : stratum_feature_template_or_parametric_template;
      implementation_or_resident_stratum : stratum_feature_or_stratum; 
      causal_item : OPTIONAL restriction_basis_item;
    DERIVE
      resident_stratum : Stratum := get_resident_stratum(SELF);
    WHERE
      WR1: NOT EXISTS(SELF\Product_view_definition.name);
  END_ENTITY;

  ENTITY Stratum_stack_model_to_interconnect_assignment
    SUBTYPE OF (View_definition_relationship);
     SELF\View_definition_relationship.relating_view RENAMED concept : Design_stack_model;
     SELF\View_definition_relationship.related_view RENAMED design   : Interconnect_module;
    WHERE
     WR1 : NOT EXISTS(SELF\View_definition_relationship.relation_type);
  END_ENTITY;

  ENTITY Stratum_surface;
      name       : stratum_surface_designation;  
      of_stratum : Stratum;
    UNIQUE
      UR1 : name,
 of_stratum;
  END_ENTITY;

  ENTITY Stratum_technology_occurrence_to_stratum_mapping_relationship;
    technology_occurrence_link : Stratum_technology_occurrence_link;
    stratum_link               : Adjacent_stratum_surface_definition;
    mapping_context            : Stratum_stack_model_to_interconnect_assignment;
   UNIQUE
    UR1: mapping_context, technology_occurrence_link;
   WHERE
    WR1: technology_occurrence_link.precedent_sto.definition :=:
         stratum_link.precedent_surface.of_stratum.of_technology; 
    WR2: technology_occurrence_link.subsequent_sto.definition :=:
         stratum_link.subsequent_surface.of_stratum.of_technology; 
  END_ENTITY;

  ENTITY Structured_layout_component
    ABSTRACT SUPERTYPE OF (ONEOF (Footprint_occurrence, 
            Material_removal_structured_component,
			Multi_stratum_special_symbol_component,
            Padstack_occurrence, 
            Single_stratum_special_symbol_component))
    SUBTYPE OF (Assembly_group_component);
      SELF\Definition_based_product_occurrence.derived_from : Structured_template;
    WHERE
      WR1 : SIZEOF(TYPEOF(SELF) *
        ['LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.LAMINATE_COMPONENT',
        'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.PHYSICAL_COMPONENT']) = 0;
      WR2: SIZEOF(QUERY(agc <* SELF\Assembly_group_component.components |
        NOT('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.STRUCTURED_LAYOUT_COMPONENT_SUB_ASSEMBLY_RELATIONSHIP' IN TYPEOF(agc)))) = 0;
  END_ENTITY;

ENTITY Structured_layout_component_sub_assembly_relationship
    SUPERTYPE OF (Footprint_occurrence_sub_assembly_relationship)
    SUBTYPE OF (Next_assembly_usage_occurrence_relationship);
      SELF\View_definition_relationship.relating_view : Structured_layout_component;
      SELF\View_definition_relationship.related_view : Assembly_component;
      first_location : Template_location_in_structured_template;
      second_location : OPTIONAL Template_location_in_structured_template;
      overriding_shape : OPTIONAL Part_template_shape_model;
   DERIVE
      first_location_overridden : BOOLEAN := NOT EXISTS(second_location) AND
                  (SELF\View_definition_relationship.related_view\Assembly_component.derived_from
                   :<>: first_location.template);      
      second_location_overridden : BOOLEAN := EXISTS(second_location) AND
                  (SELF\View_definition_relationship.related_view\Assembly_component.derived_from
                   :<>: second_location.template);
    UNIQUE
      UR1 : first_location, second_location,relating_view,related_view;
    WHERE
     WR1 : NOT EXISTS(SELF\View_definition_relationship.relation_type);
     WR2 : NOT EXISTS(SELF\View_definition_relationship.id);
     WR3 : NOT EXISTS(SELF\Assembly_component_relationship.location_indicator);
     WR4 : NOT EXISTS(SELF\Assembly_component_relationship.quantity);
     WR5 : first_location_overridden OR 
          (SELF\View_definition_relationship.relating_view\Assembly_component.derived_from :=: first_location.assembly);
     WR6 : first_location :<>: second_location;
     WR7 : NOT first_location_overridden OR ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.PADSTACK_OCCURRENCE' IN TYPEOF(relating_view));
     WR8 : NOT second_location_overridden OR ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.FOOTPRINT_OCCURRENCE' IN TYPEOF(relating_view));
     WR9 : NOT (first_location_overridden AND second_location_overridden);
     WR10: NOT (EXISTS(overriding_shape) XOR (first_location_overridden OR second_location_overridden));
     WR11: NOT EXISTS(overriding_shape) OR (related_view.derived_from IN overriding_shape.shape_characterized_definition);
  END_ENTITY;

  ENTITY Unplated_cutout_edge_segment
    SUBTYPE OF (Cutout_edge_segment);
      SELF\Cutout_edge_segment.composed_cutout : Partially_plated_cutout;
   WHERE
    WR1 : NOT('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.PLATED_INTER_STRATUM_FEATURE' IN TYPEOF(SELF));
  END_ENTITY;

  ENTITY Unplated_interconnect_module_edge_segment
    SUBTYPE OF (Interconnect_module_edge_segment);
      SELF\Interconnect_module_edge_segment.composed_edge : Partially_plated_interconnect_module_edge;
   WHERE
    WR1 : NOT('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.PLATED_INTER_STRATUM_FEATURE' IN TYPEOF(SELF));
  END_ENTITY;

  ENTITY Unrouted_conductive_interconnect_element
    SUBTYPE OF (Conductive_interconnect_element);
      SELF\Stratum_feature_template_component.implementation_or_resident_stratum : Stratum;
  END_ENTITY;

  ENTITY Unrouted_join_relationship
    SUBTYPE OF (Join_relationship);
      unrouted_terminals : OPTIONAL SET[1:?] OF Laminate_component_join_terminal;
      unrouted_lcp       : OPTIONAL SET[1:?] OF Layer_connection_point;
      unrouted_junction  : OPTIONAL SET[1:?] OF Layout_junction;
      unrouted_paa       : OPTIONAL SET[1:?] OF Probe_access_area;
      unrouted_via       : OPTIONAL SET[1:?] OF Via_terminal;
    INVERSE
      network_topology : Generic_physical_network FOR unrouted_connectivity_requirement_element;
    WHERE
      WR1: (SIZEOF(unrouted_terminals) + SIZEOF(unrouted_lcp) + SIZEOF(unrouted_paa) + SIZEOF(unrouted_via) + SIZEOF(unrouted_junction)) > 0;
  END_ENTITY;

  ENTITY Unrouted_physical_network
    SUBTYPE OF (Generic_physical_network);
  END_ENTITY; 

  ENTITY Unsupported_passage
    SUBTYPE OF (Inter_stratum_feature);
      SELF\Definition_based_product_occurrence.derived_from : Unsupported_passage_template;
    WHERE
      WR1 : NOT EXISTS(SELF\Product_view_definition.name);
  END_ENTITY;

  ENTITY Via
    ABSTRACT SUPERTYPE OF (Filled_via)
    SUBTYPE OF (Plated_passage);
      SELF\Definition_based_product_occurrence.derived_from : Via_template;
  END_ENTITY;

  ENTITY Via_terminal
    SUBTYPE OF (Laminate_component_feature);
      SELF\Component_feature.definition           : Via_template_terminal;
      SELF\Component_feature.associated_component : Via;
    WHERE
      WR1 : NOT EXISTS(SELF\Shape_element.description);
  END_ENTITY;

  FUNCTION correlated_terminals(
    input1 : SET OF Conductive_interconnect_element_terminal ;
    input2 : SET OF Conductive_interconnect_element_terminal_link
  ) : BOOLEAN;

    LOCAL
      pass : BOOLEAN := FALSE;
      ciet : SET OF conductive_interconnect_element_terminal := [];
    END_LOCAL;

    REPEAT i := 1 TO SIZEOF(input2) BY 1;
      ciet := ciet + input2[i].precedent_point;
      ciet := ciet + input2[i].subsequent_point;
    END_REPEAT;
    pass := (input1 = ciet);
    RETURN(pass);
  END_FUNCTION;

FUNCTION get_base_component(input : Stratum): SET OF Area_component;
LOCAL
   sf : SET OF Stratum_feature := bag_to_set(USEDIN(input,'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.STRATUM_FEATURE.RESIDENT_STRATUM'));
   sftc : SET OF Stratum_feature_template_component := bag_to_set(
            USEDIN(input,'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.STRATUM_FEATURE_TEMPLATE_COMPONENT.IMPLEMENTATION_OR_RESIDENT_STRATUM'));
   i : INTEGER := 0;
   ac: SET OF Area_component;
END_LOCAL;
   REPEAT i := 1 TO HIINDEX(sf) BY 1;
   ac := bag_to_set(QUERY(temp <* USEDIN(sf[i],
                   'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.STRATUM_FEATURE_TEMPLATE_COMPONENT.IMPLEMENTATION_OR_RESIDENT_STRATUM') | 
                    (('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.AREA_COMPONENT' IN TYPEOF(temp)) AND
                     (temp.is_base = TRUE))));
   END_REPEAT;
   REPEAT i := 1 to HIINDEX(sftc) BY 1;
      IF(('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.AREA_COMPONENT' IN TYPEOF(sftc[i])) AND
         (sftc[i].is_base = TRUE))
      THEN
       ac := ac + sftc[i];
      END_IF;
   END_REPEAT;
  RETURN(ac);
END_FUNCTION;

  FUNCTION get_included_stratum(
    input1 : Stratum;
    input2 : Stratum
  ) : SET OF Stratum;
    RETURN (?);
  END_FUNCTION;

  FUNCTION make_aggregate_join(
    input1 : SET OF Inter_stratum_join_relationship ;
    input2 : SET OF Intra_stratum_join_relationship ;
    input3 : SET OF Stratum_embedded_physical_component_join_relationship;
    input4 : SET OF Unrouted_join_relationship) : SET OF Join_relationship;

    LOCAL
      v1 : SET OF join_relationship := input1;
    END_LOCAL;

    v1 := v1 + input2 + input3 + input4;
    RETURN(v1);
  END_FUNCTION;

FUNCTION get_assemblies(input : Assembly_component) : SET OF Product_view_definition;
LOCAL
  acr : SET OF Assembly_component_relationship := input.occurrence_contexts;
  pvd : SET OF Product_view_definition := [];
END_LOCAL;
REPEAT i := 1 TO HIINDEX(acr) BY 1;
  pvd := pvd + acr[i]\View_definition_relationship.relating_view; 
END_REPEAT;

RETURN (pvd);
END_FUNCTION;

FUNCTION get_ims(input : Stratum) : SET OF Product_view_definition;
LOCAL
  imsar : SET OF Interconnect_module_stratum_assembly_relationship := input.assembly;
  pvd : SET OF Product_view_definition := [];
END_LOCAL;
REPEAT i := 1 TO HIINDEX(imsar) BY 1;
  pvd := pvd + imsar[i].assembly; 
END_REPEAT;

RETURN (pvd);
END_FUNCTION;

FUNCTION get_resident_stratum(input: Stratum_feature_template_component) : Stratum;
   IF 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.STRATUM_FEATURE' IN TYPEOF(input.implementation_or_resident_stratum)
     THEN RETURN(input.implementation_or_resident_stratum.resident_stratum);
   ELSE 
     IF 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.STRATUM' IN TYPEOF(input.implementation_or_resident_stratum)
       THEN RETURN(input.implementation_or_resident_stratum);
     END_IF;  
   END_IF;
   RETURN(?); 
END_FUNCTION;

END_SCHEMA;

