(*
   $Id: arm.exp,v 1.121 2005/11/08 21:15:00 liutkus Exp $
   ISO TC184/SC4/WG12 N3483 - ISO/CD-TS 10303-1698 Layered interconnect module design - EXPRESS ARM
*)

SCHEMA Layered_interconnect_module_design_arm;

	USE FROM Edge_shape_feature_arm;	-- ISO/TS 10303-1673
	USE FROM Interconnect_module_usage_view_arm;	-- ISO/TS 10303-1686
	USE FROM Interconnect_physical_requirement_allocation_arm;	-- ISO/TS 10303-1689
	USE FROM Part_template_2d_shape_arm;	-- ISO/TS 10303-1716
	USE FROM Physical_connectivity_definition_arm;	-- ISO/TS 10303-1755
	USE FROM Fill_area_style_arm; -- ISO/TS 10303-1672
	USE FROM Part_template_extension_arm;	-- ISO/TS 10303-1718
	USE FROM Interconnect_module_connection_routing_arm;

	SUBTYPE_CONSTRAINT limd_assembly_component_subtypes FOR Assembly_component; 
	    (ONEOF (Physical_component,
	 	Laminate_component));
	END_SUBTYPE_CONSTRAINT;
	
	SUBTYPE_CONSTRAINT array_placement_group_subtypes FOR Array_placement_group; 
		(ONEOF (Laminate_text_string_component,
		 Linear_array_placement_group_component,
		 Rectangular_array_placement_group_component));
	END_SUBTYPE_CONSTRAINT;

	SUBTYPE_CONSTRAINT assembly_group_component_subtypes FOR Assembly_group_component; 
	    (interfaced_group_component ANDOR
	 	array_placement_group ANDOR
	 	(ONEOF (Footprint_occurrence,
	 	Padstack_occurrence)));
	END_SUBTYPE_CONSTRAINT;

	SUBTYPE_CONSTRAINT component_feature_subtypes FOR Component_feature;     
		 ONEOF (Physical_component_feature,
		 Laminate_component_feature);
	END_SUBTYPE_CONSTRAINT;

	SUBTYPE_CONSTRAINT component_terminal_subtypes FOR Component_terminal;     
		 ONEOF (Physical_component_terminal,
		 Laminate_component_join_terminal);
	END_SUBTYPE_CONSTRAINT;

	SUBTYPE_CONSTRAINT default_land_physical_template_subtypes FOR Default_land_physical_template;     
		(ONEOF (Default_passage_based_land_physical_template,
		 Default_attachment_size_based_land_physical_template));
	END_SUBTYPE_CONSTRAINT;

	SUBTYPE_CONSTRAINT Default_attachment_size_based_land_physical_template_subtypes FOR Default_attachment_size_based_land_physical_template;     
	    (ONEOF (Default_attachment_size_and_component_termination_passage_based_land_physical_template,
	 	Default_attachment_size_and_via_based_land_physical_template));
	END_SUBTYPE_CONSTRAINT;

	SUBTYPE_CONSTRAINT interconnect_module_terminal_subtypes FOR Interconnect_module_terminal;     
		(ONEOF (Interconnect_module_interface_terminal,
		 Interconnect_module_join_terminal));
	END_SUBTYPE_CONSTRAINT; 

	SUBTYPE_CONSTRAINT limd_part_view_definition_subtypes FOR Part_view_definition; 
		(ONEOF (Part_usage_view,
		Part_design_view,
		Stratum));
	END_SUBTYPE_CONSTRAINT; 

	SUBTYPE_CONSTRAINT template_definition_subtypes FOR Template_definition; 
	    (ONEOF (Generic_footprint_definition,
	    Padstack_definition,
	    Inter_stratum_feature_template,
		 Material_removal_feature_template,
		 Non_conductive_cross_section_template,
		 Printed_part_cross_section_template,
		 Printed_part_template,
		 Special_symbol_part_template,
		 Stratum_feature_template,
		 Trace_template) ANDOR
		 Part_text_template);
	END_SUBTYPE_CONSTRAINT;

 	TYPE bare_die_component_or_packaged_component = EXTENSIBLE GENERIC_ENTITY SELECT;
	END_TYPE;

 	TYPE bare_die_terminal_or_packaged_part_terminal = EXTENSIBLE GENERIC_ENTITY SELECT;
	END_TYPE;

 	TYPE component_feature_or_stratum_surface = EXTENSIBLE GENERIC_ENTITY SELECT
		(Component_feature,
		Stratum_surface);
 	END_TYPE;

  TYPE horizontal_justification = ENUMERATION OF
    (right,
     centre,
     left);
  END_TYPE;


	TYPE limd_ee_product_definition_with_annotation_elements = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON ee_product_definition_with_annotation_elements WITH 
   	(Template_definition,
   	Part_usage_view,
   	Part_design_view,
   	Stratum);
	END_TYPE; 

 	TYPE limd_external_identification_item = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON external_identification_item WITH  
		(Laminate_layer_stack,
		Stratum,
		Laminate_component);
	END_TYPE;

	TYPE limd_material_item_select = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON material_item_select WITH
		(Passage_technology);
	END_TYPE;

	TYPE limd_feature_select = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON feature_select WITH 
	   	(Printed_part_template_terminal,
	   	Land_template_terminal,
	   	Component_termination_passage_template_terminal,
	   	Via_template_terminal,
	   	Part_terminal_external_reference);
	END_TYPE; 

	TYPE limd_physical_feature_or_part_template = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON physical_feature_or_part_template WITH 
	   (Part_feature,
		Physical_component_feature,
	 	Laminate_component,
	 	Template_definition,
	 	Stratum_feature);
	END_TYPE;

	TYPE limd_requirement_assignment_item = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON requirement_assignment_item WITH 
	    (Stratum_feature_conductive_join,
	     Dielectric_crossover_area,
	    Interconnect_module);
	END_TYPE; 

	TYPE limd_documented_element_select = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON documented_element_select WITH 
	    (stratum_concept,
	     Stratum);
	END_TYPE;

	TYPE limd_trace_junction_or_via_select = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON trace_junction_or_via WITH 
		(Inter_stratum_join_relationship);
	END_TYPE;

	TYPE limd_usage_concept = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON usage_concept WITH 
		(Component_termination_passage_template_terminal,
	     Via_template_terminal);
	END_TYPE;

 	TYPE material_or_specification = SELECT
 		(Requirement_definition_property,
     	Material_identification);
	END_TYPE;

  TYPE printed_part_template_or_printed_part_cross_section_template = SELECT
    (Printed_part_template,
     Printed_part_cross_section_template);
  END_TYPE;

 	TYPE stratum_concept = EXTENSIBLE GENERIC_ENTITY SELECT
    (Laminate_component,
     Inter_stratum_feature,
     Stratum_feature,
     Stratum,
     Stratum_surface);
	END_TYPE;

	TYPE stratum_feature_or_stratum_feature_template_component = SELECT(
		Stratum_feature,
    	Stratum_feature_template_component);
	END_TYPE;

  TYPE stratum_surface_designation = ENUMERATION OF
    (average_surface,
     primary_surface,
     secondary_surface);
  END_TYPE;

  TYPE vertical_justification = ENUMERATION OF
    (centre,
     top,
     bottom);
  END_TYPE;

  ENTITY Adjacent_stratum_surface_definition;
      name               : STRING;
      precedent_surface  : Stratum_surface;
      subsequent_surface : Stratum_surface;
    UNIQUE
      UR1 : name;
      UR2 : precedent_surface,
 subsequent_surface;
    WHERE
      WR1 : precedent_surface.name = stratum_surface_designation.secondary_surface;
      WR2 : subsequent_surface.name = stratum_surface_designation.primary_surface;
  END_ENTITY;

  ENTITY Adjacent_stratum_surface_embedded_physical_component_surface_definition;
      name            : STRING;
      precedent_item  : component_feature_or_stratum_surface;
      subsequent_item : component_feature_or_stratum_surface;
    UNIQUE
      UR1 : name;
      UR2 : precedent_item,
 subsequent_item;
    WHERE
      WR1 : TYPEOF(precedent_item) <> TYPEOF(subsequent_item);
      WR2 : precedent_item <> subsequent_item;
      WR3 : NOT ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.COMPONENT_FEATURE' IN TYPEOF(precedent_item)) OR 
        (SIZEOF(['LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.BARE_DIE_SURFACE',
               'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.PACKAGE_BODY_SURFACE'] * TYPEOF(precedent_item.definition)) = 1);
      WR4 : NOT ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.COMPONENT_FEATURE' IN TYPEOF(subsequent_item)) OR 
        (SIZEOF(['LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.BARE_DIE_SURFACE',
                 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.PACKAGE_BODY_SURFACE'] * TYPEOF(subsequent_item.definition)) = 1);
  END_ENTITY;

  ENTITY Blind_passage_template
    SUBTYPE OF (Unsupported_passage_template);
      of_measure_orientation               : measure_orientation;
      datum_reference                      : Stratum_surface;
      bottom_distance_from_datum_reference : Shape_dimension_representation;
  END_ENTITY;

  ENTITY Component_termination_passage
    SUBTYPE OF (Plated_passage);
      SELF\Definition_based_product_occurrence.derived_from : Component_termination_passage_template;
    INVERSE
      access_mechanism           : SET[1:?] OF component_termination_passage_join_terminal FOR containing_shape;
      interface_access_mechanism : component_termination_passage_interface_terminal FOR associated_component;
  END_ENTITY;

  ENTITY Component_termination_passage_interface_terminal
    SUBTYPE OF (Laminate_component_interface_terminal);
      SELF\Component_feature.definition           : Component_termination_passage_template_interface_terminal;
      SELF\Component_feature.associated_component : Component_termination_passage;
    DERIVE
      SELF\Shape_element.description : STRING := '';
  END_ENTITY;

  ENTITY Component_termination_passage_join_terminal
    SUBTYPE OF (Laminate_component_join_terminal);
      SELF\Component_feature.definition           : Component_termination_passage_template_join_terminal;
      SELF\Component_feature.associated_component : Component_termination_passage;
    DERIVE
      SELF\Shape_element.description : STRING := '';
  END_ENTITY;

  ENTITY Component_termination_passage_template
    SUBTYPE OF (Inter_stratum_feature_template);
      SELF\Inter_stratum_feature_template.of_passage_technology : Default_component_termination_passage_definition;
    INVERSE
      access_mechanisms : SET[2:?] OF component_termination_passage_template_terminal FOR associated_definition;
  END_ENTITY;

  ENTITY Component_termination_passage_template_interface_terminal
    SUBTYPE OF (Component_termination_passage_template_terminal);
  END_ENTITY;

  ENTITY Component_termination_passage_template_join_terminal
    SUBTYPE OF (Component_termination_passage_template_terminal);
      disallowed_inter_stratum_extent : OPTIONAL SET[1:?] OF Inter_stratum_extent;
  END_ENTITY;

  ENTITY Component_termination_passage_template_terminal
    ABSTRACT SUPERTYPE OF (ONEOF (Component_termination_passage_template_interface_terminal,
 Component_termination_passage_template_join_terminal))
    SUBTYPE OF (Placed_feature);
      SELF\Shape_element.containing_shape RENAMED associated_definition    : Component_termination_passage_template;
      terminal_connection_zone : OPTIONAL SET[1:?] OF Connection_zone_in_layout_template;
    DERIVE
      SELF\Shape_element.description : STRING := '';
    INVERSE
      terminal_shape : SET[0:1] OF geometric_model_constituent_relationship FOR constituent_element;
    UNIQUE
      UR1 : SELF\Shape_element.element_name,
 associated_definition;
  END_ENTITY;

  ENTITY Conductive_filled_area
    SUPERTYPE OF (Connected_filled_area)
    SUBTYPE OF (Stratum_feature);
    DERIVE
      SELF\Shape_element.description : STRING := '';
  END_ENTITY;

  ENTITY Conductive_interconnect_element
    ABSTRACT SUPERTYPE OF (ONEOF (Unrouted_conductive_interconnect_element,
 Conductive_interconnect_element_with_pre_defined_transitions))
    SUBTYPE OF (Laminate_component);
      composed_conductor : OPTIONAL Stratum_feature;
    DERIVE
      SELF\Product_view_definition.name : STRING := '';
    INVERSE
      access_mechanisms : SET[2:?] OF conductive_interconnect_element_terminal FOR associated_component;
  END_ENTITY;

  ENTITY Conductive_interconnect_element_terminal
    SUBTYPE OF (Laminate_component_feature);
      SELF\Component_feature.associated_component : Conductive_interconnect_element;
      connection                                  : OPTIONAL Connection_zone_in_design_view;
      location                                    : Layer_connection_point;
    DERIVE
      SELF\Shape_element.description : STRING := '';
    UNIQUE
      UR1 : element_name,
 SELF\Component_feature.associated_component;
    WHERE
      WR1 : NOT (EXISTS(SELF\Component_feature.associated_component\Conductive_interconnect_element.composed_conductor)) OR (location.resident_design_layer_stratum = SELF\Component_feature.associated_component\Conductive_interconnect_element.composed_conductor.resident_stratum);
  END_ENTITY;

  ENTITY Conductive_interconnect_element_terminal_link;
      associated_element : Conductive_interconnect_element;
      precedent_point    : Conductive_interconnect_element_terminal;
      subsequent_point   : Conductive_interconnect_element_terminal;
    UNIQUE
      UR1 : precedent_point,
 subsequent_point;
    WHERE
      WR1 : precedent_point <> subsequent_point;
      WR2 : precedent_point.associated_component = associated_element;
      WR3 : subsequent_point.associated_component = associated_element;
  END_ENTITY;

  ENTITY Conductive_interconnect_element_with_pre_defined_transitions
    SUPERTYPE OF (Join_two_physical_connectivity_definition_supporting_printed_component)
    SUBTYPE OF (Conductive_interconnect_element);
      SELF\Definition_based_product_occurrence.derived_from   : Trace_template;
      centreline_shape                                        : Curve;
      SELF\Conductive_interconnect_element.composed_conductor : Stratum_feature;
    INVERSE
      connected_points : SET[1:?] OF conductive_interconnect_element_terminal_link FOR associated_element;
    WHERE
      WR1 : SIZEOF(connected_points) = SIZEOF(SELF\Conductive_interconnect_element.access_mechanisms) - 1;
      WR2 : correlated_terminals(SELF\Conductive_interconnect_element.access_mechanisms,
 connected_points);
      WR3 : SIZEOF(['LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.CONDUCTOR',
            'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.CONDUCTIVE_FILLED_AREA'] *
            TYPEOF(SELF\Conductive_interconnect_element.composed_conductor)) = 1;
  END_ENTITY;

  ENTITY Conductor
    SUBTYPE OF (Stratum_feature);
      SELF\Stratum_feature.resident_stratum : Design_layer_stratum;
      implementation_requirement            : Intra_stratum_join_relationship;
    DERIVE
      SELF\Shape_element.description : STRING := '';
  END_ENTITY;

  ENTITY Connected_area_component
    SUBTYPE OF (Stratum_feature_template_component);
      associated_layer_connection_point : SET[1:?] OF Layer_connection_point;
  END_ENTITY;

  ENTITY Connected_filled_area
    SUBTYPE OF (Conductive_filled_area);
      SELF\Stratum_feature.resident_stratum : Design_layer_stratum;
      implementation_requirement            : Intra_stratum_join_relationship;
  END_ENTITY;

  ENTITY Counterbore_passage_template
    SUBTYPE OF (Unsupported_passage_template);
      smaller_passage : Unsupported_passage_template;
      larger_passage  : Blind_passage_template;
  END_ENTITY;

  ENTITY Countersunk_passage_template
    SUBTYPE OF (Unsupported_passage_template);
      constant_diameter_passage : Unsupported_passage_template;
      tapered_passage           : Blind_passage_template;
  END_ENTITY;

  ENTITY Cutout
    SUPERTYPE OF (ONEOF (Physical_connectivity_interrupting_cutout,
 Plated_cutout,
 Partially_plated_cutout))
    SUBTYPE OF (Inter_stratum_feature);
    DERIVE
      SELF\Product_view_definition.name : STRING := '';
  END_ENTITY;

  ENTITY Cutout_edge_segment
    SUPERTYPE OF (Plated_cutout_edge_segment)
    SUBTYPE OF (Inter_stratum_feature);
      composed_cutout                             : Cutout;
      start_vertex                                : Edge_segment_vertex;
      end_vertex                                  : Edge_segment_vertex;
      SELF\Inter_stratum_feature.derived_from : Inter_stratum_feature_edge_segment_template;
    WHERE
      WR1 : start_vertex :<>: end_vertex;
  END_ENTITY;

  ENTITY Default_attachment_size_and_component_termination_passage_based_land_physical_template
    SUBTYPE OF (Default_component_termination_passage_based_land_physical_template,
 Default_attachment_size_based_land_physical_template);
  END_ENTITY;

  ENTITY Default_attachment_size_and_via_based_land_physical_template
    SUBTYPE OF (Default_via_based_land_physical_template,
 Default_attachment_size_based_land_physical_template);
  END_ENTITY;

  ENTITY Default_component_termination_passage_based_land_physical_template
    SUPERTYPE OF (Default_attachment_size_and_component_termination_passage_based_land_physical_template)
    SUBTYPE OF (Default_passage_based_land_physical_template);
      SELF\Default_passage_based_land_physical_template.of_passage_technology : Default_component_termination_passage_definition;
  END_ENTITY;

  ENTITY Default_component_termination_passage_definition
    SUBTYPE OF (Passage_technology);
      minimum_allowed_component_terminal_extent	: Length_data_element;
      maximum_allowed_component_terminal_extent	: Length_data_element;
    DERIVE
      minimum_as_finished_deposition_thickness 	: length_data_element := SELF\Passage_technology.of_technology.minimum_as_finished_deposition_thickness;
      minimum_as_finished_passage_extent       	: length_data_element := SELF\Passage_technology.of_technology.minimum_as_finished_passage_extent;
    INVERSE
      SELF\Passage_technology.deposition_material : SET [1:1] OF material_identification FOR items;
    WHERE
      WR1 : EXISTS(minimum_as_finished_deposition_thickness);
      WR2 : EXISTS(minimum_as_finished_passage_extent);
      WR3 : 'CONDUCTIVITY_MATERIAL_ASPECTS.'+ 'MATERIAL_IDENTIFICATION_WITH_CONDUCTIVITY_CLASSIFICATION' IN TYPEOF (deposition_material);
  END_ENTITY;

  ENTITY Default_passage_based_land_physical_template
    ABSTRACT SUPERTYPE OF (ONEOF (Default_via_based_land_physical_template,
 Default_component_termination_passage_based_land_physical_template,
 Default_unsupported_passage_based_land_physical_template))
    SUBTYPE OF (Default_land_physical_template);
      minimum_fabrication_allowance : Length_data_element;
      of_passage_technology         : Passage_technology;
      of_stratum_extent             : Inter_stratum_extent;
      minimum_annular_ring          : Length_data_element;
    UNIQUE
      UR1 : of_passage_technology,
 SELF\Stratum_feature_template.of_stratum_technology;
  END_ENTITY;

	ENTITY Default_plated_passage_based_land_physical_template
	  SUBTYPE OF (Default_passage_based_land_physical_template);
	 SELF\Default_passage_based_land_physical_template.of_passage_technology :
		Default_via_definition;
	END_ENTITY;

  ENTITY Default_unsupported_passage_based_land_physical_template
    SUBTYPE OF (Default_passage_based_land_physical_template);
      SELF\Default_passage_based_land_physical_template.of_passage_technology : Default_unsupported_passage_definition;
  END_ENTITY;

  ENTITY Default_unsupported_passage_definition
    SUBTYPE OF (Passage_technology);
    DERIVE
      minimum_as_finished_passage_extent				: length_data_element := SELF\Passage_technology.of_technology.minimum_as_finished_passage_extent;
    WHERE
      WR1 : EXISTS(minimum_as_finished_passage_extent);
  END_ENTITY;

  ENTITY Default_via_based_land_physical_template
    SUPERTYPE OF (Default_attachment_size_and_via_based_land_physical_template)
    SUBTYPE OF (Default_passage_based_land_physical_template);
      SELF\Default_passage_based_land_physical_template.of_passage_technology : Default_via_definition;
  END_ENTITY;


  ENTITY Default_via_definition
    SUBTYPE OF (Passage_technology);
    DERIVE
      minimum_as_finished_deposition_thickness 	: length_data_element := SELF\Passage_technology.of_technology.minimum_as_finished_deposition_thickness;
      minimum_as_finished_passage_extent       	: length_data_element := SELF\Passage_technology.of_technology.minimum_as_finished_passage_extent;
    INVERSE
      SELF\Passage_technology.deposition_material : SET [1:1] OF material_identification FOR items;
    WHERE
      WR1 : EXISTS(minimum_as_finished_deposition_thickness);
      WR2 : EXISTS(minimum_as_finished_passage_extent);
      WR3 : 'CONDUCTIVITY_MATERIAL_ASPECTS.'+ 'MATERIAL_IDENTIFICATION_WITH_CONDUCTIVITY_CLASSIFICATION' IN TYPEOF (deposition_material);
  END_ENTITY;

  ENTITY Design_layer_stratum
    SUBTYPE OF (Stratum);
      primary_design_layer_stratum : BOOLEAN;
      SELF\Stratum.of_technology   : Design_layer_technology;
    DERIVE
       library_definition : SET[0:1] OF Library_reference_view_definition_relationship :=
        BAG_TO_SET(QUERY(vdr <* USEDIN (SELF,'PRODUCT_VIEW_DEFINITION_RELATIONSHIP_ARM.VIEW_DEFINITION_RELATIONSHIP.RELATED_VIEW') | 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.' 
        + 'LIBRARY_REFERENCE_VIEW_DEFINITION_RELATIONSHIP' IN TYPEOF (vdr)));
    INVERSE
      existence_dependence : SET[1:?] OF layer_connection_point FOR resident_design_layer_stratum;
    WHERE
      WR1 : (NOT (primary_design_layer_stratum) AND (SIZEOF(QUERY(imps <* USEDIN(SELF,
 'DESIGN_SPECIFIC_ASSIGNMENT_TO_INTERCONNECT_USAGE_VIEW_ARM.STRATUM_CONCEPT_TO_PHYSICAL_USAGE_VIEW_ASSIGNMENT.' + 'ASSIGNED_DESIGN_OBJECT') | ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.INTERCONNECT_MODULE_PRIMARY_SURFACE' IN TYPEOF(imps.defined_part_feature)))) = 0)) OR ((primary_design_layer_stratum) AND (SIZEOF(QUERY(imps <* USEDIN(SELF,
 'DESIGN_SPECIFIC_ASSIGNMENT_TO_INTERCONNECT_USAGE_VIEW_ARM.STRATUM_CONCEPT_TO_PHYSICAL_USAGE_VIEW_ASSIGNMENT.' + 'ASSIGNED_DESIGN_OBJECT') | ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.INTERCONNECT_MODULE_PRIMARY_SURFACE' IN TYPEOF(imps.defined_part_feature)))) = 1));
      WR2: SIZEOF(library_definition) <= 1;
  END_ENTITY;

  ENTITY Dielectric_material_passage
    SUBTYPE OF (Inter_stratum_feature);
      feature_material  : OPTIONAL material_or_specification;
      precedent_passage : Cutout;
    DERIVE
      SELF\Product_view_definition.name : STRING := '';
  END_ENTITY;

  ENTITY Documentation_layer_stratum
    SUBTYPE OF (Stratum);
      SELF\Stratum.of_technology : Documentation_layer_technology;
    DERIVE
       library_definition : SET[0:1] OF Library_reference_view_definition_relationship :=
        BAG_TO_SET(QUERY(vdr <* USEDIN (SELF,'PRODUCT_VIEW_DEFINITION_RELATIONSHIP_ARM.VIEW_DEFINITION_RELATIONSHIP.RELATED_VIEW') | 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.' 
        + 'LIBRARY_REFERENCE_VIEW_DEFINITION_RELATIONSHIP' IN TYPEOF (vdr)));
    WHERE    
      WR1: SIZEOF(library_definition) <= 1;
  END_ENTITY;

  ENTITY Embedded_physical_component_terminal
    SUBTYPE OF (Laminate_component_join_terminal);
      SELF\Component_feature.definition           : bare_die_terminal_or_packaged_part_terminal;
      SELF\Component_feature.associated_component : bare_die_component_or_packaged_component;
    DERIVE
      SELF\Shape_element.description : STRING := '';
  END_ENTITY;

  ENTITY Fiducial
    SUBTYPE OF (Laminate_component);
  END_ENTITY;

  ENTITY Fiducial_stratum_feature
    SUBTYPE OF (Stratum_feature);
  END_ENTITY;

  ENTITY Footprint_occurrence
    SUBTYPE OF (Assembly_group_component);
      SELF\Definition_based_product_occurrence.derived_from : Generic_footprint_definition;
    WHERE
(* no longer need wr1,wr2
      WR1 : SIZEOF(USEDIN(SELF,
 'PHYSICAL_UNIT_DESIGN_VIEW_ARM.COMPONENT_MAKE_FROM_RELATIONSHIP.RESULTANT_COMPONENT')) <= 1;
      WR2 : NOT (SIZEOF(USEDIN(SELF,
 'PHYSICAL_UNIT_DESIGN_VIEW_ARM.COMPONENT_MAKE_FROM_RELATIONSHIP.RESULTANT_COMPONENT')) = 1) OR (SIZEOF(QUERY(cmfr <* USEDIN(SELF,
 'PHYSICAL_UNIT_DESIGN_VIEW_ARM.COMPONENT_MAKE_FROM_RELATIONSHIP.RESULTANT_COMPONENT') | 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.ASSEMBLY_GROUP_COMPONENT' IN TYPEOF(cmfr.reusable_component))) = 1);
*)
      WR1 : SIZEOF(TYPEOF(SELF) * ['LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.PRINTED_COMPONENT',
 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.LAMINATE_COMPONENT',
 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.PHYSICAL_COMPONENT']) = 0;
 
--this rule had a typo.  it should have been fosar, not posar.  it has been corrected.
      WR2: SIZEOF(QUERY(agc <* SELF\Assembly_group_component.components |
      NOT('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.FOOTPRINT_OCCURRENCE_SUB_ASSEMBLY_RELATIONSHIP' IN TYPEOF(agc))
           )) = 0;
  END_ENTITY;

  ENTITY Footprint_occurrence_sub_assembly_relationship
	SUBTYPE OF (Next_assembly_usage_occurence_relationship);  
      SELF\View_definition_relationship.relating_view                 : Footprint_occurrence;	
      SELF\View_definition_relationship.related_view                  : Laminate_component;
      sub_assembly_reference_designation : Part_template_location_in_fd_or_pd;
      terminal_location                  : Padstack_location_in_footprint_definition;
    UNIQUE
      UR1 : sub_assembly_reference_designation,
 relating_view,
 terminal_location;
    WHERE
      WR1 : terminal_location.footprint :=: relating_view.derived_from;
      WR2 : sub_assembly_reference_designation.padstack :=: terminal_location.padstack;
      WR3 : related_view\Definition_based_product_occurrence.derived_from :=: sub_assembly_reference_designation.template;
      WR4: NOT EXISTS(SELF\View_definition_relationship.relation_type);
      WR5: NOT EXISTS(SELF\View_definition_relationship.id);
      WR6: NOT EXISTS(SELF\Assembly_component_relationship.location_indicator);
      WR7: NOT EXISTS(SELF\Assembly_component_relationship.quantity);
  END_ENTITY;

  ENTITY Generic_physical_network
    ABSTRACT SUPERTYPE OF (ONEOF(Unrouted_physical_network, Routed_physical_network));
      name                                         : STRING;
      current_associated_definition                : Interconnect_module;
      prior_associated_definition                  : OPTIONAL SET[1:?] OF Interconnect_module;      
      connectivity_requirement_element             : SET[2:?] OF Laminate_component_join_terminal;
    UNIQUE
      UR1 : name,
 current_associated_definition;
 		WHERE
      WR1 : NOT (EXISTS(prior_associated_definition)) OR NOT (current_associated_definition IN prior_associated_definition); 
  END_ENTITY; 

  ENTITY Inter_stratum_extent
    SUBTYPE OF (Part_definition_relationship);
      SELF\View_definition_relationship.relating_view RENAMED from_stratum : Stratum;
      SELF\View_definition_relationship.related_view RENAMED to_stratum    : Stratum;
    DERIVE  
      SELF\View_definition_relationship.relation_type : STRING := '';
  END_ENTITY;

  ENTITY Inter_stratum_feature
		ABSTRACT SUPERTYPE OF (ONEOF (Unsupported_passage,
			Plated_inter_stratum_feature))  
    SUBTYPE OF (Laminate_component);
      feature_of_size                          : BOOLEAN;
      SELF\Definition_based_product_occurrence.derived_from : Inter_stratum_feature_template;
  END_ENTITY;

  ENTITY Inter_stratum_feature_template
    SUBTYPE OF (Template_definition);
      of_passage_technology : Passage_technology;
    DERIVE
      SELF\Product_view_definition.name : STRING := '';
  END_ENTITY;

  ENTITY Inter_stratum_join_relationship
    SUBTYPE OF (Routed_join_relationship);
      points_to_be_connected : SET[2:?] OF Layer_connection_point;
  END_ENTITY;

  ENTITY Interconnect_connection_zone_position_relationship;
      associating_design_view_shape               : Feature_shape_definition;
      associated_usage                            : Connection_zone_in_design_view;
      associated_connection_zone_shape_definition : Feature_shape_definition;
      associated_usage_placement                  : Axis_placement;
      associating_design_view                     : Interconnect_module;
  END_ENTITY;

  ENTITY Interconnect_module
  	SUPERTYPE OF (Pcb)
    SUBTYPE OF (Assembly_definition, Part_design_view);
    INVERSE
      of_fabrication_thickness_requirement : SET[0:?] OF requirement_assignment FOR assigned_to;
    WHERE
      WR1 : SIZEOF(QUERY(ftr <* of_fabrication_thickness_requirement | NOT ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.FABRICATION_THICKNESS_REQUIREMENT_OCCURRENCE' IN TYPEOF(ftr\Requirement_assignment.assigned_requirement)))) = 0;
      WR2 : (SIZEOF(USEDIN(SELF,'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.INTERCONNECT_MODULE_STRATUM_ASSEMBLY_RELATIONSHIP.' + 'ASSEMBLY')) = 0)
      OR
      (SIZEOF(QUERY(imsar <* USEDIN(SELF, 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.INTERCONNECT_MODULE_STRATUM_ASSEMBLY_RELATIONSHIP.' + 'ASSEMBLY') | 
              (('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.DESIGN_LAYER_STRATUM' IN TYPEOF(imsar.component)) AND 
               (imsar.component\Design_layer_stratum.primary_design_layer_stratum = TRUE)))) = 1);
  END_ENTITY;

  ENTITY Interconnect_module_edge
    SUPERTYPE OF (ONEOF (Partially_plated_interconnect_module_edge,
 Plated_interconnect_module_edge))
    SUBTYPE OF (Inter_stratum_feature);
  END_ENTITY;

  ENTITY Interconnect_module_edge_segment
    SUPERTYPE OF (ONEOF(Plated_interconnect_module_edge_segment,
                        Unplated_interconnect_module_edge_segment))
    SUBTYPE OF (Inter_stratum_feature);
      composed_edge                               : Interconnect_module_edge;
      start_vertex                                : Edge_segment_vertex;
      end_vertex                                  : Edge_segment_vertex;
      SELF\Inter_stratum_feature.derived_from : Inter_stratum_feature_edge_segment_template;
    WHERE
      WR1 : start_vertex :<>: end_vertex;
  END_ENTITY;

  ENTITY Interconnect_module_join_terminal
    SUBTYPE OF (Interconnect_module_terminal);
    INVERSE
      defining_terminal : component_feature_to_physical_usage_view_assignment FOR defined_part_feature;
    WHERE
      WR1 : SIZEOF(['LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.COMPONENT_TERMINATION_PASSAGE_JOIN_TERMINAL',
 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.VIA_TERMINAL',
 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.PRINTED_COMPONENT_JOIN_TERMINAL',
 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.CONDUCTIVE_INTERCONNECT_ELEMENT_TERMINAL',
 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.LAND_JOIN_TERMINAL',
 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.NON_FUNCTIONAL_LAND_JOIN_TERMINAL'] * TYPEOF(defining_terminal.assigned_design_object)) = 1;
  END_ENTITY;

  ENTITY Interconnect_module_stratum_assembly_relationship;
      assembly              : Interconnect_module;
      component             : Stratum;
      reference_designation : STRING; 
    UNIQUE
      UR1 : assembly,
 reference_designation;
  END_ENTITY;

  ENTITY Interface_access_material_removal_feature
    SUBTYPE OF (Material_removal_feature);
      accessed_interface : Laminate_component_interface_terminal;
  END_ENTITY;

  ENTITY Interface_access_stratum_feature_template_component
    SUBTYPE OF (Stratum_feature_template_component);
      accessed_interface : Laminate_component_interface_terminal;
  END_ENTITY;

  ENTITY Internal_probe_access_area
    SUBTYPE OF (Probe_access_area);
      stratum_feature_implementation : Stratum_feature;
    INVERSE
      internal_access : internal_stratum_access FOR connected_probe;
  END_ENTITY;

  ENTITY Internal_stratum_access;
      connected_probe       : Internal_probe_access_area;
      inter_stratum_feature : Via;
    UNIQUE
      UR1 : connected_probe,
 Inter_stratum_feature;
  END_ENTITY;

  ENTITY Intra_stratum_join_relationship
    SUBTYPE OF (Routed_join_relationship);
      points_to_be_connected : SET[2:?] OF Layer_connection_point;
    DERIVE
      associated_stratum : Design_layer_stratum := points_to_be_connected[1].resident_design_layer_stratum;
    INVERSE
      ordered_implementation : SET[0:1] OF conductor FOR implementation_requirement;
      random_implementation  : SET[0:1] OF connected_filled_area FOR implementation_requirement;
    WHERE
      WR1 : (EXISTS(ordered_implementation)) XOR (EXISTS(random_implementation));
      WR2 : SIZEOF(QUERY(ptbc <* points_to_be_connected |
            NOT(ptbc.resident_design_layer_stratum = associated_stratum)
              )) = 0;
  END_ENTITY;

  ENTITY Join_relationship
    ABSTRACT SUPERTYPE OF (ONEOF (Routed_join_relationship,
	 	Unrouted_join_relationship));
      associated_layout : Interconnect_module;
  END_ENTITY;

  ENTITY Join_two_physical_connectivity_definition_supporting_printed_component
    SUBTYPE OF (Conductive_interconnect_element_with_pre_defined_transitions);
      joined_definitions : SET[2:2] OF Physical_connectivity_definition;
  END_ENTITY;

  ENTITY Laminate_component
		SUPERTYPE OF (ONEOF (Conductive_interconnect_element,
			Stratum_feature_template_component,
			Probe_access_area,
			Inter_stratum_feature,
			Special_symbol_laminate_component,
			Laminate_text_component,
			Laminate_text_string_component) ANDOR
			Fiducial)
    SUBTYPE OF (Assembly_component);
      SELF\Definition_based_product_occurrence.derived_from : Template_definition;
    INVERSE
      padstack_occurrence_assembly  : SET[0:1] OF padstack_occurrence_sub_assembly_relationship FOR related_view; --related_component;      
      footprint_occurrence_assembly : SET[0:1] OF footprint_occurrence_sub_assembly_relationship FOR related_view;
	  cad_layer						: SET[0:1] OF External_source_identification FOR item;      	  
    WHERE
      WR1 : SIZEOF(padstack_occurrence_assembly) + SIZEOF(footprint_occurrence_assembly) < 2;
      WR2 : NOT (SIZEOF(padstack_occurrence_assembly) = 1) OR 
            	(padstack_occurrence_assembly[1] = SELF\Assembly_component.occurrence_contexts[1]);
      WR3 : NOT (SIZEOF(padstack_occurrence_assembly) = 1) OR 
            	(footprint_occurrence_assembly[1] = SELF\Assembly_component.occurrence_contexts[1]);            	
  END_ENTITY;

  ENTITY Laminate_component_feature
    ABSTRACT SUPERTYPE OF (ONEOF (Conductive_interconnect_element_terminal,
 Laminate_component_interface_terminal,
 Laminate_component_join_terminal,
 Via_terminal))
    SUBTYPE OF (Component_feature);
  END_ENTITY;

  ENTITY Laminate_component_interface_terminal
    ABSTRACT SUPERTYPE 
    SUBTYPE OF (Laminate_component_feature);
  END_ENTITY;

  ENTITY Laminate_component_join_terminal
    ABSTRACT SUPERTYPE 
    SUBTYPE OF (Laminate_component_feature,
 Component_terminal);
    INVERSE
      node_implementation : SET[0:1] OF Generic_physical_network FOR connectivity_requirement_element;
  END_ENTITY;

  ENTITY Laminate_group_component_make_from_relationship
    SUBTYPE OF (Component_make_from_relationship);
      SELF\Component_make_from_relationship.reusable_component  : Assembly_group_component;
      SELF\Component_make_from_relationship.resultant_component : Assembly_group_component;
      stratum_mapping                                           : SET[1:?] OF Part_definition_relationship;
    WHERE
     WR1: SIZEOF(QUERY(sar <* SELF\Component_make_from_relationship.reusable_component.components | NOT ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.LAMINATE_COMPONENT' IN TYPEOF(sar\view_definition_relationship.related_view)))) = 0;
     WR2: SIZEOF(QUERY(sar <* SELF\Component_make_from_relationship.resultant_component.components | NOT ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.LAMINATE_COMPONENT' IN TYPEOF(sar\view_definition_relationship.related_view)))) = 0;

  END_ENTITY;

  ENTITY Laminate_layer_stack;
      name        : STRING;  
      extent      : Inter_stratum_extent;
    INVERSE
      layer_usage	: SET[0:1] OF External_source_identification FOR item;
    UNIQUE
      UR1 : name;
  END_ENTITY;

  ENTITY Laminate_text_component
    SUBTYPE OF (Laminate_component);
      SELF\Definition_based_product_occurrence.derived_from : Part_text_template;
      stratum_feature_implementation           : SET[1:?] OF Stratum_feature;
	DERIVE
      of_character : STRING(1) := SELF\laminate_text_component.derived_from.of_character.character;      
      SELF\Product_view_definition.name : STRING := '';
  END_ENTITY;

  ENTITY Laminate_text_string_component
    SUBTYPE OF (Array_placement_group,
 Laminate_component);
      message_contents            : Text_literal_with_extent;
    DERIVE
      SELF\Product_view_definition.name : STRING := '';
    WHERE
		SIZEOF(QUERY(sar <* SELF\Assembly_group_component.components | 
		NOT  ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.LAMINATE_TEXT_COMPONENT' IN  TYPEOF(sar.related_view)) )) = 0;  
  END_ENTITY;

  ENTITY Layer_connection_point
    ABSTRACT SUPERTYPE
    SUBTYPE OF (Shape_element);
      location_2d                   : OPTIONAL Cartesian_point;
      location_3d                   : OPTIONAL Cartesian_point;
      SELF\Shape_element.containing_shape RENAMED resident_design_layer_stratum : Design_layer_stratum;
    DERIVE
      aggregate_join    : SET[1:?] OF join_relationship := 
           make_aggregate_join(
               inter_join_path,
               intra_join_path,
               embedded_physical_component_path,
               unrouted_join_path);
      reference_network : Generic_physical_network := aggregate_join[1].network_topology;
    INVERSE
      inter_join_path         : SET[0:1] OF Inter_stratum_join_relationship FOR points_to_be_connected;
      intra_join_path         : SET [0:1] OF Intra_stratum_join_relationship FOR points_to_be_connected;
      embedded_physical_component_path : SET[0:?] OF Stratum_embedded_physical_component_join_relationship FOR point_to_be_connected;
      unrouted_join_path         : SET [0:1] OF Unrouted_join_relationship FOR unrouted_lcp;
    UNIQUE
      UR1 : SELF\Shape_element.element_name, resident_design_layer_stratum;
    WHERE
      WR1 : EXISTS(location_2d) OR EXISTS(location_3d);
      WR2 : NOT (EXISTS(location_2d)) OR ((SIZEOF(location_2d\Cartesian_point.coordinates)) = 2);
      WR3 : NOT (EXISTS(location_3d)) OR ((SIZEOF(location_3d\Cartesian_point.coordinates)) = 3);
      WR4 : SIZEOF(QUERY(jr <* aggregate_join | jr.network_topology <> reference_network)) = 0;
      WR5 : EXISTS(reference_network); 
  END_ENTITY;

  ENTITY Layout_junction;
      name                  : STRING;  
      associated_definition : Interconnect_module;
      net                   : Generic_physical_network;
      location              : Cartesian_point;
    UNIQUE
      UR1 : location,
 net;
      UR2 : name,
 net;
    WHERE
      WR1 : associated_definition :=: net.current_associated_definition;
  END_ENTITY;

  ENTITY Library_reference_view_definition_relationship
    SUBTYPE OF (View_definition_relationship);
    DERIVE
     SELF\View_definition_relationship.relation_type : STRING := '';
  END_ENTITY;

  ENTITY Multi_layer_material_removal_feature
    SUBTYPE OF (Material_removal_feature);
      derived_layer_geometry : Laminate_layer_stack;
  END_ENTITY;

  ENTITY Multi_layer_stratum_feature
    SUBTYPE OF (Stratum_feature);
      derived_layer_geometry : Laminate_layer_stack;
  END_ENTITY;

  ENTITY Multi_layer_stratum_feature_template_component
    SUBTYPE OF (Stratum_feature_template_component);
      derived_layer_geometry : Laminate_layer_stack;
  END_ENTITY;

  ENTITY Padstack_occurrence
    SUBTYPE OF (Assembly_group_component);
      SELF\Definition_based_product_occurrence.derived_from : Padstack_definition;
    WHERE
      WR1 : SIZEOF(TYPEOF(SELF) * ['LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.PRINTED_COMPONENT',
 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.LAMINATE_COMPONENT',
 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.PHYSICAL_COMPONENT']) = 0;
      WR2: SIZEOF(QUERY(agc <* SELF\Assembly_group_component.components |
      NOT('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.PADSTACK_OCCURRENCE_SUB_ASSEMBLY_RELATIONSHIP' IN TYPEOF(agc))
           )) = 0;
  END_ENTITY;

  ENTITY Padstack_occurrence_sub_assembly_relationship
	SUBTYPE OF (Next_assembly_usage_occurence_relationship);  
      SELF\View_definition_relationship.relating_view                 : Padstack_occurrence;	
      SELF\View_definition_relationship.related_view                  : Laminate_component;
      sub_assembly_reference_designation : Part_template_location_in_fd_or_pd;
    UNIQUE
      UR1 : sub_assembly_reference_designation,
 relating_view, --relating_component,
 related_view; --related_component;
    WHERE
      WR1: NOT EXISTS(SELF\View_definition_relationship.relation_type);
      WR2: NOT EXISTS(SELF\View_definition_relationship.id);
      WR3: NOT EXISTS(SELF\Assembly_component_relationship.location_indicator);
      WR4: NOT EXISTS(SELF\Assembly_component_relationship.quantity);    
  END_ENTITY;

  ENTITY Partially_plated_cutout
    SUBTYPE OF (Cutout);
    INVERSE
      plated_segment   : SET[1:?] OF Plated_cutout_edge_segment FOR composed_cutout;
      unplated_segment : SET[1:?] OF Unplated_cutout_edge_segment FOR composed_cutout;
  END_ENTITY;
  
  ENTITY Partially_plated_interconnect_module_edge
    SUBTYPE OF (Interconnect_module_edge);
    DERIVE
      SELF\Product_view_definition.name : STRING := '';
    INVERSE
      plated_segment   : SET[1:?] OF Plated_interconnect_module_edge_segment FOR composed_edge;
      unplated_segment : SET[1:?] OF Unplated_interconnect_module_edge_segment FOR composed_edge;
  END_ENTITY;

  ENTITY Passage_padstack_definition
    SUBTYPE OF (Padstack_definition);
      technology_reference : Passage_technology_parameters;
  END_ENTITY;

	ENTITY Passage_technology
		SUPERTYPE OF (ONEOF (Default_via_definition,
 			Default_component_termination_passage_definition,
 			Default_unsupported_passage_definition));
      name                              : STRING;
	  of_technology						: Passage_technology_parameters;
      associated_definition				: Interconnect_module;
      as_finished_inter_stratum_extent	: Inter_stratum_extent;      
   INVERSE
	  deposition_material : SET [0:1] OF material_identification FOR items;      
      UNIQUE
       UR1 : name, associated_definition;
	  WHERE
	  WR1 : NOT (SIZEOF(deposition_material) = 1) OR
            ('CONDUCTIVITY_MATERIAL_ASPECTS.'+ 'MATERIAL_IDENTIFICATION_WITH_CONDUCTIVITY_CLASSIFICATION' IN TYPEOF (deposition_material[1]));
      WR2: NOT (of_technology.plated_passage) OR (SIZEOF(deposition_material) = 1);
      WR3: NOT EXISTS(of_technology.maximum_as_finished_deposition_thickness) OR (SIZEOF(deposition_material) = 1);
      WR4: NOT EXISTS(of_technology.minimum_as_finished_deposition_thickness) OR (SIZEOF(deposition_material) = 1);
      WR5: NOT (of_technology.plated_passage) OR
           (SIZEOF([deposition_material[1].electrical_conductivity_classification,
                   deposition_material[1].magnetic_conductivity_classification, 
                   deposition_material[1].optical_conductivity_classification,  
                   deposition_material[1].thermal_conductivity_classification] *
                  ['conductive']) >= 1);
	END_ENTITY;

  ENTITY Pcb
    SUBTYPE OF (Interconnect_module);
      SELF\Part_design_view.usage_view : OPTIONAL Pcb_usage_view;
  END_ENTITY;

  ENTITY Physical_connectivity_interrupting_cutout
    SUBTYPE OF (Cutout);
      interrupted_connectivity_element : SET[1:?] OF Conductive_interconnect_element;
  END_ENTITY;

  ENTITY Plated_cutout
    SUBTYPE OF (Cutout,
 Plated_inter_stratum_feature);
  END_ENTITY;

  ENTITY Plated_cutout_edge_segment
    SUBTYPE OF (Cutout_edge_segment,
 Plated_inter_stratum_feature);
      SELF\Cutout_edge_segment.composed_cutout : Partially_plated_cutout;
  END_ENTITY;

  ENTITY Plated_inter_stratum_feature
    ABSTRACT SUPERTYPE OF (ONEOF (Plated_cutout,
		 Plated_interconnect_module_edge,
		 Plated_cutout_edge_segment,
		 Plated_interconnect_module_edge_segment,
		 Plated_passage))
    SUBTYPE OF (Inter_stratum_feature);
  END_ENTITY;

  ENTITY Plated_interconnect_module_edge
    SUBTYPE OF (Interconnect_module_edge,
 Plated_inter_stratum_feature);
    DERIVE
      SELF\Product_view_definition.name : STRING := '';
  END_ENTITY;

  ENTITY Plated_interconnect_module_edge_segment
    SUBTYPE OF (Plated_inter_stratum_feature,
 Interconnect_module_edge_segment);
      SELF\Interconnect_module_edge_segment.composed_edge : Partially_plated_interconnect_module_edge;
  END_ENTITY;

  ENTITY Plated_passage
    SUPERTYPE OF (ONEOF (Component_termination_passage,
 Via))
    SUBTYPE OF (Plated_inter_stratum_feature);
    DERIVE
      SELF\Product_view_definition.name : STRING := '';
  END_ENTITY;

  ENTITY Primary_stratum_indicator_symbol
    SUBTYPE OF (Special_symbol_laminate_component);
  END_ENTITY;

  ENTITY Probe_access_area
    SUPERTYPE OF (Internal_probe_access_area)
    SUBTYPE OF (Laminate_component);
    	SELF\Definition_based_product_occurrence.derived_from : Stratum_feature_template;
      probed_layout_item 																		: Stratum_feature;
      probe_contact_zone 																		: Connection_zone_in_design_view;
    	stratum_feature_material_stackup											: OPTIONAL Multi_layer_stratum_feature;
    INVERSE
      network : Routed_physical_network FOR probe;
  END_ENTITY;

  ENTITY Routed_join_relationship
    ABSTRACT SUPERTYPE OF (ONEOF (
        Inter_stratum_join_relationship,
		Intra_stratum_join_relationship,
	 	Stratum_embedded_physical_component_join_relationship))
    SUBTYPE OF (Join_relationship);
    INVERSE
      network_topology : Routed_physical_network FOR routed_connectivity_requirement_element;
  END_ENTITY;

  ENTITY Routed_physical_network
    SUBTYPE OF (Generic_physical_network);
      reference_connected_terminals                	: OPTIONAL Part_connected_terminals_definition;    
      routed_connectivity_requirement_element 			: SET[1:?] OF Routed_join_relationship;
      unrouted_connectivity_requirement_element 		: OPTIONAL SET[1:?] OF Unrouted_join_relationship;      
      probe                                        	: OPTIONAL SET[1:?] OF Probe_access_area;
    DERIVE
    	complete	: BOOLEAN := NOT EXISTS(unrouted_connectivity_requirement_element);
    WHERE
      WR1 : SIZEOF(QUERY(cre <* connectivity_requirement_element | NOT (NOT ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.LAND_JOIN_TERMINAL' IN TYPEOF(cre)) OR (SIZEOF(TYPEOF(cre\Component_feature.associated_component) * ['LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.CONTACT_SIZE_DEPENDENT_LAND',
 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.' + 'COMPONENT_TERMINATION_PASSAGE_AND_CONTACT_SIZE_DEPENDENT_LAND',
 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.VIA_AND_CONTACT_SIZE_DEPENDENT_LAND']) = 1)))) = 0;
      WR2 : SIZEOF(QUERY(cre <* connectivity_requirement_element | NOT (NOT ('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.NON_FUNCTIONAL_LAND_JOIN_TERMINAL' IN TYPEOF(cre)) OR (SIZEOF(TYPEOF(cre\Component_feature.associated_component) * ['LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.' + 'COMPONENT_TERMINATION_PASSAGE_AND_' + 'CONTACT_SIZE_DEPENDENT_NON_FUNCTIONAL_LAND',
 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.' + 'VIA_AND_CONTACT_SIZE_DEPENDENT_NON_FUNCTIONAL_LAND']) = 1)))) = 0;      
      WR3: reference_connected_terminals.associated_definition = SELF\Generic_physical_network.current_associated_definition\Part_design_view.usage_view;
  END_ENTITY; 

  ENTITY Special_symbol_laminate_component
    SUPERTYPE OF (Primary_stratum_indicator_symbol)
    SUBTYPE OF (Laminate_component);
      SELF\Definition_based_product_occurrence.derived_from : Special_symbol_part_template;
      stratum_feature_implementation           				: Stratum_feature;
    DERIVE
      SELF\Product_view_definition.name : STRING := '';
  END_ENTITY;

  ENTITY Stratum
    SUPERTYPE OF (ONEOF (Documentation_layer_stratum,
 Design_layer_stratum))
    SUBTYPE OF (Part_view_definition, Item_shape);
      of_technology 												: Stratum_technology;
    DERIVE
      of_average_surface 	: SET[0:1] OF stratum_average_surface := 
        QUERY(tmp <* of_surface | 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.STRATUM_AVERAGE_SURFACE' IN TYPEOF(tmp));

      SELF\Item_shape.described_element : shapeable_item := SELF;
    INVERSE
      of_surface         	: SET[1:3] OF stratum_surface FOR of_stratum;
      assembly           	: SET[1:?] OF interconnect_module_stratum_assembly_relationship FOR component;
	  stratum_usage			: SET[0:1] OF External_source_identification FOR item;      
   WHERE
    WR1: SIZEOF(QUERY(tmp <* of_surface | tmp\Stratum_surface.name = stratum_surface_designation.average_surface)) <= 1;
    WR2: NOT(SIZEOF(QUERY(tmp <* of_surface | tmp\Stratum_surface.name = stratum_surface_designation.average_surface)) = 1) OR
            (SIZEOF(of_surface) < 3);    
    WR3: SIZEOF(QUERY(tmp <* of_surface | tmp\Stratum_surface.name = stratum_surface_designation.primary_surface)) <= 1;
    WR4: SIZEOF(QUERY(tmp <* of_surface | tmp\Stratum_surface.name = stratum_surface_designation.secondary_surface)) <= 1;
    WR5: NOT(SIZEOF(QUERY(tmp <* of_surface | tmp\Stratum_surface.name = stratum_surface_designation.secondary_surface)) = 1) OR
            (SIZEOF(QUERY(tmp <* of_surface | tmp\Stratum_surface.name = stratum_surface_designation.primary_surface)) = 1);
      END_ENTITY;

  ENTITY Stratum_average_surface
      SUBTYPE OF (Stratum_surface);
   WHERE
    WR1 : SELF\Stratum_surface.name = stratum_surface_designation.average_surface;
  END_ENTITY;

  ENTITY Stratum_embedded_physical_component_join_relationship
    SUBTYPE OF (Routed_join_relationship);
      terminal_to_be_connected : SET[1:?] OF Embedded_physical_component_terminal;
      point_to_be_connected    : SET[1:?] OF Layer_connection_point;
    DERIVE
      associated_component : Assembly_component := terminal_to_be_connected[1]\Component_feature.associated_component;
    WHERE
      WR1 : SIZEOF(QUERY(t <* terminal_to_be_connected | t.associated_component <> associated_component)) = 0;
  END_ENTITY;

  ENTITY Stratum_feature
		SUPERTYPE OF (ONEOF (Conductor,
 			Conductive_filled_area) ANDOR (Fiducial_stratum_feature))    
		SUBTYPE OF (Shape_element); 			
      SELF\Shape_element.containing_shape RENAMED resident_stratum  : Stratum;
      feature_of_size                                               : BOOLEAN;
    UNIQUE
      UR1 : SELF\Shape_element.element_name,
 resident_stratum;
  END_ENTITY;

  ENTITY Stratum_feature_template_component
    SUBTYPE OF (Laminate_component);
      SELF\Definition_based_product_occurrence.derived_from : Stratum_feature_template;
      stratum_feature_implementation           : Stratum_feature;
    DERIVE
      SELF\Product_view_definition.name : STRING := '';
  END_ENTITY;

  ENTITY Stratum_specific_part_template_location_in_padstack_definition
    SUBTYPE OF (Part_template_location_in_fd_or_pd);
      bound_stratum : Stratum;
    WHERE
      WR1 : SIZEOF(['LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.STRATUM_FEATURE_TEMPLATE',
 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.MATERIAL_ADDITION_FEATURE_TEMPLATE',
 'LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.MATERIAL_REMOVAL_FEATURE_TEMPLATE'] * 
 TYPEOF(SELF\Part_template_location_in_fd_or_pd.template)) = 1;
  END_ENTITY;

  ENTITY Stratum_surface;
      name       : stratum_surface_designation;  
      of_stratum : Stratum;
    UNIQUE
      UR1 : name,
 of_stratum;
  END_ENTITY;

  ENTITY Unplated_cutout_edge_segment
    SUBTYPE OF (Cutout_edge_segment);
      SELF\Cutout_edge_segment.composed_cutout : Partially_plated_cutout;
   WHERE
    WR1 : NOT('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.PLATED_INTER_STRATUM_FEATURE' IN TYPEOF(SELF));
  END_ENTITY;

  ENTITY Unplated_interconnect_module_edge_segment
    SUBTYPE OF (Interconnect_module_edge_segment);
      SELF\Interconnect_module_edge_segment.composed_edge : Partially_plated_interconnect_module_edge;
   WHERE
    WR1 : NOT('LAYERED_INTERCONNECT_MODULE_DESIGN_ARM.PLATED_INTER_STRATUM_FEATURE' IN TYPEOF(SELF));
  END_ENTITY;

  ENTITY Unrouted_conductive_interconnect_element
    SUBTYPE OF (Conductive_interconnect_element);
    INVERSE
      connected_points : SET[1:?] OF conductive_interconnect_element_terminal_link FOR associated_element;
    WHERE
      WR1 : NOT (EXISTS(SELF\Conductive_interconnect_element.composed_conductor));
      WR2 : correlated_terminals(SELF\Conductive_interconnect_element.access_mechanisms,
 connected_points);
  END_ENTITY;

  ENTITY Unrouted_join_relationship
    SUBTYPE OF (Join_relationship);
      unrouted_terminals : OPTIONAL SET[1:?] OF Laminate_component_join_terminal;
      unrouted_lcp       : OPTIONAL SET[1:?] OF Layer_connection_point;
      unrouted_junction  : OPTIONAL SET[1:?] OF Layout_junction;
      unrouted_paa       : OPTIONAL SET[1:?] OF Probe_access_area;
      unrouted_via       : OPTIONAL SET[1:?] OF Via_terminal;
    INVERSE
      network_topology : Routed_physical_network FOR unrouted_connectivity_requirement_element;
    WHERE
      WR1 : (SIZEOF(unrouted_terminals) + SIZEOF(unrouted_lcp) + SIZEOF(unrouted_paa) + SIZEOF(unrouted_via) + SIZEOF(unrouted_junction)) > 1;
  END_ENTITY;

  ENTITY Unrouted_physical_network
    SUBTYPE OF (Generic_physical_network);
  END_ENTITY; 

  ENTITY Unsupported_passage
    SUBTYPE OF (Inter_stratum_feature);
      SELF\Definition_based_product_occurrence.derived_from : Unsupported_passage_template;
    DERIVE
      SELF\Product_view_definition.name : STRING := '';
  END_ENTITY;

  ENTITY Unsupported_passage_template
    SUPERTYPE OF (ONEOF (Counterbore_passage_template,
 Countersunk_passage_template,
 Blind_passage_template))
    SUBTYPE OF (Inter_stratum_feature_template);
      SELF\Inter_stratum_feature_template.of_passage_technology : Default_unsupported_passage_definition;
  END_ENTITY;

  ENTITY Via
    ABSTRACT SUPERTYPE
    SUBTYPE OF (Plated_passage);
      SELF\Definition_based_product_occurrence.derived_from : Via_template;
  END_ENTITY;

  ENTITY Via_template
    SUBTYPE OF (Inter_stratum_feature_template);
      SELF\Inter_stratum_feature_template.of_passage_technology : Default_via_definition;
    INVERSE
      access_mechanisms : SET[2:?] OF via_template_terminal FOR containing_shape;
  END_ENTITY;

  ENTITY Via_template_terminal
    SUBTYPE OF (Placed_feature);
      SELF\Shape_element.containing_shape RENAMED associated_definition : Via_template;
      disallowed_inter_stratum_extent                                   : OPTIONAL Inter_stratum_extent;
      terminal_connection_zone                                          : OPTIONAL SET[1:?] OF Connection_zone_in_layout_template;
    DERIVE
      SELF\Shape_element.description : STRING := '';
    INVERSE
      SELF\Placed_feature.feature_shape : SET[0:1] OF geometric_model_constituent_relationship FOR constituent_element;
    UNIQUE
      UR1 : SELF\Shape_element.element_name,
 associated_definition;
  END_ENTITY;

  ENTITY Via_terminal
    SUBTYPE OF (Laminate_component_feature);
      SELF\Component_feature.definition           : Via_template_terminal;
      SELF\Component_feature.associated_component : Via;
    DERIVE
      SELF\Shape_element.description : STRING := '';
  END_ENTITY;

  FUNCTION correlated_terminals(
    input1 : SET OF Conductive_interconnect_element_terminal ;
    input2 : SET OF Conductive_interconnect_element_terminal_link
  ) : BOOLEAN;

    LOCAL
      pass : BOOLEAN := FALSE;
      ciet : SET OF conductive_interconnect_element_terminal := [];
    END_LOCAL;

    REPEAT i := 1 TO SIZEOF(input2) BY 1;
      ciet := ciet + input2[i].precedent_point;
      ciet := ciet + input2[i].subsequent_point;
    END_REPEAT;
    pass := (input1 = ciet);
    RETURN(pass);
  END_FUNCTION;

  FUNCTION make_aggregate_join(
    input1 : SET OF Inter_stratum_join_relationship ;
    input2 : SET OF Intra_stratum_join_relationship ;
    input3 : SET OF Stratum_embedded_physical_component_join_relationship;
    input4 : SET OF Unrouted_join_relationship) : SET OF Join_relationship;

    LOCAL
      v1 : SET OF join_relationship := input1;
    END_LOCAL;

    v1 := v1 + input2 + input3 + input4;
    RETURN(v1);
  END_FUNCTION;

  FUNCTION bag_to_set(
    the_bag : BAG OF GENERIC : intype
  ) : SET OF GENERIC : intype;

    LOCAL
      the_set : SET OF GENERIC : intype := [];
      i       : INTEGER;
    END_LOCAL;

    IF SIZEOF(the_bag) > 0 THEN
      REPEAT i := 1 TO HIINDEX(the_bag);
        the_set := the_set + the_bag[i];
      END_REPEAT;
    END_IF;
    RETURN(the_set);
  END_FUNCTION;

END_SCHEMA;

