(*
   $Id: mkmodule.js,v 1.41 2004/10/11 20:17:49 thendrix Exp $
   ISO TC184/SC4/WG12 N - ISO/CD-TS 10303-xxxx Layered interconnect module with printed component design - EXPRESS ARM
*)

SCHEMA Layered_interconnect_module_with_printed_component_design_arm;   

USE FROM Layered_interconnect_module_design_arm;

 	TYPE limwpcd_external_identification_item = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON external_identification_item WITH  
		(Printed_component);
	END_TYPE;

	SUBTYPE_CONSTRAINT limwpcd_assembly_component_subtypes FOR assembly_component; 
	    (ONEOF (physical_component,
		 printed_component,
	 	laminate_component));
	END_SUBTYPE_CONSTRAINT;

  ENTITY Printed_component
    SUBTYPE OF (Assembly_component);
      stratum_feature_implementation           : OPTIONAL SET[1:?] OF stratum_feature;
      SELF\definition_based_product_occurrence.derived_from : printed_part_template_or_printed_part_cross_section_template;
      printed_component_stack                  : OPTIONAL SET[1:?] OF printed_component_link;
      required_material_stack                  : OPTIONAL Laminate_layer;
      footprint_implementation                 : OPTIONAL footprint_occurrence;
    DERIVE
      access_mechanism : SET[1:?] OF printed_component_join_terminal := raw_access_mechanism + printed_component_access_mechanisms(printed_component_stack);
    INVERSE
      raw_access_mechanism       	: SET[1:?] OF printed_component_join_terminal FOR associated_component;
      associated_precedent_link  	: SET[0:1] OF printed_component_link FOR precedent_printed_component;
      associated_subsequent_link 	: SET[0:1] OF printed_component_link FOR subsequent_printed_component;
      cad_layer										: SET[0:1] OF External_source_identification FOR item;
    WHERE
      WR1  : NOT EXISTS(stratum_feature_implementation) OR same_stratum(stratum_feature_implementation);
      WR2  : NOT EXISTS(SELF\definition_based_product_occurrence.derived_from.of_stratum_technology) OR EXISTS(stratum_feature_implementation);
      WR3  : NOT EXISTS(SELF\definition_based_product_occurrence.derived_from.material_stack) OR EXISTS(required_material_stack);
      WR4  : NOT EXISTS(SELF\definition_based_product_occurrence.derived_from.printed_part_template_stack) OR EXISTS(printed_component_stack);
      WR5  : NOT EXISTS(printed_component_stack) OR consistent_stack_definition(SELF\definition_based_product_occurrence.derived_from,
 printed_component_stack);
      WR6  : NOT ('LAYERED_INTERCONNECT_MODULE_WITH_PRINTED_COMPONENT_DESIGN_ARM.ROUTED_PRINTED_COMPONENT' IN TYPEOF(SELF)) OR ('LAYERED_INTERCONNECT_MODULE_WITH_PRINTED_COMPONENT_DESIGN_ARM.PRINTED_PART_CROSS_SECTION_TEMPLATE' IN TYPEOF(SELF\definition_based_product_occurrence.derived_from));
      WR7  : NOT ('LAYERED_INTERCONNECT_MODULE_WITH_PRINTED_COMPONENT_DESIGN_ARM.PRINTED_PART_CROSS_SECTION_TEMPLATE' IN TYPEOF(SELF\definition_based_product_occurrence.derived_from)) OR ('LAYERED_INTERCONNECT_MODULE_WITH_PRINTED_COMPONENT_DESIGN_ARM.ROUTED_PRINTED_COMPONENT' IN TYPEOF(SELF));
      WR8  : SIZEOF(access_mechanism) > 0;
      WR9  : NOT EXISTS(footprint_implementation) OR (('LAYERED_INTERCONNECT_MODULE_WITH_PRINTED_COMPONENT_DESIGN_ARM.PRINTED_PART_TEMPLATE' IN TYPEOF(footprint_implementation.derived_from.reference_package)) AND (derived_from = footprint_implementation.derived_from.reference_package));
      WR10 : NOT EXISTS(footprint_implementation) OR NOT ('LAYERED_INTERCONNECT_MODULE_WITH_PRINTED_COMPONENT_DESIGN_ARM.ROUTED_PRINTED_COMPONENT' IN TYPEOF(SELF));
  END_ENTITY; -- printed_component

  ENTITY Printed_component_join_terminal
    SUBTYPE OF (Laminate_component_join_terminal);
      SELF\component_feature.definition           : printed_part_template_join_terminal;
      SELF\component_feature.associated_component : printed_component;
      stratum_concept_implementation              : stratum_feature_template_component;
    WHERE
      WR1 : SIZEOF(QUERY(sf <* SELF\component_feature.associated_component\printed_component.stratum_feature_implementation | sf = stratum_concept_implementation.stratum_feature_implementation)) = 1;
  END_ENTITY; -- printed_component_join_terminal

  ENTITY Printed_component_link;
      precedent_printed_component  : printed_component;
      subsequent_printed_component : printed_component;
      definition                   : printed_part_template_link;
    INVERSE
      associated_printed_component : printed_component FOR printed_component_stack;
    WHERE
      WR1 : precedent_printed_component\definition_based_product_occurrence.derived_from = definition.precedent_printed_part_template;
      WR2 : subsequent_printed_component\definition_based_product_occurrence.derived_from = definition.subsequent_printed_part_template;
      WR3 : precedent_printed_component <> subsequent_printed_component;
  END_ENTITY; -- printed_component_link

  ENTITY Printed_connector_component
    SUBTYPE OF (printed_component);
      SELF\definition_based_product_occurrence.derived_from : printed_connector_template;
    INVERSE
      interface_access_mechanism : SET[1:?] OF printed_connector_component_interface_terminal FOR associated_component;
  END_ENTITY; -- printed_connector_component

  ENTITY Printed_connector_component_interface_terminal
    SUBTYPE OF (Laminate_component_interface_terminal);
      SELF\component_feature.definition           : printed_part_template_interface_terminal;
      SELF\component_feature.associated_component : printed_connector_component;
      stratum_concept_implementation              : stratum_feature_template_component;
    WHERE
      WR1 : NOT EXISTS(SELF\component_feature.associated_component\printed_component.stratum_feature_implementation) OR (SIZEOF(QUERY(temp <* SELF\component_feature.associated_component\printed_component.stratum_feature_implementation | temp :=: stratum_concept_implementation.stratum_feature_implementation)) = 1);
  END_ENTITY; -- printed_connector_component_interface_terminal

  ENTITY Routed_printed_component
    SUBTYPE OF (printed_component);
      routed_centreline_shape                  : curve;
      SELF\definition_based_product_occurrence.derived_from : printed_part_cross_section_template;
      component_extent                         : inter_stratum_extent;
  END_ENTITY; -- routed_printed_component

  FUNCTION consistent_stack_definition(
    input1 : printed_part_template ;
    input2 : SET OF printed_component_link
  ) : BOOLEAN;

    LOCAL
      pass : BOOLEAN := FALSE;
    END_LOCAL;

    REPEAT i := 1 TO SIZEOF(input2) BY 1;
      pass := input2[i].definition.associated_printed_part_template :=: input1;
    END_REPEAT;
    RETURN(pass);
  END_FUNCTION; -- consistent_stack_definition

  FUNCTION printed_component_access_mechanisms(
    input : SET OF printed_component_link
  ) : SET OF printed_component_join_terminal;

    LOCAL
      pcjt : SET OF printed_component_join_terminal := [];
    END_LOCAL;

    REPEAT i := 1 TO SIZEOF(input) BY 1;
      pcjt := input[i].precedent_printed_component.raw_access_mechanism + pcjt;
      pcjt := input[i].subsequent_printed_component.raw_access_mechanism + pcjt;
    END_REPEAT;
    RETURN(pcjt);
  END_FUNCTION; -- printed_component_access_mechanisms

  FUNCTION same_stratum(
    input : SET OF stratum_feature
  ) : BOOLEAN;

    LOCAL
      pass : BOOLEAN := FALSE;
      s    : SET OF stratum := [];
      pptt : SET OF printed_part_template_terminal := [];
    END_LOCAL;

    REPEAT i := 1 TO SIZEOF(input) BY 1;
      s := input[i].resident_stratum + s;
    END_REPEAT;
    pass := (SIZEOF(s) = 1);
    RETURN(pass);
  END_FUNCTION; -- same_stratum

END_SCHEMA; 

