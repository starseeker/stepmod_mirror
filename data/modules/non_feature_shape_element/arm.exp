(*
   $Id: arm.exp,v 1.41 2005/11/14 09:59:27 kovaliovas Exp $
   ISO TC184/SC4/WG12 N3495 - ISO/CD-TS 10303-1706 Non feature shape element - EXPRESS ARM
*)

SCHEMA Non_feature_shape_element_arm; 

	USE FROM Physical_unit_shape_with_parameters_arm;	-- ISO/TS 10303-1730
  
  TYPE ee_product_definition_with_annotation_elements = EXTENSIBLE GENERIC_ENTITY SELECT;
  END_TYPE;

	TYPE nfse_usage_concept = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON usage_concept WITH 
		(Non_feature_shape_element);
	END_TYPE;

    TYPE nfse_feature_or_non_feature_usage = EXTENSIBLE GENERIC_ENTITY SELECT BASED_ON feature_or_non_feature_usage WITH 
		(Usage_view_level_non_feature_shape_definition);
	END_TYPE;
	
  TYPE view_shape_select = EXTENSIBLE GENERIC_ENTITY SELECT;
  END_TYPE;
  
  ENTITY Design_view_level_non_feature_shape_definition
    SUBTYPE OF (Non_feature_shape_definition);
      SELF\Non_feature_shape_definition.model_shape : Physical_unit_shape_model;
    WHERE
      WR1 : SELF\Geometric_model.context_of_items = SELF\Non_feature_shape_definition.model_shape\Geometric_model.context_of_items;
  END_ENTITY;
  
  ENTITY Interface_plane
    SUBTYPE OF (Non_feature_shape_element);
   WHERE
    WR1 : (SELF\Shape_element.element_name = 'interface plane');
  END_ENTITY;

  ENTITY Non_feature_shape_definition
  SUPERTYPE OF (ONEOF (Design_view_level_non_feature_shape_definition,
	    Usage_view_level_non_feature_shape_definition))   
    SUBTYPE OF (Geometric_model);
      associated_element : Non_feature_shape_element;
      model_shape        : OPTIONAL Geometric_model;
    DERIVE
      SELF\Representation.id : STRING := '';
    WHERE
      WR1 : TYPEOF(SELF) <> TYPEOF(model_shape);
  END_ENTITY;

  ENTITY Non_feature_shape_element
    SUBTYPE OF (Shape_element);
      SELF\Shape_element.element_name : STRING;
      SELF\Shape_element.containing_shape RENAMED scope : ee_product_definition_with_annotation_elements;
    INVERSE
      element_shape            : SET[0:?] OF non_feature_shape_definition FOR associated_element;
      associated_usage_concept : SET[0:?] OF geometric_model_constituent_relationship FOR constituent_element;
    UNIQUE
      UR1 : SELF\Shape_element.element_name,
 scope;
    WHERE
      WR1 : (NOT (SIZEOF(associated_usage_concept) > 0)) OR (SIZEOF(SELF\Placed_feature.feature_shape) > 0);
      WR2: NOT EXISTS (SELF\Shape_element.description);
  END_ENTITY;

  ENTITY Non_feature_shape_element_relationship
    SUBTYPE OF (Shape_element_relationship);
      SELF\Shape_element_relationship.relating : Non_feature_shape_element;    
      SELF\Shape_element_relationship.related : Non_feature_shape_element;
    DERIVE
      SELF\Shape_element_relationship.relation_type : STRING := '';
    UNIQUE
      UR1 : SELF\Shape_element_relationship.related,
 SELF\Shape_element_relationship.relating;
    WHERE
      WR1 : NOT EXISTS (SELF\Shape_element_relationship.relation_type);
  END_ENTITY;

   ENTITY Reference_graphic_registration_mark
    SUBTYPE OF (Non_feature_shape_element);
  END_ENTITY;

  ENTITY Seating_plane
    SUBTYPE OF (Non_feature_shape_element);
  END_ENTITY;

  ENTITY Usage_view_level_non_feature_shape_definition
    ABSTRACT SUPERTYPE
    SUBTYPE OF (Non_feature_shape_definition);
      SELF\Non_feature_shape_definition.model_shape : view_shape_select;
    WHERE
      WR1 : SELF\Geometric_model.context_of_items = SELF\Non_feature_shape_definition.model_shape\Geometric_model.context_of_items;
  END_ENTITY;

  ENTITY View_level_non_feature_shape_element
    SUBTYPE OF (Non_feature_shape_element);
     DERIVE
       SELF\Shape_element.description : STRING := '';
     WHERE
      WR1: NOT(SIZEOF(SELF\Non_feature_shape_element.element_shape) > 0) OR
      valid_es('NON_FEATURE_SHAPE_ELEMENT_ARM.USAGE_VIEW_LEVEL_NON_FEATURE_SHAPE_DEFINITION',
      (SELF\Non_feature_shape_element.element_shape));
  END_ENTITY;
  
  FUNCTION valid_es(input1 : STRING;
                  input2 : SET OF NON_FEATURE_SHAPE_DEFINITION) : BOOLEAN;
   REPEAT i := 1 to HIINDEX(input2);
    IF NOT (input1 IN TYPEOF(input2)) THEN RETURN(FALSE);
    END_IF;
   END_REPEAT;
    RETURN(TRUE);
  END_FUNCTION;

END_SCHEMA;
