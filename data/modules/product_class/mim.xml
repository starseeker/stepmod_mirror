<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<?xml-stylesheet type="text/xsl" href="../../../xsl/express.xsl"?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">

<express description.file="mim_descriptions.xml" language_version="2" rcs.date="$Date$" rcs.revision="$Revision$" reference="ISO/TS 10303-1103">
   <application name="JSDAI" owner="LKSoft" source="product_class_mim schema_instance" url="www.lksoft.com" version="4.0 beta"/>
   <schema name="Product_class_mim">
      <interface kind="use" schema="Classification_assignment_mim"/>
      <interface kind="use" schema="Group_mim"/>
      <interface kind="use" schema="Identification_assignment_mim"/>
      <interface kind="use" schema="Product_concept_identification_mim"/>
      <interface kind="use" schema="Property_assignment_mim"/>
      <interface kind="use" schema="basic_attribute_schema">
         <interfaced.item name="object_role"/>
      </interface>
      <interface kind="use" schema="product_concept_schema">
         <interfaced.item name="conditional_concept_feature"/>
         <interfaced.item name="product_concept_relationship"/>
         <interfaced.item name="product_concept_feature"/>
         <interfaced.item name="product_concept_feature_association"/>
         <interfaced.item name="concept_feature_operator"/>
      </interface>
      <interface kind="use" schema="product_property_definition_schema">
         <interfaced.item name="characterized_object"/>
      </interface>
      <type name="category_usage_item">
         <select selectitems="product_class"/>
      </type>
      <type name="id_for_class">
         <select basedon="identification_item" extensible="YES" genericentity="YES" selectitems="product_class product_concept_feature"/>
      </type>
      <type name="specification_for_category">
         <select basedon="groupable_item" extensible="YES" genericentity="YES" selectitems="package_product_concept_feature product_concept_feature"/>
      </type>
      <entity name="characterized_product_concept_feature" supertypes="product_concept_feature characterized_object"/>
      <entity name="characterized_product_concept_feature_category" supertypes="product_concept_feature_category characterized_object"/>
      <entity name="exclusive_product_concept_feature_category" supertypes="product_concept_feature_category"/>
      <entity name="inclusion_product_concept_feature" supertypes="conditional_concept_feature">
         <where expression="NOT ( 'PRODUCT_CLASS_MIM.' + 'PACKAGE_PRODUCT_CONCEPT_FEATURE' IN TYPEOF ( SELF ) )" label="WR1"/>
         <where expression="SIZEOF (QUERY( cfr &lt;* USEDIN( SELF ,'PRODUCT_CONCEPT_SCHEMA.' + 'CONCEPT_FEATURE_RELATIONSHIP.RELATING_PRODUCT_CONCEPT_FEATURE' ) | &#10;&#9;&#9;&#9;&#9;&#9;&#9;'PRODUCT_CONCEPT_SCHEMA.'+ 'CONCEPT_FEATURE_RELATIONSHIP_WITH_CONDITION' IN TYPEOF( cfr ) &#10;&#9;&#9;&#9; )) + &#10;&#9;&#9;&#9; SIZEOF(QUERY( cfr &lt;* USEDIN(SELF , 'PRODUCT_CONCEPT_SCHEMA.' + 'CONCEPT_FEATURE_RELATIONSHIP.RELATED_PRODUCT_CONCEPT_FEATURE' ) | &#10;&#9;&#9;&#9;&#9;&#9;&#9;'PRODUCT_CONCEPT_SCHEMA.' + 'CONCEPT_FEATURE_RELATIONSHIP_WITH_CONDITION' IN TYPEOF(cfr)&#10;&#9;&#9;&#9;)) = 0" label="WR2"/>
         <where expression="SELF.condition.conditional_operator.name = 'implication'" label="WR3"/>
      </entity>
      <entity name="package_product_concept_feature" supertypes="product_concept_feature">
         <where expression="NOT ( 'PRODUCT_CONCEPT_SCHEMA.' + 'CONDITIONAL_CONCEPT_FEATURE' IN TYPEOF ( SELF ) )" label="WR1"/>
         <where expression="SIZEOF ( QUERY ( cfr &lt;* USEDIN ( SELF , 'PRODUCT_CONCEPT_SCHEMA.' + 'CONCEPT_FEATURE_RELATIONSHIP.' +'RELATING_PRODUCT_CONCEPT_FEATURE' ) | &#10;&#9;&#9;        ('PRODUCT_CONCEPT_SCHEMA.' + 'CONCEPT_FEATURE_RELATIONSHIP_WITH_CONDITION' IN TYPEOF (cfr ) ) AND &#10;&#9;&#9;&#9;    (SIZEOF ( QUERY (ipcf &lt;* USEDIN ( cfr , 'PRODUCT_CONCEPT_SCHEMA.' + 'CONDITIONAL_CONCEPT_FEATURE.' + 'CONDITION' ) | &#10;&#9;&#9;&#9;&#9; 'PRODUCT_CLASS_MIM.' + 'INCLUSION_PRODUCT_CONCEPT_FEATURE' IN TYPEOF ( ipcf ) &#10;&#9;&#9;&#9;     )) = 1)&#10;&#9;&#9;)) &gt; 0" label="WR2"/>
      </entity>
      <entity name="product_class" supertypes="product_concept characterized_object"/>
      <entity name="product_concept_feature_category" supertypes="group">
         <where expression="SIZEOF(QUERY(aga &lt;* USEDIN( SELF, 'MANAGEMENT_RESOURCES_SCHEMA.' + 'GROUP_ASSIGNMENT.ASSIGNED_GROUP' ) |&#10;           ('GROUP_MIM.'+ 'APPLIED_GROUP_ASSIGNMENT' IN TYPEOF(aga)) AND&#10;           (( aga\group_assignment.role\object_role.name &lt;&gt; 'specification category member' ) OR &#10;            ( SIZEOF(QUERY (i &lt;* aga\applied_group_assignment.items | ('PRODUCT_CONCEPT_SCHEMA.'+ 'PRODUCT_CONCEPT_FEATURE' IN TYPEOF ( i ) ) AND &#10;             NOT ('PRODUCT_CONCEPT_SCHEMA.'+ 'CONDITIONAL_CONCEPT_FEATURE' IN TYPEOF (i)))) &lt;&gt; SIZEOF (aga\applied_group_assignment.items)&#10;              ))&#10;          )) =0" label="WR1"/>
      </entity>
      <entity name="product_concept_feature_category_usage" supertypes="group_assignment">
         <explicit name="assigned_group">
            <typename name="product_concept_feature_category"/>
            <redeclaration entity-ref="group_assignment"/>
         </explicit>
         <explicit name="items">
            <aggregate lower="1" type="SET" upper="?"/>
            <typename name="category_usage_item"/>
         </explicit>
         <where expression="SELF.role.name IN [ 'mandatory category usage', 'optional category usage' ]" label="WR1"/>
      </entity>
      <rule appliesto="product_concept_feature" name="product_concept_feature_requires_category">
         <where expression="SIZEOF ( QUERY ( pcf &lt;* product_concept_feature |&#10;(SIZEOF(['PRODUCT_CLASS_MIM.' + 'INCLUSION_PRODUCT_CONCEPT_FEATURE',&#10;'PRODUCT_CONCEPT_SCHEMA.' + 'CONDITIONAL_CONCEPT_FEATURE'] * TYPEOF(pcf)) = 0) AND &#10;(SIZEOF ( QUERY ( aga &lt;* USEDIN ( pcf , 'GROUP_MIM.' + 'APPLIED_GROUP_ASSIGNMENT.' + 'ITEMS' ) | &#10;(aga\group_assignment.role\object_role.name = 'specification category member' ) AND &#10;('PRODUCT_CLASS_MIM.' + 'PRODUCT_CONCEPT_FEATURE_CATEGORY' IN TYPEOF ( aga.assigned_group )))) &lt;&gt;1 ) ) ) = 0" label="WR1"/>
      </rule>
      <rule appliesto="concept_feature_operator" name="restrict_concept_feature_operator">
         <where expression="SIZEOF ( QUERY ( cfo &lt;* concept_feature_operator | NOT&#10;&#9;&#9;( cfo.name IN ['and' , 'or' , 'oneof' , 'not' , 'implication'] ) ) ) = 0" label="WR1"/>
         <where expression="SIZEOF ( QUERY ( cfo &lt;* concept_feature_operator | (cfo.name = 'implication' ) AND&#10;&#9; ( SIZEOF ( QUERY (cfrwc &lt;* USEDIN ( cfo , 'PRODUCT_CONCEPT_SCHEMA.' + 'CONCEPT_FEATURE_RELATIONSHIP_WITH_CONDITION.' +&#10;&#9;'CONDITIONAL_OPERATOR' ) | &#10;&#9;&#9;SIZEOF ( QUERY ( ccf &lt;* USEDIN( cfrwc , 'PRODUCT_CONCEPT_SCHEMA.' + 'CONDITIONAL_CONCEPT_FEATURE.CONDITION' ) | &#10;&#9;&#9;NOT ('PRODUCT_CLASS_MIM.' + 'INCLUSION_PRODUCT_CONCEPT_FEATURE' IN TYPEOF ( ccf )))) &gt;0 )) &gt;0 ))) = 0" label="WR2"/>
         <where expression="SIZEOF( QUERY (cfo &lt;* concept_feature_operator | (cfo.name = 'not')&#10;&#9;AND (SIZEOF(QUERY(cfrwc &lt;* USEDIN(cfo, 'PRODUCT_CONCEPT_SCHEMA.' + 'CONCEPT_FEATURE_RELATIONSHIP_WITH_CONDITION.CONDITIONAL_OPERATOR') | &#10;&#9;&#9;cfrwc.related_product_concept_feature :&lt;&gt;: cfrwc.relating_product_concept_feature)) &gt;0 ))) = 0" label="WR3"/>
      </rule>
      <rule appliesto="group_relationship" name="restrict_group_relationship_for_specification_category">
         <where expression="SIZEOF( QUERY( gr &lt;* group_relationship | &#10;  (gr.name = 'specification category hierarchy') AND &#10;  (NOT('PRODUCT_CLASS_MIM.PRODUCT_CONCEPT_FEATURE_CATEGORY' IN TYPEOF(gr.related_group)) &#10;  OR NOT('PRODUCT_CLASS_MIM.PRODUCT_CONCEPT_FEATURE_CATEGORY' IN TYPEOF(gr.relating_group))) )) = 0" label="WR1"/>
      </rule>
   </schema>
</express>
