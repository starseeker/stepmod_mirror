<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<?xml-stylesheet type="text/xsl" href="../../../xsl/express.xsl"?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">

<express description.file="mim_descriptions.xml" language_version="2" rcs.date="$Date$" rcs.revision="$Revision$" reference="ISO/TS 10303-1063">
   <application name="JSDAI" owner="LKSoft" source="product_occurrence_mim schema_instance" url="www.lksoft.com" version="4.0 beta"/>
   <schema name="Product_occurrence_mim">
      <interface kind="use" schema="Assembly_structure_mim"/>
      <interface kind="use" schema="Product_view_definition_relationship_mim"/>
      <interface kind="use" schema="Extended_measure_representation_mim"/>
      <interface kind="use" schema="Specified_product_mim"/>
      <interface kind="use" schema="Part_view_definition_mim"/>
      <interface kind="use" schema="product_structure_schema">
         <interfaced.item name="product_definition_occurrence"/>
         <interfaced.item name="product_definition_occurrence_relationship"/>
         <interfaced.item name="product_definition_specified_occurrence"/>
         <interfaced.item name="product_definition_occurrence_reference"/>
         <interfaced.item name="product_definition_occurrence_reference_with_local_representation"/>
         <interfaced.item name="quantified_assembly_component_usage"/>
      </interface>
      <interface kind="use" schema="product_definition_schema">
         <interfaced.item name="product_definition_relationship"/>
      </interface>
      <interface kind="use" schema="product_property_definition_schema">
         <interfaced.item name="characterized_product_definition"/>
         <interfaced.item name="property_definition"/>
      </interface>
      <interface kind="use" schema="product_property_representation_schema">
         <interfaced.item name="property_definition_representation"/>
      </interface>
      <interface kind="reference" schema="support_resource_schema">
         <interfaced.item name="bag_to_set"/>
      </interface>
      <type name="product_definition_or_assembly_relationship">
         <select selectitems="assembly_component_usage product_definition"/>
      </type>
      <rule appliesto="product_definition" name="restrict_part_occurrence">
         <algorithm>LOCAL
      part_occurrences: SET OF product_definition := QUERY(pd &lt;* product_definition | 
	    ( pd.frame_of_reference.name = 'part occurrence' ));
    END_LOCAL;</algorithm>
         <where expression="SIZEOF ( QUERY ( pd &lt;* part_occurrences | &#10;&#9;    ( NOT( pd.name IN &#10;        ['single instance' , 'selected instance' ,'quantified instance' , 'specified instance' ] ) ) ) ) = 0" label="WR1"/>
         <where expression="SIZEOF ( QUERY ( pd &lt;* part_occurrences | &#10; &#9;    (SIZEOF ( QUERY ( pdr &lt;* USEDIN ( pd ,&#10;        'PRODUCT_DEFINITION_SCHEMA.' + 'PRODUCT_DEFINITION_RELATIONSHIP.RELATED_PRODUCT_DEFINITION' ) | &#10;&#9;    pdr.name = 'definition usage' ) ) &lt;&gt;1 ) AND &#10;        ( SIZEOF ( QUERY ( cd &lt;* USEDIN ( pd , 'CONFIGURATION_MANAGEMENT_SCHEMA.' + 'CONFIGURATION_DESIGN.DESIGN' ) | &#10;        ( cd.name = 'occurrence usage definition' ) AND &#10;        ( NOT ('SPECIFIED_PRODUCT_MIM.' + 'PRODUCT_IDENTIFICATION' IN TYPEOF( cd.configuration ) ) ) ) ) &lt;&gt;1 ) ) ) = 0" label="WR2"/>
         <where expression="SIZEOF ( QUERY ( pd &lt;* part_occurrences |  &#10;        (SIZEOF ( QUERY ( cd &lt;* USEDIN ( pd , 'PRODUCT_DEFINITION_SCHEMA.'+ 'PRODUCT_DEFINITION_RELATIONSHIP.RELATED_PRODUCT_DEFINITION' ) |&#10;        ( 'PRODUCT_STRUCTURE_SCHEMA.' +'PRODUCT_DEFINITION_USAGE' IN TYPEOF ( cd ) ) ) ) = 0 )AND&#10;        ( SIZEOF ( USEDIN ( pd , 'PRODUCT_STRUCTURE_SCHEMA.' + 'PRODUCT_DEFINITION_OCCURRENCE_RELATIONSHIP.OCCURRENCE' ) ) = 0 ) ) ) = 0" label="WR3"/>
         <where expression="SIZEOF ( QUERY ( pd &lt;* part_occurrences | &#10;        ( pd.name = 'selected instance' ) AND &#10;        NOT valid_selected_instance_representation(pd) ))=0" label="WR4"/>
         <where expression="SIZEOF ( QUERY ( pd &lt;* part_occurrences | &#10;        ( pd.name = 'quantified instance' ) AND &#10;        ( SIZEOF ( QUERY (ppd &lt;* USEDIN ( pd , 'PRODUCT_PROPERTY_DEFINITION_SCHEMA.' +'PROPERTY_DEFINITION.DEFINITION' ) |&#10;        ( ppd.name ='occurrence quantity' ) AND &#10;        ( SIZEOF ( QUERY ( pdr &lt;*USEDIN ( ppd , 'PRODUCT_PROPERTY_REPRESENTATION_SCHEMA.' +'PROPERTY_DEFINITION_REPRESENTATION.DEFINITION' ) | (&#10;        pdr.used_representation.name = 'quantity' ) AND &#10;        (SIZEOF ( pdr.used_representation.items ) = 1 ) AND &#10;        (SIZEOF ( QUERY ( i &lt;* pdr.used_representation.items | &#10;        ('QUALIFIED_MEASURE_SCHEMA.' + 'MEASURE_REPRESENTATION_ITEM' IN TYPEOF ( i ) ) AND&#10;        ( i.name = 'quantity measure' ) ) ) = 1)))= 1 )))= 0 )))= 0" label="WR5"/>
         <where expression="SIZEOF ( QUERY ( pd &lt;* part_occurrences | &#10;        ( pd.name = 'specified instance' ) AND &#10;        ( SIZEOF ( QUERY (&#10;        pdor &lt;* USEDIN ( pd , 'PRODUCT_STRUCTURE_SCHEMA.' +'PRODUCT_DEFINITION_OCCURRENCE_RELATIONSHIP.OCCURRENCE' ) | &#10;        'PRODUCT_STRUCTURE_SCHEMA.' +'SPECIFIED_HIGHER_USAGE_OCCURRENCE' IN TYPEOF ( pdor.occurrence_usage ) ) ) = 0 ) ) ) = 0" label="WR6"/>
      </rule>
      <rule appliesto="product_definition" name="restrict_part_occurrence_category">
         <algorithm>LOCAL
      part_occurrences: SET OF product_definition := QUERY( pd &lt;* product_definition |(
        pd.frame_of_reference.name = 'part occurrence'));
    END_LOCAL;</algorithm>
         <where expression="SIZEOF( QUERY( pd &lt;* part_occurrences | &#10;        (SIZEOF( QUERY( prpc &lt;* USEDIN(pd.formation.of_product, 'PRODUCT_DEFINITION_SCHEMA.PRODUCT_RELATED_PRODUCT_CATEGORY.PRODUCTS') | &#10;        prpc.name IN ['part','raw material','tool'] )) = 0 ) )) = 0" label="WR1"/>
      </rule>
      <rule appliesto="product_definition_relationship" name="restrict_product_definitions_for_definition_usage">
         <where expression="SIZEOF ( QUERY ( pdr &lt;* product_definition_relationship |&#10;        ( pdr.name = 'definition usage' ) AND &#10;        ( ( pdr.relating_product_definition.frame_of_reference.name&lt;&gt; 'part definition' ) OR &#10;        ( pdr.related_product_definition.frame_of_reference.name&lt;&gt;'part occurrence' )))) =0" label="WR1"/>
      </rule>
      <rule appliesto="assembly_component_usage" name="selected_instance_usage_requires_representation">
         <algorithm>LOCAL
      selected_instance_usages: SET OF assembly_component_usage := QUERY( acr &lt;* assembly_component_usage|
        (acr.name = 'selected instance usage'));
    END_LOCAL;</algorithm>
         <where expression="SIZEOF ( QUERY ( acr &lt;* selected_instance_usages | &#10;        NOT valid_selected_instance_representation(acr) ))=0" label="WR1"/>
      </rule>
      <function name="valid_selected_instance_representation">
         <parameter name="pd">
            <typename name="product_definition_or_assembly_relationship"/>
         </parameter>
         <builtintype type="LOGICAL"/>
         <algorithm>LOCAL
      properties: SET OF property_definition := bag_to_set(QUERY( prd&lt;* USEDIN ( pd ,'PRODUCT_PROPERTY_DEFINITION_SCHEMA.PROPERTY_DEFINITION.DEFINITION' ) | 
        (prd.name = 'occurrence selection' )));
      property_definition_representations: SET OF property_definition_representation := bag_to_set(QUERY ( pdr &lt;* USEDIN ( properties[1] , 'PRODUCT_PROPERTY_REPRESENTATION_SCHEMA.PROPERTY_DEFINITION_REPRESENTATION.DEFINITION') | 
	    ( pdr.used_representation.name = 'selection criteria' )));
      selected_representation: representation;
    END_LOCAL;
    IF (SIZEOF( properties)&lt;&gt;1) THEN
	  RETURN(FALSE);
    END_IF;
    IF (SIZEOF(property_definition_representations)&lt;&gt;1) THEN
	  RETURN(FALSE);
    END_IF;
    selected_representation := property_definition_representations[1]\property_definition_representation.used_representation;
    IF (SIZEOF(selected_representation\representation.items) &lt;1) OR (SIZEOF(selected_representation\representation.items) &gt;2) THEN
	  RETURN(FALSE);
    END_IF;
    IF (SIZEOF ( QUERY ( i &lt;* selected_representation\representation.items |
	  ( SIZEOF (['QUALIFIED_MEASURE_SCHEMA.MEASURE_REPRESENTATION_ITEM' ,
      'EXTENDED_MEASURE_REPRESENTATION_MIM.VALUE_RANGE']* TYPEOF ( i ) ) = 1) AND
      ( i.name = 'selection quantity' ))) &lt;&gt; 1 ) THEN
      RETURN(FALSE);
    END_IF;
    IF (SIZEOF ( QUERY ( i &lt;* selected_representation\representation.items |
	  ( 'QUALIFIED_MEASURE_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' IN TYPEOF ( i ) ) AND
 	  ( i.name = 'selection control' )))&gt; 1) THEN
	  RETURN(FALSE);
    END_IF; --the selection control is not specified then the quantity shall be a qualified_representation_item or a value_range
    IF (SIZEOF ( QUERY ( i &lt;* selected_representation\representation.items |
      ( 'QUALIFIED_MEASURE_SCHEMA.DESCRIPTIVE_REPRESENTATION_ITEM' IN TYPEOF( i ) ) AND
      ( i.name = 'selection control' ) ))= 0) AND 
      (SIZEOF ( QUERY ( i &lt;* selected_representation\representation.items |
      ( i.name = 'selection quantity' ) AND  
      ( SIZEOF(['QUALIFIED_MEASURE_SCHEMA.QUALIFIED_REPRESENTATION_ITEM' ,
      'EXTENDED_MEASURE_REPRESENTATION_MIM.VALUE_RANGE']* TYPEOF ( i ) ) =0 ))) &gt; 0 ) THEN
	  RETURN(FALSE);
    END_IF;
    RETURN(TRUE);</algorithm>
      </function>
   </schema>
</express>
