<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../../../xsl/express.xsl"?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">

<express language_version="2" rcs.date="$Date$" rcs.revision="$Revision$" description.file="arm_descriptions.xml">
   <application name="JSDAI" owner="LKSoft" url="www.lksoft.com" version="4.0 beta" source="shape_feature_arm schema_instance"/>
   <schema name="Shape_feature_arm">
      <interface kind="use" schema="Contextual_shape_positioning_arm"/>
      <interface kind="use" schema="Property_assignment_arm"/>
      <interface kind="reference" schema="Characterizable_object_arm">
         <interfaced.item name="bag_to_set"/>
      </interface>
      <type name="sf_property_assignment_select">
         <select basedon="property_assignment_select" selectitems="Shape_element Characterizable_object"/>
      </type>
      <entity name="Instanced_feature" supertypes="Shape_feature_occurrence Shape_feature_definition"/>
      <entity name="Placed_feature" supertypes="Shape_feature_occurrence">
         <explicit name="definition">
            <typename name="Shape_feature_definition"/>
         </explicit>
      </entity>
      <entity name="Shape_feature_definition" supertypes="Characterizable_object">
         <derived name="feature_model" expression="get_geometric_model(of_shape)">
            <aggregate type="SET" lower="1" upper="?"/>
            <typename name="Geometric_model"/>
         </derived>
         <inverse name="of_shape" entity="Item_shape" attribute="described_element"/>
         <where label="WR1" expression="EXISTS(feature_model)"/>
      </entity>
      <entity name="Shape_feature_occurrence" abstract.supertype="YES" supertypes="Shape_element" super.expression="ONEOF (Instanced_feature, Placed_feature)"/>
      <function name="get_geometric_model">
         <parameter name="input">
            <typename name="Item_shape"/>
         </parameter>
         <aggregate type="SET" lower="0" upper="?"/>
         <typename name="Geometric_model"/>
         <algorithm>LOCAL
  sda : SET OF Shape_description_association := [];
  gm : SET OF Geometric_model := [];
 END_LOCAL;
 
  sda := bag_to_set(USEDIN(input,
	 	'SHAPE_PROPERTY_ASSIGNMENT_ARM.' + 
	 	'SHAPE_DESCRIPTION_ASSOCIATION.' + 'REPRESENTED_CHARACTERISTIC'));
 
 REPEAT i := 1 to SIZEOF(sda) BY 1;
  gm := gm + sda[i].representation;
 END_REPEAT;
 RETURN(gm);</algorithm>
      </function>
   </schema>
</express>
