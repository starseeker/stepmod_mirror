<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<?xml-stylesheet type="text/xsl" href="../../../xsl/express.xsl"?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">

<express description.file="arm_descriptions.xml" language_version="2" rcs.date="$Date$" rcs.revision="$Revision$" reference="ISO/TS 10303-1108">
   <application name="JSDAI" owner="LKSoft" source="specification_based_configuration_arm schema_instance" url="www.lksoft.com" version="4.0 beta"/>
   <schema name="Specification_based_configuration_arm">
      <interface kind="use" schema="Effectivity_application_arm"/>
      <interface kind="use" schema="Product_class_arm"/>
      <type name="configuration_inheritance_types">
         <enumeration items="exception_case full_inheritance no_inheritance"/>
      </type>
      <type name="configuration_kind">
         <enumeration items="usage design"/>
      </type>
      <type name="configured_item_select">
         <select extensible="YES" genericentity="YES"/>
      </type>
      <type name="configured_specification_select">
         <select selectitems="Class_condition_association Class_specification_association"/>
      </type>
      <type name="effectivity_for_configuration">
         <select basedon="effectivity_item" selectitems="Configuration"/>
      </type>
      <entity name="Configuration">
         <explicit name="configured_element">
            <typename name="configured_item_select"/>
         </explicit>
         <explicit name="is_solution_for">
            <typename name="configured_specification_select"/>
         </explicit>
         <explicit name="configuration_type">
            <typename name="configuration_kind"/>
         </explicit>
         <explicit name="inheritance_type">
            <typename name="configuration_inheritance_types"/>
         </explicit>
         <where expression="consistent_configuration_type(SELF)" label="WR1"/>
      </entity>
      <rule appliesto="Effectivity_assignment" name="restrict_to_dated_effectivity">
         <algorithm>LOCAL
  ndea_set : SET OF Effectivity_assignment := [];
END_LOCAL;
  ndea_set := QUERY(ea &lt;* Effectivity_assignment | 
	NOT ('EFFECTIVITY_ARM.DATED_EFFECTIVITY' IN TYPEOF(ea.assigned_effectivity)));</algorithm>
         <where expression="SIZEOF(QUERY(ea &lt;* ndea_set | &#10;&#9;&#9;(SIZEOF(['SPECIFICATION_BASED_CONFIGURATION_ARM.CONFIGURATION']*type_of_set(ea.items))&gt;0) )) =0" label="WR1"/>
      </rule>
      <function name="consistent_configuration_type">
         <parameter name="config">
            <typename name="Configuration"/>
         </parameter>
         <builtintype type="BOOLEAN"/>
         <algorithm>IF ('PRODUCT_CLASS_ARM.CLASS_CONDITION_ASSOCIATION' IN TYPEOF(config.is_solution_for)) THEN
  IF config.configuration_type = configuration_kind.usage THEN
    RETURN(config.is_solution_for\Class_condition_association.condition_type ='part usage');
  ELSE
    RETURN(config.is_solution_for\Class_condition_association.condition_type ='design case');
  END_IF;
END_IF;

IF ('PRODUCT_CLASS_ARM.CLASS_SPECIFICATION_ASSOCIATION' IN TYPEOF(config.is_solution_for)) THEN
  IF config.configuration_type = configuration_kind.usage THEN
    RETURN(config.is_solution_for\Class_specification_association.association_type ='part usage');
  ELSE 
    RETURN(config.is_solution_for\Class_specification_association.association_type ='design case');
  END_IF;
END_IF;

RETURN(FALSE);</algorithm>
      </function>
      <function name="type_of_set">
         <parameter name="items">
            <aggregate lower="0" type="SET" upper="?"/>
            <builtintype type="GENERICENTITY"/>
         </parameter>
         <aggregate lower="0" type="SET" upper="?"/>
         <builtintype type="STRING"/>
         <algorithm>LOCAL
  result: SET OF STRING:= [];
END_LOCAL;

REPEAT i:=1 TO HIINDEX(items);
  result := result + TYPEOF(items[i]);
END_REPEAT;
RETURN(result);</algorithm>
      </function>
   </schema>
</express>
