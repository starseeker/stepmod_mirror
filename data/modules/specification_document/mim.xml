<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../../../xsl/express.xsl"?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">

<express language_version="2" rcs.date="2005-03-30T15:55:31" rcs.revision="1.0" description.file="mim_descriptions.xml">
   <application name="JSDAI" owner="LKSoft" url="www.lksoft.com" version="4.0 beta" source="specification_document_mim schema_instance"/>
   <schema name="SPECIFICATION_DOCUMENT_MIM">
      <interface kind="use" schema="CHARACTERISTIC_MIM"/>
      <interface kind="use" schema="CONFIGURATION_ITEM_MIM"/>
      <interface kind="use" schema="DOCUMENT_ASSIGNMENT_MIM"/>
      <interface kind="use" schema="ENCODED_TEXT_REPRESENTATION_MIM"/>
      <interface kind="use" schema="PERSON_ORGANIZATION_ASSIGNMENT_MIM"/>
      <interface kind="use" schema="PERSON_ORGANIZATION_MIM"/>
      <interface kind="use" schema="DOCUMENT_SCHEMA">
         <interfaced.item name="document_type"/>
      </interface>
      <interface kind="use" schema="MANAGEMENT_RESOURCES_SCHEMA">
         <interfaced.item name="group_assignment"/>
      </interface>
      <interface kind="use" schema="DATE_TIME_SCHEMA">
         <interfaced.item name="date_time_role"/>
      </interface>
      <interface kind="use" schema="PRODUCT_DEFINITION_SCHEMA">
         <interfaced.item name="product_definition_formation_relationship"/>
      </interface>
      <type name="document_identifier_assigned_item">
         <select selectitems="document"/>
      </type>
      <type name="sd_document_reference_item">
         <select extensible="YES" genericentity="YES" basedon="document_reference_item" selectitems="configuration_item product product_definition product_definition_formation"/>
      </type>
      <entity name="document_identifier" supertypes="group">
         <unique label="ur1">
            <unique.attribute entity-ref="document_identifier" attribute="name"/>
            <unique.attribute entity-ref="document_identifier" attribute="description"/>
         </unique>
         <where label="wr1" expression=" sizeof ( usedin ( self , 'specification_document_mim.' + 'document_identifier_assignment.items' ) ) &gt; 0 "/>
      </entity>
      <entity name="document_identifier_assignment" supertypes="group_assignment">
         <explicit name="assigned_group">
            <typename name="document_identifier"/>
            <redeclaration entity-ref="group_assignment"/>
         </explicit>
         <explicit name="items">
            <aggregate type="SET" lower="1" upper="?"/>
            <typename name="document_identifier_assigned_item"/>
         </explicit>
      </entity>
      <entity name="ee_specification" supertypes="document">
         <where label="wr1" expression=" sizeof ( query ( apoa &lt;* usedin ( self , 'specification_document_mim.' + 'applied_person_and_organization_assignment.items' ) | apoa . role \ person_and_organization_role . name = 'document source' ) ) + sizeof ( query ( apoa &lt;* usedin ( self , 'specification_document_mim.' + 'applied_organization_assignment.items' ) | apoa . role \ organization_role . name = 'document source' ) ) &gt;= 1 "/>
         <where label="wr2" expression=" self \ document . kind \ document_type . product_data_type in [ 'assembly technology specification' , 'design specification' , 'fabrication technology specification' , 'interface specification' , 'language reference manual' , 'lead form specification' , 'material specification' , 'reference document' , 'source code' , 'font registration document' , 'process specification' , 'surface finish specification' , 'test specification' ] "/>
      </entity>
      <entity name="structured_text_representation_context" supertypes="representation_context">
         <where label="wr1" expression=" sizeof ( query ( rep &lt;* usedin ( self , 'specification_document_mim.' + 'representation.context_of_items' ) | not ( 'specification_document_mim.' + 'structured_text_representation_item' in typeof ( rep ) ) ) ) = 0 "/>
      </entity>
      <entity name="structured_text_representation_item" supertypes="representation descriptive_representation_item">
         <where label="wr1" expression=" sizeof ( query ( rr &lt;* usedin ( self , 'specification_document_mim.' + 'representation_relationship.rep_2' ) | 'specification_document_mim.' + 'structured_text_representation_item' in typeof ( rr . rep_1 ) ) ) &lt;= 1 "/>
         <where label="wr2" expression=" sizeof ( usedin ( self , 'specification_document_mim.' + 'applied_document_reference.items' ) ) &gt;= 1 "/>
         <where label="wr3" expression=" ( sizeof ( query ( it &lt;* self \ representation . items | 'specification_document_mim.' + 'externally_defined_representation_item' in typeof ( it ) ) ) = 1 ) "/>
      </entity>
      <rule name="ee_document_constraint" appliesto="document">
         <where label="wr1" expression=" sizeof ( query ( doc &lt;* document | ( sizeof ( query ( adata &lt;* usedin ( doc , 'specification_document_mim.' + 'applied_date_and_time_assignment.items' ) | ( adata . role \ date_time_role . name = 'creation date' ) ) ) = 0 ) ) ) = 0 "/>
         <where label="wr2" expression=" sizeof ( query ( doc &lt;* document | not ( ( sizeof ( query ( aoa &lt;* usedin ( doc , 'specification_document_mim.' + 'applied_organization_assignment.items' ) | ( aoa . role \ organization_role . name = 'publisher' ) ) ) = 1 ) or ( sizeof ( query ( apaoa &lt;* usedin ( doc , 'specification_document_mim.' + 'applied_person_and_organization_assignment.items' ) | ( apaoa . role \ person_and_organization_role . name = 'publisher' ) ) ) = 1 ) ) ) ) = 0 "/>
         <where label="wr3" expression=" sizeof ( query ( doc &lt;* document | not ( sizeof ( usedin ( doc , 'specification_document_mim.' + 'document_identifier_assignment.items' ) ) = 1 ) ) ) = 0 "/>
      </rule>
      <rule name="ee_document_unique_constraint" appliesto="document document_identifier_assignment">
         <algorithm> local pass : boolean := true ; rev_exists_bag : bag of document := [ ] ; dia_bag : bag of document_identifier_assignment := [ ] ; desc_bag : bag of string := [ ] ; end_local ; repeat i := 1 to sizeof ( document ) by 1 ; if ( not pass ) then escape ; end_if ; if not ( exists ( document [ i ] . description ) ) then pass := false ; end_if ; end_repeat ; repeat i := 1 to sizeof ( document_identifier_assignment ) by 1 ; if ( not pass ) then escape ; end_if ; desc_bag := [ ] ; repeat j := 1 to sizeof ( document_identifier_assignment [ i ] . items ) by 1 ; desc_bag := desc_bag + document_identifier_assignment [ i ] . items [ j ] \ document . description ; end_repeat ; if not ( value_unique ( desc_bag ) ) then pass := false ; end_if ; end_repeat ; </algorithm>
         <where label="wr1" expression=" pass "/>
      </rule>
      <rule name="product_association_constraint" appliesto="product_definition_formation_relationship">
         <where label="wr1" expression=" sizeof ( query ( pdfr &lt;* product_definition_formation_relationship | ( pdfr \ product_definition_formation_relationship . name = 'product association' ) and ( sizeof ( query ( adr &lt;* usedin ( pdfr , 'specification_document_mim.' + 'applied_document_reference.items' ) | ( 'specification_document_mim.' + 'ee_specification' in typeof ( adr . assigned_document ) ) ) ) = 0 ) ) ) = 0 "/>
      </rule>
      <rule name="product_association_unique_constraint" appliesto="product_definition_formation_relationship">
         <algorithm> local pdfr : bag of product_definition_formation_relationship := query ( r &lt;* product_definition_formation_relationship | ( r \ product_definition_formation_relationship . name = 'product association' ) ) ; pdf_bag : bag of product_definition_formation := [ ] ; pdfr_bag : bag of product_definition_formation_relationship ; pass : boolean := true ; adr_bag : bag of applied_document_reference ; es_bag : bag of ee_specification ; end_local ; repeat i := 1 to sizeof ( pdfr ) by 1 ; if exists ( pdfr [ i ] . relating_product_definition_formation ) then if ( not ( pdfr [ i ] . relating_product_definition_formation in pdf_bag ) ) then pdf_bag := pdf_bag + pdfr [ i ] . relating_product_definition_formation ; end_if ; end_if ; end_repeat ; repeat i := 1 to sizeof ( pdf_bag ) by 1 ; if ( not pass ) then escape ; end_if ; pdfr_bag := query ( r &lt;* pdfr | ( r . relating_product_definition_formation :=: pdf_bag [ i ] ) ) ; es_bag := [ ] ; repeat j := 1 to sizeof ( pdfr_bag ) by 1 ; if ( not pass ) then escape ; end_if ; adr_bag := query ( adr &lt;* usedin ( pdfr_bag [ j ] , ( 'ap210_product_data_management_mim.' + 'applied_document_reference.items' ) ) | ( ( 'ap210_product_data_management_mim.' + 'ee_specification' ) in typeof ( adr . assigned_document ) ) ) ; repeat k := 1 to sizeof ( adr_bag ) by 1 ; if exists ( adr_bag [ k ] . assigned_document ) then if ( adr_bag [ k ] . assigned_document in es_bag ) then pass := false ; escape ; else es_bag := es_bag + adr_bag [ k ] . assigned_document ; end_if ; end_if ; end_repeat ; end_repeat ; end_repeat ; </algorithm>
         <where label="wr1" expression=" pass "/>
      </rule>
   </schema>
</express>
