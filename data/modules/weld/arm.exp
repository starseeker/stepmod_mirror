(*
   $Id: arm.exp,v 1.2 2014/10/20 20:05:07 thomasrthurman Exp $
   N - ISO/CD-TS - 10303- weld - EXPRESS ARM*)
(* UNDER DEVELOPMENT *)
(* rev 1.3
replace Length_data_element with Length_tolerance_characteristic except where
nominal values were specified.
replace Angle_data_element with Angle_tolerance_characteristic except where
nominal values were specified.
Added USE FROM Geometric_tolerance because there are some flatness tolerances specified in e.g.,
Added USE FROM Surface_conditions because surface texture (ISO 1302) may be specified.
Added USE FROM Model_based_3d_geometrical_dimensioning_and_tolerancing_representation_arm to allow us to establish
weld context for binding to block definition diagram.
Added explicit USE FROM reference to Weld_context for clarity.
Added corrections on Assembly_bond_definition to permit Welding_definition to point to more than one joint.
associated bugzilla bugs 5144, 5145, 5147, 5148
rev 1.2
replaced Groove_weld_definition with Butt_weld_definition to avoid
mixing ISO and ASME names.
moved elementary_weld_type from ENUMERATION to individual ENTITY types.
Added inclined_butt_weld_joint --maybe obsolete?
Added Length and Angle tolerance in preparation for using following
initial team review.
how to relate this to block definition diagram?
For conformance specification, specify the AO we require in the USE FROM.*)


SCHEMA Weld_arm;

USE FROM Assembly_technology_arm
  (Assembled_with_bonding,
   Assembly_bond_definition);

USE FROM Characteristic_arm
     (Length_tolerance_characteristic,
      Maximum_tolerance_characteristic,
      Minimum_tolerance_characteristic,
      Nominal_tolerance_characteristic,
      Plus_minus_tolerance_characteristic,
      Qualified_tolerance_characteristic,
      Statistical_tolerance_characteristic,
      Symmetrical_tolerance_characteristic,
      Tolerance_characteristic,
      Typical_tolerance_characteristic);

USE FROM Characterizable_object_arm
   (Characterizable_object);

USE FROM Extended_measure_representation_arm
   (Value_with_tolerances);

USE FROM Foundation_representation_arm
  (Representation);

USE FROM Generic_material_aspects_arm
  (Material_identification);

USE FROM Geometric_tolerance_arm
   (Axis_placement_shape_element,
    Flatness_tolerance);

USE FROM Machining_features_arm
  (Face_shape_element,
   Path_element);

USE FROM Model_based_3d_geometrical_dimensioning_and_tolerancing_representation_arm;

USE FROM Product_and_manufacturing_information_view_context_arm
  (Weld_context);

USE FROM Shape_property_assignment_arm
  (Associated_shape_element);

USE FROM Specification_document_arm
  (Process_specification);

USE FROM Value_with_unit_arm
  (count_measure);

USE FROM Surface_conditions_arm
   (Surface_texture);

USE FROM Value_with_unit_extension_arm
   (Angle_data_element,
    Length_data_element);

  TYPE resistance_or_fusion_weld = ENUMERATION OF
    (RESISTANCE_WELD,
     FUSION_WELD);
  END_TYPE;

  TYPE supplemental_information = EXTENSIBLE ENUMERATION OF
    (FLAT_FINISHED_FLUSH,
     CONVEX,
     CONCAVE,
     TOES_BLENDED_SMOOTHLY,
     BACK_RUN,
     BACKING_WELD,
     SPECIFIED_ROOT_REINFORCEMENT,
     WELD_ALL_AROUND,
     WELD_BETWEEN_TWO_POINTS,
     FIELD_WELD,
     STAGGERED_INTERMITTENT_WELD);
  END_TYPE;

  TYPE weld_auxiliary_material_role = ENUMERATION OF
     (consumable_insert,
      permanent_backing,
      removable_backing,
      spacer,
      unspecified_backing);
  END_TYPE;

  ENTITY Angle_tolerance_characteristic
    SUBTYPE OF(Tolerance_characteristic);
    WHERE
      WR1 : ('CHARACTERISTIC_ARM.STATISTICAL_TOLERANCE_CHARACTERISTIC' IN TYPEOF(SELF)) OR
            ('CHARACTERISTIC_ARM.SYMMETRICAL_TOLERANCE_CHARACTERISTIC' IN TYPEOF(SELF)) OR
            ('CHARACTERISTIC_ARM.PLUS_MINUS_TOLERANCE_CHARACTERISTIC' IN TYPEOF(SELF)) OR
        (SIZEOF(QUERY(it <* SELF\Representation.items |
          NOT('VALUE_WITH_UNIT_EXTENSION_ARM.ANGLE_DATA_ELEMENT' IN TYPEOF(it))
         )) = 0);
      WR2 : NOT('CHARACTERISTIC_ARM.SYMMETRICAL_TOLERANCE_CHARACTERISTIC' IN TYPEOF(SELF)) OR
        (SIZEOF(QUERY(it <* SELF\Representation.items |
        ('VALUE_WITH_UNIT_EXTENSION_ARM.ANGLE_DATA_ELEMENT' IN TYPEOF(it))
           )) = 1);
      WR3 : NOT('CHARACTERISTIC_ARM.STATISTICAL_TOLERANCE_CHARACTERISTIC' IN TYPEOF(SELF)) OR
        (SIZEOF(QUERY(it <* SELF\Representation.items |
        ('VALUE_WITH_UNIT_EXTENSION_ARM.ANGLE_DATA_ELEMENT' IN TYPEOF(it))
           )) = 1);
      WR4 : NOT EXISTS(SELF\Representation.description);
      WR5 : NOT('CHARACTERISTIC_ARM.PLUS_MINUS_TOLERANCE_CHARACTERISTIC' IN TYPEOF(SELF)) OR
        (SIZEOF(QUERY(it <* SELF\Representation.items |
          NOT(('EXTENDED_MEASURE_REPRESENTATION_ARM.VALUE_WITH_TOLERANCES' IN TYPEOF(it)) AND
             ('VALUE_WITH_UNIT_EXTENSION_ARM.ANGLE_DATA_ELEMENT' IN TYPEOF(it\Value_with_tolerances.item_value)))
         )) = 0);
  END_ENTITY;

  ENTITY Butt_joint
    SUPERTYPE OF (ONEOF (Flanged_Butt_joint, Inclined_Butt_joint))
    SUBTYPE OF(Welded_joint);
      SELF\assembled_with_bonding.default_bond_definition : Butt_joint_welding_definition;
  END_ENTITY;

  ENTITY Butt_joint_welding_definition
    SUBTYPE OF(Welding_definition);
      SELF\Welding_definition.welds : set [1:?] OF Butt_weld_definition;
    INVERSE
    welded_joints : SET [1:?] OF Butt_joint FOR default_bond_definition;
  END_ENTITY;

  ENTITY Butt_weld_definition
    SUPERTYPE OF (ONEOF(
     Square_butt_weld_definition,
     Single_v_butt_weld_definition,
     Single_bevel_butt_weld_definition,
     Single_u_butt_weld_definition,
     Single_j_butt_weld_definition,
     Flare_v_weld_definition,
     Flare_bevel_weld_definition))
    SUBTYPE OF(Weld_definition);
      partial_penetration_depth   : OPTIONAL Length_tolerance_characteristic;
      intermittent_data           : OPTIONAL Weld_intermittent_position_data;
      chain_intermittent_data     : OPTIONAL Weld_intermittent_position_data;
      staggered_intermittent_data : OPTIONAL Weld_intermittent_position_data;
      full_penetration            : BOOLEAN;
      joint_preparation_depth     : OPTIONAL Length_tolerance_characteristic;
      root_gap                    : OPTIONAL Length_tolerance_characteristic;
      included_angle              : OPTIONAL Angle_tolerance_characteristic;
      joint_preparation_defined   : BOOLEAN;
    WHERE
      WR1 : full_penetration XOR EXISTS(partial_penetration_depth);
      WR2 : (NOT EXISTS(intermittent_data)AND NOT EXISTS(chain_intermittent_data)) OR
            (NOT EXISTS(chain_intermittent_data) AND NOT EXISTS(staggered_intermittent_data)) OR
            (NOT EXISTS(intermittent_data) AND NOT EXISTS(staggered_intermittent_data));
  END_ENTITY;
(*
*Attribute definitions*
[[joint_preparation_defined]]
joint_preparation_defined specifies that joint preparation shall be provide.
note: in the case that explicit joint preparation is not provided, only the
specified weld quality is provided.
example: A butt weld is specified to be in accordance with ISO 5817-8 but the
joint preparation is not provided. The production unit will use ISO 5817-8 for
quality purposes.
[[WR1]]
The penetration provided shall be indicated as full or a value shall be
provided for partial penetration, but both full indication and partial
penetration data shall not be simultaneously provided.
[[WR2]]
No more than one of intermittent_data, chain_intermittent_data,
staggered_intermittent_data shall be provided.
*)


  ENTITY Corner_joint
    SUBTYPE OF(Welded_joint);
      SELF\assembled_with_bonding.default_bond_definition : Corner_joint_welding_definition;
  END_ENTITY;

  ENTITY Corner_joint_welding_definition
    SUBTYPE OF(Welding_definition);
    INVERSE
    welded_joints : SET [1:?] OF Corner_joint FOR default_bond_definition;
  END_ENTITY;

  ENTITY Double_bevel_butt_weld_definition
       SUBTYPE OF (Pre_defined_combined_weld_definition);
        arrow_side : Single_bevel_butt_weld_definition;
        other_side : OPTIONAL Single_bevel_butt_weld_definition;
    WHERE
     WR1 : SELF\Pre_defined_combined_weld_definition.symmetrical XOR EXISTS(other_side);
  END_ENTITY;

  ENTITY Double_bevel_butt_with_broad_root_face_and_fillet_welds_weld_definition
       SUBTYPE OF (Double_bevel_butt_weld_definition);
        arrow_side_fillet : fillet_weld_definition;
        other_side_fillet : OPTIONAL fillet_weld_definition;
    WHERE
     WR1 : SELF\Pre_defined_combined_weld_definition.symmetrical XOR EXISTS(other_side_fillet);
  END_ENTITY;

  ENTITY Double_u_butt_weld_definition
       SUBTYPE OF (Pre_defined_combined_weld_definition);
        arrow_side : Single_u_butt_weld_definition;
        other_side : OPTIONAL Single_u_butt_weld_definition;
    WHERE
     WR1 : SELF\Pre_defined_combined_weld_definition.symmetrical XOR EXISTS(other_side);
  END_ENTITY;

  ENTITY Double_v_butt_weld_definition
       SUBTYPE OF (Pre_defined_combined_weld_definition);
        arrow_side : Single_v_butt_weld_definition;
        other_side : OPTIONAL Single_v_butt_weld_definition;
    WHERE
     WR1 : SELF\Pre_defined_combined_weld_definition.symmetrical XOR EXISTS(other_side);
  END_ENTITY;

  ENTITY Edge_joint
    SUBTYPE OF(Welded_joint);
      SELF\assembled_with_bonding.default_bond_definition : Edge_joint_welding_definition;
  END_ENTITY;

  ENTITY Edge_joint_welding_definition SUBTYPE OF(Welding_definition);
    INVERSE
    welded_joints : SET [1:?] OF Edge_joint FOR default_bond_definition;
  END_ENTITY;

  ENTITY Edge_weld_definition
    SUBTYPE OF(Weld_definition);
      weld_metal_thickness : Length_tolerance_characteristic;
  END_ENTITY;

  ENTITY Fillet_weld_definition
    SUBTYPE OF(Weld_definition);
      leg_length                        : OPTIONAL Length_tolerance_characteristic;
      nominal_throat_thickness          : OPTIONAL Length_data_element;
      deep_penetration_throat_thickness : OPTIONAL Length_data_element;
      unequal_legs                      : OPTIONAL LIST [2:2] OF Leg_based_on_surface;
      intermittent_data                 : OPTIONAL Weld_intermittent_position_data;
      chain_intermittent_data           : OPTIONAL Weld_intermittent_position_data;
      staggered_intermittent_data       : OPTIONAL Weld_intermittent_position_data;
  END_ENTITY;

  ENTITY Flanged_Butt_joint
    SUBTYPE OF(Butt_joint);
  END_ENTITY;

  ENTITY Flanged_butt_or_corner_weld_definition
       SUBTYPE OF (Weld_definition);
  END_ENTITY;

  ENTITY Flanged_Corner_joint
    SUBTYPE OF(Corner_joint);
  END_ENTITY;

  ENTITY Flare_bevel_weld_definition
    SUBTYPE OF (Butt_weld_definition);
      flare_bevel                 : Length_tolerance_characteristic;
  END_ENTITY;

  ENTITY Flare_v_weld_definition
    SUBTYPE OF (Butt_weld_definition);
      flare_v                     : Length_tolerance_characteristic;
  END_ENTITY;

  ENTITY Inclined_Butt_joint
    SUBTYPE OF(Butt_joint);
  END_ENTITY;

  ENTITY Single_bevel_butt_weld_definition
    SUBTYPE OF (Butt_weld_definition);
  END_ENTITY;

  ENTITY Single_bevel_butt_with_broad_root_face_weld_definition
    SUBTYPE OF (Single_bevel_butt_weld_definition);
  END_ENTITY;

  ENTITY Single_u_butt_weld_definition
    SUBTYPE OF (Butt_weld_definition);
  END_ENTITY;

  ENTITY Single_v_butt_weld_definition
    SUBTYPE OF (Butt_weld_definition);
  END_ENTITY;

  ENTITY Single_v_butt_with_broad_root_face_weld_definition
    SUBTYPE OF (Single_v_butt_weld_definition);
  END_ENTITY;

  ENTITY Lap_joint
    SUBTYPE OF(Welded_joint);
      SELF\assembled_with_bonding.default_bond_definition : Lap_joint_welding_definition;
  END_ENTITY;

  ENTITY Lap_joint_welding_definition
    SUBTYPE OF(Welding_definition);
    INVERSE
     welded_joints : SET [1:?] OF Lap_joint FOR default_bond_definition;
 END_ENTITY;

  ENTITY Leg_based_on_surface;
      leg_length         : Length_tolerance_characteristic;
      leg_reference_face : OPTIONAL Face_shape_element;
  END_ENTITY;

  ENTITY Overlay_weld_definition
    SUBTYPE OF(Weld_definition);
      overlay_thickness : Length_tolerance_characteristic;
  END_ENTITY;

  ENTITY Path_element_with_ends
   SUBTYPE OF(Path_element);
    start_point	:	Axis_placement_shape_element;
    end_point	:	Axis_placement_shape_element;
  WHERE
   WR1 : start_point :<>: end_point;
   WR2 : (NOT EXISTS(start_point) AND NOT EXISTS(end_point)) OR
         (EXISTS(start_point) AND EXISTS(end_point));
  END_ENTITY;

  ENTITY Plug_weld_in_circular_holes_definition
    SUBTYPE OF(Weld_definition);
      full_penetration                                : BOOLEAN;
      plug_diameter                                   : Length_tolerance_characteristic;
      partial_fill_depth                               : OPTIONAL Length_tolerance_characteristic;
      centre_to_centre_distance_between_weld_elements : OPTIONAL Length_tolerance_characteristic;
  END_ENTITY;

  ENTITY Plug_weld_in_slot_definition
    SUBTYPE OF(Weld_definition);
      full_penetration   : BOOLEAN;
      slot_width         : OPTIONAL Length_tolerance_characteristic;
      partial_fill_depth : OPTIONAL Length_tolerance_characteristic;
      intermittent_data  : OPTIONAL Weld_intermittent_position_data;
      countersink_angle  : OPTIONAL Angle_tolerance_characteristic;
  END_ENTITY;

  ENTITY Pre_defined_combined_weld_definition
     SUPERTYPE OF (ONEOF(
       Double_v_butt_weld_definition,
       Double_bevel_butt_weld_definition,
       Double_u_butt_weld_definition))
     SUBTYPE OF (Weld_definition);
       symmetrical : BOOLEAN;
  END_ENTITY;

  ENTITY Seam_weld_definition
    SUBTYPE OF(Weld_definition);
      weld_type         : resistance_or_fusion_weld;
      intermittent_data : OPTIONAL Weld_intermittent_position_data;
      weld_width        : Length_tolerance_characteristic;
  END_ENTITY;

  ENTITY Single_j_butt_weld_definition
    SUBTYPE OF (Butt_weld_definition);
  END_ENTITY;

  ENTITY Spot_weld_definition
    SUBTYPE OF(Weld_definition);
      weld_diameter          : Length_tolerance_characteristic;
      distance_between_welds : OPTIONAL Length_tolerance_characteristic;
      number_of_welds        : OPTIONAL count_measure;
      weld_type              : resistance_or_fusion_weld;
    WHERE
      WR1 : (NOT EXISTS(distance_between_welds) AND NOT EXISTS(number_of_welds)) OR
            (EXISTS(distance_between_welds) AND EXISTS(number_of_welds));
  END_ENTITY;
(*
[[WR1]]
Either both distance_between_welds and number_of_welds shall be provided or neither shall be provided.
*)

  ENTITY Square_butt_weld_definition
    SUBTYPE OF (Butt_weld_definition);
  END_ENTITY;

  ENTITY Stake_weld_definition
       SUBTYPE OF (Weld_definition);
  END_ENTITY;

  ENTITY Steep_flanked_single_v_butt_weld_definition
    SUBTYPE OF (Single_v_butt_weld_definition);
  END_ENTITY;

  ENTITY Stud_weld_definition
    SUBTYPE OF(Weld_definition);
      distance_between_studs : Length_tolerance_characteristic;
      stud_diameter          : Length_tolerance_characteristic;
      number_of_studs        : count_measure;
  END_ENTITY;
(*
*Attribute definitions*
[[distance_between_studs]]
centre to centre
*)

  ENTITY T_joint
    SUBTYPE OF(Welded_joint);
      SELF\assembled_with_bonding.default_bond_definition : T_joint_welding_definition;
  END_ENTITY;

  ENTITY T_joint_welding_definition
    SUBTYPE OF(Welding_definition);
    INVERSE
    welded_joints : SET [1:?] OF T_joint FOR default_bond_definition;
  END_ENTITY;

  ENTITY Weld_auxiliary_material
    SUBTYPE OF (Material_identification);
      role : weld_auxiliary_material_role;
      shape : OPTIONAL Associated_shape_element;
     SELF\Material_identification.items : SET [1:1] OF Welding_definition;
  END_ENTITY;

  ENTITY Weld_definition
    SUPERTYPE OF (ONEOF(
        Fillet_weld_definition,
        Butt_weld_definition,
        Flanged_butt_or_corner_weld_definition,
        Plug_weld_in_circular_holes_definition,
        Plug_weld_in_slot_definition,
        Spot_weld_definition,
        Seam_weld_definition,
        Edge_weld_definition,
        Overlay_weld_definition,
        Stake_weld_definition,
        Stud_weld_definition,
        Pre_defined_combined_weld_definition))
    SUBTYPE OF (Characterizable_object);
  END_ENTITY;

  ENTITY Weld_intermittent_position_data;
      number_of_weld_elements                : count_measure;
      nominal_length_of_weld_element         : Length_data_element;
      nominal_distance_between_weld_elements : Length_data_element;
  END_ENTITY;

  ENTITY Welded_joint
    ABSTRACT SUPERTYPE OF (ONEOF(Butt_joint,
                                 Corner_joint,
                                 T_joint,
                                 Lap_joint,
                                 Edge_joint))
    SUBTYPE OF(Assembled_with_bonding);
    SELF\Assembled_with_bonding.default_bond_definition : Welding_definition;
  END_ENTITY;

  ENTITY Welding_definition
    ABSTRACT SUPERTYPE OF (ONEOF(
           Butt_joint_welding_definition,
           Corner_joint_welding_definition,
           T_joint_welding_definition,
           Lap_joint_welding_definition,
           Edge_joint_welding_definition))
    SUBTYPE OF(Assembly_bond_definition);
      supplemental_information : SET [0:?] OF supplemental_information;
      surface_texture          : OPTIONAL Surface_texture;
      welds                    : SET [1:?] OF Weld_definition;
      process_specification    : SET [0:?] OF Process_specification;
      path                     : OPTIONAL Path_element_with_ends;
      arrow_side : Associated_shape_element;
      other_side : OPTIONAL Associated_shape_element;
--used Associated_shape_element to get easy access to geometric face but use generic rather than specific for more flexibility.
   DERIVE
      bond_feature_a : Physical_component_feature := SELF\Assembly_bond_definition.bonded_feature_1
      bond_feature_b : Physical_component_feature := SELF\Assembly_bond_definition.bonded_feature_2
   INVERSE
      welded_joint : SET [1:?] OF Welded_joint FOR default_bond_definition;
      auxiliary_material       : SET [0:?] OF Weld_auxiliary_material FOR items;
  WHERE
   WR1 : arrow_side :<>: other_side;
   WR2 : NOT EXISTS(bond_feature_a) AND NOT EXISTS(bond_feature_b);
  END_ENTITY;

  ENTITY Welding_definition_sequence_relationship;
    precedent_welding_definition : Welding_definition;
    subsequent_welding_definition : Welding_definition;
   WHERE
     WR1 : w_acyclic_sequence (precedent_welding_definition, subsequent_welding_definition);
  END_ENTITY;

FUNCTION w_acyclic_sequence ( input1 : Welding_definition; input2 : Welding_definition) : BOOLEAN;
RETURN (TRUE);
END_FUNCTION;

END_SCHEMA;
