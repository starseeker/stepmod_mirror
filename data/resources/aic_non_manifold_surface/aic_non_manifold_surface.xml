<?xml version='1.0' encoding='UTF-8'?>
<!-- $Id: express2xml2.js,v 1.3 2003/05/02 07:56:57 robbod Exp $ -->
<?xml-stylesheet type="text/xsl" href="../../../xsl/express.xsl"?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">
<express
  language_version="2"
  reference="10303-508"
  rcs.date="$Date: $"
  rcs.revision="$Revision: $">

  <application
    name="express2xml2.js"
    owner="Eurostep Limited"
    url="http://www.eurostep.com"
    version="1.3"
    source="../data/resources/aic_non_manifold_surface/aic_non_manifold_surface.exp"/>

  <schema name="aic_non_manifold_surface">

    <interface
      kind="use"
      schema="aic_topologically_bounded_surface">
    </interface>
    <interface
      kind="use"
      schema="geometric_model_schema">
      <interfaced.item
        name="face_based_surface_model"/>
    </interface>
    <interface
      kind="use"
      schema="geometry_schema">
      <interfaced.item
        name="b_spline_curve"/>
      <interfaced.item
        name="b_spline_surface"/>
      <interfaced.item
        name="bounded_pcurve"/>
      <interfaced.item
        name="bounded_surface_curve"/>
      <interfaced.item
        name="cartesian_transformation_operator_3d"/>
      <interfaced.item
        name="curve"/>
      <interfaced.item
        name="curve_replica"/>
      <interfaced.item
        name="degenerate_pcurve"/>
      <interfaced.item
        name="evaluated_degenerate_pcurve"/>
      <interfaced.item
        name="intersection_curve"/>
      <interfaced.item
        name="offset_curve_3d"/>
      <interfaced.item
        name="offset_surface"/>
      <interfaced.item
        name="point_on_curve"/>
      <interfaced.item
        name="point_on_surface"/>
      <interfaced.item
        name="seam_curve"/>
      <interfaced.item
        name="surface"/>
      <interfaced.item
        name="surface_replica"/>
    </interface>
    <interface
      kind="use"
      schema="product_property_representation_schema">
      <interfaced.item
        name="shape_representation"/>
    </interface>
    <interface
      kind="use"
      schema="representation_schema">
      <interfaced.item
        name="mapped_item"/>
      <interfaced.item
        name="representation"/>
      <interfaced.item
        name="representation_item"/>
      <interfaced.item
        name="representation_map"/>
    </interface>
    <interface
      kind="use"
      schema="topology_schema">
      <interfaced.item
        name="closed_shell"/>
      <interfaced.item
        name="connected_face_set"/>
      <interfaced.item
        name="face"/>
      <interfaced.item
        name="open_shell"/>
      <interfaced.item
        name="oriented_face"/>
    </interface>
    <entity
      name="non_manifold_surface_shape_representation"
      supertypes="shape_representation">
      <where
        label="WR1"
        expression="SIZEOF (QUERY (it &lt;* SELF.items | NOT (SIZEOF (['AIC_NON_MANIFOLD_SURFACE.FACE_BASED_SURFACE_MODEL','AIC_NON_MANIFOLD_SURFACE.MAPPED_ITEM','AIC_NON_MANIFOLD_SURFACE.AXIS2_PLACEMENT_3D'] * TYPEOF (it)) = 1)))= 0">
      </where>
      <where
        label="WR2"
        expression="SIZEOF (QUERY (it &lt;* SELF.items | SIZEOF (['AIC_NON_MANIFOLD_SURFACE.FACE_BASED_SURFACE_MODEL','AIC_NON_MANIFOLD_SURFACE.MAPPED_ITEM'] * TYPEOF (it)) = 1)) &gt; 0">
      </where>
      <where
        label="WR3"
        expression="SIZEOF (QUERY (mi &lt;* QUERY (it &lt;* SELF.items |'AIC_NON_MANIFOLD_SURFACE.MAPPED_ITEM' IN TYPEOF (it)) | NOT (('AIC_NON_MANIFOLD_SURFACE.'+'NON_MANIFOLD_SURFACE_SHAPE_REPRESENTATION' IN TYPEOF (mi\mapped_item.mapping_source.mapped_representation)) AND(SIZEOF(QUERY (mr_it &lt;* mi\mapped_item.mapping_source.mapped_representation.items |('AIC_NON_MANIFOLD_SURFACE.FACE_BASED_SURFACE_MODEL' IN TYPEOF (mr_it)))) &gt; 0)))) = 0">
      </where>
      <where
        label="WR4"
        expression="SIZEOF (QUERY (fbsm &lt;* QUERY (it &lt;* SELF.items |'AIC_NON_MANIFOLD_SURFACE.FACE_BASED_SURFACE_MODEL' IN TYPEOF (it)) | NOT (SIZEOF (QUERY (cfs &lt;* fbsm\face_based_surface_model.fbsm_faces | NOT (SIZEOF (QUERY (fa &lt;* cfs.cfs_faces | NOT (SIZEOF (['AIC_NON_MANIFOLD_SURFACE.FACE_SURFACE','AIC_NON_MANIFOLD_SURFACE.ORIENTED_FACE'] * TYPEOF (fa)) = 1)))= 0))) = 0))) = 0">
      </where>
      <where
        label="WR5"
        expression="SIZEOF (QUERY (fbsm &lt;* QUERY (it &lt;* SELF.items |'AIC_NON_MANIFOLD_SURFACE.FACE_BASED_SURFACE_MODEL' IN TYPEOF (it)) | NOT (SIZEOF (QUERY (cfs &lt;* fbsm\face_based_surface_model.fbsm_faces | NOT (SIZEOF (QUERY (f_sf &lt;* QUERY (fa &lt;* cfs.cfs_faces |('AIC_NON_MANIFOLD_SURFACE.FACE_SURFACE' IN TYPEOF (fa))) | NOT (('AIC_NON_MANIFOLD_SURFACE.ADVANCED_FACE' IN TYPEOF (f_sf)) OR(nmsf_surface_check(f_sf\face_surface.face_geometry))))) = 0)))= 0))) = 0">
      </where>
      <where
        label="WR6"
        expression="SIZEOF (QUERY (fbsm &lt;* QUERY (it &lt;* SELF.items |'AIC_NON_MANIFOLD_SURFACE.FACE_BASED_SURFACE_MODEL' IN TYPEOF (it)) | NOT (SIZEOF (QUERY (cfs &lt;* fbsm\face_based_surface_model.fbsm_faces | NOT (SIZEOF (QUERY (o_fa &lt;* QUERY (fa &lt;* cfs.cfs_faces |('AIC_NON_MANIFOLD_SURFACE.ORIENTED_FACE' IN TYPEOF (fa))) | NOT (('AIC_NON_MANIFOLD_SURFACE.ADVANCED_FACE' IN TYPEOF(o_fa\oriented_face.face_element)) OR(nmsf_surface_check(o_fa\oriented_face.face_element\face_surface.face_geometry)))))= 0))) = 0))) = 0">
      </where>
      <where
        label="WR7"
        expression="SIZEOF (QUERY (fbsm &lt;* QUERY (it &lt;* SELF.items |'AIC_NON_MANIFOLD_SURFACE.FACE_BASED_SURFACE_MODEL' IN TYPEOF (it)) | NOT (SIZEOF (QUERY (cfs &lt;* fbsm\face_based_surface_model.fbsm_faces | NOT (SIZEOF (QUERY (fa &lt;* cfs.cfs_faces | NOT (('AIC_NON_MANIFOLD_SURFACE.ADVANCED_FACE' IN TYPEOF (fa)) OR(SIZEOF (QUERY (bnds &lt;* fa.bounds | NOT (SIZEOF (['AIC_NON_MANIFOLD_SURFACE.EDGE_LOOP','AIC_NON_MANIFOLD_SURFACE.VERTEX_LOOP']* TYPEOF (bnds.bound)) = 1))) = 0)))) = 0))) = 0))) = 0">
      </where>
      <where
        label="WR8"
        expression="SIZEOF (QUERY (fbsm &lt;* QUERY (it &lt;* SELF.items|'AIC_NON_MANIFOLD_SURFACE.FACE_BASED_SURFACE_MODEL' IN TYPEOF (it)) | NOT (SIZEOF (QUERY (cfs &lt;* fbsm\face_based_surface_model.fbsm_faces | NOT (SIZEOF (QUERY (fa &lt;* cfs.cfs_faces | NOT (('AIC_NON_MANIFOLD_SURFACE.ADVANCED_FACE' IN TYPEOF (fa)) OR(SIZEOF (QUERY (elp_fbnds &lt;* QUERY (bnds &lt;* fa.bounds |'AIC_NON_MANIFOLD_SURFACE.EDGE_LOOP' IN TYPEOF (bnds.bound)) | NOT (SIZEOF (QUERY (oe &lt;* elp_fbnds\path.edge_list | NOT ('AIC_NON_MANIFOLD_SURFACE.EDGE_CURVE' IN TYPEOF(oe.edge_element)))) = 0))) = 0)))) = 0))) = 0))) = 0">
      </where>
      <where
        label="WR9"
        expression="SIZEOF (QUERY (fbsm &lt;* QUERY (it &lt;* SELF.items |'AIC_NON_MANIFOLD_SURFACE.FACE_BASED_SURFACE_MODEL' IN TYPEOF (it)) | NOT (SIZEOF (QUERY (cfs &lt;* fbsm\face_based_surface_model.fbsm_faces | NOT (SIZEOF (QUERY (fa &lt;* cfs.cfs_faces | NOT (('AIC_NON_MANIFOLD_SURFACE.ADVANCED_FACE' IN TYPEOF (fa)) OR(SIZEOF (QUERY (elp_fbnds &lt;* QUERY (bnds &lt;* fa.bounds |'AIC_NON_MANIFOLD_SURFACE.EDGE_LOOP' IN TYPEOF (bnds.bound)) | NOT (SIZEOF (QUERY (oe_cv &lt;* QUERY (oe &lt;* elp_fbnds\path.edge_list |'AIC_NON_MANIFOLD_SURFACE.EDGE_CURVE' IN TYPEOF (oe.edge_element)) | NOT (SIZEOF (['AIC_NON_MANIFOLD_SURFACE.B_SPLINE_CURVE','AIC_NON_MANIFOLD_SURFACE.CONIC','AIC_NON_MANIFOLD_SURFACE.CURVE_REPLICA','AIC_NON_MANIFOLD_SURFACE.LINE','AIC_NON_MANIFOLD_SURFACE.OFFSET_CURVE_3D','AIC_NON_MANIFOLD_SURFACE.PCURVE','AIC_NON_MANIFOLD_SURFACE.POLYLINE','AIC_NON_MANIFOLD_SURFACE.SURFACE_CURVE'] * TYPEOF (oe_cv.edge_element\edge_curve.edge_geometry))= 1))) = 0))) = 0)))) = 0))) = 0))) = 0">
      </where>
      <where
        label="WR10"
        expression="SIZEOF (QUERY (fbsm &lt;* QUERY (it &lt;* SELF.items |'AIC_NON_MANIFOLD_SURFACE.FACE_BASED_SURFACE_MODEL' IN TYPEOF (it)) | NOT (SIZEOF (QUERY (cfs &lt;* fbsm\face_based_surface_model.fbsm_faces | NOT (SIZEOF (QUERY (fa &lt;* cfs.cfs_faces | NOT (('AIC_NON_MANIFOLD_SURFACE.ADVANCED_FACE' IN TYPEOF (fa)) OR(SIZEOF (QUERY (elp_fbnds &lt;* QUERY (bnds &lt;* fa.bounds |'AIC_NON_MANIFOLD_SURFACE.EDGE_LOOP' IN TYPEOF (bnds.bound)) | NOT (SIZEOF (QUERY (oe &lt;* elp_fbnds\path.edge_list | NOT (nmsf_curve_check (oe.edge_element\edge_curve.edge_geometry))))= 0))) = 0)))) = 0))) = 0))) = 0">
      </where>
      <where
        label="WR11"
        expression="SIZEOF (QUERY(fbsm &lt;* QUERY (it &lt;* SELF.items |'AIC_NON_MANIFOLD_SURFACE.FACE_BASED_SURFACE_MODEL' IN TYPEOF (it)) | NOT (SIZEOF (QUERY (cfs &lt;* fbsm\face_based_surface_model.fbsm_faces | NOT (SIZEOF (QUERY (fa &lt;* cfs.cfs_faces | NOT (('AIC_NON_MANIFOLD_SURFACE.ADVANCED_FACE' IN TYPEOF (fa)) OR(SIZEOF (QUERY (elp_fbnds &lt;* QUERY (bnds &lt;* fa.bounds |'AIC_NON_MANIFOLD_SURFACE.EDGE_LOOP' IN TYPEOF (bnds.bound)) | NOT (SIZEOF (QUERY (oe &lt;* elp_fbnds\path.edge_list| NOT (('AIC_NON_MANIFOLD_SURFACE.VERTEX_POINT' IN TYPEOF(oe.edge_element.edge_start)) AND('AIC_NON_MANIFOLD_SURFACE.VERTEX_POINT' IN TYPEOF (oe.edge_element.edge_end)))))= 0))) = 0)))) = 0))) = 0))) = 0">
      </where>
      <where
        label="WR12"
        expression="SIZEOF (QUERY (fbsm &lt;* QUERY (it &lt;* SELF.items |'AIC_NON_MANIFOLD_SURFACE.FACE_BASED_SURFACE_MODEL' IN TYPEOF (it)) | NOT (SIZEOF (QUERY (cfs &lt;* fbsm\face_based_surface_model.fbsm_faces | NOT (SIZEOF (QUERY (fa &lt;* cfs.cfs_faces | NOT (('AIC_NON_MANIFOLD_SURFACE.ADVANCED_FACE' IN TYPEOF (fa)) OR(SIZEOF (QUERY (elp_fbnds &lt;* QUERY (bnds &lt;* fa.bounds |'AIC_NON_MANIFOLD_SURFACE.EDGE_LOOP' IN TYPEOF (bnds.bound)) | NOT (SIZEOF (QUERY (oe &lt;* elp_fbnds\path.edge_list | NOT ((SIZEOF (['AIC_NON_MANIFOLD_SURFACE.CARTESIAN_POINT','AIC_NON_MANIFOLD_SURFACE.DEGENERATE_PCURVE','AIC_NON_MANIFOLD_SURFACE.POINT_ON_CURVE','AIC_NON_MANIFOLD_SURFACE.POINT_ON_SURFACE'] * TYPEOF(oe.edge_element.edge_start\vertex_point.vertex_geometry)) = 1) AND(SIZEOF (['AIC_NON_MANIFOLD_SURFACE.CARTESIAN_POINT','AIC_NON_MANIFOLD_SURFACE.DEGENERATE_PCURVE','AIC_NON_MANIFOLD_SURFACE.POINT_ON_CURVE','AIC_NON_MANIFOLD_SURFACE.POINT_ON_SURFACE'] * TYPEOF(oe.edge_element.edge_end\vertex_point.vertex_geometry)) = 1)))) = 0))) = 0)))) = 0))) = 0))) = 0">
      </where>
      <where
        label="WR13"
        expression="SIZEOF (QUERY (fbsm &lt;* QUERY (it &lt;* SELF.items |'AIC_NON_MANIFOLD_SURFACE.FACE_BASED_SURFACE_MODEL' IN TYPEOF (it)) | NOT (SIZEOF (QUERY (cfs &lt;* fbsm\face_based_surface_model.fbsm_faces | NOT (SIZEOF (QUERY (fa &lt;* cfs.cfs_faces | NOT (('AIC_NON_MANIFOLD_SURFACE.ADVANCED_FACE' IN TYPEOF (fa)) OR(SIZEOF (QUERY (vlp_fbnds &lt;* QUERY (bnds &lt;* fa.bounds |'AIC_NON_MANIFOLD_SURFACE.VERTEX_LOOP' IN TYPEOF (bnds.bound)) | NOT ('AIC_NON_MANIFOLD_SURFACE.VERTEX_POINT' IN TYPEOF(vlp_fbnds\vertex_loop.loop_vertex)))) = 0)))) = 0)))= 0))) = 0">
      </where>
      <where
        label="WR14"
        expression="SIZEOF (QUERY (fbsm &lt;* QUERY (it &lt;* SELF.items |'AIC_NON_MANIFOLD_SURFACE.FACE_BASED_SURFACE_MODEL' IN TYPEOF (it)) | NOT (SIZEOF (QUERY (cfs &lt;* fbsm\face_based_surface_model.fbsm_faces | NOT (SIZEOF (QUERY (fa &lt;* cfs.cfs_faces | NOT (('AIC_NON_MANIFOLD_SURFACE.ADVANCED_FACE' IN TYPEOF (fa)) OR(SIZEOF (QUERY (vlp_fbnds &lt;* QUERY (bnds &lt;* fa.bounds |'AIC_NON_MANIFOLD_SURFACE.VERTEX_LOOP' IN TYPEOF (bnds.bound)) | NOT (SIZEOF (['AIC_NON_MANIFOLD_SURFACE.CARTESIAN_POINT','AIC_NON_MANIFOLD_SURFACE.DEGENERATE_PCURVE','AIC_NON_MANIFOLD_SURFACE.POINT_ON_CURVE','AIC_NON_MANIFOLD_SURFACE.POINT_ON_SURFACE'] * TYPEOF(vlp_fbnds\vertex_loop.loop_vertex\vertex_point.vertex_geometry))= 1))) = 0)))) = 0))) = 0))) = 0">
      </where>
    </entity>

    <function
      name="nmsf_curve_check">
      <parameter
        name="cv">
        <typename
          name="representation_item"/>
      </parameter>
      <builtintype
        type="BOOLEAN"/>
      <algorithm>
IF SIZEOF (['AIC_NON_MANIFOLD_SURFACE.BOUNDED_CURVE',
'AIC_NON_MANIFOLD_SURFACE.CONIC',
'AIC_NON_MANIFOLD_SURFACE.CURVE_REPLICA',
'AIC_NON_MANIFOLD_SURFACE.LINE',
'AIC_NON_MANIFOLD_SURFACE.OFFSET_CURVE_3D'] * TYPEOF(cv)) &gt; 1
THEN RETURN(FALSE);
ELSE
IF (('AIC_NON_MANIFOLD_SURFACE.B_SPLINE_CURVE' IN TYPEOF (cv)) AND
(cv\b_spline_curve.self_intersect = FALSE) OR
(cv\b_spline_curve.self_intersect = UNKNOWN))
THEN RETURN(TRUE);
ELSE
IF SIZEOF (['AIC_NON_MANIFOLD_SURFACE.CONIC',
'AIC_NON_MANIFOLD_SURFACE.LINE'] * TYPEOF (cv)) = 1 THEN
RETURN(TRUE);
ELSE
IF 'AIC_NON_MANIFOLD_SURFACE.CURVE_REPLICA' IN TYPEOF(cv) THEN
RETURN (nmsf_curve_check(cv\curve_replica.parent_curve));
ELSE
IF (('AIC_NON_MANIFOLD_SURFACE.OFFSET_CURVE_3D' IN TYPEOF (cv))
AND
((cv\offset_curve_3d.self_intersect = FALSE) OR
(cv\offset_curve_3d.self_intersect = UNKNOWN))
AND
(NOT ('AIC_NON_MANIFOLD_SURFACE.POLYLINE' IN TYPEOF
(cv\offset_curve_3d.basis_curve)))) THEN
RETURN (nmsf_curve_check(cv\offset_curve_3d.basis_curve));
ELSE
IF 'AIC_NON_MANIFOLD_SURFACE.PCURVE' IN TYPEOF(cv) THEN
RETURN ((nmsf_curve_check
(cv\pcurve.reference_to_curve\representation.items[1]))
AND
(nmsf_surface_check(cv\pcurve.basis_surface)));
ELSE
IF 'AIC_NON_MANIFOLD_SURFACE.SURFACE_CURVE' IN TYPEOF(cv) THEN
IF nmsf_curve_check(cv\surface_curve.curve_3d) THEN
REPEAT i := 1 TO SIZEOF
(cv\surface_curve.associated_geometry);
IF 'AIC_NON_MANIFOLD_SURFACE.SURFACE' IN
TYPEOF (cv\surface_curve.associated_geometry[i]) THEN
IF NOT nmsf_surface_check
(cv\surface_curve.associated_geometry[i]) THEN
RETURN(FALSE);
END_IF;
ELSE
IF 'AIC_NON_MANIFOLD_SURFACE.PCURVE' IN TYPEOF
(cv\surface_curve.associated_geometry[i]) THEN
IF NOT nmsf_curve_check
(cv\surface_curve.associated_geometry[i]) THEN
RETURN(FALSE);
END_IF;
END_IF;
END_IF;
END_REPEAT;
RETURN(TRUE);
END_IF;
ELSE
IF 'AIC_NON_MANIFOLD_SURFACE.POLYLINE' IN TYPEOF(cv) THEN
IF (SIZEOF (cv\polyline.points) &gt;= 3) THEN RETURN (TRUE);
END_IF;
END_IF;
END_IF;
END_IF;
END_IF;
END_IF;
END_IF;
END_IF;
END_IF;
RETURN (FALSE);
      </algorithm>
    </function>

    <function
      name="nmsf_surface_check">
      <parameter
        name="surf">
        <typename
          name="surface"/>
      </parameter>
      <builtintype
        type="BOOLEAN"/>
      <algorithm>
IF 'AIC_NON_MANIFOLD_SURFACE.ELEMENTARY_SURFACE' IN TYPEOF(surf) THEN
RETURN(TRUE);
ELSE
IF 'AIC_NON_MANIFOLD_SURFACE.SWEPT_SURFACE' IN TYPEOF (surf) THEN
RETURN (nmsf_curve_check(surf\swept_surface.swept_curve));
ELSE
IF (('AIC_NON_MANIFOLD_SURFACE.OFFSET_SURFACE' IN TYPEOF (surf)) AND
(surf\offset_surface.self_intersect = FALSE) OR
(surf\offset_surface.self_intersect = UNKNOWN)) THEN
RETURN (nmsf_surface_check(surf\offset_surface.basis_surface));
ELSE
IF 'AIC_NON_MANIFOLD_SURFACE.SURFACE_REPLICA' IN TYPEOF(surf) THEN
RETURN(nmsf_surface_check(surf\surface_replica.parent_surface));
ELSE
IF (('AIC_NON_MANIFOLD_SURFACE.B_SPLINE_SURFACE' IN TYPEOF(surf))
AND
(surf\b_spline_surface.self_intersect = FALSE) OR
(surf\b_spline_surface.self_intersect = UNKNOWN)) THEN
RETURN(TRUE);
END_IF;
END_IF;
END_IF;
END_IF;
END_IF;
RETURN(FALSE);
      </algorithm>
    </function>

  </schema>
</express>
