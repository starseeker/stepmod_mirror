<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<?xml-stylesheet type="text/xsl" href="../../../xsl/express.xsl"?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">

<express description.file="descriptions.xml" language_version="2" rcs.date="$Date$" rcs.revision="$Revision$" reference="ISO 10303-105">
   <application name="JSDAI" owner="LKSoft" source="kinematic_topology_schema schema_instance" url="www.lksoft.com" version="4.0 beta"/>
   <schema name="kinematic_topology_schema">
      <interface kind="reference" schema="representation_schema">
         <interfaced.item name="representation"/>
      </interface>
      <interface kind="reference" schema="topology_schema">
         <interfaced.item name="connected_edge_set"/>
         <interfaced.item name="edge"/>
         <interfaced.item name="edge_loop"/>
         <interfaced.item name="oriented_edge"/>
         <interfaced.item name="path"/>
         <interfaced.item name="vertex"/>
      </interface>
      <type name="kinematic_topology_representation_select">
         <select selectitems="kinematic_topology_structure kinematic_topology_directed_structure kinematic_topology_network_structure"/>
      </type>
      <entity name="kinematic_joint" supertypes="edge">
         <explicit name="edge_start">
            <typename name="kinematic_link"/>
            <redeclaration entity-ref="edge"/>
         </explicit>
         <explicit name="edge_end">
            <typename name="kinematic_link"/>
            <redeclaration entity-ref="edge"/>
         </explicit>
         <unique label="UR1">
            <unique.attribute attribute="edge_start"/>
            <unique.attribute attribute="edge_end"/>
         </unique>
         <where expression="edge_start :&lt;&gt;: edge_end" label="WR1"/>
      </entity>
      <entity name="kinematic_link" supertypes="vertex"/>
      <entity name="kinematic_loop" supertypes="edge_loop">
         <explicit name="edge_list">
            <aggregate lower="1" type="LIST" unique="YES" upper="?"/>
            <typename name="oriented_joint"/>
            <redeclaration entity-ref="path"/>
         </explicit>
      </entity>
      <entity name="kinematic_topology_directed_structure" supertypes="representation">
         <explicit name="items">
            <aggregate lower="1" type="SET" upper="?"/>
            <typename name="oriented_joint"/>
            <redeclaration entity-ref="representation"/>
         </explicit>
         <explicit name="parent">
            <typename name="kinematic_topology_structure"/>
         </explicit>
         <where expression="context_of_items :=: parent.context_of_items" label="WR1"/>
         <where expression="get_kinematic_joints_from_oriented_joints(items) &lt;= parent.items" label="WR2"/>
      </entity>
      <entity name="kinematic_topology_network_structure" supertypes="representation">
         <explicit name="items">
            <aggregate lower="1" type="SET" upper="?"/>
            <typename name="kinematic_loop"/>
            <redeclaration entity-ref="representation"/>
         </explicit>
         <explicit name="parent">
            <typename name="kinematic_topology_structure"/>
         </explicit>
         <where expression="context_of_items :=: parent.context_of_items" label="WR1"/>
         <where expression="get_kinematic_joints_from_kinematic_loops(items) &lt;= parent.items" label="WR2"/>
      </entity>
      <entity name="kinematic_topology_structure" supertypes="representation">
         <explicit name="items">
            <aggregate lower="1" type="SET" upper="?"/>
            <typename name="kinematic_joint"/>
            <redeclaration entity-ref="representation"/>
         </explicit>
         <where expression="SIZEOF (QUERY (item &lt;* items | 'TOPOLOGY_SCHEMA.ORIENTED_EDGE' in TYPEOF(item))) = 0" label="WR1"/>
      </entity>
      <entity name="kinematic_topology_substructure" supertypes="kinematic_topology_structure">
         <explicit name="parent">
            <typename name="kinematic_topology_structure"/>
         </explicit>
         <where expression="context_of_items :=: parent.context_of_items" label="WR1"/>
         <where expression="SELF\kinematic_topology_structure.items &lt;= parent\kinematic_topology_structure.items" label="WR2"/>
      </entity>
      <entity name="kinematic_topology_tree_structure" supertypes="kinematic_topology_directed_structure"/>
      <entity name="oriented_joint" supertypes="oriented_edge">
         <explicit name="edge_element">
            <typename name="kinematic_joint"/>
            <redeclaration entity-ref="oriented_edge"/>
         </explicit>
      </entity>
      <subtype.constraint entity="representation" name="kts_representation_subtypes" super.expression="ONEOF (kinematic_topology_structure, kinematic_topology_directed_structure, kinematic_topology_network_structure)"/>
      <function name="get_kinematic_joints_from_kinematic_loops">
         <parameter name="kls">
            <aggregate lower="0" type="SET" upper="?"/>
            <typename name="kinematic_loop"/>
         </parameter>
         <aggregate lower="0" type="SET" upper="?"/>
         <typename name="kinematic_joint"/>
         <algorithm>LOCAL
    result : SET OF oriented_joint := [];
  END_LOCAL;
  IF SIZEOF(kls) &gt; 0 THEN
    REPEAT i := 1 TO HIINDEX(kls);
      result := result + kls[i].edge_list;
    END_REPEAT;
  END_IF;
  RETURN (get_kinematic_joints_from_oriented_joints(result));</algorithm>
      </function>
      <function name="get_kinematic_joints_from_oriented_joints">
         <parameter name="ors">
            <aggregate lower="0" type="SET" upper="?"/>
            <typename name="oriented_joint"/>
         </parameter>
         <aggregate lower="0" type="SET" upper="?"/>
         <typename name="kinematic_joint"/>
         <algorithm>LOCAL
    result : SET OF kinematic_joint := [];
  END_LOCAL;
  IF SIZEOF(ors) &gt; 0 THEN
    REPEAT i := 1 TO HIINDEX(ors);
      result := result + ors[i].edge_element;
    END_REPEAT;
  END_IF;
  RETURN (result);</algorithm>
      </function>
   </schema>
</express>
