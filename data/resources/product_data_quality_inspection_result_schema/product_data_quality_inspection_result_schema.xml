<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<?xml-stylesheet type="text/xsl" href="../../../xsl/express.xsl"?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">

<express description.file="descriptions.xml" language_version="2" rcs.date="$Date$" rcs.revision="$Revision$" reference="ISO 10303-59">
   <application name="JSDAI" owner="LKSoft" source="product_data_quality_inspection_result_schema schema_instance" url="www.lksoft.com" version="4.0 beta"/>
   <schema name="product_data_quality_inspection_result_schema">
      <interface kind="reference" schema="product_data_quality_criteria_schema"/>
      <interface kind="reference" schema="product_data_quality_definition_schema">
         <interfaced.item name="data_quality_definition_representation_relationship"/>
         <interfaced.item name="product_data_and_data_quality_relationship"/>
      </interface>
      <interface kind="reference" schema="product_definition_schema">
         <interfaced.item name="product_definition"/>
      </interface>
      <interface kind="reference" schema="representation_schema">
         <interfaced.item name="representation"/>
         <interfaced.item name="representation_item"/>
         <interfaced.item name="representation_item_relationship"/>
      </interface>
      <interface kind="reference" schema="support_resource_schema">
         <interfaced.item name="bag_to_set"/>
      </interface>
      <type name="statistical_value_type">
         <enumeration items="NUMBER_OF_INSPECTED_INSTANCES NUMBER_OF_QUALITY_DEFECTS"/>
      </type>
      <entity name="data_quality_inspection_criterion_report" supertypes="data_quality_inspection_report">
         <explicit name="statistical_values">
            <aggregate lower="1" type="SET" upper="2"/>
            <typename name="data_quality_inspection_criterion_report_item"/>
         </explicit>
         <where expression="SIZEOF(QUERY(i1&lt;*bag_to_set(USEDIN(&#10;              SELF\data_quality_inspection_report.&#10;              inspection_result.criterion_inspected,&#10;              'PRODUCT_DATA_QUALITY_CRITERIA_SCHEMA.'+&#10;              'DATA_QUALITY_REPORT_REQUEST.CRITERION_OF_REPORT_REQUEST'))|&#10;              'PRODUCT_DATA_QUALITY_CRITERIA_SCHEMA.'+&#10;              'SUMMARY_REPORT_REQUEST'&#10;            IN TYPEOF(i1)))&gt;0" label="WR1"/>
         <where expression="(SIZEOF(SELF.statistical_values) = 1 ) OR &#10;            (SELF.statistical_values[1].value_type &lt;&gt;&#10;             SELF.statistical_values[2].value_type)" label="WR2"/>
      </entity>
      <entity name="data_quality_inspection_criterion_report_item" supertypes="representation_item">
         <explicit name="statistical_value">
            <builtintype type="INTEGER"/>
         </explicit>
         <explicit name="value_type">
            <typename name="statistical_value_type"/>
         </explicit>
         <where expression="SIZEOF(QUERY(q &lt;* bag_to_set( USEDIN(SELF,&#10;                            'REPRESENTATION_SCHEMA.REPRESENTATION.ITEMS'))&#10;                          |'PRODUCT_DATA_QUALITY_CRITERIA_SCHEMA.'+&#10;                           'DATA_QUALITY_CRITERIA_REPRESENTATION'&#10;                           IN TYPEOF(q)))=0" label="WR1"/>
      </entity>
      <entity name="data_quality_inspection_instance_report" supertypes="data_quality_inspection_report">
         <explicit name="inspected_instances">
            <aggregate lower="1" type="LIST" upper="?"/>
            <typename name="data_quality_inspection_instance_report_item"/>
         </explicit>
         <where expression="SIZEOF(QUERY(i1&lt;*bag_to_set(USEDIN(&#10;              SELF\data_quality_inspection_report.&#10;              inspection_result.criterion_inspected,&#10;              'PRODUCT_DATA_QUALITY_CRITERIA_SCHEMA.'+&#10;              'DATA_QUALITY_REPORT_REQUEST.CRITERION_OF_REPORT_REQUEST'))|&#10;              'PRODUCT_DATA_QUALITY_CRITERIA_SCHEMA.'+&#10;              'DETAILED_REPORT_REQUEST'&#10;            IN TYPEOF(i1)))&gt;0" label="WR1"/>
      </entity>
      <entity name="data_quality_inspection_instance_report_item" supertypes="representation_item">
         <where expression="SIZEOF(QUERY(q &lt;* bag_to_set( USEDIN(SELF,&#10;                            'REPRESENTATION_SCHEMA.REPRESENTATION.ITEMS'))&#10;                          |'PRODUCT_DATA_QUALITY_CRITERIA_SCHEMA.'+&#10;                           'DATA_QUALITY_CRITERIA_REPRESENTATION'&#10;                           IN TYPEOF(q)))=0" label="WR1"/>
      </entity>
      <entity name="data_quality_inspection_report" super.expression="ONEOF (data_quality_inspection_criterion_report, data_quality_inspection_instance_report)" supertypes="representation_item">
         <explicit name="inspection_result">
            <typename name="data_quality_inspection_result"/>
         </explicit>
         <where expression="SIZEOF(QUERY(q &lt;* bag_to_set( USEDIN(SELF,&#10;                            'REPRESENTATION_SCHEMA.REPRESENTATION.ITEMS'))&#10;                          |'PRODUCT_DATA_QUALITY_CRITERIA_SCHEMA.'+&#10;                           'DATA_QUALITY_CRITERIA_REPRESENTATION'&#10;                           IN TYPEOF(q)))=0" label="WR1"/>
      </entity>
      <entity name="data_quality_inspection_result" supertypes="representation_item">
         <explicit name="criterion_inspected">
            <typename name="data_quality_criterion"/>
         </explicit>
         <where expression="SIZEOF(QUERY(q &lt;* bag_to_set( USEDIN(SELF,&#10;                            'REPRESENTATION_SCHEMA.REPRESENTATION.ITEMS'))&#10;                          |'PRODUCT_DATA_QUALITY_CRITERIA_SCHEMA.'+&#10;                           'DATA_QUALITY_CRITERIA_REPRESENTATION'&#10;                           IN TYPEOF(q)))=0" label="WR1"/>
      </entity>
      <entity name="data_quality_inspection_result_representation" supertypes="representation">
         <explicit name="criteria_inspected">
            <typename name="data_quality_criteria_representation"/>
         </explicit>
         <where expression="SIZEOF( QUERY( q &lt;* SELF\representation.items|&#10;                                'PRODUCT_DATA_QUALITY_INSPECTION_RESULT_SCHEMA.' +&#10;                                'DATA_QUALITY_INSPECTION_RESULT' IN TYPEOF(q))) &gt; 0" label="WR1"/>
         <where expression="SIZEOF(inspected_product_definition(SELF)) &gt; 0" label="WR2"/>
      </entity>
      <entity name="data_quality_inspection_result_with_judgement" supertypes="data_quality_inspection_result">
         <explicit name="judgement">
            <builtintype type="BOOLEAN"/>
         </explicit>
      </entity>
      <entity name="data_quality_report_measurement_association" supertypes="representation_item_relationship">
         <explicit name="related_representation_item">
            <typename name="data_quality_inspection_report"/>
            <redeclaration entity-ref="representation_item_relationship"/>
         </explicit>
         <explicit name="relating_representation_item">
            <typename name="data_quality_measurement_requirement"/>
            <redeclaration entity-ref="representation_item_relationship"/>
         </explicit>
      </entity>
      <function name="inspected_product_definition">
         <parameter name="dqir">
            <typename name="data_quality_inspection_result_representation"/>
         </parameter>
         <aggregate lower="0" type="BAG" upper="?"/>
         <typename name="product_definition"/>
         <algorithm>LOCAL
      dqdr :BAG OF data_quality_definition_representation_relationship:= [];
      pdqdr :BAG OF product_data_and_data_quality_relationship:= [];
      pd   :BAG OF product_definition:= [];
    END_LOCAL;
    dqdr := USEDIN(dqir,'PRODUCT_DATA_QUALITY_DEFINITION_SCHEMA.'
                       +'DATA_QUALITY_DEFINITION_REPRESENTATION_RELATIONSHIP.'
                       +'USED_REPRESENTATION');
    REPEAT i:= 1 TO SIZEOF(dqdr);
      pdqdr := USEDIN(dqdr[i].definition,
                      'PRODUCT_DATA_QUALITY_DEFINITION_SCHEMA.'
                     +'PRODUCT_DATA_AND_DATA_QUALITY_RELATIONSHIP.'
                     +'DATA_QUALITY');
      REPEAT j:= 1 TO SIZEOF(pdqdr);
        pd := pd + pdqdr[j].product_data; 
      END_REPEAT;
    END_REPEAT;
    RETURN(pd);</algorithm>
      </function>
   </schema>
</express>
