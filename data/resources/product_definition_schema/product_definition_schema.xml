<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" 
  href="../../../xsl/express.xsl"
?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">
<express language_version="2" rcs.date="$Date: $" rcs.revision="$Revision: $" reference="ISO 10303-41" description.file="descriptions.xml">
	<application name="GraphicalEXPRESS" owner="Eurostep" url="www.eurostep.com" version="1.3.14" source="product_definition_schema_v009.vsd"/>
	<schema name="product_definition_schema">
		<interface kind="reference" schema="application_context_schema">
			<interfaced.item name="product_context"/>
			<interfaced.item name="product_definition_context"/>
		</interface>
		<interface kind="reference" schema="basic_attribute_schema">
			<interfaced.item name="get_id_value"/>
			<interfaced.item name="get_name_value"/>
			<interfaced.item name="name_attribute"/>
		</interface>
		<interface kind="reference" schema="document_schema">
			<interfaced.item name="document"/>
		</interface>
		<interface kind="reference" schema="effectivity_schema">
			<interfaced.item name="effectivity"/>
		</interface>
		<interface kind="reference" schema="support_resource_schema">
			<interfaced.item name="bag_to_set"/>
			<interfaced.item name="identifier"/>
			<interfaced.item name="label"/>
			<interfaced.item name="text"/>
		</interface>
		<type name="source">
			<enumeration items="made bought not_known"/>
			<graphic.element page="2" xcoord="437" ycoord="106"/>
		</type>
		<entity name="product">
			<explicit name="id">
				<typename name="identifier"/>
			</explicit>
			<explicit name="name">
				<typename name="label"/>
			</explicit>
			<explicit name="description" optional="YES">
				<typename name="text"/>
			</explicit>
			<explicit name="frame_of_reference">
				<aggregate type="SET" lower="1" upper="?"/>
				<typename name="product_context"/>
			</explicit>
			<graphic.element page="2" xcoord="131" ycoord="559"/>
		</entity>
		<entity name="product_category">
			<explicit name="name">
				<typename name="label"/>
			</explicit>
			<explicit name="description" optional="YES">
				<typename name="text"/>
			</explicit>
			<derived name="id" expression="get_id_value (SELF)">
				<typename name="identifier"/>
			</derived>
			<where label="WR1" expression="SIZEOF (USEDIN (SELF, 'BASIC_ATTRIBUTE_SCHEMA.' + 'ID_ATTRIBUTE.IDENTIFIED_ITEM')) &lt;= 1"/>
			<graphic.element page="2" xcoord="347" ycoord="418"/>
		</entity>
		<entity name="product_category_relationship">
			<explicit name="name">
				<typename name="label"/>
			</explicit>
			<explicit name="description" optional="YES">
				<typename name="text"/>
			</explicit>
			<explicit name="category">
				<typename name="product_category"/>
			</explicit>
			<explicit name="sub_category">
				<typename name="product_category"/>
			</explicit>
			<where label="WR1" expression="acyclic_product_category_relationship (SELF, [SELF.sub_category])"/>
			<graphic.element page="2" xcoord="347" ycoord="290"/>
		</entity>
		<entity name="product_definition">
			<explicit name="id">
				<typename name="identifier"/>
			</explicit>
			<explicit name="description" optional="YES">
				<typename name="text"/>
			</explicit>
			<explicit name="formation">
				<typename name="product_definition_formation"/>
			</explicit>
			<explicit name="frame_of_reference">
				<typename name="product_definition_context"/>
			</explicit>
			<derived name="name" expression="get_name_value (SELF)">
				<typename name="label"/>
			</derived>
			<where label="WR1" expression="SIZEOF (USEDIN (SELF, 'BASIC_ATTRIBUTE_SCHEMA.' + 'NAME_ATTRIBUTE.NAMED_ITEM')) &lt;= 1"/>
			<graphic.element page="3" xcoord="391" ycoord="567"/>
		</entity>
		<entity name="product_definition_context_association">
			<explicit name="definition">
				<typename name="product_definition"/>
			</explicit>
			<explicit name="frame_of_reference">
				<typename name="product_definition_context"/>
			</explicit>
			<explicit name="role">
				<typename name="product_definition_context_role"/>
			</explicit>
			<graphic.element page="3" xcoord="483" ycoord="42"/>
		</entity>
		<entity name="product_definition_context_role">
			<explicit name="name">
				<typename name="label"/>
			</explicit>
			<explicit name="description" optional="YES">
				<typename name="text"/>
			</explicit>
			<graphic.element page="3" xcoord="171" ycoord="42"/>
		</entity>
		<entity name="product_definition_effectivity" supertypes="effectivity">
			<explicit name="usage">
				<typename name="product_definition_relationship"/>
			</explicit>
			<where label="WR1" expression="SIZEOF (USEDIN (SELF, 'MANAGEMENT_RESOURCES_SCHEMA.' + 'EFFECTIVITY_ASSIGNMENT.ASSIGNED_EFFECTIVITY')) = 0"/>
			<graphic.element page="3" xcoord="171" ycoord="255"/>
		</entity>
		<entity name="product_definition_formation">
			<explicit name="id">
				<typename name="identifier"/>
			</explicit>
			<explicit name="description" optional="YES">
				<typename name="text"/>
			</explicit>
			<explicit name="of_product">
				<typename name="product"/>
			</explicit>
			<unique label="UR1">
				<unique.attribute attribute="id"/>
				<unique.attribute attribute="of_product"/>
			</unique>
			<graphic.element page="2" xcoord="106" ycoord="177"/>
		</entity>
		<entity name="product_definition_formation_relationship">
			<explicit name="id">
				<typename name="identifier"/>
			</explicit>
			<explicit name="name">
				<typename name="label"/>
			</explicit>
			<explicit name="description" optional="YES">
				<typename name="text"/>
			</explicit>
			<explicit name="relating_product_definition_formation">
				<typename name="product_definition_formation"/>
			</explicit>
			<explicit name="related_product_definition_formation">
				<typename name="product_definition_formation"/>
			</explicit>
			<graphic.element page="2" xcoord="474" ycoord="177"/>
		</entity>
		<entity name="product_definition_formation_with_specified_source" supertypes="product_definition_formation">
			<explicit name="make_or_buy">
				<typename name="source"/>
			</explicit>
			<graphic.element page="2" xcoord="141" ycoord="106"/>
		</entity>
		<entity name="product_definition_relationship">
			<explicit name="id">
				<typename name="identifier"/>
			</explicit>
			<explicit name="name">
				<typename name="label"/>
			</explicit>
			<explicit name="description" optional="YES">
				<typename name="text"/>
			</explicit>
			<explicit name="relating_product_definition">
				<typename name="product_definition"/>
			</explicit>
			<explicit name="related_product_definition">
				<typename name="product_definition"/>
			</explicit>
			<graphic.element page="3" xcoord="391" ycoord="255"/>
		</entity>
		<entity name="product_definition_substitute">
			<explicit name="description" optional="YES">
				<typename name="text"/>
			</explicit>
			<explicit name="context_relationship">
				<typename name="product_definition_relationship"/>
			</explicit>
			<explicit name="substitute_definition">
				<typename name="product_definition"/>
			</explicit>
			<derived name="name" expression="get_name_value (SELF)">
				<typename name="label"/>
			</derived>
			<where label="WR1" expression="context_relationship.related_product_definition :&lt;&gt;: substitute_definition"/>
			<where label="WR2" expression="SIZEOF (USEDIN (SELF, 'BASIC_ATTRIBUTE_SCHEMA.' + 'NAME_ATTRIBUTE.NAMED_ITEM')) &lt;= 1"/>
			<graphic.element page="3" xcoord="121" ycoord="382"/>
		</entity>
		<entity name="product_definition_with_associated_documents" supertypes="product_definition">
			<explicit name="documentation_ids">
				<aggregate type="SET" lower="1" upper="?"/>
				<typename name="document"/>
			</explicit>
			<graphic.element page="3" xcoord="192" ycoord="567"/>
		</entity>
		<entity name="product_related_product_category" supertypes="product_category">
			<explicit name="products">
				<aggregate type="SET" lower="1" upper="?"/>
				<typename name="product"/>
			</explicit>
			<graphic.element page="2" xcoord="325" ycoord="616"/>
		</entity>
		<entity name="product_relationship">
			<explicit name="id">
				<typename name="identifier"/>
			</explicit>
			<explicit name="name">
				<typename name="label"/>
			</explicit>
			<explicit name="description" optional="YES">
				<typename name="text"/>
			</explicit>
			<explicit name="relating_product">
				<typename name="product"/>
			</explicit>
			<explicit name="related_product">
				<typename name="product"/>
			</explicit>
			<graphic.element page="2" xcoord="141" ycoord="488"/>
		</entity>
		<function name="acyclic_product_category_relationship">
			<parameter name="relation">
				<typename name="product_category_relationship"/>
			</parameter>
			<parameter name="children">
				<aggregate type="SET"/>
				<typename name="product_category"/>
			</parameter>
			<builtintype type="BOOLEAN"/>
			<algorithm>
LOCAL
      x : SET OF product_category_relationship;
      local_children : SET OF product_category;
    END_LOCAL;

    REPEAT i := 1 TO HIINDEX(children);
      IF relation.category :=: children[i] THEN
        RETURN (FALSE);
      END_IF;
    END_REPEAT;
    x := bag_to_set(USEDIN(relation.category, 'PRODUCT_DEFINITION_SCHEMA.' + 'PRODUCT_CATEGORY_RELATIONSHIP.SUB_CATEGORY'));
    local_children := children + relation.category;
    IF SIZEOF(x) > 0 THEN
      REPEAT i := 1 TO HIINDEX(x);
        IF NOT acyclic_product_category_relationship(x[i], local_children) THEN
          RETURN (FALSE);
        END_IF;
      END_REPEAT;
    END_IF;
    RETURN (TRUE);      </algorithm>
		</function>
		<function name="acyclic_product_definition_formation_relationship">
			<parameter name="relation">
				<typename name="product_definition_formation_relationship"/>
			</parameter>
			<parameter name="relatives">
				<aggregate type="SET" lower="1" upper="?"/>
				<typename name="product_definition_formation"/>
			</parameter>
			<parameter name="specific_relation">
				<builtintype type="STRING"/>
			</parameter>
			<builtintype type="BOOLEAN"/>
			<algorithm>
 LOCAL
      x : SET OF product_definition_formation_relationship;
    END_LOCAL;

    IF relation.relating_product_definition_formation IN relatives THEN
      RETURN (FALSE);
    END_IF;
    x := QUERY(pdf &lt;* bag_to_set(USEDIN(relation.relating_product_definition_formation, 'PRODUCT_DEFINITION_SCHEMA.' + 'PRODUCT_DEFINITION_FORMATION_RELATIONSHIP.' + 'RELATED_PRODUCT_DEFINITION_FORMATION')) | specific_relation IN TYPEOF(pdf));
    REPEAT i := 1 TO HIINDEX(x);
      IF NOT acyclic_product_definition_formation_relationship(x[i], relatives + relation.relating_product_definition_formation, specific_relation) THEN
        RETURN (FALSE);
      END_IF;
    END_REPEAT;
    RETURN (TRUE);
			</algorithm>
		</function>
		<function name="acyclic_product_definition_relationship">
			<parameter name="relation">
				<typename name="product_definition_relationship"/>
			</parameter>
			<parameter name="relatives">
				<aggregate type="SET" lower="1" upper="?"/>
				<typename name="product_definition"/>
			</parameter>
			<parameter name="specific_relation">
				<builtintype type="STRING"/>
			</parameter>
			<builtintype type="BOOLEAN"/>
			<algorithm>
LOCAL
      x : SET OF product_definition_relationship;
    END_LOCAL;

    IF relation.relating_product_definition IN relatives THEN
      RETURN (FALSE);
    END_IF;
    x := QUERY(pd &lt;* bag_to_set(USEDIN(relation.relating_product_definition, 'PRODUCT_DEFINITION_SCHEMA.' + 'PRODUCT_DEFINITION_RELATIONSHIP.' + 'RELATED_PRODUCT_DEFINITION')) | specific_relation IN TYPEOF(pd));
    REPEAT i := 1 TO HIINDEX(x);
      IF NOT acyclic_product_definition_relationship(x[i], relatives + relation.relating_product_definition, specific_relation) THEN
        RETURN (FALSE);
      END_IF;
    END_REPEAT;
RETURN (TRUE);
			</algorithm>
		</function>
		<function name="acyclic_product_relationship">
			<parameter name="relation">
				<typename name="product_relationship"/>
			</parameter>
			<parameter name="relatives">
				<aggregate type="SET" lower="1" upper="?"/>
				<typename name="product"/>
			</parameter>
			<parameter name="specific_relation">
				<builtintype type="STRING"/>
			</parameter>
			<builtintype type="BOOLEAN"/>
			<algorithm>
 LOCAL
      x : SET OF product_relationship;
    END_LOCAL;

    IF relation.relating_product IN relatives THEN
      RETURN (FALSE);
    END_IF;
    x := QUERY(prod &lt;* bag_to_set(USEDIN(relation.relating_product, 'PRODUCT_DEFINITION_SCHEMA.' + 'PRODUCT_RELATIONSHIP.' + 'RELATED_PRODUCT')) | specific_relation IN TYPEOF(prod));
    REPEAT i := 1 TO HIINDEX(x);
      IF NOT acyclic_product_relationship(x[i], relatives + relation.relating_product, specific_relation) THEN
        RETURN (FALSE);
      END_IF;
    END_REPEAT;
    RETURN (TRUE);
      </algorithm>
		</function>
		<function name="get_product_definitions">
			<parameter name="c_def_instance">
				<typename name="product"/>
			</parameter>
			<aggregate type="SET"/>
			<typename name="product_definition"/>
			<algorithm>
  LOCAL
      pd_set : SET OF product_definition_formation := [];
      pdr_set : SET OF product_definition := [];
    END_LOCAL;

    pd_set := bag_to_set(USEDIN(c_def_instance, 'PRODUCT_DEFINITION_SCHEMA.PRODUCT_DEFINITION_FORMATION.OF_PRODUCT'));
    IF (SIZEOF(pd_set) &lt; 1) THEN
      RETURN (pdr_set);
    END_IF;
    REPEAT i := 1 TO HIINDEX(pd_set);
      pdr_set := pdr_set + bag_to_set(USEDIN(pd_set[i], 'PRODUCT_DEFINITION_SCHEMA.PRODUCT_DEFINITION.FORMATION'));
    END_REPEAT;
    RETURN (pdr_set);
			</algorithm>
		</function>
		<graphic.element page="1" xcoord="283" ycoord="134"/>
	</schema>
</express>
