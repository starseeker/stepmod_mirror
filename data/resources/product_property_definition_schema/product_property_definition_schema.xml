<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<?xml-stylesheet type="text/xsl" href="../../../xsl/express.xsl"?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">

<express description.file="descriptions.xml" language_version="2" rcs.date="$Date$" rcs.revision="$Revision$" reference="ISO 10303-41">
   <application name="JSDAI" owner="LKSoft" source="product_property_definition_schema schema_instance" url="www.lksoft.com" version="4.0 beta"/>
   <schema name="product_property_definition_schema">
      <interface kind="reference" schema="process_property_schema">
         <interfaced.item name="action_property"/>
         <interfaced.item name="resource_property"/>
      </interface>
      <interface kind="reference" schema="product_definition_schema">
         <interfaced.item name="product_definition"/>
         <interfaced.item name="product_definition_relationship"/>
         <interfaced.item name="product_definition_relationship_relationship"/>
      </interface>
      <interface kind="reference" schema="product_structure_schema">
         <interfaced.item name="assembly_component_usage"/>
         <interfaced.item name="multi_level_reference_designator"/>
         <interfaced.item name="next_assembly_usage_occurrence"/>
         <interfaced.item name="product_definition_occurrence"/>
      </interface>
      <interface kind="reference" schema="support_resource_schema">
         <interfaced.item name="bag_to_set"/>
         <interfaced.item name="identifier"/>
         <interfaced.item name="label"/>
         <interfaced.item name="text"/>
      </interface>
      <interface kind="reference" schema="basic_attribute_schema">
         <interfaced.item name="get_id_value"/>
         <interfaced.item name="id_attribute"/>
         <interfaced.item name="id_attribute_select"/>
      </interface>
      <interface kind="reference" schema="product_property_representation_schema">
         <interfaced.item name="item_identified_representation_usage"/>
      </interface>
      <interface kind="reference" schema="shape_dimension_schema">
         <interfaced.item name="dimensional_size"/>
      </interface>
      <interface kind="reference" schema="shape_tolerance_schema">
         <interfaced.item name="geometric_tolerance"/>
      </interface>
      <type name="characterized_definition">
         <select selectitems="characterized_item characterized_object characterized_product_definition shape_definition"/>
      </type>
      <type name="characterized_item">
         <select selectitems="item_identified_representation_usage dimensional_size geometric_tolerance"/>
      </type>
      <type name="characterized_product_definition">
         <select selectitems="product_definition product_definition_occurrence product_definition_relationship product_definition_relationship_relationship"/>
      </type>
      <type name="derived_property_select">
         <select selectitems="property_definition action_property resource_property"/>
      </type>
      <type name="internal_or_reflected_shape_aspect">
         <select selectitems="shape_aspect identifier"/>
      </type>
      <type name="multi_or_next_assembly_usage_occurrence">
         <select selectitems="multi_level_reference_designator next_assembly_usage_occurrence"/>
      </type>
      <type name="ppds_id_attribute_select">
         <select basedon="id_attribute_select" selectitems="property_definition shape_aspect shape_aspect_relationship"/>
      </type>
      <type name="product_definition_shape_or_shape_aspect">
         <select selectitems="product_definition_shape shape_aspect"/>
      </type>
      <type name="shape_aspect_or_characterized_object">
         <select selectitems="shape_aspect characterized_object"/>
      </type>
      <type name="shape_definition">
         <select selectitems="product_definition_shape shape_aspect shape_aspect_relationship"/>
      </type>
      <entity name="characterized_object">
         <explicit name="name">
            <typename name="label"/>
         </explicit>
         <explicit name="description" optional="YES">
            <typename name="text"/>
         </explicit>
      </entity>
      <entity name="characterized_object_relationship">
         <explicit name="name">
            <typename name="label"/>
         </explicit>
         <explicit name="description" optional="YES">
            <typename name="text"/>
         </explicit>
         <explicit name="relating_object">
            <typename name="characterized_object"/>
         </explicit>
         <explicit name="related_object">
            <typename name="characterized_object"/>
         </explicit>
      </entity>
      <entity name="component_path_shape_aspect" supertypes="shape_aspect">
         <explicit name="location">
            <typename name="multi_or_next_assembly_usage_occurrence"/>
         </explicit>
         <explicit name="component_shape_aspect">
            <typename name="internal_or_reflected_shape_aspect"/>
         </explicit>
         <unique label="UR1">
            <unique.attribute attribute="location"/>
            <unique.attribute attribute="component_shape_aspect"/>
         </unique>
      </entity>
      <entity name="general_property">
         <explicit name="id">
            <typename name="identifier"/>
         </explicit>
         <explicit name="name">
            <typename name="label"/>
         </explicit>
         <explicit name="description" optional="YES">
            <typename name="text"/>
         </explicit>
      </entity>
      <entity name="general_property_association">
         <explicit name="name">
            <typename name="label"/>
         </explicit>
         <explicit name="description" optional="YES">
            <typename name="text"/>
         </explicit>
         <explicit name="base_definition">
            <typename name="general_property"/>
         </explicit>
         <explicit name="derived_definition">
            <typename name="derived_property_select"/>
         </explicit>
         <where expression="SIZEOF(USEDIN(derived_definition, 'PRODUCT_PROPERTY_DEFINITION_SCHEMA.' + 'GENERAL_PROPERTY_ASSOCIATION.' + 'DERIVED_DEFINITION')) = 1" label="WR1"/>
         <where expression="derived_definition.name = base_definition.name" label="WR2"/>
      </entity>
      <entity name="general_property_relationship">
         <explicit name="name">
            <typename name="label"/>
         </explicit>
         <explicit name="description" optional="YES">
            <typename name="text"/>
         </explicit>
         <explicit name="relating_property">
            <typename name="general_property"/>
         </explicit>
         <explicit name="related_property">
            <typename name="general_property"/>
         </explicit>
      </entity>
      <entity name="product_definition_shape" supertypes="property_definition">
         <unique label="UR1">
            <unique.attribute attribute="SELF\property_definition.definition"/>
         </unique>
         <where expression="SIZEOF(['PRODUCT_PROPERTY_DEFINITION_SCHEMA.CHARACTERIZED_PRODUCT_DEFINITION', 'PRODUCT_PROPERTY_DEFINITION_SCHEMA.CHARACTERIZED_OBJECT'] * TYPEOF(SELF\property_definition.definition)) &gt; 0" label="WR1"/>
      </entity>
      <entity name="property_definition">
         <explicit name="name">
            <typename name="label"/>
         </explicit>
         <explicit name="description" optional="YES">
            <typename name="text"/>
         </explicit>
         <explicit name="definition">
            <typename name="characterized_definition"/>
         </explicit>
         <derived expression="get_id_value(SELF)" name="id">
            <typename name="identifier"/>
         </derived>
         <where expression="SIZEOF(USEDIN(SELF, 'BASIC_ATTRIBUTE_SCHEMA.' + 'ID_ATTRIBUTE.IDENTIFIED_ITEM')) &lt;= 1" label="WR1"/>
      </entity>
      <entity name="shape_aspect" super.expression="ONEOF (shape_aspect_occurrence, component_path_shape_aspect)">
         <explicit name="name">
            <typename name="label"/>
         </explicit>
         <explicit name="description" optional="YES">
            <typename name="text"/>
         </explicit>
         <explicit name="of_shape">
            <typename name="product_definition_shape_or_shape_aspect"/>
         </explicit>
         <explicit name="product_definitional">
            <builtintype type="LOGICAL"/>
         </explicit>
         <derived expression="get_id_value(SELF)" name="id">
            <typename name="identifier"/>
         </derived>
         <unique label="UR1">
            <unique.attribute attribute="id"/>
            <unique.attribute attribute="of_shape"/>
         </unique>
         <where expression="SIZEOF(USEDIN(SELF, 'BASIC_ATTRIBUTE_SCHEMA.' + 'ID_ATTRIBUTE.IDENTIFIED_ITEM')) &lt;= 1" label="WR1"/>
      </entity>
      <entity name="shape_aspect_occurrence" supertypes="shape_aspect">
         <explicit name="definition">
            <typename name="shape_aspect_or_characterized_object"/>
         </explicit>
         <where expression="acyclic_shape_aspect_occurrence(SELF,definition)" label="WR1"/>
      </entity>
      <entity name="shape_aspect_relationship">
         <explicit name="name">
            <typename name="label"/>
         </explicit>
         <explicit name="description" optional="YES">
            <typename name="text"/>
         </explicit>
         <explicit name="relating_shape_aspect">
            <typename name="shape_aspect"/>
         </explicit>
         <explicit name="related_shape_aspect">
            <typename name="shape_aspect"/>
         </explicit>
         <derived expression="get_id_value(SELF)" name="id">
            <typename name="identifier"/>
         </derived>
         <where expression="SIZEOF(USEDIN(SELF, 'BASIC_ATTRIBUTE_SCHEMA.' + 'ID_ATTRIBUTE.IDENTIFIED_ITEM')) &lt;= 1" label="WR1"/>
      </entity>
      <function name="acyclic_characterized_object_relationship">
         <parameter name="relation">
            <typename name="characterized_object_relationship"/>
         </parameter>
         <parameter name="relatives">
            <aggregate lower="1" type="SET" upper="?"/>
            <typename name="characterized_object"/>
         </parameter>
         <parameter name="specific_relation">
            <builtintype type="STRING"/>
         </parameter>
         <builtintype type="BOOLEAN"/>
         <algorithm>LOCAL
      x : SET OF characterized_object_relationship;
    END_LOCAL;

    IF relation.relating_object IN relatives THEN
      RETURN (FALSE);
    END_IF;
    x := QUERY(ca &lt;* bag_to_set(USEDIN(relation.relating_object, 'PRODUCT_PROPERTY_DEFINITION_SCHEMA.' + 'CHARACTERIZED_OBJECT_RELATIONSHIP.' + 'RELATED_OBJECT')) | specific_relation IN TYPEOF(ca));
    REPEAT i := 1 TO HIINDEX(x);
      IF NOT acyclic_characterized_object_relationship(x[i], relatives + relation.relating_object, specific_relation) THEN
        RETURN (FALSE);
      END_IF;
    END_REPEAT;
    RETURN (TRUE);</algorithm>
      </function>
      <function name="acyclic_general_property_relationship">
         <parameter name="relation">
            <typename name="general_property_relationship"/>
         </parameter>
         <parameter name="relatives">
            <aggregate lower="1" type="SET" upper="?"/>
            <typename name="general_property"/>
         </parameter>
         <parameter name="specific_relation">
            <builtintype type="STRING"/>
         </parameter>
         <builtintype type="BOOLEAN"/>
         <algorithm>LOCAL
      x : SET OF general_property_relationship;
    END_LOCAL;

    IF relation.relating_property IN relatives THEN
      RETURN (FALSE);
    END_IF;
    x := QUERY(genp &lt;* bag_to_set(USEDIN(relation.relating_property, 'PRODUCT_PROPERTY_DEFINITION_SCHEMA.' + 'GENERAL_PROPERTY_RELATIONSHIP.' + 'RELATED_PROPERTY')) | specific_relation IN TYPEOF(genp));
    REPEAT i := 1 TO HIINDEX(x);
      IF NOT acyclic_general_property_relationship(x[i], relatives + relation.relating_property, specific_relation) THEN
        RETURN (FALSE);
      END_IF;
    END_REPEAT;
    RETURN (TRUE);</algorithm>
      </function>
      <function name="acyclic_shape_aspect">
         <parameter name="sa">
            <typename name="shape_aspect"/>
         </parameter>
         <parameter name="of_shape">
            <typename name="shape_aspect_or_characterized_object"/>
         </parameter>
         <builtintype type="BOOLEAN"/>
         <algorithm>IF NOT  (('PRODUCT_PROPERTY_DEFINITION_SCHEMA.SHAPE_ASPECT') IN TYPEOF(of_shape)) THEN
      RETURN  (TRUE);
    END_IF;
    IF  (of_shape :=: sa) THEN
      RETURN  (FALSE);
    ELSE RETURN(acyclic_shape_aspect(sa, of_shape\shape_aspect.of_shape));
    END_IF;</algorithm>
      </function>
      <function name="acyclic_shape_aspect_occurrence">
         <parameter name="sao">
            <typename name="shape_aspect_occurrence"/>
         </parameter>
         <parameter name="definition">
            <typename name="shape_aspect_or_characterized_object"/>
         </parameter>
         <builtintype type="BOOLEAN"/>
         <algorithm>IF NOT  (('PRODUCT_PROPERTY_DEFINITION_SCHEMA.SHAPE_ASPECT_OCCURRENCE') IN TYPEOF(definition)) THEN
      RETURN  (TRUE);
    END_IF;
    IF  (definition :=: sao) THEN
      RETURN  (FALSE);
    ELSE RETURN(acyclic_shape_aspect_occurrence(sao, definition\shape_aspect_occurrence.definition));
    END_IF;</algorithm>
      </function>
      <function name="acyclic_shape_aspect_relationship">
         <parameter name="relation">
            <typename name="shape_aspect_relationship"/>
         </parameter>
         <parameter name="relatives">
            <aggregate lower="1" type="SET" upper="?"/>
            <typename name="shape_aspect"/>
         </parameter>
         <parameter name="specific_relation">
            <builtintype type="STRING"/>
         </parameter>
         <builtintype type="BOOLEAN"/>
         <algorithm>LOCAL
      x : SET OF shape_aspect_relationship;
    END_LOCAL;

    IF relation.relating_shape_aspect IN relatives THEN
      RETURN (FALSE);
    END_IF;
    x := QUERY(sa &lt;* bag_to_set(USEDIN(relation.relating_shape_aspect, 'PRODUCT_PROPERTY_DEFINITION_SCHEMA.' + 'SHAPE_ASPECT_RELATIONSHIP.' + 'RELATED_SHAPE_ASPECT')) | specific_relation IN TYPEOF(sa));
    REPEAT i := 1 TO HIINDEX(x);
      IF NOT acyclic_shape_aspect_relationship(x[i], relatives + relation.relating_shape_aspect, specific_relation) THEN
        RETURN (FALSE);
      END_IF;
    END_REPEAT;
    RETURN (TRUE);</algorithm>
      </function>
      <function name="get_shape_aspects">
         <parameter name="c_def_instance">
            <typename name="characterized_definition"/>
         </parameter>
         <aggregate lower="0" type="SET" upper="?"/>
         <typename name="shape_aspect"/>
         <algorithm>LOCAL
      pd_set : SET OF product_definition_shape := [];
      pdr_set : SET OF shape_aspect := [];
    END_LOCAL;

    pd_set := bag_to_set(QUERY(pd &lt;* USEDIN(c_def_instance, 'PRODUCT_PROPERTY_DEFINITION_SCHEMA.PROPERTY_DEFINITION.DEFINITION') | 'PRODUCT_PROPERTY_DEFINITION_SCHEMA.PRODUCT_DEFINITION_SHAPE' IN TYPEOF(pd)));
    IF (SIZEOF(pd_set) &lt; 1) THEN
      RETURN (pdr_set);
    END_IF;
    REPEAT i := 1 TO HIINDEX(pd_set);
      pdr_set := pdr_set + bag_to_set(USEDIN(pd_set[i], 'PRODUCT_PROPERTY_DEFINITION_SCHEMA.SHAPE_ASPECT.OF_SHAPE'));
    END_REPEAT;
    RETURN (pdr_set);</algorithm>
      </function>
   </schema>
</express>
