<?xml version='1.0' encoding='UTF-8'?>
<!-- $Id: express2xml.js,v 1.38 2004/08/24 16:58:55 thendrix Exp $ -->
<?xml-stylesheet type="text/xsl" href="../../../xsl/express.xsl"?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">
<express description.file="descriptions.xml" language_version="2" rcs.date="$Date: 2012/09/08 11:59:57 $" rcs.revision="$Revision: 1.12 $" reference="ISO 10303-42">
   <application name="JSDAI" owner="LKSoft" source="scan_data_3d_shape_model_schema schema_instance" url="www.lksoft.com" version="4.0 beta"/>
 
 <schema name="scan_data_3d_shape_model_schema">

    <interface
      kind="reference"
      schema="measure_schema">
      <interfaced.item
        name="global_unit_assigned_context"/>
      <interfaced.item
        name="positive_length_measure"/>
    </interface>
    <interface
      kind="reference"
      schema="representation_schema">
      <interfaced.item
        name="representation"/>
      <interfaced.item
        name="representation_item"/>
    </interface>
    <interface
      kind="reference"
      schema="product_property_representation_schema">
      <interfaced.item
        name="shape_representation"/>
    </interface>
    <interface
          kind="reference"
          schema="support_resource_schema">
          <interfaced.item
            name="label"/>
    </interface>
    <interface
      kind="reference"
      schema="geometry_schema">
      <interfaced.item
        name="axis2_placement_3d"/>
      <interfaced.item
        name="geometric_representation_item"/>
      <interfaced.item
        name="geometric_representation_context"/>
    </interface>
    <type name="point_cloud_set_or_superset">
      <select
        selectitems="point_cloud_dataset point_cloud_superdataset">
      </select>
    </type>

    
    <entity
      name="scanned_data_item"
       super.expression="ONEOF(point_cloud_dataset, point_cloud_superdataset, triangulated_point_cloud_dataset,scan_3d_model)"
      supertypes="geometric_representation_item">
    </entity>

    <entity
      name="point_cloud_dataset"
      supertypes="scanned_data_item">
   <explicit name="point_coordinates">
                          <aggregate lower="0" type="LIST" upper="?"/>
                          <aggregate lower="3" type="LIST" upper="3"/>
                          <builtintype type="REAL"/>
                    </explicit>
   
   </entity>

    <entity
      name="point_cloud_dataset_with_normals"
      supertypes="point_cloud_dataset">
      <explicit name="normals">
                             <aggregate lower="0" type="LIST" upper="?"/>
                             <aggregate lower="3" type="LIST" upper="3"/>
                             <builtintype type="REAL"/>
                    </explicit>
      <where
        label="WR1"
        expression="SIZEOF(normals) = SIZEOF(SELF\point_cloud_dataset.point_coordinates)"/>
      
    </entity>

    <entity
      name="point_cloud_dataset_with_colours"
      supertypes="point_cloud_dataset">
      <explicit name="colours">
                             <aggregate lower="0" type="LIST" upper="?"/>
                             <aggregate lower="3" type="LIST" upper="3"/>
                             <builtintype type="REAL"/>
                    </explicit>
      <where
        label="WR1"
        expression="SIZEOF(colours) = SIZEOF(SELF\point_cloud_dataset.point_coordinates)"/>
        </entity>

    <entity
      name="point_cloud_dataset_with_intensities"
      supertypes="point_cloud_dataset">
      <explicit
        name="intensities">
        <aggregate
          type="LIST"
          lower="1"
          upper="?"/>
        <builtintype
          type="REAL"/>
      </explicit>
      <where
        label="WR1"
        expression="SIZEOF(intensities) = SIZEOF(SELF\point_cloud_dataset.point_coordinates)"/>
          </entity>

    <entity
      name="point_cloud_superdataset"
      supertypes="scanned_data_item">
      <explicit name="pts_per_sublist">
                               <builtintype type="INTEGER"/>
                    </explicit>
      <explicit name="sublists">
                                   <aggregate lower="2" type="LIST" upper="?"/>
                                   <typename name="point_cloud_dataset"/>
                    </explicit>
      
      <where
        label="WR1"
        expression="consistent_sizes(SELF.pts_per_sublist, SELF.sublists)" />
        </entity>

    <entity
      name="triangulated_point_cloud_dataset"
      supertypes="scanned_data_item">
      <explicit
              name="points">
              <typename name="point_cloud_set_or_superset"/>
      </explicit>
      
      <explicit
        name="triangles">
        <aggregate
          type="LIST"
          lower="1"
          upper="?"/>
        <aggregate
	          type="LIST"
	          lower="3"
          upper="3"/>
        <builtintype
          type="INTEGER"/>
      </explicit>
    </entity>

    <entity
      name="scan_3d_model"
      supertypes="scanned_data_item">
      <explicit
        name="scanner_info">
         <aggregate
	          type="SET"
	          lower="1"
          upper="?"/>
        <typename name="scanner_property"/>
      </explicit>
      <explicit
       name="scanned_points">
       <aggregate
		          type="SET"
		          lower="1"
	          upper="?"/>
        <typename name="scanned_data_item"/>
          </explicit>
        <where expression="SIZEOF ( QUERY ( tmp &lt;* scanned_points | 'SCAN_DATA_3D_SHAPE_MODEL_SCHEMA.SCAN_3D_MODEL' IN TYPEOF ( tmp ) ) ) = 0" label="WR1"/>
         
    </entity>

   <entity
      name="scanner_property"
      abstract.supertype="YES"
      supertypes="representation_item">
    </entity>

    <entity
      name="scanner_basic_properties"
      supertypes="scanner_property">
      <explicit
        name="scanner_identification">
        <typename
          name="label"/>
      </explicit>
      <explicit
        name="scanner_location">
        <typename
          name="axis2_placement_3d"/>
      </explicit>
      <explicit
        name="scanner_uncertainty"
        optional="YES">
        <typename
          name="positive_length_measure"/>
      </explicit>
    </entity>

 
    <entity
          name="scan_data_shape_representation"
          supertypes="shape_representation">
        <explicit name="items">
                           <aggregate lower="1" type="SET" upper="?"/>
                           <typename name="scanned_data_item"/>
                           <redeclaration entity-ref="representation"/>
         </explicit>
        <where expression="'REPRESENTATION_SCHEMA.GLOBAL_UNIT_ASSIGNED_CONTEXT' IN&#10;        TYPEOF(SELF\representation.context_of_items)" label="WR1"/>
        </entity>
 
   
 
 
 <function
      name="consistent_sizes">
      <parameter
        name="max">
        <builtintype
          type="INTEGER"/>
      </parameter>
      <parameter
        name="point_lists">
        <aggregate
          type="LIST"/>
        <typename
          name="point_cloud_dataset"/>
      </parameter>
      <builtintype
        type="BOOLEAN"/>
      <algorithm>
LOCAL
ndatasets : INTEGER := SIZEOF(point_lists);
result: BOOLEAN := TRUE;
END_LOCAL;
REPEAT i := 1 TO (ndatasets - 1);
IF (SIZEOF(point_lists[i].point_coordinates) &lt;&gt; max) THEN
result := FALSE;
RETURN(result);
END_IF;
END_REPEAT;
IF (SIZEOF(point_lists[ndatasets].point_coordinates) &gt; max) THEN
result := FALSE;
RETURN(result);
END_IF;
RETURN(result);
      </algorithm>
    </function>

  </schema>
</express>
