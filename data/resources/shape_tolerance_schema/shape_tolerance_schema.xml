<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<?xml-stylesheet type="text/xsl" href="../../../xsl/express.xsl"?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">

<express description.file="descriptions.xml" language_version="2" rcs.date="$Date$" rcs.revision="$Revision$" reference="ISO 10303-47">
   <application name="JSDAI" owner="LKSoft" source="shape_tolerance_schema schema_instance" url="www.lksoft.com" version="4.0 beta"/>
   <schema name="shape_tolerance_schema">
      <interface kind="reference" schema="product_property_definition_schema">
         <interfaced.item name="product_definition_shape"/>
         <interfaced.item name="shape_aspect"/>
         <interfaced.item name="shape_aspect_relationship"/>
      </interface>
      <interface kind="reference" schema="product_property_representation_schema">
         <interfaced.item name="item_identified_representation_usage_definition"/>
      </interface>
      <interface kind="reference" schema="measure_schema">
         <interfaced.item name="derive_dimensional_exponents"/>
         <interfaced.item name="dimensional_exponents"/>
         <interfaced.item name="length_measure_with_unit"/>
         <interfaced.item name="measure_with_unit"/>
         <interfaced.item name="measure_value"/>
         <interfaced.item name="plane_angle_measure_with_unit"/>
      </interface>
      <interface kind="reference" schema="qualified_measure_schema">
         <interfaced.item name="measure_representation_item"/>
      </interface>
      <interface kind="reference" schema="representation_schema">
         <interfaced.item name="representation"/>
      </interface>
      <interface kind="reference" schema="support_resource_schema">
         <interfaced.item name="label"/>
         <interfaced.item name="text"/>
         <interfaced.item name="type_check_function"/>
      </interface>
      <interface kind="reference" schema="shape_aspect_definition_schema">
         <interfaced.item name="datum_reference"/>
         <interfaced.item name="datum_system"/>
         <interfaced.item name="limit_condition"/>
         <interfaced.item name="general_datum_reference"/>
      </interface>
      <interface kind="reference" schema="shape_dimension_schema">
         <interfaced.item name="dimensional_characteristic"/>
         <interfaced.item name="dimensional_location"/>
         <interfaced.item name="dimensional_size"/>
      </interface>
      <type name="area_unit_type">
         <enumeration extensible="YES" items="circular square rectangular"/>
      </type>
      <type name="datum_system_or_reference">
         <select extensible="NO" genericentity="NO" selectitems="datum_reference datum_system"/>
      </type>
      <type name="directed_tolerance_zone_type">
         <enumeration extensible="NO" items="perpendicular parallel including"/>
      </type>
      <type name="geometric_tolerance_modifier">
         <enumeration extensible="YES" items="maximum_material_requirement least_material_requirement reciprocity_requirement any_cross_section free_state common_zone minor_diameter major_diameter pitch_diameter line_element not_convex statistical_tolerance tangent_plane each_radial_element separate_requirement"/>
      </type>
      <type name="geometric_tolerance_target">
         <select extensible="NO" genericentity="NO" selectitems="dimensional_location dimensional_size product_definition_shape shape_aspect"/>
      </type>
      <type name="oriented_tolerance_zone_type">
         <enumeration extensible="NO" items="perpendicular parallel angular"/>
      </type>
      <type name="shape_tolerance_select">
         <select extensible="NO" genericentity="NO" selectitems="geometric_tolerance plus_minus_tolerance"/>
      </type>
      <type name="sts_item_identified_representation_usage_definition">
         <select basedon="item_identified_representation_usage_definition" extensible="YES" genericentity="YES" selectitems="geometric_tolerance"/>
      </type>
      <type name="tolerance_method_definition">
         <select extensible="NO" genericentity="NO" selectitems="limits_and_fits tolerance_value"/>
      </type>
      <type name="tolerance_zone_target">
         <select extensible="NO" genericentity="NO" selectitems="dimensional_location dimensional_size geometric_tolerance general_datum_reference"/>
      </type>
      <entity abstract.entity="NO" abstract.supertype="NO" name="angularity_tolerance" supertypes="geometric_tolerance_with_datum_reference"/>
      <entity abstract.entity="NO" abstract.supertype="NO" name="circular_runout_tolerance" supertypes="geometric_tolerance_with_datum_reference"/>
      <entity abstract.entity="NO" abstract.supertype="NO" name="coaxiality_tolerance" supertypes="geometric_tolerance_with_datum_reference"/>
      <entity abstract.entity="NO" abstract.supertype="NO" name="concentricity_tolerance" supertypes="geometric_tolerance_with_datum_reference"/>
      <entity abstract.entity="NO" abstract.supertype="NO" name="cylindricity_tolerance" supertypes="geometric_tolerance">
         <where expression="NOT ('SHAPE_TOLERANCE_SCHEMA.' + 'GEOMETRIC_TOLERANCE_WITH_DATUM_REFERENCE' IN TYPEOF (SELF))" label="WR1"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="dimension_related_tolerance_zone_element">
         <explicit name="related_dimension" optional="NO">
            <typename name="dimensional_location"/>
         </explicit>
         <explicit name="related_element" optional="NO">
            <typename name="tolerance_zone_definition"/>
         </explicit>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="directed_tolerance_zone" supertypes="tolerance_zone_with_datum">
         <explicit name="direction" optional="NO">
            <typename name="directed_tolerance_zone_type"/>
         </explicit>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="flatness_tolerance" supertypes="geometric_tolerance">
         <where expression="NOT ('SHAPE_TOLERANCE_SCHEMA.' + 'GEOMETRIC_TOLERANCE_WITH_DATUM_REFERENCE' IN TYPEOF (SELF))" label="WR1"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="YES" name="geometric_tolerance" super.expression="geometric_tolerance_with_datum_reference ANDOR geometric_tolerance_with_defined_unit ANDOR ONEOF (geometric_tolerance_with_modifiers, modified_geometric_tolerance) ANDOR unequally_disposed_geometric_tolerance ANDOR ONEOF (cylindricity_tolerance, flatness_tolerance, line_profile_tolerance, position_tolerance, roundness_tolerance, straightness_tolerance, surface_profile_tolerance)">
         <explicit name="name" optional="NO">
            <typename name="label"/>
         </explicit>
         <explicit name="description" optional="YES">
            <typename name="text"/>
         </explicit>
         <explicit name="magnitude" optional="YES">
            <typename name="length_measure_with_unit"/>
         </explicit>
         <explicit name="toleranced_shape_aspect" optional="NO">
            <typename name="geometric_tolerance_target"/>
         </explicit>
         <derived expression="sts_get_product_definition_shape(toleranced_shape_aspect)" name="controlling_shape">
            <typename name="product_definition_shape"/>
         </derived>
         <unique label="UR1">
            <unique.attribute attribute="name"/>
            <unique.attribute attribute="controlling_shape"/>
         </unique>
         <where expression="magnitude\measure_with_unit.value_component &gt;= 0.0" label="WR1"/>
         <where expression="EXISTS(controlling_shape)" label="WR2"/>
         <where expression="NOT ('PRODUCT_PROPERTY_DEFINITION_SCHEMA.SHAPE_ASPECT_RELATIONSHIP' IN TYPEOF(toleranced_shape_aspect))&#10;       OR (toleranced_shape_aspect\shape_aspect_relationship.relating_shape_aspect.of_shape :=:&#10;            toleranced_shape_aspect\shape_aspect_relationship.related_shape_aspect.of_shape)" label="WR3"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="geometric_tolerance_relationship">
         <explicit name="name" optional="NO">
            <typename name="label"/>
         </explicit>
         <explicit name="description" optional="NO">
            <typename name="text"/>
         </explicit>
         <explicit name="relating_geometric_tolerance" optional="NO">
            <typename name="geometric_tolerance"/>
         </explicit>
         <explicit name="related_geometric_tolerance" optional="NO">
            <typename name="geometric_tolerance"/>
         </explicit>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="geometric_tolerance_with_datum_reference" super.expression="ONEOF (angularity_tolerance, circular_runout_tolerance, coaxiality_tolerance, concentricity_tolerance, parallelism_tolerance, perpendicularity_tolerance, symmetry_tolerance, total_runout_tolerance)" supertypes="geometric_tolerance">
         <explicit name="datum_system" optional="NO">
            <aggregate lower="1" optional="NO" type="SET" unique="NO" upper="?"/>
            <typename name="datum_system_or_reference"/>
         </explicit>
         <where expression="(SIZEOF(QUERY(ds &lt;* datum_system | 'SHAPE_TOLERANCE_SCHEMA.' + 'DATUM_SYSTEM' in TYPEOF(ds)))=0) OR (SIZEOF(datum_system)=1)" label="WR1"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="geometric_tolerance_with_defined_area_unit" supertypes="geometric_tolerance_with_defined_unit">
         <explicit name="area_type" optional="NO">
            <typename name="area_unit_type"/>
         </explicit>
         <explicit name="second_unit_size" optional="YES">
            <typename name="length_measure_with_unit"/>
         </explicit>
         <where expression="NOT (EXISTS(second_unit_size) XOR (area_type = rectangular))" label="WR1"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="geometric_tolerance_with_defined_unit" supertypes="geometric_tolerance">
         <explicit name="unit_size" optional="NO">
            <typename name="length_measure_with_unit"/>
         </explicit>
         <where expression="('NUMBER' IN TYPEOF (unit_size\measure_with_unit.value_component)) AND (unit_size\measure_with_unit.value_component &gt; 0.0)" label="WR1"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="geometric_tolerance_with_maximum_tolerance" supertypes="geometric_tolerance_with_modifiers">
         <explicit name="maximum_upper_tolerance" optional="NO">
            <typename name="length_measure_with_unit"/>
         </explicit>
         <where expression="(geometric_tolerance_modifier.maximum_material_requirement IN SELF\geometric_tolerance_with_modifiers.modifiers) OR (geometric_tolerance_modifier.least_material_requirement IN SELF\geometric_tolerance_with_modifiers.modifiers)" label="WR1"/>
         <where expression="(maximum_upper_tolerance\measure_with_unit.unit_component = SELF\geometric_tolerance.magnitude\measure_with_unit.unit_component) AND (maximum_upper_tolerance\measure_with_unit.value_component &gt; SELF\geometric_tolerance.magnitude\measure_with_unit.value_component)" label="WR2"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="geometric_tolerance_with_modifiers" supertypes="geometric_tolerance">
         <explicit name="modifiers" optional="NO">
            <aggregate lower="1" optional="NO" type="SET" unique="NO" upper="?"/>
            <typename name="geometric_tolerance_modifier"/>
         </explicit>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="limits_and_fits">
         <explicit name="form_variance" optional="NO">
            <typename name="label"/>
         </explicit>
         <explicit name="zone_variance" optional="NO">
            <typename name="label"/>
         </explicit>
         <explicit name="grade" optional="NO">
            <typename name="label"/>
         </explicit>
         <explicit name="source" optional="NO">
            <typename name="text"/>
         </explicit>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="line_profile_tolerance" supertypes="geometric_tolerance"/>
      <entity abstract.entity="NO" abstract.supertype="NO" name="modified_geometric_tolerance" supertypes="geometric_tolerance">
         <explicit name="modifier" optional="NO">
            <typename name="limit_condition"/>
         </explicit>
      <where label="IP1"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="non_uniform_zone_definition" supertypes="tolerance_zone_definition"/>
      <entity abstract.entity="NO" abstract.supertype="NO" name="oriented_tolerance_zone" supertypes="tolerance_zone_with_datum">
         <explicit name="orientation" optional="NO">
            <typename name="oriented_tolerance_zone_type"/>
         </explicit>
         <explicit name="angle" optional="YES">
            <typename name="plane_angle_measure_with_unit"/>
         </explicit>
         <where expression="(orientation &lt;&gt; angular) XOR EXISTS(angle)" label="WR1"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="parallelism_tolerance" supertypes="geometric_tolerance_with_datum_reference"/>
      <entity abstract.entity="NO" abstract.supertype="NO" name="perpendicularity_tolerance" supertypes="geometric_tolerance_with_datum_reference"/>
      <entity abstract.entity="NO" abstract.supertype="NO" name="plus_minus_tolerance">
         <explicit name="range" optional="NO">
            <typename name="tolerance_method_definition"/>
         </explicit>
         <explicit name="toleranced_dimension" optional="NO">
            <typename name="dimensional_characteristic"/>
         </explicit>
         <unique label="UR1">
            <unique.attribute attribute="toleranced_dimension"/>
         </unique>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="position_tolerance" supertypes="geometric_tolerance"/>
      <entity abstract.entity="NO" abstract.supertype="NO" name="projected_zone_definition" supertypes="tolerance_zone_definition">
         <explicit name="projection_end" optional="NO">
            <typename name="shape_aspect"/>
         </explicit>
         <explicit name="projected_length" optional="NO">
            <typename name="length_measure_with_unit"/>
         </explicit>
         <where expression="('NUMBER' IN TYPEOF (projected_length\measure_with_unit.value_component)) AND (projected_length\measure_with_unit.value_component &gt; 0.0)" label="WR1"/>
         <where expression="(derive_dimensional_exponents (projected_length\measure_with_unit.unit_component)= dimensional_exponents(1,0,0,0,0,0,0))" label="WR2"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="projected_zone_definition_with_offset" supertypes="projected_zone_definition">
         <explicit name="offset" optional="NO">
            <typename name="length_measure_with_unit"/>
         </explicit>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="roundness_tolerance" supertypes="geometric_tolerance">
         <where expression="NOT ('SHAPE_TOLERANCE_SCHEMA.' + 'GEOMETRIC_TOLERANCE_WITH_DATUM_REFERENCE' IN TYPEOF (SELF))" label="WR1"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="runout_zone_definition" supertypes="tolerance_zone_definition">
         <explicit name="orientation" optional="NO">
            <typename name="runout_zone_orientation"/>
         </explicit>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="runout_zone_orientation">
         <explicit name="angle" optional="NO">
            <typename name="plane_angle_measure_with_unit"/>
         </explicit>
      <where label="IP1"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="runout_zone_orientation_reference_direction" supertypes="runout_zone_orientation">
         <explicit name="orientation_defining_relationship" optional="NO">
            <typename name="shape_aspect_relationship"/>
         </explicit>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="statistical_distribution_for_tolerance" supertypes="representation">
         <where expression="SIZEOF (QUERY (item &lt;* SELF\representation.items | NOT ('QUALIFIED_MEASURE_SCHEMA.MEASURE_REPRESENTATION_ITEM' IN TYPEOF (item)))) = 0" label="WR1"/>
      <where label="IP1"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="straightness_tolerance" supertypes="geometric_tolerance">
         <where expression="NOT ('SHAPE_TOLERANCE_SCHEMA.' + 'GEOMETRIC_TOLERANCE_WITH_DATUM_REFERENCE' IN TYPEOF (SELF))" label="WR1"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="surface_profile_tolerance" supertypes="geometric_tolerance"/>
      <entity abstract.entity="NO" abstract.supertype="NO" name="symmetry_tolerance" supertypes="geometric_tolerance_with_datum_reference"/>
      <entity abstract.entity="NO" abstract.supertype="NO" name="tolerance_value">
         <explicit name="lower_bound" optional="NO">
            <typename name="measure_with_unit"/>
         </explicit>
         <explicit name="upper_bound" optional="NO">
            <typename name="measure_with_unit"/>
         </explicit>
         <derived expression="upper_bound\measure_with_unit.value_component" name="ubvc">
            <builtintype fixed="NO" type="REAL"/>
         </derived>
         <derived expression="lower_bound\measure_with_unit.value_component" name="lbvc">
            <builtintype fixed="NO" type="REAL"/>
         </derived>
         <where expression="ubvc &gt; lbvc" label="WR1"/>
         <where expression="upper_bound\measure_with_unit.unit_component = lower_bound\measure_with_unit.unit_component" label="WR2"/>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="tolerance_with_statistical_distribution">
         <explicit name="associated_tolerance" optional="NO">
            <typename name="shape_tolerance_select"/>
         </explicit>
         <explicit name="tolerance_allocation" optional="NO">
            <typename name="statistical_distribution_for_tolerance"/>
         </explicit>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="tolerance_zone" supertypes="shape_aspect">
         <explicit name="defining_tolerance" optional="NO">
            <aggregate lower="1" optional="NO" type="SET" unique="NO" upper="?"/>
            <typename name="tolerance_zone_target"/>
         </explicit>
         <explicit name="form" optional="NO">
            <typename name="tolerance_zone_form"/>
         </explicit>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="tolerance_zone_definition" super.expression="ONEOF (projected_zone_definition, non_uniform_zone_definition, runout_zone_definition)">
         <explicit name="zone" optional="NO">
            <typename name="tolerance_zone"/>
         </explicit>
         <explicit name="boundaries" optional="NO">
            <aggregate lower="0" optional="NO" type="SET" unique="NO" upper="?"/>
            <typename name="shape_aspect"/>
         </explicit>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="tolerance_zone_form">
         <explicit name="name" optional="NO">
            <typename name="label"/>
         </explicit>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="tolerance_zone_with_datum" super.expression="ONEOF (directed_tolerance_zone, oriented_tolerance_zone)" supertypes="tolerance_zone">
         <explicit name="datum_reference" optional="NO">
            <typename name="datum_system"/>
         </explicit>
      </entity>
      <entity abstract.entity="NO" abstract.supertype="NO" name="total_runout_tolerance" supertypes="geometric_tolerance_with_datum_reference"/>
      <entity abstract.entity="NO" abstract.supertype="NO" name="unequally_disposed_geometric_tolerance" supertypes="geometric_tolerance">
         <explicit name="displacement" optional="NO">
            <typename name="length_measure_with_unit"/>
         </explicit>
         <where expression="('NUMBER' IN TYPEOF (SELF\geometric_tolerance_with_defined_unit.unit_size\measure_with_unit.value_component)) AND (SELF\geometric_tolerance_with_defined_unit.unit_size\measure_with_unit.value_component &gt; 0.0)" label="WR1"/>
      </entity>
      <rule appliesto="geometric_tolerance" name="subtype_exclusiveness_geometric_tolerance">
         <where expression="SIZEOF(QUERY (gt &lt;* geometric_tolerance | NOT (type_check_function(gt, ['SHAPE_TOLERANCE_SCHEMA.ANGULARITY_TOLERANCE', 'SHAPE_TOLERANCE_SCHEMA.CIRCULAR_RUNOUT_TOLERANCE', 'SHAPE_TOLERANCE_SCHEMA.COAXIALITY_TOLERANCE', 'SHAPE_TOLERANCE_SCHEMA.CONCENTRICITY_TOLERANCE', 'SHAPE_TOLERANCE_SCHEMA.CYLINDRICITY_TOLERANCE', 'SHAPE_TOLERANCE_SCHEMA.FLATNESS_TOLERANCE', 'SHAPE_TOLERANCE_SCHEMA.LINE_PROFILE_TOLERANCE', 'SHAPE_TOLERANCE_SCHEMA.PARALLELISM_TOLERANCE', 'SHAPE_TOLERANCE_SCHEMA.PERPENDICULARITY_TOLERANCE', 'SHAPE_TOLERANCE_SCHEMA.POSITION_TOLERANCE', 'SHAPE_TOLERANCE_SCHEMA.ROUNDNESS_TOLERANCE', 'SHAPE_TOLERANCE_SCHEMA.STRAIGHTNESS_TOLERANCE', 'SHAPE_TOLERANCE_SCHEMA.SURFACE_PROFILE_TOLERANCE', 'SHAPE_TOLERANCE_SCHEMA.SYMMETRY_TOLERANCE', 'SHAPE_TOLERANCE_SCHEMA.TOTAL_RUNOUT_TOLERANCE'] , 2 ) ))) = 0" label="WR1"/>
      </rule>
      <function name="sts_get_product_definition_shape">
         <parameter name="input">
            <typename name="geometric_tolerance_target"/>
         </parameter>
         <typename name="product_definition_shape"/>
         <algorithm>CASE TRUE OF ('SHAPE_DIMENSION_SCHEMA.DIMENSIONAL_LOCATION' IN TYPEOF(input)) : 
                 RETURN(input\shape_aspect_relationship.relating_shape_aspect\shape_aspect.of_shape);
               ('SHAPE_DIMENSION_SCHEMA.DIMENSIONAL_SIZE' IN TYPEOF(input)) : 
                 RETURN(input\dimensional_size.applies_to\shape_aspect.of_shape);
               ('PRODUCT_PROPERTY_DEFINITION_SCHEMA.PRODUCT_DEFINITION_SHAPE' IN TYPEOF(input)) : 
                 RETURN(input);
               ('PRODUCT_PROPERTY_DEFINITION_SCHEMA.SHAPE_ASPECT' IN TYPEOF(input)) : 
                 RETURN(input\shape_aspect.of_shape);
  OTHERWISE : RETURN(?);
  END_CASE;</algorithm>
      </function>
   </schema>
</express>
