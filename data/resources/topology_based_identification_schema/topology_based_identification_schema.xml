<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<?xml-stylesheet type="text/xsl" href="../../../xsl/express.xsl"?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">

<express description.file="descriptions.xml" language_version="2" rcs.date="$Date: 2017/02/06 13:45:10 $" rcs.revision="$Revision: 1.2 $" reference="ISO 10303-57">
   <application name="JSDAI" owner="LKSoft" source="topology_based_identification_schema schema_instance" url="www.lksoft.com" version="4.0 beta"/>
   <schema name="topology_based_identification_schema">
      <interface kind="reference" schema="geometry_schema">
         <interfaced.item name="cartesian_point"/>
         <interfaced.item name="geometric_representation_item"/>
      </interface>
      <interface kind="reference" schema="topology_schema">
         <interfaced.item name="closed_shell"/>
         <interfaced.item name="edge_curve"/>
		 <interfaced.item name="face"/>
         <interfaced.item name="face_surface"/>
		 <interfaced.item name="list_shell_faces"/>
      </interface>
      <interface kind="reference" schema="geometric_model_schema">
         <interfaced.item name="extruded_face_solid"/>
		 <interfaced.item name="manifold_solid_brep"/>
		 <interfaced.item name="msb_shells"/>
		 <interfaced.item name="revolved_face_solid"/>
		 <interfaced.item name="solid_model"/>
      </interface>
      <interface kind="reference" schema="sketch_schema">
         <interfaced.item name="positioned_sketch"/>
      </interface>
      <interface kind="reference" schema="solid_shape_element_schema">
         <interfaced.item name="edge_blended_solid"/>
		 <interfaced.item name="extruded_face_solid_with_trim_conditions"/>
		 <interfaced.item name="offset_face_solid"/>
		 <interfaced.item name="revolved_face_solid_with_trim_conditions"/>
		 <interfaced.item name="sculptured_solid"/>
		 <interfaced.item name="shelled_solid"/>
		 <interfaced.item name="solid_with_chamfered_edges"/>
		 <interfaced.item name="solid_with_circular_pattern"/>
		 <interfaced.item name="solid_with_general_pocket"/>
		 <interfaced.item name="solid_with_general_protrusion"/>
		 <interfaced.item name="solid_with_rectangular_pattern"/>
		 <interfaced.item name="solid_with_stepped_round_hole"/>
		 <interfaced.item name="thickened_face_solid"/>
      </interface>
      <type name="role_of_created_extrusion_face">
         <enumeration items="initial lateral terminal"/>
      </type>
      <type name="face_shape">
         <enumeration items="planar cylindrical conical spherical"/>
      </type>
      <type name="profile_type_select">
         <select selectitems="face_surface positioned_sketch"/>
      </type>
      <entity abstract.supertype="YES" name="basic_face_identification" super.expression="ONEOF (imported_face_identification, profile_based_feature_identification, hole_feature_identification, transition_feature_identification, shell_feature_identification, offset_feature_identification, trimmed_feature_identification, pattern_feature_identification, face_surface_based_feature_identification)" supertypes="geometric_representation_item">
         <explicit name="containing_model">
            <typename name="solid_model"/>
         </explicit>
      </entity>
	  <entity name="imported_face_identification" supertypes="basic_face_identification">
         <explicit name="containing_model">
			<typename name="manifold_solid_brep"/>
            <redeclaration entity-ref="basic_face_identification"/>
         </explicit>
		 <explicit name="imported_face">
            <typename name="face_surface"/>
         </explicit>
         <where expression="face_in_brep(imported_face, SELF\basic_face_identification.containing_model)" label="WR1"/>
      </entity>
      <entity abstract.supertype="YES" name="profile_based_feature_identification" super.expression="ONEOF (extrude_feature_identification, revolve_feature_identification)" supertypes="basic_face_identification">
         <explicit name="surface_instance">
            <typename name="profile_type_select"/>
         </explicit>
         <explicit name="edge_segment" optional="YES">
            <typename name="edge_curve"/>
         </explicit>
		 <explicit name="face_creation_type">
            <typename name="role_of_created_extrusion_face"/>
         </explicit>
		 <where expression="NOT (('SKETCH_SCHEMA.POSITIONED_SKETCH' IN	TYPEOF(surface_instance)) AND NOT ('TOPOLOGY_SCHEMA.FACE_SURFACE' IN TYPEOF(surface_instance.sketch_basis)))" label="WR1"/>
      </entity>
      <entity name="extrude_feature_identification" supertypes="profile_based_feature_identification">
         <where expression="SIZEOF(TYPEOF(SELF\basic_face_identification.containing_model) * ['GEOMETRIC_MODEL_SCHEMA.EXTRUDED_FACE_SOLID',	'SOLID_SHAPE_ELEMENT_SCHEMA.SOLID_WITH_GENERAL_POCKET',	'SOLID_SHAPE_ELEMENT_SCHEMA.SOLID_WITH_GENERAL_PROTRUSION']) = 1" label="WR1"/>
      </entity>
      <entity name="revolve_feature_identification" supertypes="profile_based_feature_identification">
         <explicit name="containing_model">
			<typename name="revolved_face_solid"/>
            <redeclaration entity-ref="basic_face_identification"/>
         </explicit>
      </entity>
	  <entity name="hole_feature_identification" supertypes="basic_face_identification">
         <explicit name="containing_model">
			<typename name="solid_with_stepped_round_hole"/>
            <redeclaration entity-ref="basic_face_identification"/>
         </explicit>
         <explicit name="face_order">
            <builtintype type="INTEGER"/>
         </explicit>
         <explicit name="identified_face_shape">
            <typename name="face_shape"/>
         </explicit>
         <where expression="face_order >= 1" label="WR1"/>
      </entity>
	  <entity abstract.supertype="YES" name="transition_feature_identification" super.expression="ONEOF (edge_blend_feature_identification, chamfer_feature_identification)" supertypes="basic_face_identification">
         <explicit name="adjacent_face_identifications">
            <aggregate lower="2" type="LIST" upper="?" unique="YES"/>
            <typename name="basic_face_identification"/>
         </explicit>
	  </entity>
	  <entity name="edge_blend_feature_identification" supertypes="transition_feature_identification">
         <explicit name="containing_model">
			<typename name="edge_blended_solid"/>
            <redeclaration entity-ref="basic_face_identification"/>
         </explicit>
      </entity>
	  <entity name="chamfer_feature_identification" supertypes="transition_feature_identification">
         <explicit name="containing_model">
			<typename name="solid_with_chamfered_edges"/>
            <redeclaration entity-ref="basic_face_identification"/>
         </explicit>
      </entity>
	  <entity name="shell_feature_identification" supertypes="basic_face_identification">
         <explicit name="containing_model">
			<typename name="shelled_solid"/>
            <redeclaration entity-ref="basic_face_identification"/>
         </explicit>
		 <explicit name="opposite_face_identification">
            <typename name="basic_face_identification"/>
         </explicit>
      </entity>
	  <entity name="offset_feature_identification" supertypes="basic_face_identification">
         <explicit name="containing_model">
			<typename name="offset_face_solid"/>
            <redeclaration entity-ref="basic_face_identification"/>
         </explicit>
		 <explicit name="offset_face_identification">
            <typename name="basic_face_identification"/>
         </explicit>
      </entity>
	  <entity name="trimmed_feature_identification" supertypes="basic_face_identification">
         <explicit name="trimmed_face_identification">
            <typename name="basic_face_identification"/>
         </explicit>
		 <where expression="SIZEOF(TYPEOF(SELF\basic_face_identification.containing_model) * ['SOLID_SHAPE_ELEMENT_SCHEMA.EXTRUDED_FACE_SOLID_WITH_TRIM_CONDITIONS', 'SOLID_SHAPE_ELEMENT_SCHEMA.REVOLVED_FACE_SOLID_WITH_TRIM_CONDITIONS']) = 1" label="WR1"/>
      </entity>
	  <entity abstract.supertype="YES" name="face_surface_based_feature_identification" super.expression="ONEOF (sculpture_feature_identification, thicken_feature_identification)" supertypes="basic_face_identification">
         <explicit name="target_face">
            <typename name="face_surface"/>
         </explicit>
	  </entity>
	  <entity name="sculpture_feature_identification" supertypes="face_surface_based_feature_identification">
         <explicit name="containing_model">
			<typename name="sculptured_solid"/>
            <redeclaration entity-ref="basic_face_identification"/>
         </explicit>
      </entity>
	  <entity name="thicken_feature_identification" supertypes="face_surface_based_feature_identification">
         <explicit name="containing_model">
			<typename name="thickened_face_solid"/>
            <redeclaration entity-ref="basic_face_identification"/>
         </explicit>
		 <explicit name="edge_segment" optional="YES">
            <typename name="edge_curve"/>
         </explicit>
		 <explicit name="face_creation_type">
            <typename name="role_of_created_extrusion_face"/>
         </explicit>
      </entity>
      <entity abstract.supertype="YES" name="pattern_feature_identification" super.expression="ONEOF (rectangular_pattern_feature_identification, circular_pattern_feature_identification)" supertypes="basic_face_identification">
         <explicit name="target_face_identification">
            <typename name="basic_face_identification"/>
         </explicit>
      </entity>
	  <entity name="rectangular_pattern_feature_identification" supertypes="pattern_feature_identification">
         <explicit name="containing_model">
			<typename name="solid_with_rectangular_pattern"/>
            <redeclaration entity-ref="basic_face_identification"/>
         </explicit>
		 <explicit name="row_inst_order">
            <builtintype type="INTEGER"/>
         </explicit>
         <explicit name="col_inst_order">
            <builtintype type="INTEGER"/>
         </explicit>
		 <where expression="(row_inst_order &gt; 0) AND (row_inst_order &lt;= SELF\basic_face_identification.containing_model\solid_with_rectangular_pattern.row_count)" label="WR1"/>
		 <where expression="(col_inst_order &gt; 0) AND (col_inst_order &lt;= SELF\basic_face_identification.containing_model\solid_with_rectangular_pattern.column_count)" label="WR2"/>
      </entity>
	  <entity name="circular_pattern_feature_identification" supertypes="pattern_feature_identification">
         <explicit name="containing_model">
			<typename name="solid_with_circular_pattern"/>
            <redeclaration entity-ref="basic_face_identification"/>
         </explicit>
         <explicit name="ang_inst_order">
            <builtintype type="INTEGER"/>
         </explicit>
		 <where expression="(ang_inst_order &gt; 0) AND (ang_inst_order &lt;= SELF\basic_face_identification.containing_model\solid_with_circular_pattern.replicate_count)" label="WR1"/>
      </entity>
	  <entity abstract.supertype="YES" name="ambiguity_resolution" super.expression="ONEOF (split_element_information, merged_element_information)" supertypes="geometric_representation_item"/>
	  <entity name="split_element_information" supertypes="ambiguity_resolution">
         <explicit name="split_elements_number">
            <builtintype type="INTEGER"/>
         </explicit>
         <explicit name="element_order">
            <builtintype type="INTEGER"/>
         </explicit>
		 <explicit name="reference_point">
			<typename name="cartesian_point"/>
         </explicit>
		 <where expression="split_elements_number &gt;= 2" label="WR1"/>
		 <where expression="(element_order &gt; 0) AND (element_order &lt;= split_elements_number)" label="WR2"/>
      </entity>
	  <entity name="merged_element_information" supertypes="ambiguity_resolution">
         <explicit name="merged_elements_number">
            <builtintype type="INTEGER"/>
         </explicit>
         <explicit name="merged_element_identifications">
            <aggregate lower="1" type="LIST" upper="?" unique="YES"/>
            <typename name="basic_face_identification"/>
         </explicit>
      </entity>
	  <entity abstract.supertype="YES" name="topology_based_element_identification" super.expression="ONEOF (topology_based_face_identification, topology_based_edge_identification, topology_based_vertex_identification)" supertypes="geometric_representation_item"/>
	  <entity name="topology_based_face_identification" supertypes="topology_based_element_identification">
         <explicit name="face_basic_identification">
            <typename name="basic_face_identification"/>
         </explicit>
         <explicit name="face_SEI" optional="YES">
            <typename name="split_element_information"/>
         </explicit>
         <explicit name="face_MEI" optional="YES">
            <typename name="merged_element_information"/>
         </explicit>
      </entity>
      <entity name="topology_based_edge_identification" supertypes="topology_based_element_identification">
         <explicit name="left_adjacent_face">
            <typename name="topology_based_face_identification"/>
         </explicit>
         <explicit name="right_adjacent_face">
            <typename name="topology_based_face_identification"/>
         </explicit>
         <explicit name="edge_SEI" optional="YES">
            <typename name="split_element_information"/>
         </explicit>
      </entity>
      <entity name="topology_based_vertex_identification" supertypes="topology_based_element_identification">
         <explicit name="adjacent_faces">
            <aggregate lower="1" type="LIST" upper="?"/>
            <typename name="topology_based_face_identification"/>
         </explicit>
         <explicit name="vertex_SEI" optional="YES">
            <typename name="split_element_information"/>
         </explicit>
      </entity>
      <entity name="user_selected_topology_element" supertypes="geometric_representation_item">
         <explicit name="querying_topology_identification">
            <typename name="topology_based_element_identification"/>
         </explicit>
      </entity>
	  <function name="face_in_brep">
         <parameter name="test_face">
            <typename name="face"/>
         </parameter>
		 <parameter name="brep">
            <typename name="manifold_solid_brep"/>
         </parameter>
         <builtintype type="BOOLEAN"/>
         <algorithm>LOCAL
  shells : SET[1 : ?] OF closed_shell := msb_shells(brep);
  faces : LIST[0 : ?] OF face := [];
  i, j : INTEGER;
  result : BOOLEAN := FALSE;
END_LOCAL;
REPEAT i := 1 TO SIZEOF(shells);
  faces := list_shell_faces(shells[i]);
  REPEAT j := 1 TO SIZEOF(faces); 
    IF (test_face :=: faces[j]) THEN
      result := TRUE;
    END_IF;
  END_REPEAT;
END_REPEAT;
RETURN(result);</algorithm>
      </function>
   </schema>
</express>
