<?xml version='1.0' encoding='UTF-8'?>
<!-- $Id: express2xml.js,v 1.38 2004/08/24 16:58:55 thendrix Exp $ -->
<?xml-stylesheet type="text/xsl" href="../../../xsl/express.xsl"?>
<!DOCTYPE express SYSTEM "../../../dtd/express.dtd">
<express
  language_version="2"
  reference="ISO 10303-108"
  rcs.date="$Date: $"
  rcs.revision="$Revision: $">

  <application
    name="express2xml2.js"
    owner="Eurostep Limited"
    url="http://www.eurostep.com"
    version="1.38"
    source="variational_representation_schema.exp"/>

  <schema name="variational_representation_schema">

    <interface
      kind="reference"
      schema="geometry_schema">
      <interfaced.item
        name="geometric_representation_item"/>
    </interface>
    <interface
      kind="reference"
      schema="representation_schema">
      <interfaced.item
        name="representation"/>
      <interfaced.item
        name="representation_item"/>
      <interfaced.item
        name="representation_relationship"/>
      <interfaced.item
        name="using_representations"/>
    </interface>
    <interface
      kind="reference"
      schema="parameterization_schema">
      <interfaced.item
        name="bound_model_parameter"/>
      <interfaced.item
        name="fixed_instance_attribute_set"/>
      <interfaced.item
        name="instance_attribute_reference"/>
      <interfaced.item
        name="unbound_model_parameter"/>
    </interface>
    <interface
      kind="reference"
      schema="explicit_constraint_schema">
      <interfaced.item
        name="explicit_constraint"/>
      <interfaced.item
        name="free_form_constraint"/>
    </interface>
    <interface
      kind="reference"
      schema="explicit_geometric_constraint_schema">
      <interfaced.item
        name="explicit_geometric_constraint"/>
    </interface>
    <interface
      kind="reference"
      schema="ISO13584_generic_expressions_schema">
      <interfaced.item
        name="generic_variable"/>
    </interface>
    <entity
      name="variational_representation_item"
      abstract.supertype="YES"
      super.expression="(auxiliary_geometric_representation_item)"
      supertypes="representation_item">
      <where
        label="WR1"
        expression="SIZEOF(QUERY(q &lt;* using_representations(SELF) | NOT ('VARIATIONAL_REPRESENTATION_SCHEMA.VARIATIONAL_REPRESENTATION' IN TYPEOF(q)))) = 0">
      </where>
      <where
        label="WR2"
        expression="SIZEOF(QUERY(q &lt;* using_representations(SELF) | NOT (SELF IN q.items))) = 0">
      </where>
    </entity>

    <entity
      name="auxiliary_geometric_representation_item"
      supertypes="geometric_representation_item variational_representation_item">
    </entity>

    <entity
      name="variational_representation"
      supertypes="representation">
      <inverse
        name="cm_link"
        entity="variational_current_representation_relationship"
        attribute="rep_1">
      </inverse>
      <where
        label="WR1"
        expression="SIZEOF(QUERY(q &lt;* SELF\representation.items |'VARIATIONAL_REPRESENTATION_SCHEMA.VARIATIONAL_REPRESENTATION_ITEM' IN TYPEOF(q))) &gt; 0">
      </where>
      <where
        label="WR2"
        expression="SIZEOF(QUERY(q &lt;* (SELF\representation.items - cm_link.rep_2.items) | invalidate_vrep_item(q))) = 0">
      </where>
    </entity>

    <entity
      name="variational_current_representation_relationship"
      supertypes="representation_relationship">
      <explicit
        name="rep_1">
        <typename
          name="variational_representation"/>
        <redeclaration
          entity-ref="representation_relationship"/>
        </explicit>
        <explicit
          name="current_result">
          <typename
            name="representation"/>
        </explicit>
        <unique
          label="UR1">
          <unique.attribute
            attribute="current_result"/>
        </unique>
        <where
          label="WR1"
          expression="QUERY(q &lt;* SELF\representation_relationship.rep_1.items | NOT('VARIATIONAL_REPRESENTATION_SCHEMA.VARIATIONAL_REPRESENTATION_ITEM' IN TYPEOF(q))) = SELF\representation_relationship.rep_2.items">
        </where>
        <where
          label="WR2"
          expression="SELF\representation_relationship.rep_1.context_of_items :=: SELF\representation_relationship.rep_2.context_of_items">
        </where>
        <where
          label="WR3"
          expression="SIZEOF(QUERY(q &lt;* SELF\representation_relationship.rep_2.items |'VARIATIONAL_REPRESENTATION_SCHEMA.VARIATIONAL_REPRESENTATION_ITEM' IN TYPEOF(q))) = 0">
        </where>
        <where
          label="WR4"
          expression="TYPEOF(SELF\representation_relationship.rep_1) - TYPEOF(SELF\representation_relationship.rep_2) =['VARIATIONAL_REPRESENTATION_SCHEMA.VARIATIONAL_REPRESENTATION']">
        </where>
        <where
          label="WR5"
          expression="current_result :=: SELF\representation_relationship.rep_2">
        </where>
      </entity>

      <function
        name="invalidate_vrep_item">
        <parameter
          name="item">
          <typename
            name="variational_representation_item"/>
        </parameter>
        <builtintype
          type="BOOLEAN"/>
        <algorithm>
LOCAL
reps : SET[1:?] OF representation := using_representations(item);
svri : SET[1:?] OF variational_representation_item;
iar : instance_attribute_reference;
i : INTEGER;
n : INTEGER := HIINDEX(reps);
END_LOCAL;
IF ('PARAMETERIZATION_SCHEMA.BOUND_MODEL_PARAMETER' IN TYPEOF(item))
THEN
IF 'PARAMETERIZATION_SCHEMA.INSTANCE_ATTRIBUTE_REFERENCE'
IN TYPEOF(item\generic_variable.interpretation.semantics)
THEN
BEGIN
iar := item\generic_variable.interpretation.semantics;
IF (reps &lt;&gt; using_representations(iar.owning_instance))
THEN
RETURN(TRUE);
END_IF;
END;
ELSE RETURN(TRUE);
END_IF;
END_IF;
IF ('PARAMETERIZATION_SCHEMA.UNBOUND_MODEL_PARAMETER' IN TYPEOF(item))
THEN
BEGIN
REPEAT i := 1 TO n;
svri := QUERY(q &lt;* reps[i].items |
'EXPLICIT_CONSTRAINT_SCHEMA.FREE_FORM_CONSTRAINT' IN TYPEOF(q));
IF SIZEOF(QUERY(r &lt;* svri |
item IN (r.reference_elements + r.constrained_elements))) = 0
THEN
RETURN(TRUE);
END_IF;
END_REPEAT;
END;
END_IF;
IF ('PARAMETERIZATION_SCHEMA.FIXED_INSTANCE_ATTRIBUTE_SET'
IN TYPEOF(item))
THEN
REPEAT i := 1 TO SIZEOF(item.fixed_attributes);
IF (reps &lt;&gt; using_representations(item.fixed_attributes[i]))
THEN
RETURN(TRUE);
END_IF;
END_REPEAT;
END_IF;
IF ('EXPLICIT_CONSTRAINT_SCHEMA.EXPLICIT_CONSTRAINT' IN TYPEOF(item))
THEN
IF SIZEOF(QUERY(q &lt;*
(item.reference_elements + item.constrained_elements) |
reps &lt;&gt; using_representations(q))) &gt; 0
THEN
RETURN(TRUE);
END_IF;
END_IF;
IF ('VARIATIONAL_REPRESENTATION_SCHEMA.AUXILIARY_GEOMETRIC_REPRESENTATION_ITEM' IN TYPEOF(item))
THEN
BEGIN
REPEAT i := 1 TO n;
svri := QUERY(q &lt;* reps[i].items |
'EXPLICIT_GEOMETRIC_CONSTRAINT_SCHEMA.EXPLICIT_GEOMETRIC_CONSTRAINT' IN TYPEOF(q));
IF SIZEOF(QUERY(r &lt;* svri |
item IN r.reference_elements)) = 0
THEN
RETURN(TRUE);
END_IF;
END_REPEAT;
END;
END_IF;
RETURN(FALSE);
        </algorithm>
      </function>

    </schema>
  </express>
