<?xml version="1.0" encoding="utf-8"?>
<!--  $Id: build.xsl,v 1.46 2013/03/11 23:53:48 mikeward Exp $
Author:  Rob Bodington, Eurostep Limited
Owner:   Developed by Eurostep Limited http://www.eurostep.com and supplied to NIST under contract.
Purpose: To build the initial ANT publication file. 
-->
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
	xmlns:exslt="http://exslt.org/common" exclude-result-prefixes="exslt" version="1.0">

	<xsl:import href="../../xsl/ap_doc/common.xsl"/>
	<xsl:import href="../../xsl/res_doc/common.xsl"/>
	<!-- BOM -->
	<xsl:import href="../../xsl/bom_doc/common.xsl"/>

	<xsl:output method="xml" indent="yes"/>

	<xsl:variable name="mim_modules">
		<xsl:call-template name="get_mod_node_set"/>
	</xsl:variable>


	<xsl:variable name="mim_modules_node_set" select="exslt:node-set($mim_modules)"/>

	<xsl:variable name="dlongforms">
		<xsl:apply-templates select="$mim_modules_node_set/module" mode="long_form"/>
	</xsl:variable>


	<xsl:variable name="LOWER" select="'abcdefghijklmnopqrstuvwxyz_'"/>
	<xsl:variable name="UPPER" select="'ABCDEFGHIJKLMNOPQRSTUVWXYZ'"/>
	
	<xsl:variable name="depbompresent">
		<xsl:variable name="ap_name" select="//publication_index/application_protocols/ap_doc/@name"/>
		<xsl:variable name="ap_doc_path" select="concat('../../data/application_protocols/', $ap_name, '/application_protocol.xml')"/>
		<xsl:variable name="bom_name" select="document(string($ap_doc_path))//application_protocol/@business_object_model"/>
		<xsl:choose>
			<xsl:when test="string-length($bom_name) > 0">
				<xsl:value-of select="'YES'"/>
			</xsl:when>
			<xsl:otherwise>
				<xsl:value-of select="'NO'"/>
			</xsl:otherwise>
		</xsl:choose>
	</xsl:variable>
	
	

	<xsl:template match="publication_index">

		<xsl:variable name="index_ok1">
			<xsl:apply-templates select="." mode="check_single"/>
		</xsl:variable>

		<xsl:variable name="index_ok2">
			<xsl:apply-templates select="." mode="check"/>
		</xsl:variable>

		<xsl:choose>
			<!-- dont check to see if a pure build
		   <xsl:when test="contains($index_ok1,'false') or contains($index_ok2,'false')"> -->
			<xsl:when test="''">
				<xsl:message> ************************************************************ ABORTING
					THE BUILD The file publication_index.xml is referencing modules, resource
					document or APs that have errors
					************************************************************ </xsl:message>
			</xsl:when>
			<xsl:otherwise>
				<!-- output the build.xml file -->
				<xsl:text>
		</xsl:text>
				<xsl:comment> This file has been auto generated by: ant -buildfile buildbuild.xml
					${START_TIME} </xsl:comment>

				<!-- 
			 note the use of xsl:extension-element-prefixes to prevent the
			 output of the names space
		-->
				<project xsl:extension-element-prefixes="exslt" name="iso_publication" default="all"
					basedir="../../..">
					<xsl:text>
					</xsl:text>
					
					<xsl:apply-templates select="." mode="target_variables"/>
					<xsl:apply-templates select="." mode="target_init"/>
					<xsl:apply-templates select="." mode="target_isoindex"/>
					<!-- See: http://locke.dcnicn.com/bugzilla/iso10303/show_bug.cgi?id=3786#c1
		  	<xsl:apply-templates select="." mode="target_normref_check"/>-->
					<xsl:apply-templates select="." mode="target_finish"/>
					<xsl:apply-templates select="." mode="target_resources"/>
					<xsl:if test="./modules/module">
						<xsl:apply-templates select="." mode="target_isomodules"/>
						<xsl:apply-templates select="." mode="target_publish_isomodules"/>
					</xsl:if>
					<xsl:if test="./application_protocols/ap_doc">
						<xsl:apply-templates select="." mode="target_isoapdocs"/>
						<xsl:apply-templates select="." mode="target_publish_isoapdocs"/>
					</xsl:if>
					<xsl:if test="./resource_docs/res_doc">
						<xsl:apply-templates select="." mode="target_isoresdocs"/>
						<xsl:apply-templates select="." mode="target_publish_isoresdocs"/>
					</xsl:if>

					<!-- STAND ALONE BOM -->
					<xsl:if test="./business_object_models/bom_doc">
						<xsl:apply-templates select="." mode="target_isobomdocs"/>
						<xsl:apply-templates select="." mode="target_publish_isobomdocs"/>
					</xsl:if>
					<xsl:apply-templates select="." mode="target_all"/>
				</project>
			</xsl:otherwise>
		</xsl:choose>
	</xsl:template>


	<!-- generate the target "variables" -->
	<xsl:template match="publication_index" mode="target_variables">
		<xsl:element name="target">
			<xsl:attribute name="name">variables</xsl:attribute>
			<xsl:attribute name="description">initialize variables</xsl:attribute>
			<tstamp>
				<format property="START_TIME" pattern="EEE, d MMM yyyy HH:mm:ss"/>
				<format property="PUB_DATE" pattern="yyyy-MM-dd"/>
			</tstamp>
			<echo> Publication started: ${START_TIME} </echo>


			<input message="Have you created  CVS tag for the modules (y/n)?"
				addproperty="do.continue"/>
			<condition property="do.abort">
				<xsl:element name="equals">
					<xsl:attribute name="arg1">n</xsl:attribute>
					<xsl:attribute name="arg2">${do.continue}</xsl:attribute>
				</xsl:element>
			</condition>
			<fail if="do.abort"> ------------------------------------------------------------ You
				need to tag the repository before publishing the modules.
				------------------------------------------------------------ </fail>

			<input message="Enter CVS tag " addproperty="CVS_tag"/>

			<echo> The CVS tag is: ${CVS_tag} </echo>
			<input message="Is this correct (y/n)?" addproperty="do.continue1"/>
			<condition property="do.abort1">
				<xsl:element name="equals">
					<xsl:attribute name="arg1">n</xsl:attribute>
					<xsl:attribute name="arg2">${do.continue1}</xsl:attribute>
				</xsl:element>

			</condition>
			<fail if="do.abort1"> ------------------------------------------------------------ Enter
				the correct values for the CVS tag and module edition
				------------------------------------------------------------ </fail>

			<xsl:element name="property">
				<xsl:attribute name="name">PUBLICATION</xsl:attribute>
				<xsl:attribute name="value">YES</xsl:attribute>
			</xsl:element>

			<xsl:element name="property">
				<xsl:attribute name="name">PUBDIR</xsl:attribute>
				<xsl:attribute name="value">
					<xsl:value-of select="concat('publication/isopub/',@name)"/>
				</xsl:attribute>
			</xsl:element>

			<xsl:element name="property">
				<xsl:attribute name="name">SC4COVERDIR</xsl:attribute>
				<xsl:attribute name="value">
					<xsl:value-of select="concat('publication/isopub/',@name, '/sc4covers')"/>
				</xsl:attribute>
			</xsl:element>

			<xsl:element name="property">
				<xsl:attribute name="name">TMPDIR</xsl:attribute>
				<xsl:attribute name="value">
					<xsl:value-of select="concat('publication/isopub/',@name,'/tmp')"/>
				</xsl:attribute>
			</xsl:element>

			<xsl:element name="property">
				<xsl:attribute name="name">ISOMENU</xsl:attribute>
				<xsl:attribute name="value">
					<xsl:value-of
						select="concat('./publication/publication/',@name,'/menubar_iso.xml')"/>
				</xsl:attribute>
			</xsl:element>

			<xsl:element name="property">
				<xsl:attribute name="name">PUBSRCDIR</xsl:attribute>
				<xsl:attribute name="value">
					<xsl:value-of select="concat('publication/publication/',@name)"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="property">
				<xsl:attribute name="name">PUBSRCDTD</xsl:attribute>
				<xsl:attribute name="value">publication/dtd</xsl:attribute>
			</xsl:element>
			<xsl:element name="property">
				<xsl:attribute name="name">PUBSRCSTYLES</xsl:attribute>
				<xsl:attribute name="value">publication/xsl</xsl:attribute>
			</xsl:element>


			<xsl:element name="property">
				<xsl:attribute name="name">APDOCS_INLINE_ERRORS</xsl:attribute>
				<xsl:attribute name="value">'yes'</xsl:attribute>
			</xsl:element>
			<xsl:element name="property">
				<xsl:attribute name="name">MODULES_INLINE_ERRORS</xsl:attribute>
				<xsl:attribute name="value">'yes'</xsl:attribute>
			</xsl:element>
			<xsl:element name="property">
				<xsl:attribute name="name">DEPMODULES_INLINE_ERRORS</xsl:attribute>
				<xsl:attribute name="value">'yes'</xsl:attribute>
			</xsl:element>
			<xsl:element name="property">
				<xsl:attribute name="name">OUTPUT_RCS</xsl:attribute>
				<xsl:attribute name="value">NO</xsl:attribute>
			</xsl:element>
			<xsl:element name="property">
				<xsl:attribute name="name">OUTPUT_ISSUES</xsl:attribute>
				<xsl:attribute name="value">NO</xsl:attribute>
			</xsl:element>

			<xsl:element name="property">
				<xsl:attribute name="name">STEPMOD_DATA_MODULES</xsl:attribute>
				<xsl:attribute name="value">
					<xsl:value-of select="'../../../../data/modules/'"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="property">
				<xsl:attribute name="name">STEPMOD_DATA_APS</xsl:attribute>
				<xsl:attribute name="value">
					<xsl:value-of select="'../../../../data/application_protocol/'"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="property">
				<xsl:attribute name="name">STEPMOD_DATA_RESOURCES</xsl:attribute>
				<xsl:attribute name="value">
					<xsl:value-of select="'../../../../data/resources/'"/>
				</xsl:attribute>
			</xsl:element>

			<!-- STAND ALONE BOM -->
			<xsl:element name="property">
				<xsl:attribute name="name">STEPMOD_DATA_BOMS</xsl:attribute>
				<xsl:attribute name="value">
					<xsl:value-of select="'../../../../data/business_object_models/'"/>
				</xsl:attribute>
			</xsl:element>

			<xsl:element name="property">
				<xsl:attribute name="name">STEPMODSTYLES</xsl:attribute>
				<xsl:attribute name="value">xsl</xsl:attribute>
			</xsl:element>

			<xsl:element name="property">
				<xsl:attribute name="name">STEPMODDTDDIR</xsl:attribute>
				<xsl:attribute name="value">dtd</xsl:attribute>
			</xsl:element>

			<xsl:element name="property">
				<xsl:attribute name="name">DATE</xsl:attribute>
				<xsl:attribute name="value">
					<xsl:value-of select="'${DSTAMP}'"/>
				</xsl:attribute>
			</xsl:element>

			<!-- assumption that if the AP document is specified, then all the
		   modules are part of that document -->
			<xsl:if test="./application_protocols">
				<xsl:apply-templates select="." mode="dependent_mod_res_variables"/>
				<!-- BOM -->
				<xsl:if test="$depbompresent='YES'">
					<xsl:apply-templates select="." mode="dependent_bom_doc_variables">
					<xsl:with-param name="bom_doc_param">
						<xsl:variable name="ap_name" select="./application_protocols/ap_doc/@name"/>
						<xsl:variable name="ap_doc_path"
							select="concat('../../data/application_protocols/', $ap_name, '/application_protocol.xml')"/>
						<xsl:value-of
							select="document(string($ap_doc_path))//application_protocol/@business_object_model"
						/>
					</xsl:with-param>
				</xsl:apply-templates>
				</xsl:if>
				
				<xsl:apply-templates select="." mode="apdoc_variables"/>
			</xsl:if>

			<xsl:if test="./modules">
				<xsl:apply-templates select="." mode="dependent_mod_res_variables"/>
				<xsl:apply-templates select="." mode="modules_variables"/>
			</xsl:if>

			<xsl:if test="./resource_docs">
				<xsl:apply-templates select="." mode="dependent_res_doc_variables"/>
				<xsl:apply-templates select="." mode="resdoc_variables"/>
			</xsl:if>

			<!-- STAND ALONE BOM -->
			<xsl:if test="./business_object_models">
				<xsl:apply-templates select="." mode="bomdoc_variables"/>
			</xsl:if>

		</xsl:element>


	</xsl:template>


	<!-- variables for building the module -->
	<xsl:template match="publication_index" mode="modules_variables">


		<xsl:element name="property">
			<xsl:attribute name="name">MODULES</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/**/*.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">CONTENTSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/contents.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">SCOPEXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/1_scope.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">REFSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/2_refs.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DEFSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/3_defs.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">INFOREQSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/4_info_reqs.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">MAINXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/5_main.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">REFDATAXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/6_refdata.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">MAPPINGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/5_mapping.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">MIMXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/5_mim.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">INDEXXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/index.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">ABSTRACTXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/abstract.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">ASHORTNAMESXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/a_short_names.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOBJREGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/b_obj_reg.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BIBLIOXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/biblio.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">MODINDEXXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/modindex.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">CARMEXPGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/c_arm_expg.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">COVERXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/cover.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">COVERHTM</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/cover.htm'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>


		<xsl:element name="property">
			<xsl:attribute name="name">ISOCOVERXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/isocover.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">ISOCOVERHTM</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/isocover.htm'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>


		<xsl:element name="property">
			<xsl:attribute name="name">DMIMEXPGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/d_mim_expg.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">EEXPXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/e_exp.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">EEXPARMXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/e_exp_arm.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">EEXPARMLFXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="long_form">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/e_exp_arm_lf.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">EEXPMIMXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/e_exp_mim.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">EEXPMIMLFXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="long_form">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/e_exp_mim_lf.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">FGUIDEXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/f_guide.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">GCHANGEXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/g_change.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">FOREWORDXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/foreword.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">INTRODUCTIONXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/introduction.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">ARMDESCRIPTIONSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/arm_descriptions.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">MIMDESCRIPTIONSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/mim_descriptions.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">ARMEXPGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/armexpg*.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">MIMEXPGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/mimexpg*.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">ARMEXPXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/arm.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">ARMLFEXPXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/arm_lf.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>



		<xsl:element name="property">
			<xsl:attribute name="name">MIMEXPXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/mim.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">MIMLFEXPXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/mim_lf.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">EXPRESS</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/*.exp'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">GIFS</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/*.gif'"/>
					<xsl:with-param name="terminate" select="'NO'"/>
				</xsl:apply-templates>
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/*.png'"/>
					<xsl:with-param name="terminate" select="'NO'"/>
				</xsl:apply-templates>
				<xsl:apply-templates select="modules/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/*.jpg'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>
		<xsl:text>
	</xsl:text>
	</xsl:template>

	<!-- variables for building the AP documents -->
	<xsl:template match="publication_index" mode="apdoc_variables">
		<xsl:element name="property">
			<xsl:attribute name="name">APDIR</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:value-of
					select="concat('data/application_protocols/',./application_protocols/ap_doc/@name)"
				/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCS</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/**/*.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APXSL</xsl:attribute>
			<xsl:attribute name="value">xsl/ap_doc</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCGIFS</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/*.gif</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCJPEGS</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/*.jpeg</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCJPGS</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/*.jpg</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCPNGS</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/*.png</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCSHOMEXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/home.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCSAAMIDEFXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/aamidef*.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCSDATAPLANXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/data_plan_*.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCSCOPEXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/1_scope.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCREFSXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/2_refs.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCDEFSXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/3_defs.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINFOREQSXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/4_info_reqs.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCMAINXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/5_main.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCCCSXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/6_ccs.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCCCSARMTABLEXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/6_ccs_arm_table.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCCCSMIMTABLEXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/6_ccs_mim_table.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCANNEXAAM</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/annex_aam.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCABSTRACT</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/abstract.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCANNEXARMEXPGXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/annex_arm_expg.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCANNEXMIMEXPGXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/annex_mim_expg.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCANNEXCHANGESXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/annex_changes.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCANNEXCOMP</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/annex_comp_int.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCANNEXEXPLFXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/annex_exp_lf.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCANNEXGUIDEXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/annex_guide.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCANNEXIMPMETHXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/annex_imp_meth.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCANNEXOBJREGXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/annex_obj_reg.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCANNEXPICSXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/annex_pics.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCANNEXSHORTNAMESXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/annex_shortnames.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCANNEXTECHDISCXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/annex_tech_disc.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCBIBLIOXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/biblio.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCCONTENTSXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/contents.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXAPDOCXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_apdoc.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCCOVERXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/cover.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCCOVERHTM</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/cover.htm</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCISOCOVERXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/isocover.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCISOCOVERHTM</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/isocover.htm</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCFOREWORDXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/foreword.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCFRAMEAPTITLEXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/frame_aptitle.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCFRAMECONTENTTITLEXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/frame_contenttitle.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCFRAMEINDEXXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/frame_index.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCFRAMETOCXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/frame_toc.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCFRAMETOCSHORTXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/frame_toc_short.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCHELPXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/help.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">INDEXARMEXPRESSNAVXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_arm_express_nav.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">INDEXARMEXPRESSNAVINNERXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_arm_express_nav_inner.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">INDEXARMEXPRESSNAVTOPXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_arm_express_nav_top.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXARMEXPRESSXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_arm_express.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXARMEXPRESSINNERXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_arm_express_inner.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXARMEXPRESSTOPXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_arm_express_top.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXARMMAPPINGSXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_arm_mappings.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXARMMAPPINGSINNERXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_arm_mappings_inner.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXARMMAPPINGSTOP</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_arm_mappings_top.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXARMMODULES</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_arm_modules.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXARMMODULESINNER</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_arm_modules_inner.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXARMMODULESINNERPART</xsl:attribute>
			<xsl:attribute name="value"
				>${APDIR}/sys/index_arm_modules_inner_part.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXARMMODULESTOP</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_arm_modules_top.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXMIMEXPRESS</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_mim_express.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXMIMEXPRESSINNERXML</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_mim_express_inner.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXMIMEXPRESSTOP</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_mim_express_top.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXMIMMODULES</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_mim_modules.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXMIMMODULESINNER</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_mim_modules_inner.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXMIMMODULESINNERPART</xsl:attribute>
			<xsl:attribute name="value"
				>${APDIR}/sys/index_mim_modules_inner_part.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXMIMMODULESTOP</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_mim_modules_top.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXRESOURCES</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_resources.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXRESOURCESINNER</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_resources_inner.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXRESOURCESINNERPART</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_resources_inner_part.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINDEXRESOURCESTOP</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/index_resources_top.xml</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">APDOCINTRODUCTION</xsl:attribute>
			<xsl:attribute name="value">${APDIR}/sys/introduction.xml</xsl:attribute>
		</xsl:element>
	</xsl:template>

	<!-- variables for building the resource documents -->
	<xsl:template match="publication_index" mode="resdoc_variables">
		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCGIFS</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/*.exp'"/>
					<xsl:with-param name="terminate" select="'NO'"/>
				</xsl:apply-templates>
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/*.gif'"/>
					<xsl:with-param name="terminate" select="'NO'"/>
				</xsl:apply-templates>
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/*.png'"/>
					<xsl:with-param name="terminate" select="'NO'"/>
				</xsl:apply-templates>
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/*.jpg'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCINDEXXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/resdocindex.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCABSTRACTXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/abstract.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCCONTENTSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/contents.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCS</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/**/*.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCSCOPEXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/1_scope.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCRESDOCINDEXXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/resdocindex.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCREFSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/2_refs.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCDEFSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/3_defs.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>


		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCMAINXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/main.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCSCHEMAXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/*_schema.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCASHORTNAMESXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/a_short_names.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCBOBJREGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/b_obj_reg.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCBIBLIOXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/biblio.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCISOCOVERXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/isocover.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCCOVERXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/cover.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCCOVERHTM</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/cover.htm'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCISOCOVERHTM</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/isocover.htm'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCCEXPSCHEMAXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/c_exp_schema_*.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCCEXPXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/c_exp.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCDEXPGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/d_expg.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCTECHDISCUSSIONXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/tech_discussion.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCEXAMPLESXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/examples.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCCHANGEXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/g_change.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCADDSCOPE</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/add_scope.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCFOREWORDXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/foreword.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCINTRODUCTIONXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/sys/introduction.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCDESCRIPTIONSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resources/'"/>
					<xsl:with-param name="suffix" select="'/descriptions.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCSCHEMADIAGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="resource_docs/res_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/resource_docs/'"/>
					<xsl:with-param name="suffix" select="'/schema_diagexpg*.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:variable name="resdoc_file"
			select="concat('../../data/resource_docs/',resource_docs/res_doc/@name,'/resource.xml')"/>
		<xsl:variable name="resdoc_xml" select="document($resdoc_file)"/>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCRESOURCESSCHEMAEXPGXMLS</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$resdoc_xml//schema" mode="list">
					<xsl:with-param name="prefix" select="'data/resources/'"/>
					<xsl:with-param name="suffix" select="'expg*.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESDOCRESOURCESSCHEMAEXPGGIFS</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$resdoc_xml//schema" mode="list">
					<xsl:with-param name="prefix" select="'data/resources/'"/>
					<xsl:with-param name="suffix" select="'expg*.gif'"/>
					<xsl:with-param name="terminate" select="'NO'"/>
				</xsl:apply-templates>
				<xsl:apply-templates select="$resdoc_xml//schema" mode="list">
					<xsl:with-param name="prefix" select="'data/resources/'"/>
					<xsl:with-param name="suffix" select="'expg*.png'"/>
					<xsl:with-param name="terminate" select="'NO'"/>
				</xsl:apply-templates>
				<xsl:apply-templates select="$resdoc_xml//schema" mode="list">
					<xsl:with-param name="prefix" select="'data/resources/'"/>
					<xsl:with-param name="suffix" select="'expg*.jpg'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>
	</xsl:template>

	<!-- STAND ALONE BOM -->
	<!-- variables for building the business object models -->
	<xsl:template match="publication_index" mode="bomdoc_variables">

		<xsl:element name="property">
			<xsl:attribute name="name">BOMDOCDIR</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:value-of
					select="concat('data/business_object_models/',./business_object_models/bom_doc/@name)"
				/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMDOCS</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/**/*.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOM1SCOPEXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/1_scope.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOM2REFSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/2_refs.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOM3DEFSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/3_defs.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOM4INFOREQSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/4_info_reqs.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOM5MAINXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/5_main.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMANNEXEXPGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/annex_bom_expg.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMANNEXUMLXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/annex_bom_uml.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMANNEXCOMPINTXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/annex_comp_int.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>
		
		<xsl:element name="property">
			<xsl:attribute name="name">BOMBOMXSDXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/bom_xsd.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>
		
		<xsl:element name="property">
			<xsl:attribute name="name">BOMCONFIGXSDXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/config_xsd.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMANNEXOBJREGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/annex_obj_reg.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMANNEXXSDDERXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/annex_xsd_der.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMBIBLIOXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/biblio.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>


		<xsl:element name="property">
			<xsl:attribute name="name">BOMINDEXXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/bomindex.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMCONTENTSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/contents.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMCOVERXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/cover.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMFOREWORDXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/foreword.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<!-- MIKE: file not built in stepmod/utils/build.xml boms -->
		<xsl:element name="property">
			<xsl:attribute name="name">BOMFRAMEBOMTITLE</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/frame_title.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMFRAMETITLE</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/frame_title.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMFRAMETOC</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/frame_toc.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<!-- MIKE: file not built in stepmod/utils/build.xml boms -->
		<xsl:element name="property">
			<xsl:attribute name="name">BOMHELP</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/help.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<!-- MIKE: file not built in stepmod/utils/build.xml boms -->
		<xsl:element name="property">
			<xsl:attribute name="name">INDEXBOMEXPRESS</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/index_bom_express.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<!-- MIKE: file not built in stepmod/utils/build.xml boms -->
		<xsl:element name="property">
			<xsl:attribute name="name">INDEXBOMEXPRESSINNER</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/index_bom_express_inner.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<!-- MIKE: file not built in stepmod/utils/build.xml boms -->
		<xsl:element name="property">
			<xsl:attribute name="name">INDEXBOMEXPRESSNAV</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/index_bom_express_nav.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<!-- MIKE: file not built in stepmod/utils/build.xml boms -->
		<xsl:element name="property">
			<xsl:attribute name="name">INDEXBOMEXPRESSNAVINNER</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/index_bom_express_nav_inner.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<!-- MIKE: file not built in stepmod/utils/build.xml boms -->
		<xsl:element name="property">
			<xsl:attribute name="name">INDEXBOMEXPRESSNAVTOP</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/index_bom_express_nav_top.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<!-- MIKE: file not built in stepmod/utils/build.xml boms -->
		<xsl:element name="property">
			<xsl:attribute name="name">INDEXBOMEXPRESSTOP</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/index_bom_express_top.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<!-- MIKE: file not built in stepmod/utils/build.xml boms -->
		<xsl:element name="property">
			<xsl:attribute name="name">INDEXBOMMAPPINGINNER</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/index_bom_mapping_inner.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<!-- MIKE: file not built in stepmod/utils/build.xml boms -->
		<xsl:element name="property">
			<xsl:attribute name="name">INDEXBOMMAPPINGTOP</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/index_bom_mapping_top.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<!-- MIKE: file not built in stepmod/utils/build.xml boms -->
		<xsl:element name="property">
			<xsl:attribute name="name">INDEXBOMDOC</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/index_bomdoc.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<!-- MIKE: file not built in stepmod/utils/build.xml boms -->
		<xsl:element name="property">
			<xsl:attribute name="name">INDEXBOMMMAPPRINGS</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/index_bom_mappings.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMINTRODUCTIONXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/introduction.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMISOCOVERXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/isocover.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMISOCOVERHTM</xsl:attribute>
			<xsl:attribute name="value">${BOMDOCDIR}/sys/isocover.htm</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/bom.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>


		<xsl:element name="property">
			<xsl:attribute name="name">BOMHOMEXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/home.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMDESCRIPTIONSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/bom_descriptions.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMEXPGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/bomexpg*.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMANNEXCOMPINTXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/annex_comp_int.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>
		
	

		<xsl:element name="property">
			<xsl:attribute name="name">BOMABSTRACTXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/abstract.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="property">
			<xsl:attribute name="name">BOMEXPRESS</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/*.exp'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">BOMXSD</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/bom.xsd'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>
		
		<xsl:element name="property">
			<xsl:attribute name="name">P28CONFIGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/p28_config.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>
		
		

		<xsl:element name="property">
			<xsl:attribute name="name">BOMGIFS</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/*.gif'"/>
					<xsl:with-param name="terminate" select="'NO'"/>
				</xsl:apply-templates>
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/*.png'"/>
					<xsl:with-param name="terminate" select="'NO'"/>
				</xsl:apply-templates>
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/*.PNG'"/>
					<xsl:with-param name="terminate" select="'NO'"/>
				</xsl:apply-templates>
				<xsl:apply-templates select="business_object_models/bom_doc" mode="list">
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/*.jpg'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>


		<xsl:text>
	</xsl:text>
	</xsl:template>

	<!-- EMBEDDED BOM -->
	<!-- variables for building the dependent/embedded business object models -->
	<xsl:template match="publication_index" mode="dependent_bom_doc_variables">
		<xsl:param name="bom_doc_param"/>
		<xsl:element name="property">
			<xsl:attribute name="name">DBOMDOCDIR</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:value-of select="concat('data/business_object_models/', $bom_doc_param)"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMDOCS</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/**/*.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOM1SCOPEXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/1_scope.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOM2REFSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/2_refs.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOM3DEFSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/3_defs.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOM4INFOREQSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/4_info_reqs.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOM5MAINXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/5_main.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMANNEXEXPGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/annex_bom_expg.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMANNEXUMLXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/annex_bom_uml.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMANNEXCOMPINTXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/annex_comp_int.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMBOMXSDXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/bom_xsd.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>
		
		<xsl:element name="property">
			<xsl:attribute name="name">DBOMCONFIGXSDXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/config_xsd.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMANNEXOBJREGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/annex_obj_reg.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMANNEXXSDDERXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/annex_xsd_der.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMBIBLIOXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/biblio.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>


		<xsl:element name="property">
			<xsl:attribute name="name">DBOMINDEXXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/bomindex.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMCONTENTSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/contents.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMCOVERXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/cover.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMFOREWORDXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/foreword.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMFRAMETITLE</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/frame_title.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMFRAMETOC</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/frame_toc.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>
		
		<xsl:element name="property">
			<xsl:attribute name="name">DINDEXBOMDOC</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/index_bomdoc.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMINTRODUCTIONXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/introduction.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMISOCOVERXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/isocover.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMISOCOVERHTM</xsl:attribute>
			<xsl:attribute name="value">${DBOMDOCDIR}/sys/isocover.htm</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/bom.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>


		<xsl:element name="property">
			<xsl:attribute name="name">DBOMHOMEXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/home.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMDESCRIPTIONSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/bom_descriptions.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMEXPGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/bomexpg*.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMANNEXCOMPINTXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/annex_comp_int.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMABSTRACTXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/sys/abstract.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>
		
		<xsl:element name="property">
			<xsl:attribute name="name">DBOMEXPRESS</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/*.exp'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMXSD</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/bom.xsd'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>
		
		<xsl:element name="property">
			<xsl:attribute name="name">DP28CONFIGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/p28_config.xml'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DBOMGIFS</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/*.gif'"/>
					<xsl:with-param name="terminate" select="'NO'"/>
				</xsl:call-template>
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/*.png'"/>
					<xsl:with-param name="terminate" select="'NO'"/>
				</xsl:call-template>
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/*.PNG'"/>
					<xsl:with-param name="terminate" select="'NO'"/>
				</xsl:call-template>
				<xsl:call-template name="embedded_bom_doc">
					<xsl:with-param name="bom_doc_param" select="$bom_doc_param"/>
					<xsl:with-param name="prefix" select="'data/business_object_models/'"/>
					<xsl:with-param name="suffix" select="'/*.jpg'"/>
				</xsl:call-template>
			</xsl:attribute>
		</xsl:element>


		<xsl:text>
	</xsl:text>
	</xsl:template>


	<!-- generate the target "isoindex" -->
	<xsl:template match="publication_index" mode="target_isoindex">
		<xsl:text>
	</xsl:text>
		<target name="isoindex" depends="init" description="Create HTML index">
			<dependset>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${PUBSRCDTD}'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'**/*.dtd, **/*.ent'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${PUBSRCSTYLES}'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'**/*.xsl'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${PUBSRCDIR}'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'**/*.xml'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="targetfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${PUBSRCDIR}/*.htm*'"/>
					</xsl:attribute>
				</xsl:element>
			</dependset>

			<xsl:element name="xslt">
				<xsl:attribute name="in">
					<xsl:value-of select="'${PUBSRCDIR}/sys/publication_summary.xml'"/>
				</xsl:attribute>
				<xsl:attribute name="out">
					<xsl:value-of select="'${PUBDIR}/index.htm'"/>
				</xsl:attribute>
				<xsl:attribute name="destdir">
					<xsl:value-of select="'${PUBDIR}'"/>
				</xsl:attribute>
				<xsl:attribute name="extension">
					<xsl:value-of select="'.htm'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${PUBSRCSTYLES}/publication_summary.xsl'"/>
				</xsl:attribute>
				<param name="output_type" expression="HTM"/>
				<param name="stepmodhome" expression="."/>
				<xsl:element name="param">
					<xsl:attribute name="name">
						<xsl:value-of select="'date'"/>
					</xsl:attribute>
					<xsl:attribute name="expression">
						<xsl:value-of select="'${DATE}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="in">
					<xsl:value-of select="'${PUBSRCDIR}/publication_index.xml'"/>
				</xsl:attribute>
				<xsl:attribute name="out">
					<xsl:value-of select="'${PUBDIR}/readme.txt'"/>
				</xsl:attribute>
				<xsl:attribute name="destdir">
					<xsl:value-of select="'${PUBDIR}'"/>
				</xsl:attribute>
				<xsl:attribute name="extension">
					<xsl:value-of select="'.txt'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${PUBSRCSTYLES}/publication_readme.xsl'"/>
				</xsl:attribute>
				<xsl:element name="param">
					<xsl:attribute name="name">
						<xsl:value-of select="'date'"/>
					</xsl:attribute>
					<xsl:attribute name="expression">
						<xsl:value-of select="'${DATE}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>

			<!-- make sure that the CR/LF are windows for the readme -->
			<xsl:element name="fixcrlf">
				<xsl:attribute name="srcdir">
					<xsl:value-of select="concat('publication/isopub/',@name)"/>
				</xsl:attribute>
				<xsl:attribute name="includes">
					<xsl:value-of select="'readme.txt'"/>
				</xsl:attribute>
				<xsl:attribute name="eol">
					<xsl:value-of select="'crlf'"/>
				</xsl:attribute>
			</xsl:element>

		</target>
	</xsl:template>

	<!-- generate the target "init" -->
	<xsl:template match="publication_index" mode="target_init">
		<target xsl:extension-element-prefixes="exslt" name="init" depends="variables">

			<xsl:element name="mkdir">
				<xsl:attribute name="dir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
			</xsl:element>

			<xsl:element name="mkdir">
				<xsl:attribute name="dir">
					<xsl:value-of select="'${PUBDIR}/zip'"/>
				</xsl:attribute>
			</xsl:element>

			<!--
		  <xsl:element name="mkdir">
		  <xsl:attribute name="dir">
		  <xsl:value-of select="'${PUBDIR}/sc4covers'"/>
		  </xsl:attribute>          
		  </xsl:element>
	  -->

			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}/images'"/>
				</xsl:attribute>
				<fileset dir="images"/>
			</xsl:element>
			<!-- edit which allows for publication of multiple parts within same package -->
			<!--<xsl:element name="mkdir">
			<xsl:attribute name="dir">
				<xsl:value-of select="'${PUBDIR}/merged_data'"/>
			</xsl:attribute>          
		</xsl:element>
		<xsl:element name="mkdir">
			<xsl:attribute name="dir">
				<xsl:value-of select="'${MERGEDIR}/images'"/>
			</xsl:attribute>          
		</xsl:element>
		<xsl:element name="mkdir">
			<xsl:attribute name="dir">
				<xsl:value-of select="'${MERGEDIR}/data'"/>
			</xsl:attribute>          
		</xsl:element>-->

		</target>
		<xsl:text>
	</xsl:text>
	</xsl:template>



	<!-- output the variable for the dependent modules and resources -->
	<xsl:template match="publication_index" mode="dependent_mod_res_variables">
		<xsl:apply-templates select="." mode="dependent_variables">
			<xsl:with-param name="mim_modules" select="$mim_modules"/>
		</xsl:apply-templates>
	</xsl:template>

	<!-- output the variable for  dependent  resources for resource docs -->
	<xsl:template match="publication_index" mode="dependent_res_doc_variables">
		<!--
		<xsl:variable name="resdoc_schema">
		<xsl:call-template name="get_resource_schema_node_set"/>
		</xsl:variable>
	-->
		<xsl:apply-templates select="." mode="dependent_variables">
			<xsl:with-param name="mim_modules" select="$mim_modules"/>
		</xsl:apply-templates>
	</xsl:template>

	<xsl:template match="publication_index" mode="dependent_variables">
		<xsl:param name="mim_modules"/>


		<!-- The resources -->
		<xsl:element name="property">
			<xsl:attribute name="name">RESOURCESXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/resource" mode="list">
					<xsl:with-param name="prefix" select="'data/resources/'"/>
					<xsl:with-param name="suffix" select="'.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESOURCESEXP</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/resource" mode="list">
					<xsl:with-param name="prefix" select="'data/resources/'"/>
					<xsl:with-param name="suffix" select="'.exp'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESOURCESSCHEMAEXPGGIFS</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/resource" mode="list">
					<xsl:with-param name="prefix" select="'data/resources/'"/>
					<xsl:with-param name="suffix" select="'expg*.gif'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">RESOURCESSCHEMAEXPGXMLS</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/resource" mode="list">
					<xsl:with-param name="prefix" select="'data/resources/'"/>
					<xsl:with-param name="suffix" select="'expg*.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<!-- The dependent modules -->
		<xsl:element name="property">
			<xsl:attribute name="name">DMODEXPRESS</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/*.exp'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODGIFS</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/*.exp'"/>
					<xsl:with-param name="terminate" select="'NO'"/>
				</xsl:apply-templates>
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/*.gif'"/>
					<xsl:with-param name="terminate" select="'NO'"/>
				</xsl:apply-templates>
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/*.png'"/>
					<xsl:with-param name="terminate" select="'NO'"/>
				</xsl:apply-templates>
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/*.jpg'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODCONTENTSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/contents.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODMODULES</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/**/*.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODSCOPEXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/1_scope.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODREFSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/2_refs.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODDEFSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/3_defs.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODINFOREQSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/4_info_reqs.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODMAINXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/5_main.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODREFDATAXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/6_refdata.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODMAPPINGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/5_mapping.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODMIMXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/5_mim.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODINDEXXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/index.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODASHORTNAMESXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/a_short_names.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODBOBJREGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/b_obj_reg.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODBIBLIOXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/biblio.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODMODINDEXXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/modindex.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODCARMEXPGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/c_arm_expg.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODCOVERXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/cover.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODCOVERHTM</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/cover.htm'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODISOCOVERXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/isocover.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODISOCOVERHTM</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/isocover.htm'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODDMIMEXPGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/d_mim_expg.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODEEXPXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/e_exp.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODEEXPARMXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/e_exp_arm.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODEEXPMIMXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/e_exp_mim.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:if test="string-length($dlongforms)>0">

			<xsl:element name="property">
				<xsl:attribute name="name">DMODEEXPARMLFXML</xsl:attribute>
				<xsl:attribute name="value">
					<xsl:apply-templates select="$mim_modules_node_set/module" mode="long_form">
						<xsl:with-param name="prefix" select="'data/modules/'"/>
						<xsl:with-param name="suffix" select="'/sys/e_exp_arm_lf.xml'"/>
					</xsl:apply-templates>
				</xsl:attribute>
			</xsl:element>


			<xsl:element name="property">
				<xsl:attribute name="name">DMODEEXPMIMLFXML</xsl:attribute>
				<xsl:attribute name="value">
					<xsl:apply-templates select="$mim_modules_node_set/module" mode="long_form">
						<xsl:with-param name="prefix" select="'data/modules/'"/>
						<xsl:with-param name="suffix" select="'/sys/e_exp_mim_lf.xml'"/>
					</xsl:apply-templates>
				</xsl:attribute>
			</xsl:element>

		</xsl:if>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODFGUIDEXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/f_guide.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODGCHANGEXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/g_change.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODFOREWORDXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/foreword.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODINTRODUCTIONXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/introduction.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODARMDESCRIPTIONSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/arm_descriptions.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODMIMDESCRIPTIONSXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/mim_descriptions.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODARMEXPGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/armexpg*.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODMIMEXPGXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/mimexpg*.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODARMEXPXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/arm.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="property">
			<xsl:attribute name="name">DMODMIMEXPXML</xsl:attribute>
			<xsl:attribute name="value">
				<xsl:apply-templates select="$mim_modules_node_set/module" mode="list">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/mim.xml'"/>
				</xsl:apply-templates>
			</xsl:attribute>
		</xsl:element>

	</xsl:template>


	<xsl:template match="publication_index" mode="target_isodepbom">
		<xsl:param name="menu"/>
		<xsl:variable name="ap_name" select="./application_protocols/ap_doc/@name"/>
		<!-- get ap file -->
		<xsl:variable name="ap_doc_path"
			select="concat('../../data/application_protocols/', $ap_name, '/application_protocol.xml')"/>

		<!-- get name of bom called from ap -->
		<xsl:variable name="bom_name"
			select="document(string($ap_doc_path))//application_protocol/@business_object_model"/>
		<xsl:choose>
			<xsl:when test="string-length($bom_name)=0">
				<xsl:apply-templates select="." mode="target_isodepbom_nobom"/>
			</xsl:when>
			<xsl:otherwise>
				<xsl:apply-templates select="." mode="target_isodepbom_bom">
					<xsl:with-param name="menu" select="$menu"/>
					<xsl:with-param name="bom_name" select="$bom_name"/>
				</xsl:apply-templates>
			</xsl:otherwise>
		</xsl:choose>
	</xsl:template>

	
	<!-- There is no BOM with the AP - so just output an empty target -->
	<xsl:template match="publication_index" mode="target_isodepbom_nobom">
		<target xsl:extension-element-prefixes="exslt" name="isodepbom" depends="init"
			description="Empty target as NO BOM specified in underlying AP"/>
	</xsl:template>

	<xsl:template match="publication_index" mode="target_isodepbom_bom">
		<xsl:param name="menu"/>
		<target xsl:extension-element-prefixes="exslt" name="isodepbom" depends="init"
			description="generate HTML for a BOM underlying an AP">

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMHOMEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/home.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMFRAMETOC}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/frame_toc.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMFRAMETITLE}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/frame_title.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/express.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMDESCRIPTIONSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/descriptions.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMEXPGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/imgfile.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMCONTENTSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_contents.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMINDEXXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_bomindex.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOM1SCOPEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_1_scope.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOM2REFSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_2_refs.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOM3DEFSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_3_defs.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOM4INFOREQSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_4_info_reqs.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOM5MAINXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_5_main.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMBOMXSDXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_xsd.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMCONFIGXSDXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_config.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMANNEXOBJREGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_annex_obj_reg.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMBIBLIOXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_biblio.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMANNEXEXPGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_annex_bom_expg.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMANNEXUMLXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_annex_bom_uml.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMANNEXXSDDERXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_annex_xsd_der.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMANNEXCOMPINTXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_annex_comp_int.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMCOVERXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_cover.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMISOCOVERXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_isocover.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>


			<!-- move the ISO cover page to cover page -->
			<xsl:element name="move">
				<xsl:attribute name="todir">${TMPDIR}</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">${TMPDIR}</xsl:attribute>
					<xsl:attribute name="includes">${BOMISOCOVERHTM}</xsl:attribute>
				</xsl:element>
				<mapper type="glob" from="*isocover.htm" to="*cover.htm"/>
			</xsl:element>


			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMFOREWORDXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_foreword.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>

			<!-- BOM INDEX -->
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DINDEXBOMDOC}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_index_bomdoc.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMINTRODUCTIONXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_introduction.xsl'"/>
				</xsl:attribute>
				<xsl:call-template name="emb_bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:call-template>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DBOMABSTRACTXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_abstract.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${DBOMEXPRESS}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>

			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${DBOMXSD}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>
			
			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${DP28CONFIGXML}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>

			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${DBOMGIFS}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>
		</target>
	</xsl:template>


	<!-- STAND ALONE BOM -->
	<!-- generate the target "target_isobomdocs" -->
	<xsl:template match="publication_index" mode="target_isobomdocs">
		<xsl:param name="menu"/>

		<xsl:text>
		</xsl:text>
		<target xsl:extension-element-prefixes="exslt" name="isobomdocs" depends="init"
			description="generate HTML for a BOM listed in the publication_index">


			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMHOMEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/home.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMFRAMETOC}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/frame_toc.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMFRAMETITLE}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/frame_title.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/express.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMDESCRIPTIONSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/descriptions.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMEXPGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/imgfile.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMCONTENTSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_contents.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMINDEXXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_bomindex.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOM1SCOPEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_1_scope.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOM2REFSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_2_refs.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOM3DEFSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_3_defs.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOM4INFOREQSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_4_info_reqs.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOM5MAINXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_5_main.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMBOMXSDXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_xsd.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMCONFIGXSDXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_config.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMANNEXOBJREGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_annex_obj_reg.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMBIBLIOXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_biblio.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMANNEXEXPGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_annex_bom_expg.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMANNEXUMLXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_annex_bom_uml.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMANNEXXSDDERXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_annex_xsd_der.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMANNEXCOMPINTXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_annex_comp_int.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMCOVERXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_cover.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMISOCOVERXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_isocover.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>


			<!-- move the ISO cover page to cover page -->
			<xsl:element name="move">
				<xsl:attribute name="todir">${TMPDIR}</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">${TMPDIR}</xsl:attribute>
					<xsl:attribute name="includes">${BOMISOCOVERHTM}</xsl:attribute>
				</xsl:element>
				<mapper type="glob" from="*isocover.htm" to="*cover.htm"/>
			</xsl:element>


			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMFOREWORDXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_foreword.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<!-- BOM INDEX -->
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${INDEXBOMDOC}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_index_bomdoc.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMINTRODUCTIONXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_introduction.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="bomdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOMABSTRACTXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/bom_doc/sect_abstract.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${BOMEXPRESS}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>

			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${BOMXSD}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>

			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${BOMGIFS}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>
		</target>
	</xsl:template>

	<!-- generate the target "target_isomodules" -->
	<xsl:template match="publication_index" mode="target_isomodules">
		<xsl:param name="menu"/>
		<xsl:text>
	</xsl:text>
		<target xsl:extension-element-prefixes="exslt" name="isomodules" depends="init"
			description="generate HTML for a module listed in the publication_index">
			<dependset>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${STEPMODDTDDIR}'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'**/*.dtd, **/*.ent'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${STEPMODSTYLES}'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'**/*.xsl'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${MODULES}'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${GIFS}'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${EXPRESS}'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="targetfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${TMPDIR}'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'/data/modules/**/*.htm'"/>
					</xsl:attribute>
				</xsl:element>
			</dependset>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${CONTENTSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_contents.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${SCOPEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_1_scope.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${REFSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_2_refs.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DEFSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_3_defs.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${INFOREQSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_4_info_reqs.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${MAINXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_5_main.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>


			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${REFDATAXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_6_refdata.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${MAPPINGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_5_mapping.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${MIMXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_5_mim.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${INDEXXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/index.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${ABSTRACTXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_abstract.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${ASHORTNAMESXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_a_short_names.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BOBJREGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_b_obj_reg.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${BIBLIOXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_biblio.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${MODINDEXXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_modindex.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${CARMEXPGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_c_arm_expg.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${COVERXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_cover.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
				<xsl:element name="param">
					<xsl:attribute name="name">
						<xsl:value-of select="'coverpage_date'"/>
					</xsl:attribute>
					<xsl:attribute name="expression">
						<xsl:value-of select="'${DATE}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>

			<!-- THX  collect into separate folder per request from secretariat 
		   <xsl:element name="move">
		   <xsl:attribute name="todir">${SC4COVERDIR}</xsl:attribute>
		   <xsl:element name="fileset">
		   <xsl:attribute name="dir">${TMPDIR}</xsl:attribute>
		   <xsl:attribute name="includes">${COVERHTM}</xsl:attribute>
		   </xsl:element>
		   <mapper type="regexp" from="^.*\\([^\\]+)\\sys\\([^\\].*)$$" to="\1_\2"  /> 
		   </xsl:element> -->


			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${ISOCOVERXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_isocover.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
				<xsl:element name="param">
					<xsl:attribute name="name">
						<xsl:value-of select="'coverpage_date'"/>
					</xsl:attribute>
					<xsl:attribute name="expression">
						<xsl:value-of select="'${DATE}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>

			<!-- move the ISO cover page to cover page -->
			<xsl:element name="move">
				<xsl:attribute name="todir">${TMPDIR}</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">${TMPDIR}</xsl:attribute>
					<xsl:attribute name="includes">${ISOCOVERHTM}</xsl:attribute>
				</xsl:element>
				<mapper type="glob" from="*isocover.htm" to="*cover.htm"/>
			</xsl:element>


			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMIMEXPGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_d_mim_expg.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${EEXPXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_e_exp.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${EEXPARMXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_e_exp_arm.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:variable name="longforms">
				<xsl:apply-templates select="modules/module" mode="long_form">
					<xsl:with-param name="prefix" select="'data/modules/'"/>
					<xsl:with-param name="suffix" select="'/sys/e_exp_arm_lf.xml'"/>
				</xsl:apply-templates>
			</xsl:variable>

			<xsl:if test="string-length($longforms)>0">
				<xsl:element name="xslt">
					<xsl:attribute name="includes">
						<xsl:value-of select="'${EEXPARMLFXML}'"/>
					</xsl:attribute>
					<xsl:attribute name="style">
						<xsl:value-of select="'${STEPMODSTYLES}/sect_e_exp_arm_lf.xsl'"/>
					</xsl:attribute>
					<xsl:apply-templates select="." mode="modules_target_style_attributes">
						<xsl:with-param name="menu" select="$menu"/>
					</xsl:apply-templates>
				</xsl:element>
			</xsl:if>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${EEXPMIMXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_e_exp_mim.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:if test="string-length($longforms)>0">
				<xsl:element name="xslt">
					<xsl:attribute name="includes">
						<xsl:value-of select="'${EEXPMIMLFXML}'"/>
					</xsl:attribute>
					<xsl:attribute name="style">
						<xsl:value-of select="'${STEPMODSTYLES}/sect_e_exp_mim_lf.xsl'"/>
					</xsl:attribute>
					<xsl:apply-templates select="." mode="modules_target_style_attributes">
						<xsl:with-param name="menu" select="$menu"/>
					</xsl:apply-templates>
				</xsl:element>
			</xsl:if>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${FGUIDEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_f_guide.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${GCHANGEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_g_change.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${FOREWORDXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_foreword.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${INTRODUCTIONXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_introduction.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of
						select="'${ARMEXPXML}, ${MIMEXPXML},${ARMLFEXPXML}, ${MIMLFEXPXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/express.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${ARMEXPGXML},${MIMEXPGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/imgfile.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${EXPRESS}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>

			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${GIFS}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>
		</target>
	</xsl:template>


	<!-- generate the target "target_resources" -->
	<xsl:template match="publication_index" mode="target_resources">
		<xsl:text>
	</xsl:text>
		<target xsl:extension-element-prefixes="exslt" name="resources" depends="init"
			description="generate common resources">
			<dependset>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${STEPMODDTDDIR}'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'**/*.dtd, **/*.ent'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${STEPMODSTYLES}'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'**/*.xsl'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfilelist">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="files">
						<xsl:value-of select="'${RESOURCESXML}'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="targetfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${TMPDIR}'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'/data/resources/**/*.htm'"/>
					</xsl:attribute>
				</xsl:element>
			</dependset>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESOURCESXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="destdir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:attribute name="extension">
					<xsl:value-of select="'.htm'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/express.xsl'"/>
				</xsl:attribute>
				<param name="output_type" expression="HTM"/>
				<xsl:element name="param">
					<xsl:attribute name="name">
						<xsl:value-of select="'output_background'"/>
					</xsl:attribute>
					<xsl:attribute name="expression">
						<xsl:value-of select="'${OUTPUT_RESOURCES_BACKGROUND}'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:choose>
					<xsl:when test="./@background.image.dependent.resources">
						<xsl:element name="param">
							<xsl:attribute name="name">
								<xsl:value-of select="'background_image'"/>
							</xsl:attribute>
							<xsl:attribute name="expression">
								<xsl:value-of select="./@background.image.dependent.resources"/>
							</xsl:attribute>
						</xsl:element>
					</xsl:when>
					<xsl:otherwise>
						<xsl:element name="param">
							<xsl:attribute name="name">
								<xsl:value-of select="'background_image'"/>
							</xsl:attribute>
							<xsl:attribute name="expression">
								<xsl:value-of select="'greybackground.jpg'"/>
							</xsl:attribute>
						</xsl:element>
					</xsl:otherwise>
				</xsl:choose>
			</xsl:element>

			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${RESOURCESEXP}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>
		</target>
	</xsl:template>


	<xsl:template match="publication_index" mode="target_isodepmodules">
		<xsl:param name="menu"/>
		<xsl:apply-templates select="." mode="target_isodepmodules_publication_record"/>
		<xsl:text>
	</xsl:text>
		<target xsl:extension-element-prefixes="exslt" name="isodepmodules"
			depends="init, isodepmodules_publication_record"
			description="generate HTML for all modules">
			<dependset>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${STEPMODDTDDIR}'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'**/*.dtd, **/*.ent'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${STEPMODSTYLES}'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'**/*.xsl'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${DMODMODULES}'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${DMODGIFS}'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${DMODEXPRESS}'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="targetfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${TMPDIR}'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'/data/modules/**/*.htm'"/>
					</xsl:attribute>
				</xsl:element>
			</dependset>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODCONTENTSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_contents.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODSCOPEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_1_scope.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODREFSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_2_refs.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODDEFSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_3_defs.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODINFOREQSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_4_info_reqs.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODMAINXML}'"/>
				</xsl:attribute>

				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_5_main.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>


			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODREFDATAXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_6_refdata.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>


			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODMAPPINGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_5_mapping.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODMIMXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_5_mim.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODINDEXXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/index.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>


			<!-- RBN - ISO do not want the abstract in the module
		   <xsl:element name="xslt">
		   <xsl:attribute name="includes">
		   <xsl:value-of select="'${DMODABSTRACTXML}'"/>
		   </xsl:attribute>
		   <xsl:attribute name="style">
		   <xsl:value-of select="'${STEPMODSTYLES}/sect_abstract.xsl'"/>
		   </xsl:attribute>        
		   <xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
		   <xsl:with-param name="menu" select="$menu"/>
		   </xsl:apply-templates>
		   </xsl:element> -->

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODASHORTNAMESXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_a_short_names.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODBOBJREGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_b_obj_reg.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODBIBLIOXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_biblio.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODMODINDEXXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_modindex.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODCARMEXPGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_c_arm_expg.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODCOVERXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_cover.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
				<xsl:element name="param">
					<xsl:attribute name="name">
						<xsl:value-of select="'coverpage_date'"/>
					</xsl:attribute>
					<xsl:attribute name="expression">
						<xsl:value-of select="'${DATE}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>

			<!-- move the cover page to SC4 cover page  -->
			<!-- RBN Commented out as per request from ISO
		   <xsl:element name="move">
		   <xsl:attribute name="todir">${TMPDIR}</xsl:attribute>
		   <xsl:element name="fileset">
		   <xsl:attribute name="dir">${TMPDIR}</xsl:attribute>
		   <xsl:attribute name="includes">${DMODCOVERHTM}</xsl:attribute>
		   </xsl:element>
		   <mapper type="glob" from="*.htm" to="*_sc4.htm"/>
		   </xsl:element> -->

			<!-- generate the ISO cover page  -->
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODISOCOVERXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_isocover.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<!-- move the ISO cover page to cover page -->
			<xsl:element name="move">
				<xsl:attribute name="todir">${TMPDIR}</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">${TMPDIR}</xsl:attribute>
					<xsl:attribute name="includes">${DMODISOCOVERHTM}</xsl:attribute>
				</xsl:element>
				<mapper type="glob" from="*isocover.htm" to="*cover.htm"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODDMIMEXPGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_d_mim_expg.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODEEXPXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_e_exp.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODEEXPARMXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_e_exp_arm.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODEEXPMIMXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_e_exp_mim.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>


			<!-- RBN the test need to be run on the dependent modules -->
			<xsl:if test="string-length($dlongforms)>0">

				<xsl:element name="xslt">
					<xsl:attribute name="includes">
						<xsl:value-of select="'${DMODEEXPARMLFXML}'"/>
					</xsl:attribute>
					<xsl:attribute name="style">
						<xsl:value-of select="'${STEPMODSTYLES}/sect_e_exp_arm_lf.xsl'"/>
					</xsl:attribute>
					<xsl:attribute name="scanincludeddirectories">
						<xsl:value-of select="'false'"/>
					</xsl:attribute>
					<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
						<xsl:with-param name="menu" select="$menu"/>
					</xsl:apply-templates>
				</xsl:element>

				<!-- RBN the test need to be run on the dependent modules       
			 <xsl:if test="string-length($dlongforms)>0"></xsl:if> -->
				<xsl:element name="xslt">
					<xsl:attribute name="includes">
						<xsl:value-of select="'${DMODEEXPMIMLFXML}'"/>
					</xsl:attribute>
					<xsl:attribute name="style">
						<xsl:value-of select="'${STEPMODSTYLES}/sect_e_exp_mim_lf.xsl'"/>
					</xsl:attribute>
					<xsl:attribute name="scanincludeddirectories">
						<xsl:value-of select="'false'"/>
					</xsl:attribute>
					<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
						<xsl:with-param name="menu" select="$menu"/>
					</xsl:apply-templates>
				</xsl:element>

			</xsl:if>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODFGUIDEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_f_guide.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODGCHANGEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_g_change.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODFOREWORDXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_foreword.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODINTRODUCTIONXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_introduction.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODARMEXPXML}, ${DMODMIMEXPXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/express.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${DMODARMEXPGXML},${DMODMIMEXPGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/imgfile.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${SYS}/e_exp_arm_lf.xml'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_e_exp_arm_lf.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="dependent_modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${DMODEXPRESS}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>

			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${DMODGIFS}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>
		</target>
	</xsl:template>


	<!-- called from template match="publication_index" mode="dependent_modules_target" -->
	<xsl:template match="publication_index" mode="dependent_modules_target_style_attributes">
		<xsl:param name="menu"/>
		<xsl:attribute name="destdir">
			<xsl:value-of select="'${TMPDIR}'"/>
		</xsl:attribute>
		<xsl:attribute name="extension">
			<xsl:value-of select="'.htm'"/>
		</xsl:attribute>
		<param name="output_type" expression="HTM"/>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'INLINE_ERRORS'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${DEPMODULES_INLINE_ERRORS}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'publication'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${PUBLICATION}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'output_rcs'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${OUTPUT_RCS}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'output_issues'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${OUTPUT_ISSUES}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'output_background'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${OUTPUT_DEPMODULES_BACKGROUND}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'menubar_file'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${ISOMENU}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'STEPMOD_DATA_MODULES'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${STEPMOD_DATA_MODULES}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'STEPMOD_DATA_RESOURCES'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${STEPMOD_DATA_RESOURCES}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'STEPMOD_DATA_APS'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${STEPMOD_DATA_APS}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'background_image'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${DEPMODULES_BACKGROUND}'"/>
			</xsl:attribute>
		</xsl:element>
	</xsl:template>

	<!-- called from template match="publication_index" mode="apdocs_target" -->
	<xsl:template match="publication_index" mode="apdocs_target_style_attributes">
		<xsl:param name="menu"/>
		<xsl:attribute name="destdir">
			<xsl:value-of select="'${TMPDIR}'"/>
		</xsl:attribute>
		<xsl:attribute name="extension">
			<xsl:value-of select="'.htm'"/>
		</xsl:attribute>
		<param name="output_type" expression="HTM"/>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'INLINE_ERRORS'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${APDOCS_INLINE_ERRORS}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'publication'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${PUBLICATION}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'output_rcs'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${OUTPUT_RCS}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'output_issues'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${OUTPUT_ISSUES}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'menubar_file'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${ISOMENU}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'STEPMOD_DATA_MODULES'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${STEPMOD_DATA_MODULES}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'STEPMOD_DATA_RESOURCES'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${STEPMOD_DATA_RESOURCES}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'STEPMOD_DATA_APS'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${STEPMOD_DATA_APS}'"/>
			</xsl:attribute>
		</xsl:element>
	</xsl:template>

	<!-- called from template match="publication_index" mode="target_isomodules" -->
	<xsl:template match="publication_index" mode="modules_target_style_attributes">
		<xsl:param name="menu"/>
		<xsl:attribute name="destdir">
			<xsl:value-of select="'${TMPDIR}'"/>
		</xsl:attribute>
		<xsl:attribute name="extension">
			<xsl:value-of select="'.htm'"/>
		</xsl:attribute>
		<param name="output_type" expression="HTM"/>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'INLINE_ERRORS'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${MODULES_INLINE_ERRORS}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'publication'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${PUBLICATION}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'output_rcs'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${OUTPUT_RCS}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'output_issues'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${OUTPUT_ISSUES}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'menubar_file'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${ISOMENU}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'STEPMOD_DATA_MODULES'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${STEPMOD_DATA_MODULES}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'STEPMOD_DATA_RESOURCES'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${STEPMOD_DATA_RESOURCES}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'STEPMOD_DATA_APS'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${STEPMOD_DATA_APS}'"/>
			</xsl:attribute>
		</xsl:element>
	</xsl:template>

	<!-- STAND ALONE BOM -->
	<!-- called from template match="publication_index" mode="target_isobomdocs" -->
	<xsl:template match="publication_index" mode="bomdocs_target_style_attributes">
		<xsl:param name="menu"/>
		<xsl:attribute name="destdir">
			<xsl:value-of select="'${TMPDIR}'"/>
		</xsl:attribute>
		<xsl:attribute name="extension">
			<xsl:value-of select="'.htm'"/>
		</xsl:attribute>
		<param name="output_type" expression="HTM"/>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'INLINE_ERRORS'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${MODULES_INLINE_ERRORS}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'publication'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${PUBLICATION}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'output_rcs'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${OUTPUT_RCS}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'menubar_file'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${ISOMENU}'"/>
			</xsl:attribute>
		</xsl:element>
	</xsl:template>

	<!-- EMBEDDED BOM -->
	<xsl:template name="emb_bomdocs_target_style_attributes">
		<xsl:param name="menu"/>
		<xsl:attribute name="destdir">
			<xsl:value-of select="'${TMPDIR}'"/>
		</xsl:attribute>
		<xsl:attribute name="extension">
			<xsl:value-of select="'.htm'"/>
		</xsl:attribute>
		<param name="output_type" expression="HTM"/>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'INLINE_ERRORS'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${MODULES_INLINE_ERRORS}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'publication'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${PUBLICATION}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'output_rcs'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${OUTPUT_RCS}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'menubar_file'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${ISOMENU}'"/>
			</xsl:attribute>
		</xsl:element>
	</xsl:template>

	<!-- generate the target "isoapdocs" -->
	<xsl:template match="publication_index" mode="target_isoapdocs">
		<xsl:param name="menu"/>

		<!-- generate the target for all the modules that the AP is dependent
		  on. These will be published as well -->
		<xsl:apply-templates select="." mode="target_isodepmodules"/>

		<!-- generate the target for all the BOM   that the AP is dependent
   		on. These will be published as well -->
		<xsl:apply-templates select="." mode="target_isodepbom"/>

		<xsl:text>
	 </xsl:text>
		<target xsl:extension-element-prefixes="exslt" name="isoapdoc" depends="init"
			description="generate HTML for AP doc">
			<dependset>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${STEPMODDTDDIR}'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'**/*.dtd, **/*.ent'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${STEPMODSTYLES}'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'**/*.xsl'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${APDOCS}'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${APDOCGIFS}'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${APDOCJPEGS}'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${APDOCJPGS}'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${APDOCPNGS}'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="targetfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${TMPDIR}'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'/${APDIR}/**/*.htm'"/>
					</xsl:attribute>
				</xsl:element>
			</dependset>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCSHOMEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/home.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCFRAMEAPTITLEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/frame_aptitle.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCFRAMECONTENTTITLEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/frame_contenttitle.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCFRAMEINDEXXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/frame_index.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCFRAMETOCXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/frame_toc.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCFRAMETOCSHORTXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/frame_toc_short.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCHELPXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_help.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCSAAMIDEFXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/imgfile.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCSDATAPLANXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/imgfile.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCSCOPEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_1_scope.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCREFSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_2_refs.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCDEFSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_3_defs.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINFOREQSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_4_info_reqs.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCMAINXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_5_main.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCCCSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_6_ccs.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCCCSARMTABLEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_6_ccs_arm_table.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCCCSMIMTABLEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_6_ccs_mim_table.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCABSTRACT}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_abstract.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCANNEXAAM}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_annex_aam.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCANNEXARMEXPGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_annex_arm_expg.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCANNEXMIMEXPGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_annex_mim_expg.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCANNEXCHANGESXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_annex_changes.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCANNEXCOMP}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_annex_comp_int.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCANNEXEXPLFXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_annex_exp_lf.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCANNEXGUIDEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_annex_guide.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCANNEXIMPMETHXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_annex_imp_meth.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCANNEXOBJREGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_annex_obj_reg.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCANNEXPICSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_annex_pics.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCANNEXSHORTNAMESXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_annex_shortnames.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCANNEXTECHDISCXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_annex_tech_disc.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCBIBLIOXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_biblio.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCCONTENTSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_contents.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXAPDOCXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_index_apdoc.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCCOVERXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_cover.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<!-- move the cover page to SC4 cover page  -->
			<!-- RBN commented out per request for ISO - not to have sc4 cover page
	   <xsl:element name="move">
		 <xsl:attribute name="todir">${TMPDIR}</xsl:attribute>
		 <xsl:element name="fileset">
		   <xsl:attribute name="dir">${TMPDIR}</xsl:attribute>
		   <xsl:attribute name="includes">${APDOCCOVERHTM}</xsl:attribute>
		 </xsl:element>
		 <mapper type="glob" from="*.htm" to="*_sc4.htm"/>
	   </xsl:element>  
	   -->

			<!-- generate the ISO cover page  -->
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCISOCOVERXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/sect_isocover.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="modules_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<!-- move the ISO cover page to cover page -->
			<xsl:element name="move">
				<xsl:attribute name="todir">${TMPDIR}</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">${TMPDIR}</xsl:attribute>
					<xsl:attribute name="includes">${APDOCISOCOVERHTM}</xsl:attribute>
				</xsl:element>
				<mapper type="glob" from="*isocover.htm" to="*cover.htm"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCFOREWORDXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_foreword.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${INDEXARMEXPRESSNAVXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_arm_express_nav.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${INDEXARMEXPRESSNAVINNERXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_arm_express_nav_inner.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${INDEXARMEXPRESSNAVTOPXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_arm_express_nav_top.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXARMEXPRESSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_arm_express.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXARMEXPRESSINNERXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_arm_express_inner.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXARMEXPRESSTOPXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_arm_express_top.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXARMMAPPINGSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_arm_mappings.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXARMMAPPINGSINNERXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_arm_mappings_inner.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXARMMAPPINGSTOP}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_arm_mappings_top.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXARMMODULES}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_arm_modules.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXARMMODULESINNER}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_arm_modules_inner.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXARMMODULESINNERPART}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_arm_modules_inner_part.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>


			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXARMMODULESTOP}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_arm_modules_top.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXMIMEXPRESS}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_mim_express.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXMIMEXPRESSINNERXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_mim_express_inner.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXMIMEXPRESSTOP}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_mim_express_top.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXMIMMODULES}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_mim_modules.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXMIMMODULESINNER}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_mim_modules_inner.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXMIMMODULESINNERPART}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_mim_modules_inner_part.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXMIMMODULESTOP}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_mim_modules_top.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXRESOURCES}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_resources.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXRESOURCESINNER}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_resources_inner.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXRESOURCESINNERPART}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_resources_inner_part.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINDEXRESOURCESTOP}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/index_resources_top.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${APDOCINTRODUCTION}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${APXSL}/sect_introduction.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="apdocs_target_style_attributes">
					<xsl:with-param name="menu" select="$menu"/>
				</xsl:apply-templates>
			</xsl:element>

			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${APDOCGIFS}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>
			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${APDOCJPGS}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>
			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${APDOCJPEGS}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>
			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${APDOCPNGS}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>
		</target>
	</xsl:template>


	<xsl:template match="publication_index" mode="target_resources_publication_record">
		<xsl:variable name="resdoc_schema">
			<xsl:call-template name="get_resource_schema_node_set"/>
		</xsl:variable>
		<xsl:variable name="resdoc_schema_node_set" select="exslt:node-set($resdoc_schema)"/>
		<xsl:text>
	 </xsl:text>
		<xsl:element name="target">
			<xsl:attribute name="name">resources_publication_record</xsl:attribute>
			<xsl:attribute name="depends">init</xsl:attribute>
			<xsl:apply-templates select="$resdoc_schema_node_set/resource" mode="pub_record_style"/>
		</xsl:element>

	</xsl:template>

	<!-- generate the target "target_isoresdocs" -->
	<xsl:template match="publication_index" mode="target_isoresdocs">

		<xsl:apply-templates select="." mode="target_resources_publication_record"/>

		<target name="isoresdocs" depends="init" description="generate HTML for all modules">
			<dependset>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${STEPMODDTDDIR}'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'**/*.dtd, **/*.ent'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${STEPMODSTYLES}'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'**/*.xsl'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${RESDOCS}'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="srcfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${RESDOCGIFS}'"/>
					</xsl:attribute>
				</xsl:element>
				<xsl:element name="targetfileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${PUBDIR}'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'/data/resource_docs/**/*.htm'"/>
					</xsl:attribute>
				</xsl:element>
			</dependset>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCINDEXXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_resdocindex.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCABSTRACTXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_abstract.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCCONTENTSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_contents.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCSCOPEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_1_scope.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCRESDOCINDEXXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_resdocindex.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCREFSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_2_refs.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCDEFSXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_3_defs.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCSCHEMAXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_schema.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCCEXPSCHEMAXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_c_exp_schema.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCCEXPXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_c_exp.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCDEXPGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_d_expg.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<!--
	   <xsl:element name="xslt">
		 <xsl:attribute name="includes">
		   <xsl:value-of select="'${RESDOCMAINXML}'"/>
		 </xsl:attribute>
		 <xsl:attribute name="style">
		   <xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_main.xsl'"/>
		 </xsl:attribute>
		 <xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
	   </xsl:element>
	   -->
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCASHORTNAMESXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_a_short_names.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCBOBJREGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_b_obj_reg.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCTECHDISCUSSIONXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_tech_discussion.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCEXAMPLESXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_examples.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCCHANGEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_g_change.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCADDSCOPEXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_add_scope.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCBIBLIOXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_biblio.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCCOVERXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_cover.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<!-- move the cover page to SC4 cover page  -->
			<!--
	   <xsl:element name="move">
		 <xsl:attribute name="todir">${TMPDIR}</xsl:attribute>
		 <xsl:element name="fileset">
		   <xsl:attribute name="dir">${TMPDIR}</xsl:attribute>
		   <xsl:attribute name="includes">${RESDOCCOVERHTM}</xsl:attribute>
		 </xsl:element>
		 <mapper type="glob" from="*.htm" to="*_sc4.htm"/>
	   </xsl:element> 
 -->
			<!-- generate the ISO cover page  -->
			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCISOCOVERXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_isocover.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<!-- move the ISO cover page to cover page -->
			<xsl:element name="move">
				<xsl:attribute name="todir">${TMPDIR}</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">${TMPDIR}</xsl:attribute>
					<xsl:attribute name="includes">${RESDOCISOCOVERHTM}</xsl:attribute>
				</xsl:element>
				<mapper type="glob" from="*isocover.htm" to="*cover.htm"/>
			</xsl:element>



			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCFOREWORDXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_foreword.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCINTRODUCTIONXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/sect_introduction.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCSCHEMADIAGXML}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/imgfile.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>

			<xsl:element name="xslt">
				<xsl:attribute name="includes">
					<xsl:value-of select="'${RESDOCRESOURCESSCHEMAEXPGXMLS}'"/>
				</xsl:attribute>
				<xsl:attribute name="style">
					<xsl:value-of select="'${STEPMODSTYLES}/res_doc/imgfile.xsl'"/>
				</xsl:attribute>
				<xsl:apply-templates select="." mode="resdoc_target_style_attributes"/>
			</xsl:element>


			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${RESDOCGIFS}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>

			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="'${TMPDIR}'"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'.'"/>
					</xsl:attribute>
					<xsl:attribute name="includes">
						<xsl:value-of select="'${RESDOCRESOURCESSCHEMAEXPGGIFS}'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>
		</target>
	</xsl:template>

	<!-- called from template match="publication_index" mode="target_isoresdocs" -->
	<xsl:template match="publication_index" mode="resdoc_target_style_attributes">
		<xsl:attribute name="destdir">
			<xsl:value-of select="'${TMPDIR}'"/>
		</xsl:attribute>
		<xsl:attribute name="extension">
			<xsl:value-of select="'.htm'"/>
		</xsl:attribute>
		<param name="output_type" expression="HTM"/>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'publication'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${PUBLICATION}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'output_rcs'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${OUTPUT_RCS}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'output_issues'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${OUTPUT_ISSUES}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'INLINE_ERRORS'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${INLINE_ERRORS}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'menubar_file'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${ISOMENU}'"/>
			</xsl:attribute>
		</xsl:element>
	</xsl:template>

	<!-- STAND ALONE BOM -->
	<!-- called from template match="publication_index" mode="bomdoc_target_style_attributes" -->
	<xsl:template match="publication_index" mode="bomdoc_target_style_attributes">
		<xsl:attribute name="destdir">
			<xsl:value-of select="'${TMPDIR}'"/>
		</xsl:attribute>
		<xsl:attribute name="extension">
			<xsl:value-of select="'.htm'"/>
		</xsl:attribute>
		<param name="output_type" expression="HTM"/>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'publication'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${PUBLICATION}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'output_rcs'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${OUTPUT_RCS}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'output_issues'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${OUTPUT_ISSUES}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'INLINE_ERRORS'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${INLINE_ERRORS}'"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:element name="param">
			<xsl:attribute name="name">
				<xsl:value-of select="'menubar_file'"/>
			</xsl:attribute>
			<xsl:attribute name="expression">
				<xsl:value-of select="'${ISOMENU}'"/>
			</xsl:attribute>
		</xsl:element>
	</xsl:template>

	<!-- generate the target "publish_isoapdocs" -->
	<xsl:template match="publication_index" mode="target_publish_isoapdocs">
		<xsl:text>
	 </xsl:text>
		<xsl:element name="target">
			<xsl:attribute name="name">publish_isoapdocs</xsl:attribute>
			<xsl:attribute name="depends">isoindex, resources, isodepmodules, isodepbom, isoapdoc</xsl:attribute>
			<xsl:attribute name="description">Copy HTML to publication directory</xsl:attribute>
			<xsl:apply-templates select="//ap_doc" mode="target_publish_isoapdocs"/>
		</xsl:element>
	</xsl:template>

	<xsl:template match="ap_doc" mode="target_publish_isoapdocs">
		<xsl:variable name="apdoc_file"
			select="concat('../../data/application_protocols/',@name,'/application_protocol.xml')"/>
		<xsl:variable name="apdoc_xml" select="document($apdoc_file)"/>

		<xsl:variable name="apdoc_iso_no"
			select="concat('iso10303_',$apdoc_xml/application_protocol/@part)"/>
		<xsl:variable name="apdoc_dir" select="concat('${PUBDIR}/',$apdoc_iso_no,'/')"/>

		<xsl:text>
	 </xsl:text>
		<xsl:comment>Publish Application protocol: <xsl:value-of select="@name"/>
		</xsl:comment>

		<!-- generate the publication record for the AP doc -->
		<xsl:apply-templates select="." mode="pub_record_style"/>

		<!-- the readme -->
		<xsl:element name="xslt">
			<xsl:attribute name="in">
				<xsl:value-of
					select="concat('data/application_protocols/',@name,'/application_protocol.xml')"
				/>
			</xsl:attribute>
			<xsl:attribute name="out">
				<xsl:value-of select="concat($apdoc_dir,$apdoc_iso_no,'_readme.txt')"/>
			</xsl:attribute>
			<xsl:attribute name="style">
				<xsl:value-of select="'${STEPMODSTYLES}/publication/pub_readme.xsl'"/>
			</xsl:attribute>
			<xsl:attribute name="destdir">
				<xsl:value-of select="$apdoc_dir"/>
			</xsl:attribute>
		</xsl:element>

		<!-- make sure that the CR/LF are windows for the readme -->
		<xsl:element name="fixcrlf">
			<xsl:attribute name="srcdir">
				<xsl:value-of select="$apdoc_dir"/>
			</xsl:attribute>
			<xsl:attribute name="includes">
				<xsl:value-of select="concat($apdoc_iso_no,'_readme.txt')"/>
			</xsl:attribute>
			<xsl:attribute name="eol">
				<xsl:value-of select="'crlf'"/>
			</xsl:attribute>
		</xsl:element>

		<!-- the frontpage redirected to application_protocol cover page -->
		<xsl:element name="xslt">
			<xsl:attribute name="in">
				<xsl:value-of
					select="concat('data/application_protocols/',@name,'/application_protocol.xml')"
				/>
			</xsl:attribute>
			<xsl:attribute name="out">
				<!-- edit which allows for publication of multiple parts within same package -->
				<xsl:value-of select="concat($apdoc_dir,$apdoc_iso_no,'.htm')"/>
				<!--<xsl:value-of select="concat('${MERGEDIR}/',$apdoc_iso_no,'.htm')"/>-->
			</xsl:attribute>
			<xsl:attribute name="style">
				<xsl:value-of select="'${STEPMODSTYLES}/publication/pub_frontpage.xsl'"/>
			</xsl:attribute>
			<xsl:attribute name="destdir">
				<xsl:value-of select="$apdoc_dir"/>
			</xsl:attribute>
			<param name="output_type" expression="HTM"/>
		</xsl:element>
		<!-- edit which allows for publication of multiple parts within same package -->
		<!-- <xsl:element name="copy">
	   <xsl:attribute name="todir">
	   	<xsl:value-of select="'${MERGEDIR}/images'"/>
	   </xsl:attribute>
	   <xsl:element name="fileset">
		 <xsl:attribute name="dir">
		   <xsl:value-of select="'${TMPDIR}/images'"/>
		 </xsl:attribute>
	   </xsl:element>
	 </xsl:element>-->
		<xsl:element name="copy">
			<xsl:attribute name="todir">
				<xsl:value-of select="concat($apdoc_dir,'images')"/>
			</xsl:attribute>
			<xsl:element name="fileset">
				<xsl:attribute name="dir">
					<xsl:value-of select="'${TMPDIR}/images'"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>

		<!-- copy the resources -->
		<!-- edit which allows for publication of multiple parts within same package -->
		<!--<xsl:element name="copy">
	   <xsl:attribute name="todir">
	   	<xsl:value-of select="'${MERGEDIR}/data/resources'"/>
	   </xsl:attribute>
	   <xsl:element name="fileset">
		 <xsl:attribute name="dir">
		   <xsl:value-of select="'${TMPDIR}/data/resources'"/>
		 </xsl:attribute>
	   </xsl:element>
	 </xsl:element>-->
		<xsl:element name="copy">
			<xsl:attribute name="todir">
				<xsl:value-of select="concat($apdoc_dir,'data/resources')"/>
			</xsl:attribute>
			<xsl:element name="fileset">
				<xsl:attribute name="dir">
					<xsl:value-of select="'${TMPDIR}/data/resources'"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>

		<!-- copy the modules -->
		<!-- edit which allows for publication of multiple parts within same package -->
		<!--<xsl:element name="copy">
	   <xsl:attribute name="todir">
	   	<xsl:value-of select="'${MERGEDIR}/data/modules'"/>
	   </xsl:attribute>
	   <xsl:element name="fileset">
		 <xsl:attribute name="dir">
		   <xsl:value-of select="'${TMPDIR}/data/modules'"/>
		 </xsl:attribute>
	   </xsl:element>
	 </xsl:element>-->
		<xsl:element name="copy">
			<xsl:attribute name="todir">
				<xsl:value-of select="concat($apdoc_dir,'data/modules')"/>
			</xsl:attribute>
			<xsl:element name="fileset">
				<xsl:attribute name="dir">
					<xsl:value-of select="'${TMPDIR}/data/modules'"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>
		<xsl:if test="$depbompresent='YES'">
			<xsl:element name="copy">
				<xsl:attribute name="todir">
					<xsl:value-of select="concat($apdoc_dir,'data/business_object_models')"/>
				</xsl:attribute>
				<xsl:element name="fileset">
					<xsl:attribute name="dir">
						<xsl:value-of select="'${TMPDIR}/data/business_object_models'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>
		</xsl:if>
		


		<!-- copy the application protocols -->
		<!-- edit which allows for publication of multiple parts within same package -->
		<!--<xsl:element name="copy">
	   <xsl:attribute name="todir">
	   	<xsl:value-of select="concat('${MERGEDIR}/data/application_protocols/',@name)"/>
	   </xsl:attribute>
	   <xsl:element name="fileset">
		 <xsl:attribute name="dir">
		   <xsl:value-of select="concat('${TMPDIR}/data/application_protocols/',@name)"/>
		 </xsl:attribute>
	   </xsl:element>
	 </xsl:element>-->
		<xsl:element name="copy">
			<xsl:attribute name="todir">
				<xsl:value-of select="concat($apdoc_dir,'data/application_protocols/',@name)"/>
			</xsl:attribute>
			<xsl:element name="fileset">
				<xsl:attribute name="dir">
					<xsl:value-of select="concat('${TMPDIR}/data/application_protocols/',@name)"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>

		<!-- copy the application protocol abstracts -->
		<!-- RBN - changed to move as per request from ISO 
	 <xsl:element name="copy"> -->
		<xsl:element name="move">
			<xsl:attribute name="file">
				<xsl:value-of
					select="concat('${TMPDIR}/data/application_protocols/',@name,'/sys/abstract.htm')"
				/>
			</xsl:attribute>
			<xsl:attribute name="tofile">
				<xsl:value-of
					select="concat($apdoc_dir,'abstracts/abstract_',$apdoc_xml/application_protocol/@part,'.htm')"
				/>
			</xsl:attribute>
		</xsl:element>

		<!-- copy the application protocol express -->
		<!-- NOT YET IMPLEMENTED -->
		<xsl:apply-templates select="." mode="copy_express">
			<xsl:with-param name="express_dir" select="concat($apdoc_dir,'express/')"/>
		</xsl:apply-templates>

		<xsl:element name="zip">
			<xsl:attribute name="zipfile">
				<xsl:value-of
					select="concat('${PUBDIR}/zip/iso10303_',$apdoc_xml/application_protocol/@part,'.zip')"
				/>
			</xsl:attribute>
			<xsl:attribute name="basedir">
				<xsl:value-of select="$apdoc_dir"/>
			</xsl:attribute>
			<xsl:attribute name="excludes">
				<xsl:value-of select="'**/*.zip'"/>
			</xsl:attribute>
			<xsl:attribute name="includes">
				<xsl:value-of select="'**'"/>
			</xsl:attribute>
		</xsl:element>
	</xsl:template>

	<!-- STAND ALONE BOM -->
	<xsl:template match="bom_doc" mode="target_publish_isobomdocs">
		<xsl:variable name="bomdoc_file"
			select="concat('../../data/business_object_models/',@name,'/business_object_model.xml')"/>
		<xsl:variable name="bomdoc_xml" select="document($bomdoc_file)"/>

		<xsl:variable name="bomdoc_iso_no"
			select="concat('iso10303_',$bomdoc_xml/business_object_model/@part)"/>
		<xsl:variable name="bomdoc_dir" select="concat('${PUBDIR}/',$bomdoc_iso_no,'/')"/>

		<xsl:text>
		</xsl:text>
		<xsl:comment>Publish Business Object models: <xsl:value-of select="@name"/>
		</xsl:comment>

		<!-- generate the publication record for the BOM  doc -->
		<xsl:apply-templates select="." mode="pub_record_style"/>

		<!-- the readme -->
		<xsl:element name="xslt">
			<xsl:attribute name="in">
				<xsl:value-of
					select="concat('data/business_object_models/',@name,'/business_object_model.xml')"
				/>
			</xsl:attribute>
			<xsl:attribute name="out">
				<xsl:value-of select="concat($bomdoc_dir,$bomdoc_iso_no,'_readme.txt')"/>
			</xsl:attribute>
			<xsl:attribute name="style">
				<xsl:value-of select="'${STEPMODSTYLES}/publication/pub_readme.xsl'"/>
			</xsl:attribute>
			<xsl:attribute name="destdir">
				<xsl:value-of select="$bomdoc_dir"/>
			</xsl:attribute>
		</xsl:element>

		<!-- make sure that the CR/LF are windows for the readme -->
		<xsl:element name="fixcrlf">
			<xsl:attribute name="srcdir">
				<xsl:value-of select="$bomdoc_dir"/>
			</xsl:attribute>
			<xsl:attribute name="includes">
				<xsl:value-of select="concat($bomdoc_iso_no,'_readme.txt')"/>
			</xsl:attribute>
			<xsl:attribute name="eol">
				<xsl:value-of select="'crlf'"/>
			</xsl:attribute>
		</xsl:element>

		<!-- the frontpage redirected to business_object_model cover page -->
		<xsl:element name="xslt">
			<xsl:attribute name="in">
				<xsl:value-of
					select="concat('data/business_object_models/',@name,'/business_object_model.xml')"
				/>
			</xsl:attribute>
			<xsl:attribute name="out">
				<!-- edit which allows for publication of multiple parts within same package -->
				<xsl:value-of select="concat($bomdoc_dir,$bomdoc_iso_no,'.htm')"/>
				<!--<xsl:value-of select="concat('${MERGEDIR}/',$bomdoc_iso_no,'.htm')"/>-->
			</xsl:attribute>
			<xsl:attribute name="style">
				<xsl:value-of select="'${STEPMODSTYLES}/publication/pub_frontpage.xsl'"/>
			</xsl:attribute>
			<xsl:attribute name="destdir">
				<xsl:value-of select="$bomdoc_dir"/>
			</xsl:attribute>
			<param name="output_type" expression="HTM"/>
		</xsl:element>

		<!-- edit which allows for publication of multiple parts within same package -->
		<!--<xsl:element name="copy">
			<xsl:attribute name="todir">
				<xsl:value-of select="'${MERGEDIR}/images'"/>
			</xsl:attribute>
			<xsl:element name="fileset">
				<xsl:attribute name="dir">
					<xsl:value-of select="'${TMPDIR}/images'"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>-->
		<xsl:element name="copy">
			<xsl:attribute name="todir">
				<xsl:value-of select="concat($bomdoc_dir,'images')"/>
			</xsl:attribute>
			<xsl:element name="fileset">
				<xsl:attribute name="dir">
					<xsl:value-of select="'${TMPDIR}/images'"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>

		<!-- edit which allows for publication of multiple parts within same package -->
		<!--<xsl:element name="copy">
			<xsl:attribute name="todir">
				<xsl:value-of select="concat('${MERGEDIR}/data/business_object_models/',@name)"/>
			</xsl:attribute>
			<xsl:element name="fileset">
				<xsl:attribute name="dir">
					<xsl:value-of select="concat('${TMPDIR}/data/business_object_models/',@name)"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>-->
		<xsl:element name="copy">
			<xsl:attribute name="todir">
				<xsl:value-of select="concat($bomdoc_dir,'data/business_object_models/',@name)"/>
			</xsl:attribute>
			<xsl:element name="fileset">
				<xsl:attribute name="dir">
					<xsl:value-of select="concat('${TMPDIR}/data/business_object_models/',@name)"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>

		<!-- copy the BOM abstracts -->
		<!-- RBN - changed to move as per request from ISO 
		<xsl:element name="copy"> -->
		<xsl:element name="move">
			<xsl:attribute name="file">
				<xsl:value-of
					select="concat('${TMPDIR}/data/business_object_models/',@name,'/sys/abstract.htm')"
				/>
			</xsl:attribute>
			<xsl:attribute name="tofile">
				<xsl:value-of
					select="concat($bomdoc_dir,'abstracts/abstract_',$bomdoc_xml/business_object_model/@part,'.htm')"
				/>
			</xsl:attribute>
		</xsl:element>

		<!-- copy the BOM  express -->
		<xsl:apply-templates select="." mode="copy_express">
			<xsl:with-param name="express_dir" select="$bomdoc_dir"/>
		</xsl:apply-templates>

		<xsl:element name="zip">
			<xsl:attribute name="zipfile">
				<xsl:value-of
					select="concat('${PUBDIR}/zip/iso10303_',$bomdoc_xml/business_object_model/@part,'.zip')"
				/>
			</xsl:attribute>
			<xsl:attribute name="basedir">
				<xsl:value-of select="$bomdoc_dir"/>
			</xsl:attribute>
			<xsl:attribute name="excludes">
				<xsl:value-of select="'**/*.zip'"/>
			</xsl:attribute>
			<xsl:attribute name="includes">
				<xsl:value-of select="'**'"/>
			</xsl:attribute>
		</xsl:element>
	</xsl:template>

	<!-- STAND ALONE BOM -->
	<!-- generate the target "publish_isobomdocs" -->
	<xsl:template match="publication_index" mode="target_publish_isobomdocs">
		<xsl:text>
		</xsl:text>
		<xsl:element name="target">
			<xsl:attribute name="name">publish_isobomdocs</xsl:attribute>
			<xsl:attribute name="depends">isoindex, isobomdocs</xsl:attribute>
			<xsl:attribute name="description">Copy HTML for boms listed in publication_index to
				publication directory</xsl:attribute>
			<xsl:apply-templates select="//bom_doc" mode="target_publish_isobomdocs"/>
		</xsl:element>
	</xsl:template>

	<!-- generate the target "publish_isomodules" -->
	<xsl:template match="publication_index" mode="target_publish_isomodules">
		<xsl:text>
	 </xsl:text>
		<xsl:element name="target">
			<xsl:attribute name="name">publish_isomodules</xsl:attribute>
			<xsl:attribute name="depends">isoindex, resources, isomodules</xsl:attribute>
			<xsl:attribute name="description">Copy HTML for modules listed in publication_index to
				publication directory</xsl:attribute>
			<xsl:apply-templates select="//module" mode="target_publish_isomodules"/>
		</xsl:element>
	</xsl:template>

	<xsl:template match="module" mode="target_publish_isomodules">

		<xsl:variable name="module_file" select="concat('../../data/modules/',@name,'/module.xml')"/>
		<xsl:variable name="module_xml" select="document($module_file)"/>

		<xsl:variable name="module_iso_no" select="concat('iso10303_',$module_xml/module/@part)"/>
		<xsl:variable name="module_dir" select="concat('${PUBDIR}/',$module_iso_no,'/')"/>

		<xsl:text>
	 </xsl:text>
		<xsl:comment> Publish module: <xsl:value-of select="@name"/>
		</xsl:comment>

		<!-- generate the publication record -->
		<xsl:apply-templates select="." mode="pub_record_style"/>

		<!-- the readme -->
		<xsl:element name="xslt">
			<xsl:attribute name="in">
				<xsl:value-of select="concat('data/modules/',@name,'/module.xml')"/>
			</xsl:attribute>
			<xsl:attribute name="out">
				<xsl:value-of select="concat($module_dir,$module_iso_no,'_readme.txt')"/>
			</xsl:attribute>
			<xsl:attribute name="style">
				<xsl:value-of select="'${STEPMODSTYLES}/publication/pub_readme.xsl'"/>
			</xsl:attribute>
			<xsl:attribute name="destdir">
				<xsl:value-of select="$module_dir"/>
			</xsl:attribute>
		</xsl:element>

		<!-- make sure that the CR/LF are windows for the readme -->
		<xsl:element name="fixcrlf">
			<xsl:attribute name="srcdir">
				<xsl:value-of select="$module_dir"/>
			</xsl:attribute>
			<xsl:attribute name="includes">
				<xsl:value-of select="concat($module_iso_no,'_readme.txt')"/>
			</xsl:attribute>
			<xsl:attribute name="eol">
				<xsl:value-of select="'crlf'"/>
			</xsl:attribute>
		</xsl:element>

		<!-- the frontpage redirected to module cover page -->
		<xsl:element name="xslt">
			<xsl:attribute name="in">
				<xsl:value-of select="concat('data/modules/',@name,'/module.xml')"/>
			</xsl:attribute>
			<xsl:attribute name="out">
				<!-- edit which allows for publication of multiple parts within same package -->
				<xsl:value-of select="concat($module_dir,$module_iso_no,'.htm')"/>
				<!--<xsl:value-of select="concat('${MERGEDIR}/',$module_iso_no,'.htm')"/>-->
			</xsl:attribute>
			<xsl:attribute name="style">
				<xsl:value-of select="'${STEPMODSTYLES}/publication/pub_frontpage.xsl'"/>
			</xsl:attribute>
			<xsl:attribute name="destdir">
				<xsl:value-of select="$module_dir"/>
			</xsl:attribute>
			<param name="output_type" expression="HTM"/>
		</xsl:element>

		<!-- edit which allows for publication of multiple parts within same package -->
		<!--<xsl:element name="copy">
	   <xsl:attribute name="todir">
	   	<xsl:value-of select="'${MERGEDIR}/images'"/>
	   </xsl:attribute>
	   <xsl:element name="fileset">
		 <xsl:attribute name="dir">
		   <xsl:value-of select="'${TMPDIR}/images'"/>
		 </xsl:attribute>
	   </xsl:element>
	 </xsl:element>-->
		<xsl:element name="copy">
			<xsl:attribute name="todir">
				<xsl:value-of select="concat($module_dir,'images')"/>
			</xsl:attribute>
			<xsl:element name="fileset">
				<xsl:attribute name="dir">
					<xsl:value-of select="'${TMPDIR}/images'"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>

		<!-- copy the resources -->
		<!-- edit which allows for publication of multiple parts within same package -->
		<xsl:element name="copy">
			<xsl:attribute name="todir">
				<xsl:value-of select="'${MERGEDIR}/data/resources'"/>
			</xsl:attribute>
			<xsl:element name="fileset">
				<xsl:attribute name="dir">
					<xsl:value-of select="'${TMPDIR}/data/resources'"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>
		<!-- <xsl:element name="copy">
	   <xsl:attribute name="todir">
		 <xsl:value-of select="concat($module_dir,'data/resources')"/>
	   </xsl:attribute>
	   <xsl:element name="fileset">
		 <xsl:attribute name="dir">
		   <xsl:value-of select="'${TMPDIR}/data/resources'"/>
		 </xsl:attribute>
	   </xsl:element>
	 </xsl:element> -->

		<!-- edit which allows for publication of multiple parts within same package -->
		<!--<xsl:element name="copy">
	   <xsl:attribute name="todir">
	   	<xsl:value-of select="concat('${MERGEDIR}/data/modules/',@name)"/>
	   </xsl:attribute>
	   <xsl:element name="fileset">
		 <xsl:attribute name="dir">
		   <xsl:value-of select="concat('${TMPDIR}/data/modules/',@name)"/>
		 </xsl:attribute>
	   </xsl:element>
	 </xsl:element>-->
		<xsl:element name="copy">
			<xsl:attribute name="todir">
				<xsl:value-of select="concat($module_dir,'data/modules/',@name)"/>
			</xsl:attribute>
			<xsl:element name="fileset">
				<xsl:attribute name="dir">
					<xsl:value-of select="concat('${TMPDIR}/data/modules/',@name)"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>

		<!-- RBN - changed to move as per request from ISO 
	 <xsl:element name="copy">
	   -->
		<xsl:element name="move">
			<xsl:attribute name="file">
				<xsl:value-of select="concat($module_dir,'data/modules/',@name,'/sys/abstract.htm')"
				/>
			</xsl:attribute>
			<xsl:attribute name="tofile">
				<xsl:value-of
					select="concat($module_dir,'abstracts/abstract_',$module_xml/module/@part,'.htm')"
				/>
			</xsl:attribute>
		</xsl:element>

		<xsl:apply-templates select="." mode="copy_express"/>

		<xsl:element name="zip">
			<xsl:attribute name="zipfile">
				<xsl:value-of
					select="concat('${PUBDIR}/zip/iso10303_',$module_xml/module/@part,'.zip')"/>
			</xsl:attribute>
			<xsl:attribute name="basedir">
				<xsl:value-of select="$module_dir"/>
			</xsl:attribute>
			<xsl:attribute name="excludes">
				<xsl:value-of select="'**/*.zip'"/>
			</xsl:attribute>
			<xsl:attribute name="includes">
				<xsl:value-of select="'**'"/>
			</xsl:attribute>
		</xsl:element>
	</xsl:template>


	<xsl:template match="publication_index" mode="target_publish_isoresdocs">
		<xsl:text>
	 </xsl:text>
		<xsl:element name="target">
			<xsl:attribute name="name">publish_isoresdocs</xsl:attribute>
			<xsl:attribute name="depends">isoindex, resources, isoresdocs</xsl:attribute>
			<xsl:attribute name="description">Copy HTML to publication directory</xsl:attribute>
			<xsl:apply-templates select="//res_doc" mode="target_publish_isoresdocs"/>
		</xsl:element>
	</xsl:template>

	<xsl:template match="res_doc" mode="target_publish_isoresdocs">
		<xsl:variable name="resdoc_file"
			select="concat('../../data/resource_docs/',@name,'/resource.xml')"/>
		<xsl:variable name="resdoc_xml" select="document($resdoc_file)"/>

		<xsl:variable name="resdoc_iso_no" select="concat('iso10303_',$resdoc_xml/resource/@part)"/>
		<xsl:variable name="resdoc_dir" select="concat('${PUBDIR}/',$resdoc_iso_no,'/')"/>
		<xsl:variable name="resdoc_express_dir"
			select="concat('${PUBDIR}/',$resdoc_iso_no,'/','inserts','/')"/>

		<xsl:variable name="data_resdoc_dir"
			select="concat($resdoc_dir,'data/resource_docs/',@name,'/')"/>


		<xsl:variable name="part" select="$resdoc_xml/resource/@part"/>
		<xsl:variable name="status"
			select="translate(translate($resdoc_xml/resource/@status,$UPPER,$LOWER),'-','')"/>
		<xsl:variable name="wg" select="$resdoc_xml/resource/@sc4.working_group"/>
		<xsl:variable name="prefix" select="concat('part',$part,$status,'_wg',$wg,'n')"/>

		<xsl:variable name="wg.number.express" select="$resdoc_xml/resource/@wg.number.express"/>


		<xsl:text>
	 </xsl:text>
		<xsl:comment>Publish resource doc: <xsl:value-of select="@name"/>
		</xsl:comment>

		<!-- generate the publication record for the AP doc-->
		<xsl:apply-templates select="." mode="pub_record_style"/>

		<!-- the readme -->
		<xsl:element name="xslt">
			<xsl:attribute name="in">
				<xsl:value-of select="concat('data/resource_docs/',@name,'/resource.xml')"/>
			</xsl:attribute>
			<xsl:attribute name="out">
				<xsl:value-of select="concat($resdoc_dir,$resdoc_iso_no,'_readme.txt')"/>
			</xsl:attribute>
			<xsl:attribute name="style">
				<xsl:value-of select="'${STEPMODSTYLES}/publication/pub_readme.xsl'"/>
			</xsl:attribute>
			<xsl:attribute name="destdir">
				<xsl:value-of select="$resdoc_dir"/>
			</xsl:attribute>
		</xsl:element>

		<!-- make sure that the CR/LF are windows for the readme -->
		<xsl:element name="fixcrlf">
			<xsl:attribute name="srcdir">
				<xsl:value-of select="$resdoc_dir"/>
			</xsl:attribute>
			<xsl:attribute name="includes">
				<xsl:value-of select="concat($resdoc_iso_no,'_readme.txt')"/>
			</xsl:attribute>
			<xsl:attribute name="eol">
				<xsl:value-of select="'crlf'"/>
			</xsl:attribute>
		</xsl:element>

		<!-- the frontpage redirected to resource cover page -->
		<xsl:element name="xslt">
			<xsl:attribute name="in">
				<xsl:value-of select="concat('data/resource_docs/',@name,'/resource.xml')"/>
			</xsl:attribute>
			<xsl:attribute name="out">
				<!-- edit which allows for publication of multiple parts within same package -->
				<xsl:value-of select="concat($resdoc_dir,$resdoc_iso_no,'.htm')"/>
				<!--<xsl:value-of select="concat('${MERGEDIR}/',$resdoc_iso_no,'.htm')"/>-->
			</xsl:attribute>
			<xsl:attribute name="style">
				<xsl:value-of select="'${STEPMODSTYLES}/publication/pub_frontpage.xsl'"/>
			</xsl:attribute>
			<xsl:attribute name="destdir">
				<xsl:value-of select="$resdoc_dir"/>
			</xsl:attribute>
			<param name="output_type" expression="HTM"/>
		</xsl:element>

		<!-- edit which allows for publication of multiple parts within same package -->
		<!--<xsl:element name="copy">
	   <xsl:attribute name="todir">
	   	<xsl:value-of select="'${MERGEDIR}/images'"/>
	   </xsl:attribute>
	   <xsl:element name="fileset">
		 <xsl:attribute name="dir">
		   <xsl:value-of select="'${TMPDIR}/images'"/>
		 </xsl:attribute>
	   </xsl:element>
	 </xsl:element>-->
		<xsl:element name="copy">
			<xsl:attribute name="todir">
				<xsl:value-of select="concat($resdoc_dir,'images')"/>
			</xsl:attribute>
			<xsl:element name="fileset">
				<xsl:attribute name="dir">
					<xsl:value-of select="'${TMPDIR}/images'"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>

		<!-- copy the resources -->
		<!-- edit which allows for publication of multiple parts within same package -->
		<!--<xsl:element name="copy">
	   <xsl:attribute name="todir">
	   	<xsl:value-of select="'${MERGEDIR}/data/resources'"/>
	   </xsl:attribute>
	   <xsl:element name="fileset">
		 <xsl:attribute name="dir">
		   <xsl:value-of select="'${TMPDIR}/data/resources'"/>
		 </xsl:attribute>
	   </xsl:element>
	 </xsl:element>-->
		<xsl:element name="copy">
			<xsl:attribute name="todir">
				<xsl:value-of select="concat($resdoc_dir,'data/resources')"/>
			</xsl:attribute>
			<xsl:element name="fileset">
				<xsl:attribute name="dir">
					<xsl:value-of select="'${TMPDIR}/data/resources'"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>


		<!-- copy the resource_docs  abstracts -->
		<!-- RBN - changed to move as per request from ISO 
	 <xsl:element name="copy">
	   -->
		<xsl:element name="move">
			<xsl:attribute name="file">
				<xsl:value-of
					select="concat('${TMPDIR}/data/resource_docs/',@name,'/sys/abstract.htm')"/>
			</xsl:attribute>
			<xsl:attribute name="tofile">
				<xsl:value-of
					select="concat($resdoc_dir,'abstracts/abstract_',$resdoc_xml/resource/@part,'.htm')"
				/>
			</xsl:attribute>
		</xsl:element>



		<!-- copy the resource docs -->
		<!-- edit which allows for publication of multiple parts within same package -->
		<!--<xsl:element name="copy">
	   <xsl:attribute name="todir">
	   	<xsl:value-of select="concat('${MERGEDIR}/data/resource_docs/',@name)"/>
	   </xsl:attribute>
	   <xsl:element name="fileset">
		 <xsl:attribute name="dir">
		   <xsl:value-of select="concat('${TMPDIR}/data/resource_docs/',@name)"/>
		 </xsl:attribute>
	   </xsl:element>
	 </xsl:element>-->
		<xsl:element name="copy">
			<xsl:attribute name="todir">
				<xsl:value-of select="concat($resdoc_dir,'data/resource_docs/',@name)"/>
			</xsl:attribute>
			<xsl:element name="fileset">
				<xsl:attribute name="dir">
					<xsl:value-of select="concat('${TMPDIR}/data/resource_docs/',@name)"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>

		<xsl:apply-templates select="." mode="copy_express"/>


		<!-- cocatenate the resource doc  express -->


		<xsl:variable name="schemalist">
			<xsl:apply-templates select="$resdoc_xml//schema" mode="list">
				<xsl:with-param name="prefix" select="'data/resources/'"/>
				<xsl:with-param name="suffix" select="'.exp'"/>
				<xsl:with-param name="terminate" select="'NO'"/>
			</xsl:apply-templates>
		</xsl:variable>

		<xsl:variable name="express_file"
			select="concat('part',
						 $resdoc_xml/resource/@part,
						 $resdoc_xml/resource/@status, '_wg',
						 $resdoc_xml/resource/@sc4.working_group,'n',
						 $resdoc_xml/resource/@wg.number.express,
						 'express.exp')"/>


		<xsl:variable name="express_dir">
			<xsl:value-of
				select="concat('${PUBDIR}','/iso10303_',$resdoc_xml/resource/@part,'/','inserts','/')"
			/>
		</xsl:variable>


		<xsl:element name="mkdir">
			<xsl:attribute name="dir">
				<xsl:value-of select="$express_dir"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="concat">
			<xsl:attribute name="destfile">
				<xsl:value-of select="concat($data_resdoc_dir,'wg12n',$wg.number.express,'.exp')"/>
			</xsl:attribute>
			<xsl:element name="fileset">
				<xsl:attribute name="dir">
					<xsl:value-of select="'.'"/>
				</xsl:attribute>
				<xsl:attribute name="includes">
					<xsl:value-of select="$schemalist"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>

		<xsl:element name="concat">
			<xsl:attribute name="destfile">
				<!--          <xsl:value-of select="concat('wg12n',$wg.number.express,'.exp')" /> -->
				<xsl:value-of select="concat($express_dir,$express_file)"/>
			</xsl:attribute>
			<xsl:element name="fileset">
				<xsl:attribute name="dir">
					<xsl:value-of select="'.'"/>
				</xsl:attribute>
				<xsl:attribute name="includes">
					<xsl:value-of select="$schemalist"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>


		<xsl:element name="zip">
			<xsl:attribute name="zipfile">
				<xsl:value-of
					select="concat('${PUBDIR}/zip/iso10303_',$resdoc_xml/resource/@part,'.zip')"/>
			</xsl:attribute>
			<xsl:attribute name="basedir">
				<xsl:value-of select="$resdoc_dir"/>
			</xsl:attribute>
			<xsl:attribute name="excludes">
				<xsl:value-of select="'**/*.zip'"/>
			</xsl:attribute>
			<xsl:attribute name="includes">
				<xsl:value-of select="'**'"/>
			</xsl:attribute>
		</xsl:element>

		<!-- need express in zips, else why create it? -->

		<xsl:element name="zip">
			<xsl:attribute name="zipfile">
				<xsl:value-of
					select="concat('${PUBDIR}/zip/iso10303_',$resdoc_xml/resource/@part,'inserts.zip')"
				/>
			</xsl:attribute>
			<xsl:attribute name="basedir">
				<xsl:value-of select="$resdoc_express_dir"/>
			</xsl:attribute>
			<xsl:attribute name="excludes">
				<xsl:value-of select="'**/*.zip'"/>
			</xsl:attribute>
			<xsl:attribute name="includes">
				<xsl:value-of select="'**'"/>
			</xsl:attribute>
		</xsl:element>
	</xsl:template>


	<!-- generate the target "all" -->
	<xsl:template match="publication_index" mode="target_all">
		<xsl:text>
	 </xsl:text>
		<xsl:variable name="target1">
			<xsl:apply-templates select="./resource_docs" mode="target_all"/>
			<xsl:apply-templates select="./modules" mode="target_all"/>
			<xsl:apply-templates select="./application_protocols" mode="target_all"/>
			<!-- BOM -->
			<xsl:apply-templates select="./business_object_models" mode="target_all"/>
		</xsl:variable>
		<xsl:variable name="target">
			<xsl:call-template name="output_comma_separated_list">
				<xsl:with-param name="string" select="normalize-space($target1)"/>
			</xsl:call-template>
		</xsl:variable>
		<xsl:element name="target">
			<xsl:attribute name="name">all</xsl:attribute>
			<xsl:attribute name="depends"><xsl:value-of select="$target"/>, finish</xsl:attribute>
			<xsl:attribute name="description">Generate the HTML for ISO publication</xsl:attribute>
		</xsl:element>
	</xsl:template>

	<xsl:template match="resource_docs" mode="target_all"> publish_isoresdocs </xsl:template>

	<xsl:template match="modules" mode="target_all"> publish_isomodules </xsl:template>

	<xsl:template match="application_protocols" mode="target_all"> publish_isoapdocs </xsl:template>

	<!-- STAND ALONE BOM -->
	<xsl:template match="business_object_models" mode="target_all"> publish_isobomdocs </xsl:template>

	<!-- EMBEDDED BOM -->
	<!-- generate the target "isodepmodules_publication_record" -->
	<xsl:template match="publication_index" mode="target_isodepmodules_publication_record">
		<xsl:text>
	 </xsl:text>
		<xsl:element name="target">
			<xsl:attribute name="name">isodepmodules_publication_record</xsl:attribute>
			<xsl:attribute name="depends">init</xsl:attribute>
			<xsl:apply-templates select="$mim_modules_node_set/module" mode="pub_record_style"/>
		</xsl:element>
	</xsl:template>

	<xsl:template match="ap_doc" mode="copy_express">
		<xsl:param name="express_dir"/>

		<!-- the readme -->
		<xsl:element name="xslt">
			<xsl:attribute name="in">
				<xsl:value-of
					select="concat('data/application_protocols/',@name,'/application_protocol.xml')"
				/>
			</xsl:attribute>
			<xsl:attribute name="out">
				<xsl:value-of select="concat($express_dir,'readme.txt')"/>
			</xsl:attribute>
			<xsl:attribute name="style">
				<xsl:value-of select="'${STEPMODSTYLES}/publication/pub_express_readme.xsl'"/>
			</xsl:attribute>
			<xsl:attribute name="destdir">
				<xsl:value-of select="$express_dir"/>
			</xsl:attribute>
		</xsl:element>

		<!-- make sure that the CR/LF are windows for the readme -->
		<xsl:element name="fixcrlf">
			<xsl:attribute name="srcdir">
				<xsl:value-of select="$express_dir"/>
			</xsl:attribute>
			<xsl:attribute name="includes">
				<xsl:value-of select="'readme.txt'"/>
			</xsl:attribute>
			<xsl:attribute name="eol">
				<xsl:value-of select="'crlf'"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:apply-templates select="$mim_modules_node_set/module" mode="copy_express">
			<xsl:with-param name="express_dir" select="$express_dir"/>
		</xsl:apply-templates>
		<xsl:apply-templates select="../modules/module" mode="copy_express">
			<xsl:with-param name="express_dir" select="$express_dir"/>
		</xsl:apply-templates>

		<!-- copy the resources -->
		<xsl:element name="copy">
			<xsl:attribute name="todir">
				<xsl:value-of select="$express_dir"/>
			</xsl:attribute>
			<xsl:attribute name="flatten">
				<xsl:value-of select="'true'"/>
			</xsl:attribute>
			<xsl:element name="fileset">
				<xsl:attribute name="dir">
					<xsl:value-of select="'${TMPDIR}/data/resources'"/>
				</xsl:attribute>
				<xsl:element name="include">
					<xsl:attribute name="name">
						<xsl:value-of select="'**/*.exp'"/>
					</xsl:attribute>
				</xsl:element>
			</xsl:element>
		</xsl:element>
	</xsl:template>


	<xsl:template match="bom_doc" mode="copy_express">
		<xsl:param name="express_dir"/>
		<xsl:variable name="bom" select="@name"/>
		<xsl:variable name="bom_node"
			select="document(concat('../../data/business_object_models/',$bom,'/business_object_model.xml'))/business_object_model"/>
		<xsl:variable name="bom_iso_no" select="concat('iso10303_',$bom_node/@part)"/>
		<xsl:variable name="express_dir1">
			<xsl:choose>
				<xsl:when test="$express_dir">
					<xsl:value-of select="$express_dir"/>
				</xsl:when>
				<xsl:otherwise>
					<xsl:value-of select="concat('${PUBDIR}/',$bom_iso_no,'/','inserts/')"/>
				</xsl:otherwise>
			</xsl:choose>
		</xsl:variable>

		<xsl:variable name="part" select="$bom_node/@part"/>
		<xsl:variable name="status"
			select="translate(translate($bom_node/@status,$UPPER,$LOWER),'-','')"/>
		<!--<xsl:variable name="wg" select="$bom_node/@sc4.working_group"/>-->
		<xsl:variable name="wg" select="12"/>
		<xsl:variable name="prefix" select="concat('part',$part,$status,'_wg',$wg,'n')"/>

		<xsl:variable name="bomexpfile"
			select="concat('part',
			$bom_node/@part,
			$status, $prefix,
			$bom_node/@wg.number.bom.exp,
			'bom.exp')"/>
		<xsl:element name="copy">
			<xsl:attribute name="file">
				<xsl:value-of select="concat('data/business_object_models/',@name,'/bom.exp')"/>
			</xsl:attribute>
			<xsl:attribute name="tofile">
				<xsl:value-of select="concat($express_dir1,$bomexpfile)"/>
			</xsl:attribute>
		</xsl:element>
		<xsl:variable name="bomxsdfile"
			select="concat('part',
			$bom_node/@part,
			$status, $prefix,
			$bom_node/@wg.number.bom.xsd,
			'bom.xsd')"/>
		<xsl:element name="copy">
			<xsl:attribute name="file">
				<xsl:value-of select="concat('data/business_object_models/',@name,'/bom.xsd')"/>
			</xsl:attribute>
			<xsl:attribute name="tofile">
				<xsl:value-of select="concat($express_dir1,$bomxsdfile)"/>
			</xsl:attribute>
		</xsl:element>

	</xsl:template>

	<xsl:template match="module" mode="copy_express">
		<xsl:param name="express_dir"/>
		<xsl:variable name="module" select="@name"/>
		<xsl:variable name="module_xml"
			select="document(concat('../../data/modules/',$module,'/module.xml'))"/>
		<xsl:variable name="module_iso_no" select="concat('iso10303_',$module_xml/module/@part)"/>
		<xsl:variable name="express_dir1">
			<xsl:choose>
				<xsl:when test="$express_dir">
					<xsl:value-of select="$express_dir"/>
				</xsl:when>
				<xsl:otherwise>
					<xsl:value-of select="concat('${PUBDIR}/',$module_iso_no,'/','inserts/')"/>
				</xsl:otherwise>
			</xsl:choose>
		</xsl:variable>

		<xsl:variable name="part" select="$module_xml/module/@part"/>
		<xsl:variable name="status"
			select="translate(translate($module_xml/module/@status,$UPPER,$LOWER),'-','')"/>
		<xsl:variable name="wg" select="$module_xml/module/@sc4.working_group"/>
		<xsl:variable name="prefix" select="concat('part',$part,$status,'_wg',$wg,'n')"/>

		<xsl:variable name="wg.number.arm" select="$module_xml/module/@wg.number.arm"/>
		<xsl:element name="copy">
			<xsl:attribute name="file">
				<xsl:value-of select="concat('data/modules/',@name,'/arm.exp')"/>
			</xsl:attribute>
			<xsl:attribute name="tofile">
				<xsl:value-of select="concat($express_dir1,'arm.exp')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:if test="$module_xml/module/arm_lf">
			<xsl:variable name="wg.number.arm_lf" select="$module_xml/module/@wg.number.arm_lf"/>
			<xsl:element name="copy">
				<xsl:attribute name="file">
					<xsl:value-of select="concat('data/modules/',@name,'/arm_lf.exp')"/>
				</xsl:attribute>
				<xsl:attribute name="tofile">
					<xsl:value-of
						select="concat($express_dir1,$prefix,$wg.number.arm_lf,'arm_lf.exp')"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:if>

		<xsl:variable name="wg.number.mim" select="$module_xml/module/@wg.number.mim"/>
		<xsl:element name="copy">
			<xsl:attribute name="file">
				<xsl:value-of select="concat('data/modules/',@name,'/mim.exp')"/>
			</xsl:attribute>
			<xsl:attribute name="tofile">
				<xsl:value-of select="concat($express_dir1,'mim.exp')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:if test="$module_xml/module/mim_lf">
			<xsl:variable name="wg.number.mim_lf" select="$module_xml/module/@wg.number.mim_lf"/>
			<xsl:element name="copy">
				<xsl:attribute name="file">
					<xsl:value-of select="concat('data/modules/',@name,'/mim_lf.exp')"/>
				</xsl:attribute>
				<xsl:attribute name="tofile">
					<xsl:value-of
						select="concat($express_dir1,$prefix,$wg.number.mim_lf,'mim_lf.exp')"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:if>
	</xsl:template>

	<!--
   <xsl:template match="res_doc" mode="copy_express">
	 <xsl:param name="express_dir"/>
	 <xsl:variable name="resdoc_schema">
	   <xsl:call-template name="get_resource_schema_node_set"/>
	 </xsl:variable>

	 <xsl:variable name="resdoc" select="@name"/>
	 <xsl:variable name="resdoc_iso_no" select="concat('iso10303_',$resdoc_xml/resource/@part)"/>
	 <xsl:variable name="express_dir1">
	   <xsl:choose>
		 <xsl:when test="$express_dir">
		   <xsl:value-of select="$express_dir"/>
		 </xsl:when>
		 <xsl:otherwise>
		   <xsl:value-of select="concat('${PUBDIR}/',$resdoc_iso_no,'/','inserts/')"/>  
		 </xsl:otherwise>
	   </xsl:choose>
	 </xsl:variable>


	 <xsl:variable name="part" select="$resdoc_xml/resource/@part"/>
	 <xsl:variable name="status" 
	   select="translate(translate($resdoc_xml/resource/@status,$UPPER,$LOWER),'-','')"/>
	 <xsl:variable name="wg" select="$resdoc_xml/resource/@sc4.working_group"/>
	 <xsl:variable name="prefix" select="concat('part',$part,$status,'_wg',$wg,'n')"/>

	 <xsl:variable name="wg.number.express" select="$resdoc_xml/resource/@wg.number.express"/>
	 <xsl:element name="copy">
	   <xsl:attribute name="file">
		 <xsl:value-of select="concat('data/resource_docs/',@name,'/',@name,'.exp')"/>
	   </xsl:attribute>
	   <xsl:attribute name="tofile">
		 <xsl:value-of select="concat($express_dir1,$prefix,$wg.number.express,@name,'.exp')"/>
	   </xsl:attribute>
	 </xsl:element>


   </xsl:template>
 -->

	<xsl:template match="schema" mode="list">
		<xsl:param name="prefix"/>
		<xsl:param name="suffix"/>
		<xsl:param name="terminate" select="'YES'"/>
		<!-- the name of the resource directory should be in lower case -->
		<xsl:variable name="lname" select="translate(./@name,$UPPER,$LOWER)"/>
		<!-- workaround - only output first occurrence of a module -->
		<xsl:if test="not(./preceding-sibling::*[@name = $lname])">
			<xsl:choose>
				<xsl:when test="$terminate='YES'">
					<xsl:choose>
						<xsl:when test="position()=last()">
							<xsl:value-of select="concat($prefix,$lname,'/',$lname,$suffix)"/>
							<xsl:text/>
						</xsl:when>
						<xsl:otherwise>
							<xsl:value-of select="concat($prefix,$lname,'/',$lname,$suffix)"
							/>,<xsl:text/>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:when>
				<xsl:otherwise>
					<xsl:value-of select="concat($prefix,$lname,'/',$lname,$suffix)"/>,<xsl:text/>
				</xsl:otherwise>
			</xsl:choose>
		</xsl:if>
	</xsl:template>

	<xsl:template match="resource|module|application_protocol|res_doc|bom_doc" mode="list">
		<xsl:param name="prefix" select="''"/>
		<xsl:param name="suffix" select="''"/>
		<xsl:param name="terminate" select="'YES'"/>
		<!-- the name of the resource directory should be in lower case -->
		<xsl:variable name="lname" select="translate(./@name,$UPPER,$LOWER)"/>
		<!-- workaround - only output first occurrence of a module -->
		<xsl:if test="not(./preceding-sibling::*[@name = $lname])">
			<xsl:choose>
				<xsl:when test="$terminate='YES'">
					<xsl:choose>
						<xsl:when test="position()=last()">
							<xsl:value-of select="concat($prefix,$lname,$suffix)"/>
							<xsl:text/>
						</xsl:when>
						<xsl:otherwise>
							<xsl:value-of select="concat($prefix,$lname,$suffix)"/>,<xsl:text/>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:when>
				<xsl:otherwise>
					<xsl:value-of select="concat($prefix,$lname,$suffix)"/>,<xsl:text/>
				</xsl:otherwise>
			</xsl:choose>
		</xsl:if>
	</xsl:template>

	<xsl:template name="embedded_bom_doc">
		<xsl:param name="bom_doc_param"/>
		<xsl:param name="prefix" select="''"/>
		<xsl:param name="suffix" select="''"/>
		<xsl:param name="terminate" select="'YES'"/>
		<!-- the name of the resource directory should be in lower case -->
		<xsl:variable name="lname" select="translate($bom_doc_param,$UPPER,$LOWER)"/>
		<xsl:value-of select="concat($prefix,$lname,$suffix)"/>,<xsl:text/>
	</xsl:template>


	<xsl:template match="module" mode="long_form">
		<xsl:param name="prefix"/>
		<xsl:param name="suffix"/>
		<xsl:param name="terminate" select="'YES'"/>
		<!-- need a variable for xpath -->
		<xsl:variable name="lname" select="translate(./@name,$UPPER,$LOWER)"/>
		<xsl:variable name="module_xml"
			select="document(concat('../../data/modules/',@name,'/module.xml'))"/>
		<!-- only want modules that declare a long form -->
		<!-- workaround - only output first occurrence of a module -->
		<xsl:if test="$module_xml/module/arm_lf and not(./preceding-sibling::*[@name = $lname])">
			<xsl:choose>
				<xsl:when test="$terminate='YES'">
					<xsl:choose>
						<xsl:when test="position()=last()">
							<xsl:value-of select="concat($prefix,@name,$suffix)"/>
							<xsl:text/>
						</xsl:when>
						<xsl:otherwise>
							<xsl:value-of select="concat($prefix,@name,$suffix)"/>,<xsl:text/>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:when>
				<xsl:otherwise>
					<xsl:value-of select="concat($prefix,@name,$suffix)"/>,<xsl:text/>
				</xsl:otherwise>
			</xsl:choose>
		</xsl:if>
	</xsl:template>


	<xsl:template match="modules" mode="present"> 1 </xsl:template>

	<xsl:template match="resource_docs" mode="present"> 2 </xsl:template>

	<xsl:template match="application_protocols" mode="present"> 3 </xsl:template>

	<xsl:template match="business_object_models" mode="present"> 4 </xsl:template>

	<xsl:template match="publication_index" mode="check_single">
		<xsl:variable name="present1">
			<xsl:apply-templates select="modules" mode="present"/>
			<xsl:apply-templates select="resource_docs" mode="present"/>
			<xsl:apply-templates select="application_protocols" mode="present"/>
		</xsl:variable>
		<xsl:variable name="present" select="normalize-space($present1)"/>
		<xsl:choose>
			<xsl:when test="string-length($present)>1">
				<xsl:message> ************************************************************ WARNING
					Should only process application protocols or modules or resources Not a mixture
					************************************************************ </xsl:message>
				<xsl:value-of select="'false'"/>
			</xsl:when>
			<xsl:otherwise>
				<xsl:value-of select="'true'"/>
			</xsl:otherwise>
		</xsl:choose>

	</xsl:template>

	<xsl:template match="publication_index" mode="check">
		<xsl:variable name="result">
			<xsl:apply-templates select="modules/module" mode="check"/>
			<xsl:apply-templates select="resource_docs/res_doc" mode="check"/>
			<xsl:apply-templates select="application_protocols/ap_doc" mode="check"/>
		</xsl:variable>
		<xsl:value-of select="normalize-space($result)"/>
	</xsl:template>

	<!-- run a check on each module listed in publication_index -->
	<xsl:template match="module" mode="check">
		<xsl:variable name="module_ok">
			<xsl:call-template name="check_module_exists">
				<xsl:with-param name="module" select="@name"/>
			</xsl:call-template>
		</xsl:variable>
		<xsl:choose>
			<xsl:when test="$module_ok!='true'">
				<xsl:message> ************************************************************ ERROR 1
						<xsl:value-of select="$module_ok"/>
					************************************************************ </xsl:message>
				<xsl:value-of select="'false'"/>
			</xsl:when>
			<xsl:otherwise>
				<xsl:value-of select="'true'"/>
			</xsl:otherwise>
		</xsl:choose>
	</xsl:template>


	<!-- run a check on each resource doc listed in publication_index -->
	<xsl:template match="res_doc" mode="check">
		<xsl:variable name="resdoc_ok">
			<xsl:call-template name="check_resdoc_exists">
				<xsl:with-param name="resdoc" select="@name"/>
			</xsl:call-template>
		</xsl:variable>
		<xsl:choose>
			<xsl:when test="$resdoc_ok!='true'">
				<xsl:message> ************************************************************ ERROR 1
						<xsl:value-of select="$resdoc_ok"/>
					************************************************************ </xsl:message>
				<xsl:value-of select="'false'"/>
			</xsl:when>
			<xsl:otherwise>
				<xsl:value-of select="'true'"/>
			</xsl:otherwise>
		</xsl:choose>
	</xsl:template>


	<!-- BOM -->
	<!-- run a check on each business_object_model doc listed in publication_index -->
	<!--<xsl:template match="bom_doc" mode="check">
		<xsl:variable name="bomdoc_ok">
			<xsl:call-template name="check_bomdoc_exists">
				<xsl:with-param name="bomdoc" select="@name"/>
			</xsl:call-template>
		</xsl:variable>
		<xsl:choose>
			<xsl:when test="$bomdoc_ok!='true'">
				<xsl:message>
					************************************************************
					ERROR 1 
					<xsl:value-of select="$bomdoc_ok"/>
					************************************************************
				</xsl:message>
				<xsl:value-of select="'false'"/>
			</xsl:when>
			<xsl:otherwise>
				<xsl:value-of select="'true'"/>
			</xsl:otherwise>
		</xsl:choose>
	</xsl:template>-->


	<!-- run a check on each application protocol listed in publication_index -->
	<xsl:template match="ap_doc" mode="check">
		<xsl:variable name="apdoc_ok">
			<xsl:call-template name="check_application_protocol_exists">
				<xsl:with-param name="application_protocol" select="@name"/>
			</xsl:call-template>
		</xsl:variable>
		<xsl:choose>
			<xsl:when test="$apdoc_ok!='true'">
				<xsl:message> ************************************************************ ERROR 1
						<xsl:value-of select="$apdoc_ok"/>
					************************************************************ </xsl:message>
				<xsl:value-of select="'false'"/>
			</xsl:when>
			<xsl:otherwise>
				<xsl:value-of select="'true'"/>
			</xsl:otherwise>
		</xsl:choose>
	</xsl:template>



	<!-- given the name of a module, check to see whether it has been
		included in the repository_index.xml file
		Return true or if not found, an error message.
		-->
	<xsl:template name="check_module_exists">
		<xsl:param name="module"/>

		<xsl:variable name="module_name">
			<xsl:call-template name="module_name">
				<xsl:with-param name="module" select="$module"/>
			</xsl:call-template>
		</xsl:variable>

		<xsl:variable name="ret_val">
			<xsl:choose>
				<xsl:when
					test="document('../../repository_index.xml')/repository_index/modules/module[@name=$module_name]">
					<xsl:value-of select="'true'"/>
				</xsl:when>
				<xsl:otherwise>
					<xsl:value-of
						select="concat(' The module ', $module_name,
					   ' is not identified as a module in repository_index.xml')"
					/>
				</xsl:otherwise>
			</xsl:choose>
		</xsl:variable>
		<xsl:value-of select="$ret_val"/>
	</xsl:template>

	<!-- return a node set of all the dependent resources for a resource doc,
 possibly excluding any that are explicitly part of the ballot -->
	<xsl:template name="get_resource_schema_node_set">
		<xsl:variable name="resource_docs">
			<xsl:for-each select="/publication_index/resource_docs/res_doc">
				<xsl:variable name="selected_res" select="@name"/>
				<xsl:variable name="res_file"
					select="concat('../../data/resource_docs/',$selected_res,'/resource.xml')"/>
				<xsl:variable name="res_node" select="document($res_file)"/>
				<xsl:for-each select="$res_node/resource/schema">
					<xsl:value-of select="concat(' ',@name,' ')"/>
				</xsl:for-each>
			</xsl:for-each>
		</xsl:variable>

		<xsl:variable name="todo_schema_list" select="string($resource_docs)"/>

		<xsl:variable name="mim_schemas"> " <xsl:call-template name="depends-on-recurse-mim-x">
				<xsl:with-param name="todo" select="$todo_schema_list"/>
				<xsl:with-param name="done" select="' '"/>
			</xsl:call-template>
		</xsl:variable>

		<xsl:variable name="schemas-node-set" select="exslt:node-set($mim_schemas)"/>


		<xsl:for-each select="$schemas-node-set//x">
			<xsl:sort/>
			<xsl:variable name="resource"
				select="substring-after(substring-before(.,'.xml'),'../../data/resources/')"/>
			<resource>
				<xsl:attribute name="name">
					<xsl:value-of select="$resource"/>
				</xsl:attribute>
			</resource>
		</xsl:for-each>

	</xsl:template>

	<!-- return a node set of all the dependent modules and resources,
	  excluding any that are explicitly part of the ballot -->
	<xsl:template name="get_mod_node_set">
		<xsl:variable name="modules">
			<xsl:for-each select="/publication_index/modules/module">
				<xsl:variable name="mod_schema">
					<xsl:call-template name="schema_name">
						<xsl:with-param name="module_name" select="@name"/>
						<xsl:with-param name="arm_mim" select="'mim'"/>
					</xsl:call-template>
				</xsl:variable>
				<xsl:value-of select="concat(' ',$mod_schema,' ')"/>
			</xsl:for-each>
		</xsl:variable>

		<xsl:variable name="aps">
			<xsl:for-each select="/publication_index/application_protocols/ap_doc">
				<xsl:variable name="selected_ap" select="@name"/>
				<xsl:variable name="ap_file"
					select="concat('../../data/application_protocols/',$selected_ap,'/application_protocol.xml')"/>
				<xsl:variable name="ap_node" select="document($ap_file)"/>
				<xsl:variable name="ap_top_module"
					select="$ap_node/application_protocol/@module_name"/>
				<xsl:variable name="mod_schema">
					<xsl:call-template name="schema_name">
						<xsl:with-param name="module_name" select="$ap_top_module"/>
						<xsl:with-param name="arm_mim" select="'mim'"/>
					</xsl:call-template>
				</xsl:variable>
				<xsl:value-of select="concat(' ',$mod_schema,' ')"/>
			</xsl:for-each>
		</xsl:variable>

		<xsl:variable name="resource_docs">
			<xsl:for-each select="/publication_index/resource_docs/res_doc">
				<xsl:variable name="selected_res" select="@name"/>
				<xsl:variable name="res_file"
					select="concat('../../data/resource_docs/',$selected_res,'/resource.xml')"/>
				<xsl:variable name="res_node" select="document($res_file)"/>
				<xsl:for-each select="$res_node/resource/schema">
					<xsl:value-of select="concat(' ',@name,' ')"/>
				</xsl:for-each>
			</xsl:for-each>
		</xsl:variable>

		<xsl:variable name="todo_schema_list"
			select="concat(string($aps),string($modules),string($resource_docs))"/>

		<xsl:variable name="mim_schemas">
			<xsl:call-template name="depends-on-recurse-mim-x">
				<xsl:with-param name="todo" select="$todo_schema_list"/>
				<xsl:with-param name="done" select="' '"/>
			</xsl:call-template>
		</xsl:variable>

		<xsl:variable name="schemas-node-set" select="exslt:node-set($mim_schemas)"/>

		<!--
  <xsl:variable name="schemas-done">
    <xsl:for-each select="$schemas-node-set//x">
      <xsl:value-of 
        select="concat(' ',substring-before(substring-after(substring-after(.,'../../data/'),'/'),'/'),' ')"/>
    </xsl:for-each>
  </xsl:variable> -->


		<!-- iterate through all mim schemas extracting the express_ref from the
       intro, arm, mim and extracting the schema name 
  <xsl:for-each select="$schemas-node-set//x">
    <xsl:if test="contains(.,'/mim.xml')">
      <xsl:variable name="module_dir" select="concat(substring-before(.,'/mim.xml'),'/')"/>
      <xsl:variable name="mim_xml" select="document(.)"/>
      <xsl:message>{{<xsl:value-of select="$mim_xml/express/schema/@name"/>}}</xsl:message>
      <xsl:message> 2{{<xsl:apply-templates select="$mim_xml//express_ref" mode="schema_name"/>}}</xsl:message>
      <xsl:if test="$mim_xml/express/@description.file">
        <xsl:variable name="mim_descriptions"
          select="concat($module_dir,$mim_xml/express/@description.file)"/>
        <xsl:message>3{{<xsl:apply-templates select="document($mim_descriptions)//express_ref" mode="schema_name"/>}}</xsl:message>
      </xsl:if>
    </xsl:if>    
  </xsl:for-each> -->

		<xsl:for-each select="$schemas-node-set//x">
			<xsl:sort/>
			<xsl:choose>
				<xsl:when test="substring-before(.,'/mim.xml')">
					<xsl:variable name="module"
						select="substring-after(substring-before(.,'/mim'),'modules/')"/>
					<xsl:variable name="module_ok">
						<xsl:call-template name="check_module_exists">
							<xsl:with-param name="module" select="$module"/>
						</xsl:call-template>
					</xsl:variable>
					<xsl:choose>
						<xsl:when test="$module_ok='true'">
							<xsl:variable name="mod_schema">
								<xsl:call-template name="schema_name">
									<xsl:with-param name="module_name" select="$module"/>
									<xsl:with-param name="arm_mim" select="'mim'"/>
								</xsl:call-template>
							</xsl:variable>
							<xsl:if test="not(contains($modules,concat(' ',$mod_schema,' ')))">
								<module>
									<xsl:attribute name="name">
										<xsl:value-of select="$module"/>
									</xsl:attribute>
								</module>
							</xsl:if>
						</xsl:when>
						<xsl:otherwise>
							<error>
								<xsl:value-of select="$module"/>
							</error>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:when>
				<xsl:otherwise>
					<xsl:variable name="resource"
						select="substring-after(substring-before(.,'.xml'),'../../data/resources/')"/>
					<resource>
						<xsl:attribute name="name">
							<xsl:value-of select="$resource"/>
						</xsl:attribute>
					</resource>
				</xsl:otherwise>
			</xsl:choose>
		</xsl:for-each>

	</xsl:template>


	<xsl:template name="depends-on-recurse-mim-x">
		<xsl:param name="todo" select="' '"/>
		<xsl:param name="done"/>
		<!--
       For each interfaced schema:
       Check if not already done
       Otherwise output and add to todo
       -->
		<xsl:variable name="this-schema"
			select="substring-before(concat(normalize-space($todo),' '),' ')"/>

		<xsl:if test="$this-schema">

			<!-- open up the relevant schema  - which can be a resource or a mim schema -->
			<xsl:variable name="file_name">
				<xsl:choose>
					<xsl:when test="substring-before($this-schema,'_mim')">
						<xsl:value-of
							select="concat('../../data/modules/',substring-before($this-schema,'_mim'),'/mim.xml')"
						/>
					</xsl:when>
					<xsl:when test="substring-before($this-schema,'_schema')">
						<xsl:value-of
							select="concat('../../data/resources/',$this-schema,'/',$this-schema,'.xml')"
						/>
					</xsl:when>
					<xsl:when test="starts-with($this-schema,'aic_')">
						<xsl:value-of
							select="concat('../../data/resources/',$this-schema,'/',$this-schema,'.xml')"
						/>
					</xsl:when>
					<xsl:when test="substring-before($this-schema,'_arm')"> BAD SCHEMA name !!!
							{<xsl:value-of select="$this-schema"/>} </xsl:when>
					<xsl:otherwise>
						<!-- assume that it is a resource -->
						<xsl:message> Found <xsl:value-of select="$this-schema"/> assumed a
							resource. </xsl:message>
						<xsl:value-of
							select="concat('../../data/resources/',$this-schema,'/',$this-schema,'.xml')"
						/>
					</xsl:otherwise>
				</xsl:choose>
			</xsl:variable>

			<xsl:if test="not(contains($done,concat(' ',$this-schema,' ')))">
				<x>
					<xsl:value-of
						select="translate($file_name,'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
      'abcdefghijklmnopqrstuvwxyz')"
					/>
				</x>
			</xsl:if>

			<xsl:variable name="mim-node" select="document($file_name)/express"/>


			<!-- get the list of schemas for this level that have not already been done -->

			<xsl:variable name="my-kids">
				<xsl:if test="not(contains($done,concat(' ',$this-schema,' ')))">
					<xsl:apply-templates select="$mim-node//interface" mode="interface-schemas">
						<xsl:with-param name="done" select="$done"/>
					</xsl:apply-templates>

					<!-- only process mims and search for express_refs-->
					<xsl:if test="substring-before($this-schema,'_mim')">
						<xsl:variable name="module_dir"
							select="concat('../../data/modules/',translate(substring-before($this-schema,'_mim'),'ABCDEFGHIJKLMNOPQRSTUVWXYZ','abcdefghijklmnopqrstuvwxyz'),'/')"/>

						<!-- get the express refs from the mim -->
						<xsl:apply-templates select="$mim-node//express_ref|$mim-node//module_ref"
							mode="schema_name">
							<xsl:with-param name="done" select="$done"/>
						</xsl:apply-templates>
						<xsl:if test="$mim-node/@description.file">
							<xsl:variable name="mim_descriptions"
								select="document(concat($module_dir,$mim-node/@description.file))"/>

							<xsl:apply-templates
								select="$mim_descriptions//express_ref|$mim_descriptions//module_ref"
								mode="schema_name">
								<xsl:with-param name="done" select="$done"/>
							</xsl:apply-templates>
						</xsl:if>

						<!-- get the express refs from the arm -->
						<xsl:variable name="arm-node"
							select="document(concat($module_dir,'arm.xml'))/express"/>
						<xsl:apply-templates select="$arm-node//express_ref|$arm-node//module_ref"
							mode="schema_name">
							<xsl:with-param name="done" select="$done"/>
						</xsl:apply-templates>
						<xsl:if test="$arm-node/@description.file">
							<xsl:variable name="arm_descriptions"
								select="document(concat($module_dir,$arm-node/@description.file))"/>
							<xsl:apply-templates
								select="$arm_descriptions//express_ref|$arm_descriptions//module_ref"
								mode="schema_name">
								<xsl:with-param name="done" select="$done"/>
							</xsl:apply-templates>
						</xsl:if>

						<!-- get the express refs from the module -->
						<xsl:variable name="module-node"
							select="document(concat($module_dir,'module.xml'))"/>
						<xsl:apply-templates
							select="$module-node//express_ref|$module-node//module_ref"
							mode="schema_name">
							<xsl:with-param name="done" select="$done"/>
						</xsl:apply-templates>
					</xsl:if>
				</xsl:if>
			</xsl:variable>

			<xsl:variable name="after"
				select="normalize-space(concat(substring-after($todo, $this-schema),$my-kids))"/>

			<xsl:if test="$after">
				<xsl:call-template name="depends-on-recurse-mim-x">
					<xsl:with-param name="todo" select="$after"/>
					<xsl:with-param name="done" select="concat($done,' ',$this-schema,' ')"/>
				</xsl:call-template>
			</xsl:if>

		</xsl:if>

	</xsl:template>

	<xsl:template match="interface" mode="interface-schemas">
		<xsl:param name="done"/>
		<xsl:variable name="schema" select="concat(' ',@schema,' ')"/>
		<xsl:if test="not(contains($done,$schema))">
			<xsl:value-of select="$schema"/>
		</xsl:if>
	</xsl:template>

	<xsl:template match="module_ref" mode="schema_name">
		<xsl:variable name="schema"
			select="concat(' ',normalize-space(substring-before(@linkend,':')),'_mim ')"/>
		<!--
  <xsl:message>
    <xsl:variable name="root" select="/*"/>
    <xsl:choose>
      <xsl:when test="name($root)='ext_descriptions'">
        <xsl:value-of select="concat('module_ref:',name($root),':',$root/@module_directory,':',$root/@schema_file,':',$schema)"/>
      </xsl:when>
      <xsl:when test="name($root)='module'">
        <xsl:value-of select="concat('module_ref:',name($root),':',$root/@name,':',$schema)"/>
      </xsl:when>
      <xsl:otherwise>
        <xsl:value-of select="concat('module_ref:',name($root),':',$schema)"/>
      </xsl:otherwise>
    </xsl:choose>
  </xsl:message> -->
		<xsl:value-of select="$schema"/>
	</xsl:template>

	<xsl:template match="express_ref" mode="schema_name">
		<xsl:param name="done"/>
		<xsl:variable name="schema"
			select="concat(' ',substring-before(substring-after(substring-after(@linkend,':'),':'),'.'),' ')"/>
		<xsl:variable name="schema1">
			<xsl:choose>
				<xsl:when test="contains($schema,'_arm ')">
					<xsl:value-of select="concat(substring-before($schema,'_arm '),'_mim ')"/>
				</xsl:when>
				<xsl:otherwise>
					<xsl:value-of select="$schema"/>
				</xsl:otherwise>
			</xsl:choose>
		</xsl:variable>
		<xsl:if test="not(contains($done,$schema1))">
			<!--
    <xsl:message>
      <xsl:variable name="root" select="/*"/>
      <xsl:choose>
        <xsl:when test="name($root)='ext_descriptions'">
          <xsl:value-of select="concat('express_ref:',name($root),':',$root/@module_directory,':',$root/@schema_file,':',$schema1)"/>
        </xsl:when>
        <xsl:when test="name($root)='module'">
          <xsl:value-of select="concat('express_ref:',name($root),':',$root/@name,':',$schema1)"/>
        </xsl:when>
        <xsl:otherwise>
          <xsl:value-of select="concat('express_ref:',name($root),':',$schema1)"/>
        </xsl:otherwise>
      </xsl:choose>
    </xsl:message> -->
			<xsl:value-of select="$schema1"/>
		</xsl:if>
	</xsl:template>

	<!-- Generates the style task for generating the publication record for a
     module -->
	<xsl:template match="module" mode="pub_record_style">
		<xsl:variable name="module_file" select="concat('../../data/modules/',@name,'/module.xml')"/>
		<xsl:variable name="module_xml" select="document($module_file)"/>
		<xsl:variable name="CVS_dir_dot_entry" select="concat('CVS_dir_dot_entry_',@name)"/>
		<xsl:variable name="CVS_dir_dvlp_entry" select="concat('CVS_dir_dvlp_entry_',@name)"/>
		<xsl:variable name="CVS_dir_sys_entry" select="concat('CVS_dir_sys_entry_',@name)"/>
		<xsl:variable name="CVS_dir_xsl_entry" select="concat('CVS_dir_xsl_entry_',@name)"/>
		<xsl:variable name="CVS_dir_xslp28xsd_entry"
			select="concat('CVS_dir_xslp28xsd_entry_',@name)"/>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_dot_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('data/modules/',@name,'/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_dvlp_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('data/modules/',@name,'/dvlp/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_sys_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('data/modules/',@name,'/sys/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_xsl_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('xsl','/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_xslp28xsd_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('xsl/p28xsd','/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="xslt">
			<xsl:attribute name="force">yes</xsl:attribute>
			<xsl:attribute name="in">
				<xsl:value-of select="concat('data/modules/',@name,'/module.xml')"/>
			</xsl:attribute>
			<xsl:attribute name="out">
				<xsl:value-of
					select="concat('${TMPDIR}/data/modules/',@name,'/publication_record.xml')"/>
			</xsl:attribute>
			<xsl:attribute name="style">
				<xsl:value-of select="'${STEPMODSTYLES}/publication/pub_record.xsl'"/>
			</xsl:attribute>
			<xsl:attribute name="destdir">
				<xsl:value-of select="'${TMPDIR}'"/>
			</xsl:attribute>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_dot_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_dot_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_dvlp_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_dvlp_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_sys_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_sys_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_xsl_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_xsl_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_xslp28xsd_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_xslp28xsd_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">
					<xsl:value-of select="'CVS_tag'"/>
				</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="'${CVS_tag}'"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">
					<xsl:value-of select="'PUBLICATION_DATE'"/>
				</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="'${PUB_DATE}'"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>
	</xsl:template>

	<!-- Generates the style task for generating the publication record for an
     AP document -->
	<xsl:template match="ap_doc" mode="pub_record_style">
		<xsl:variable name="apdoc_file"
			select="concat('../../data/application_protocols/',@name,'/application_protocol.xml')"/>
		<xsl:variable name="apdoc_xml" select="document($apdoc_file)"/>
		<xsl:variable name="CVS_dir_dot_entry" select="concat('CVS_apdoc_entry_',@name)"/>
		<xsl:variable name="CVS_dir_dvlp_entry" select="concat('CVS_apdoc_dvlp_entry_',@name)"/>
		<xsl:variable name="CVS_dir_sys_entry" select="concat('CVS_apdoc_sys_entry_',@name)"/>
		<xsl:variable name="CVS_dir_xsl_entry" select="concat('CVS_dir_xsl_entry_',@name)"/>
		<xsl:variable name="CVS_dir_xslapdoc_entry" select="concat('CVS_dir_xslapdoc_entry_',@name)"/>
		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_dot_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('data/application_protocols/',@name,'/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_dvlp_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of
					select="concat('data/application_protocols/',@name,'/dvlp/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_sys_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of
					select="concat('data/application_protocols/',@name,'/sys/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_xsl_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('xsl','/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_xslapdoc_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('xsl/ap_doc','/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="xslt">
			<xsl:attribute name="in">
				<xsl:value-of
					select="concat('data/application_protocols/',@name,'/application_protocol.xml')"
				/>
			</xsl:attribute>
			<xsl:attribute name="out">
				<xsl:value-of
					select="concat('${TMPDIR}/data/application_protocols/',@name,'/publication_record.xml')"
				/>
			</xsl:attribute>
			<xsl:attribute name="style">
				<xsl:value-of select="'${STEPMODSTYLES}/publication/pub_record.xsl'"/>
			</xsl:attribute>
			<xsl:attribute name="destdir">
				<xsl:value-of select="'${TMPDIR}'"/>
			</xsl:attribute>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_dot_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_dot_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_dvlp_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_dvlp_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_sys_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_sys_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_xsl_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_xsl_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_xslapdoc_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_xslapdoc_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">
					<xsl:value-of select="'CVS_tag'"/>
				</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="'${CVS_tag}'"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">
					<xsl:value-of select="'PUBLICATION_DATE'"/>
				</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="'${PUB_DATE}'"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>
	</xsl:template>

	<!-- Generates the style task for generating the publication record for a
     resource document -->
	<xsl:template match="res_doc" mode="pub_record_style">
		<xsl:variable name="resdoc_file"
			select="concat('../../data/resource_docs/',@name,'/resource.xml')"/>
		<xsl:variable name="resdoc_xml" select="document($resdoc_file)"/>
		<xsl:variable name="CVS_dir_dot_entry" select="concat('CVS_resdoc_entry_',@name)"/>
		<xsl:variable name="CVS_dir_dvlp_entry" select="concat('CVS_resdoc_dvlp_entry_',@name)"/>
		<xsl:variable name="CVS_dir_sys_entry" select="concat('CVS_resdoc_sys_entry_',@name)"/>
		<xsl:variable name="CVS_dir_xsl_entry" select="concat('CVS_dir_xsl_entry_',@name)"/>
		<xsl:variable name="CVS_dir_xslresdoc_entry"
			select="concat('CVS_dir_xslresdoc_entry_',@name)"/>



		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_dot_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('data/resource_docs/',@name,'/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_dvlp_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('data/resource_docs/',@name,'/dvlp/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_sys_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('data/resource_docs/',@name,'/sys/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_xsl_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('xsl','/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_xslresdoc_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('xsl/res_doc','/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>


		<xsl:element name="xslt">
			<xsl:attribute name="in">
				<xsl:value-of select="concat('data/resource_docs/',@name,'/resource.xml')"/>
			</xsl:attribute>
			<xsl:attribute name="out">
				<xsl:value-of
					select="concat('${TMPDIR}/data/resource_docs/',@name,'/publication_record.xml')"
				/>
			</xsl:attribute>
			<xsl:attribute name="style">
				<xsl:value-of select="'${STEPMODSTYLES}/publication/pub_record.xsl'"/>
			</xsl:attribute>
			<xsl:attribute name="destdir">
				<xsl:value-of select="'${TMPDIR}'"/>
			</xsl:attribute>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_dot_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_dot_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_dvlp_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_dvlp_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_sys_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_sys_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_xsl_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_xsl_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_xslresdoc_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_xslresdoc_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">
					<xsl:value-of select="'CVS_tag'"/>
				</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="'${CVS_tag}'"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">
					<xsl:value-of select="'PUBLICATION_DATE'"/>
				</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="'${PUB_DATE}'"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>
	</xsl:template>

	<!-- Generates the style task for generating the publication record for a
     resource  -->
	<xsl:template match="resource" mode="pub_record_style">

		<xsl:variable name="res_name" select="substring-after(@name,'/')"/>
		<xsl:variable name="res_file"
			select="concat('../../data/resources/',$res_name,'/',$res_name,'.xml')"/>
		<xsl:variable name="res_xml" select="document($res_file)"/>
		<xsl:variable name="CVS_dir_dot_entry" select="concat('CVS_res_entry_',@name)"/>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_dot_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('data/resources/',$res_name,'/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="xslt">
			<xsl:attribute name="in">
				<xsl:value-of select="concat('data/resources/',$res_name,'/',$res_name,'.xml')"/>
			</xsl:attribute>
			<xsl:attribute name="out">
				<xsl:value-of
					select="concat('${TMPDIR}/data/resources/',$res_name,'/publication_record.xml')"
				/>
			</xsl:attribute>
			<xsl:attribute name="style">
				<xsl:value-of select="'${STEPMODSTYLES}/publication/pub_record.xsl'"/>
			</xsl:attribute>
			<xsl:attribute name="destdir">
				<xsl:value-of select="'${TMPDIR}'"/>
			</xsl:attribute>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_dot_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_dot_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">
					<xsl:value-of select="'CVS_tag'"/>
				</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="'${CVS_tag}'"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">
					<xsl:value-of select="'PUBLICATION_DATE'"/>
				</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="'${PUB_DATE}'"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>
	</xsl:template>

	<!-- BOM -->
	<!-- Generates the style task for generating the publication record for a
		bom -->
	<xsl:template match="bom_doc" mode="pub_record_style">
		<xsl:variable name="bom_file"
			select="concat('../../data/business_object_models/',@name,'/business_object_model.xml')"/>
		<xsl:variable name="bom_xml" select="document($bom_file)"/>
		<xsl:variable name="CVS_dir_dot_entry" select="concat('CVS_dir_dot_entry_',@name)"/>
		<xsl:variable name="CVS_dir_dvlp_entry" select="concat('CVS_dir_dvlp_entry_',@name)"/>
		<xsl:variable name="CVS_dir_sys_entry" select="concat('CVS_dir_sys_entry_',@name)"/>
		<xsl:variable name="CVS_dir_xsl_entry" select="concat('CVS_dir_xsl_entry_',@name)"/>
		<xsl:variable name="CVS_dir_xslp28xsd_entry"
			select="concat('CVS_dir_xslp28xsd_entry_',@name)"/>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_dot_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('data/business_object_models/',@name,'/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_dvlp_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of
					select="concat('data/business_object_models/',@name,'/dvlp/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_sys_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of
					select="concat('data/business_object_models/',@name,'/sys/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_xsl_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('xsl','/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_xslp28xsd_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('xsl/p28xsd','/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="xslt">
			<xsl:attribute name="force">yes</xsl:attribute>
			<xsl:attribute name="in">
				<xsl:value-of
					select="concat('data/business_object_models/',@name,'/business_object_model.xml')"
				/>
			</xsl:attribute>
			<xsl:attribute name="out">
				<xsl:value-of
					select="concat('${TMPDIR}/data/business_object_models/',@name,'/publication_record.xml')"
				/>
			</xsl:attribute>
			<xsl:attribute name="style">
				<xsl:value-of select="'${STEPMODSTYLES}/publication/pub_record.xsl'"/>
			</xsl:attribute>
			<xsl:attribute name="destdir">
				<xsl:value-of select="'${TMPDIR}'"/>
			</xsl:attribute>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_dot_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_dot_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_dvlp_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_dvlp_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_sys_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_sys_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_xsl_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_xsl_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_xslp28xsd_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_xslp28xsd_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">
					<xsl:value-of select="'CVS_tag'"/>
				</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="'${CVS_tag}'"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">
					<xsl:value-of select="'PUBLICATION_DATE'"/>
				</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="'${PUB_DATE}'"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>
	</xsl:template>

	<xsl:template name="emb_pub_record_style">
		<xsl:param name="bom_doc_param"/>

		<xsl:variable name="bom_file"
			select="concat('../../data/business_object_models/',$bom_doc_param,'/business_object_model.xml')"/>
		<xsl:variable name="bom_xml" select="document($bom_file)"/>
		<xsl:variable name="CVS_dir_dot_entry" select="concat('CVS_dir_dot_entry_',$bom_doc_param)"/>
		<xsl:variable name="CVS_dir_dvlp_entry"
			select="concat('CVS_dir_dvlp_entry_',$bom_doc_param)"/>
		<xsl:variable name="CVS_dir_sys_entry" select="concat('CVS_dir_sys_entry_',$bom_doc_param)"/>
		<xsl:variable name="CVS_dir_xsl_entry" select="concat('CVS_dir_xsl_entry_',$bom_doc_param)"/>
		<xsl:variable name="CVS_dir_xslp28xsd_entry"
			select="concat('CVS_dir_xslp28xsd_entry_',$bom_doc_param)"/>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_dot_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of
					select="concat('data/business_object_models/',$bom_doc_param,'/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_dvlp_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of
					select="concat('data/business_object_models/',$bom_doc_param,'/dvlp/CVS/Entries')"
				/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_sys_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of
					select="concat('data/business_object_models/',$bom_doc_param,'/sys/CVS/Entries')"
				/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_xsl_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('xsl','/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="loadfile">
			<xsl:attribute name="property">
				<xsl:value-of select="$CVS_dir_xslp28xsd_entry"/>
			</xsl:attribute>
			<xsl:attribute name="srcfile">
				<xsl:value-of select="concat('xsl/p28xsd','/CVS/Entries')"/>
			</xsl:attribute>
		</xsl:element>

		<xsl:element name="xslt">
			<xsl:attribute name="force">yes</xsl:attribute>
			<xsl:attribute name="in">
				<xsl:value-of
					select="concat('data/business_object_models/',$bom_doc_param,'/business_object_model.xml')"
				/>
			</xsl:attribute>
			<xsl:attribute name="out">
				<xsl:value-of
					select="concat('${TMPDIR}/data/business_object_models/',$bom_doc_param,'/publication_record.xml')"
				/>
			</xsl:attribute>
			<xsl:attribute name="style">
				<xsl:value-of select="'${STEPMODSTYLES}/publication/pub_record.xsl'"/>
			</xsl:attribute>
			<xsl:attribute name="destdir">
				<xsl:value-of select="'${TMPDIR}'"/>
			</xsl:attribute>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_dot_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_dot_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_dvlp_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_dvlp_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_sys_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_sys_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_xsl_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_xsl_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">CVS_dir_xslp28xsd_entry</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="concat('${',$CVS_dir_xslp28xsd_entry,'}')"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">
					<xsl:value-of select="'CVS_tag'"/>
				</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="'${CVS_tag}'"/>
				</xsl:attribute>
			</xsl:element>
			<xsl:element name="param">
				<xsl:attribute name="name">
					<xsl:value-of select="'PUBLICATION_DATE'"/>
				</xsl:attribute>
				<xsl:attribute name="expression">
					<xsl:value-of select="'${PUB_DATE}'"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>
	</xsl:template>

	<xsl:template match="publication_index" mode="target_finish">
		<xsl:text>
    </xsl:text>
		<xsl:element name="target">
			<xsl:attribute name="name">finish</xsl:attribute>
			<xsl:attribute name="depends">isoindex</xsl:attribute>
			<xsl:attribute name="description">remove the temporary files and zip the results.</xsl:attribute>

			<xsl:element name="delete">
				<xsl:attribute name="dir">
					<xsl:value-of select="'${TMPDIR}/'"/>
				</xsl:attribute>
			</xsl:element>

			<xsl:element name="zip">
				<xsl:attribute name="zipfile">

					<xsl:choose>
						<xsl:when test="contains(@sc4.working_group,'WG')">
							<xsl:value-of
								select="concat('${PUBDIR}/',@sc4.working_group,'N',@wg.number.publication_set,'_${DATE}.zip')"
							/>
						</xsl:when>
						<xsl:otherwise>
							<xsl:value-of
								select="concat('${PUBDIR}/WG',@sc4.working_group,'N',@wg.number.publication_set,'_${DATE}.zip')"
							/>
						</xsl:otherwise>
					</xsl:choose>
				</xsl:attribute>
				<xsl:attribute name="basedir">
					<xsl:value-of select="'${PUBDIR}/'"/>
				</xsl:attribute>
				<xsl:attribute name="includes">
					<xsl:value-of select="'**'"/>
				</xsl:attribute>
				<xsl:attribute name="excludes">
					<xsl:value-of select="'*.zip, **/Thumbs.db'"/>
				</xsl:attribute>
			</xsl:element>
		</xsl:element>
	</xsl:template>

</xsl:stylesheet>

